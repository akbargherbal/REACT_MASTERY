<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16 App Router Fundamentals</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">05 Next.js ‚Äî Server-Side React</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-16-app-router-fundamentals">Chapter 16: App Router Fundamentals</h1>
<h2 id="file-based-routing">File-based routing</h2>
<h2 id="file-based-routing_1">File-based routing</h2>
<p>Before we dive into Server Components and the architectural revolution they represent, we need to understand how Next.js organizes your application. The App Router uses your file system as your routing configuration‚Äîno separate routing file, no manual route registration, just files and folders.</p>
<p>This isn't just a convenience feature. File-based routing is the foundation that makes Server Components, streaming, and parallel data fetching possible. Understanding this structure is essential before we can explore what makes Next.js different from client-only React.</p>
<h3 id="the-problem-manual-route-configuration-doesnt-scale">The Problem: Manual Route Configuration Doesn't Scale</h3>
<p>In Chapter 14, we built a documentation site with React Router. Every route required explicit configuration:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// React Router approach - manual configuration</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">BrowserRouter</span><span class="p">,</span><span class="w"> </span><span class="nx">Routes</span><span class="p">,</span><span class="w"> </span><span class="nx">Route</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">BrowserRouter</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Routes</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">Home</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">ProductList</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/products/:id&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">ProductDetail</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/cart&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">Cart</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/checkout&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">Checkout</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="cm">/* Add 50 more routes... */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Routes</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">BrowserRouter</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This works, but it creates friction:</p>
<ol>
<li><strong>Disconnected structure</strong>: Routes are defined in one place, components in another</li>
<li><strong>Manual maintenance</strong>: Every new page requires updating the routing configuration</li>
<li><strong>No conventions</strong>: Developers must decide how to organize files</li>
<li><strong>Difficult refactoring</strong>: Moving a route means updating multiple files</li>
</ol>
<p>For a small app, this is manageable. For a large application with hundreds of routes, it becomes a maintenance burden.</p>
<h3 id="nextjs-solution-your-file-system-is-your-router">Next.js Solution: Your File System IS Your Router</h3>
<p>Next.js eliminates the routing configuration file entirely. The structure of your <code>app</code> directory defines your routes automatically.</p>
<p><strong>Project Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">                    </span><span class="c1"># Route: /</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>products/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">               </span><span class="c1"># Route: /products</span>
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">[</span>id<span class="o">]</span>/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">           </span><span class="c1"># Route: /products/:id</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>cart/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">               </span><span class="c1"># Route: /cart</span>
‚îî‚îÄ‚îÄ<span class="w"> </span>checkout/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">               </span><span class="c1"># Route: /checkout</span>
</code></pre></div>

<p>Each <code>page.tsx</code> file automatically becomes a route. The folder structure defines the URL structure. No configuration needed.</p>
<h3 id="reference-implementation-e-commerce-product-catalog">Reference Implementation: E-commerce Product Catalog</h3>
<p>We'll build a product catalog that demonstrates every routing pattern you'll need in production. This will be our anchor example throughout this chapter.</p>
<p><strong>Initial Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">                    </span><span class="c1"># Home page</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>products/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">               </span><span class="c1"># Product listing</span>
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">[</span>id<span class="o">]</span>/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">           </span><span class="c1"># Product detail</span>
‚îî‚îÄ‚îÄ<span class="w"> </span>layout.tsx<span class="w">                 </span><span class="c1"># Root layout (we&#39;ll explore this in 16.3)</span>
</code></pre></div>

<p>Let's start with the home page:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/page.tsx</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">HomePage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-4xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">TechStore</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-lg text-gray-600 mb-8&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Discover</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">latest</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">technology</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">gadgets</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span>
<span class="w">        </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700&quot;</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Browse</span><span class="w"> </span><span class="nx">Products</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Notice: No routing imports, no route configuration. This file exists at <code>app/page.tsx</code>, so it's automatically the home page.</p>
<p>Now the product listing:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/page.tsx</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Hardcoded for now - we&#39;ll fetch real data in Chapter 18</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Wireless Headphones&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Smart Watch&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">299.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Laptop Stand&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">49.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">];</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-6&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;grid grid-cols-1 md:grid-cols-3 gap-6&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded-lg p-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-xl font-semibold mb-2&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span>
<span class="w">              </span><span class="na">href</span><span class="o">=</span><span class="p">{</span><span class="sb">`/products/</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">              </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-blue-600 hover:underline&quot;</span>
<span class="w">            </span><span class="p">&gt;</span>
<span class="w">              </span><span class="nx">View</span><span class="w"> </span><span class="nx">Details</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This file is at <code>app/products/page.tsx</code>, so it's automatically available at <code>/products</code>.</p>
<h3 id="dynamic-routes-the-param-convention">Dynamic Routes: The <code>[param]</code> Convention</h3>
<p>The product detail page needs to handle any product ID. In React Router, we used <code>:id</code>. In Next.js, we use <code>[id]</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">ProductPageProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ProductPageProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// In a real app, we&#39;d fetch the product by ID</span>
<span class="w">  </span><span class="c1">// For now, just display the ID</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Product</span><span class="w"> </span><span class="nx">Details</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;</span><span class="nx">Product</span><span class="w"> </span><span class="nx">ID</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-blue-600 hover:underline mt-4 block&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Products</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Key observations</strong>:</p>
<ol>
<li><strong>Folder name defines the parameter</strong>: <code>[id]</code> becomes <code>params.id</code></li>
<li><strong>Type-safe by default</strong>: TypeScript knows the shape of <code>params</code></li>
<li><strong>No route configuration</strong>: The file structure is the configuration</li>
</ol>
<p><strong>Run the app</strong>:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div>

<p><strong>Browser behavior</strong>:
- Navigate to <code>http://localhost:3000</code> ‚Üí Home page renders
- Click "Browse Products" ‚Üí <code>/products</code> page renders
- Click "View Details" on any product ‚Üí <code>/products/1</code> (or 2, 3) renders
- URL changes, but no full page reload (Next.js handles client-side navigation)</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No errors - everything works)
</code></pre></div>

<p>This is our baseline. Now let's explore what happens when we try to use client-side navigation patterns incorrectly.</p>
<h3 id="the-failure-using-a-tags-causes-full-page-reloads">The Failure: Using <code>&lt;a&gt;</code> Tags Causes Full Page Reloads</h3>
<p>Our current implementation works, but it's not optimal. Let's verify this by watching the Network tab.</p>
<p><strong>Diagnostic Analysis: Reading the Network Evidence</strong></p>
<p><strong>Browser DevTools - Network Tab</strong>:
1. Open DevTools (F12)
2. Go to Network tab
3. Click "Browse Products" link
4. Observe: Full page reload
   - New document request to <code>/products</code>
   - All JavaScript bundles re-downloaded
   - React re-initializes from scratch</p>
<p><strong>Performance Impact</strong>:
- <strong>Before navigation</strong>: Page fully loaded, React hydrated
- <strong>After navigation</strong>: 200-300ms delay while new page loads
- <strong>User experience</strong>: Brief white flash, scroll position lost</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>: </li>
<li>Expected: Instant navigation like a single-page app</li>
<li>
<p>Actual: Brief loading delay, feels like a traditional website</p>
</li>
<li>
<p><strong>What the Network tab reveals</strong>:</p>
</li>
<li>Key indicator: <code>document</code> type request for <code>/products</code></li>
<li>This means: Browser is loading an entirely new HTML page</li>
<li>
<p>Evidence: All assets (JS, CSS) are re-requested</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Using <code>&lt;a href&gt;</code> triggers browser's default navigation behavior</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: HTML <code>&lt;a&gt;</code> tags always cause full page navigation</p>
</li>
<li>
<p><strong>What we need</strong>: Client-side navigation that updates the URL without reloading the page</p>
</li>
</ol>
<h3 id="iteration-1-client-side-navigation-with-link">Iteration 1: Client-Side Navigation with <code>&lt;Link&gt;</code></h3>
<p>Next.js provides a <code>Link</code> component that handles client-side navigation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/page.tsx - Updated with Link</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">HomePage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-4xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">TechStore</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-lg text-gray-600 mb-8&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Discover</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">latest</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">technology</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">gadgets</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span>
<span class="w">        </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700&quot;</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Browse</span><span class="w"> </span><span class="nx">Products</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/page.tsx - Updated with Link</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Wireless Headphones&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Smart Watch&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">299.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Laptop Stand&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">49.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">];</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-6&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;grid grid-cols-1 md:grid-cols-3 gap-6&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded-lg p-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-xl font-semibold mb-2&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span>
<span class="w">              </span><span class="na">href</span><span class="o">=</span><span class="p">{</span><span class="sb">`/products/</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">              </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-blue-600 hover:underline&quot;</span>
<span class="w">            </span><span class="p">&gt;</span>
<span class="w">              </span><span class="nx">View</span><span class="w"> </span><span class="nx">Details</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Updated with Link</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ProductPageProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ProductPageProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Product</span><span class="w"> </span><span class="nx">Details</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;</span><span class="nx">Product</span><span class="w"> </span><span class="nx">ID</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-blue-600 hover:underline mt-4 block&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Products</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>: Rerun the navigation flow with Network tab open.</p>
<p><strong>Browser DevTools - Network Tab</strong> (After fix):
- Click "Browse Products"
- Observe: No document reload
- Only: Small JSON payload fetched (React Server Component payload)
- Size: ~2KB instead of ~200KB full page reload</p>
<p><strong>Performance Metrics</strong>:
- <strong>Before</strong> (with <code>&lt;a&gt;</code>):
  - Navigation time: 200-300ms
  - Data transferred: ~200KB (full page)
  - User experience: Brief white flash</p>
<ul>
<li><strong>After</strong> (with <code>&lt;Link&gt;</code>):</li>
<li>Navigation time: 50-100ms</li>
<li>Data transferred: ~2KB (component data only)</li>
<li>User experience: Instant, smooth transition</li>
</ul>
<p><strong>Expected vs. Actual improvement</strong>: Navigation is now 3-4x faster and feels instant. No white flash, no scroll position loss.</p>
<h3 id="route-organization-patterns">Route Organization Patterns</h3>
<p>Now that we understand basic routing, let's explore how to organize complex applications.</p>
<h4 id="pattern-1-route-groups-organization-without-url-impact">Pattern 1: Route Groups (Organization Without URL Impact)</h4>
<p>Sometimes you want to organize files without affecting URLs. Use parentheses:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="o">(</span>marketing<span class="o">)</span>/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">              </span><span class="c1"># Route: / (not /marketing)</span>
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>about/
‚îÇ<span class="w">   </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Route: /about (not /marketing/about)</span>
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>contact/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Route: /contact</span>
‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">(</span>shop<span class="o">)</span>/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>products/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Route: /products</span>
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>cart/
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Route: /cart</span>
</code></pre></div>

<p>The <code>(marketing)</code> and <code>(shop)</code> folders are purely organizational‚Äîthey don't appear in URLs. This is useful for:
- Grouping related routes
- Applying different layouts to different sections (we'll see this in 16.3)
- Team-based code organization</p>
<h4 id="pattern-2-catch-all-routes">Pattern 2: Catch-All Routes</h4>
<p>For documentation or blog systems, you might need to match multiple path segments:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îî‚îÄ‚îÄ<span class="w"> </span>docs/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">[</span>...slug<span class="o">]</span>/
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Matches /docs/a, /docs/a/b, /docs/a/b/c</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/docs/[...slug]/page.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">DocsPageProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">slug</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span><span class="w">  </span><span class="c1">// Array of path segments</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">DocsPage</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">DocsPageProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// /docs/getting-started ‚Üí params.slug = [&#39;getting-started&#39;]</span>
<span class="w">  </span><span class="c1">// /docs/api/authentication ‚Üí params.slug = [&#39;api&#39;, &#39;authentication&#39;]</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">slug</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Documentation</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;</span><span class="nx">Path</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">path</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="pattern-3-optional-catch-all-routes">Pattern 3: Optional Catch-All Routes</h4>
<p>To match both the base route AND nested routes:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îî‚îÄ‚îÄ<span class="w"> </span>docs/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">[[</span>...slug<span class="o">]]</span>/
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Matches /docs AND /docs/a AND /docs/a/b</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/docs/[[...slug]]/page.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">DocsPageProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">slug?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span><span class="w">  </span><span class="c1">// Optional - might be undefined for /docs</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">DocsPage</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">DocsPageProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">slug</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">slug</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;index&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Documentation</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;</span><span class="nx">Path</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">path</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="special-files-in-the-app-router">Special Files in the App Router</h3>
<p>Beyond <code>page.tsx</code>, Next.js recognizes several special files:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
<th>Example Use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>page.tsx</code></td>
<td>Route UI</td>
<td>The actual page content</td>
</tr>
<tr>
<td><code>layout.tsx</code></td>
<td>Shared UI wrapper</td>
<td>Navigation, footer (covered in 16.3)</td>
</tr>
<tr>
<td><code>loading.tsx</code></td>
<td>Loading UI</td>
<td>Skeleton screens (covered in 16.4)</td>
</tr>
<tr>
<td><code>error.tsx</code></td>
<td>Error UI</td>
<td>Error boundaries (covered in 16.4)</td>
</tr>
<tr>
<td><code>not-found.tsx</code></td>
<td>404 UI</td>
<td>Custom 404 page</td>
</tr>
<tr>
<td><code>route.ts</code></td>
<td>API endpoint</td>
<td>REST API routes (Chapter 19)</td>
</tr>
</tbody>
</table>
<p>We'll explore layouts, loading, and error states in the next sections. For now, understand that these files have special meaning in the App Router.</p>
<h3 id="when-to-apply-file-based-routing-decision-framework">When to Apply: File-Based Routing Decision Framework</h3>
<p><strong>Use file-based routing when</strong>:
- Building a Next.js application (it's the only option)
- You want automatic code splitting per route
- You need server-side rendering or static generation
- You value convention over configuration</p>
<p><strong>Characteristics</strong>:
- <strong>Setup complexity</strong>: Minimal - just create files
- <strong>Maintenance burden</strong>: Low - structure is self-documenting
- <strong>Performance impact</strong>: Positive - automatic optimizations
- <strong>Learning curve</strong>: Gentle - intuitive folder structure</p>
<p><strong>Limitation preview</strong>: File-based routing is powerful, but we haven't addressed how to share UI between routes (navigation, footers) or handle loading/error states. That's what layouts and special files solve, which we'll explore next.</p>
<h2 id="server-components-vs-client-components">Server Components vs. Client Components</h2>
<h2 id="server-components-vs-client-components_1">Server Components vs. Client Components</h2>
<p>Now we reach the architectural revolution that makes Next.js fundamentally different from client-only React. This is not a minor feature‚Äîit's a complete rethinking of how React applications work.</p>
<p>In Chapters 1-15, every React component we wrote ran in the browser. The server sent HTML, JavaScript downloaded, React hydrated, and then your components executed client-side. This is how React has always worked.</p>
<p>Next.js 13+ introduces <strong>React Server Components</strong>: components that run on the server, render to a special format, and never send their code to the browser. This isn't server-side rendering (SSR) in the traditional sense‚Äîit's a new paradigm.</p>
<h3 id="the-problem-everything-runs-in-the-browser">The Problem: Everything Runs in the Browser</h3>
<p>Let's expose the issue by building a product detail page that fetches data:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Client-only approach (WRONG in Next.js)</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// This makes it a Client Component</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">product</span><span class="p">,</span><span class="w"> </span><span class="nx">setProduct</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Product</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/products/</span><span class="si">${</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setProduct</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Product</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">found</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-500&quot;</span><span class="p">&gt;</span><span class="nx">Category</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This is the pattern we learned in Chapter 4. It works, but let's examine what actually happens.</p>
<p><strong>Diagnostic Analysis: Reading the Client-Side Waterfall</strong></p>
<p><strong>Browser DevTools - Network Tab</strong>:
1. Initial page load: <code>/products/1</code>
   - HTML arrives: ~2KB
   - JavaScript bundles: ~180KB (React + our component code)
   - Total time: ~400ms</p>
<ol>
<li>After JavaScript executes:</li>
<li>API request: <code>/api/products/1</code></li>
<li>Response: ~1KB JSON</li>
<li>
<p>Time: ~150ms</p>
</li>
<li>
<p>Total time to interactive: ~550ms</p>
</li>
</ol>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">No</span><span class="w"> </span><span class="n">errors</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">let</span><span class="s1">&#39;s check what loaded)</span>
</code></pre></div>

<p><strong>React DevTools - Components Tab</strong>:
- <code>ProductPage</code> component visible
- State: <code>{ product: null, isLoading: true }</code> initially
- After fetch: <code>{ product: {...}, isLoading: false }</code></p>
<p><strong>View Source</strong> (Right-click ‚Üí View Page Source):</p>
<div class="codehilite"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Loading...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Product information immediately</li>
<li>
<p>Actual: "Loading..." spinner, then content appears</p>
</li>
<li>
<p><strong>What the Network tab reveals</strong>:</p>
</li>
<li>Key indicator: Sequential waterfall (HTML ‚Üí JS ‚Üí API)</li>
<li>JavaScript must download and execute before data fetching begins</li>
<li>
<p>Total blocking time: ~400ms before data fetch even starts</p>
</li>
<li>
<p><strong>What View Source shows</strong>:</p>
</li>
<li>HTML contains only loading state</li>
<li>No product information in initial HTML</li>
<li>
<p>Search engines see "Loading..." (SEO problem)</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Data fetching happens client-side, after JavaScript loads</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: Client Components must wait for JavaScript before they can do anything</p>
</li>
<li>
<p><strong>What we need</strong>: A way to fetch data on the server and send rendered HTML</p>
</li>
</ol>
<h3 id="understanding-the-two-component-types">Understanding the Two Component Types</h3>
<p>Next.js introduces a fundamental distinction:</p>
<p><strong>Server Components</strong> (default):
- Run on the server during the request
- Can directly access databases, file systems, environment variables
- Never send their code to the browser
- Cannot use hooks like <code>useState</code>, <code>useEffect</code>
- Cannot handle browser events</p>
<p><strong>Client Components</strong> (opt-in with <code>'use client'</code>):
- Run in the browser (and during SSR)
- Can use all React hooks
- Can handle user interactions
- Their code is sent to the browser
- Cannot directly access server-only resources</p>
<h3 id="iteration-2-server-component-data-fetching">Iteration 2: Server Component Data Fetching</h3>
<p>Let's rewrite the product page as a Server Component:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Server Component approach</span>
<span class="c1">// NO &#39;use client&#39; directive - this is a Server Component by default</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Simulate database fetch - in production, this would be a real DB query</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// This runs on the server, so we can access environment variables,</span>
<span class="w">  </span><span class="c1">// databases, file systems, etc.</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/products/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Server-side fetch can use secret API keys</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_SECRET_KEY</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to fetch product&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Server Components can be async!</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Fetch data directly in the component</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-500&quot;</span><span class="p">&gt;</span><span class="nx">Category</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Key differences</strong>:</p>
<ol>
<li><strong>No <code>'use client'</code> directive</strong>: Server Component by default</li>
<li><strong><code>async</code> function</strong>: Server Components can be async</li>
<li><strong>Direct data fetching</strong>: No <code>useEffect</code>, no loading state</li>
<li><strong>Server-only code</strong>: Can use <code>process.env</code> directly</li>
</ol>
<p><strong>Verification</strong>: Run the app and check the Network tab.</p>
<p><strong>Browser DevTools - Network Tab</strong> (After fix):
1. Initial page load: <code>/products/1</code>
   - HTML arrives: ~3KB (includes rendered product data)
   - JavaScript bundles: ~120KB (60KB smaller - no fetch logic)
   - Total time: ~200ms</p>
<ol>
<li>No API request needed - data already in HTML</li>
</ol>
<p><strong>View Source</strong> (Right-click ‚Üí View Page Source):</p>
<div class="codehilite"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;</span>Wireless Headphones<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;</span>Premium noise-cancelling headphones...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span>$99.99<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-500&quot;</span><span class="p">&gt;</span>Category: Audio<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<p><strong>Performance Metrics</strong>:
- <strong>Before</strong> (Client Component):
  - Time to interactive: ~550ms
  - JavaScript bundle: ~180KB
  - SEO: Poor (only "Loading..." in HTML)
  - API requests: 1 (client-side)</p>
<ul>
<li><strong>After</strong> (Server Component):</li>
<li>Time to interactive: ~200ms (63% faster)</li>
<li>JavaScript bundle: ~120KB (33% smaller)</li>
<li>SEO: Excellent (full content in HTML)</li>
<li>API requests: 0 (server-side only)</li>
</ul>
<p><strong>Expected vs. Actual improvement</strong>: Page loads 2.75x faster, bundle is 33% smaller, and search engines see full content immediately.</p>
<h3 id="the-failure-trying-to-add-interactivity-to-server-components">The Failure: Trying to Add Interactivity to Server Components</h3>
<p>Our product page now loads fast, but it's completely static. Let's try to add a "Add to Cart" button:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Attempting to add interactivity (WILL FAIL)</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ... same as before</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Try to add click handler</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddToCart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Adding to cart:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-500&quot;</span><span class="p">&gt;</span><span class="nx">Category</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">        </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddToCart</span><span class="p">}</span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-blue-600 text-white px-6 py-3 rounded-lg&quot;</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Add</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Cart</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Event<span class="w"> </span>handlers<span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>passed<span class="w"> </span>to<span class="w"> </span>Client<span class="w"> </span>Component<span class="w"> </span>props.
<span class="w">  </span>&lt;button<span class="w"> </span><span class="nv">onClick</span><span class="o">={</span><span class="k">function</span><span class="o">}</span><span class="w"> </span>...&gt;
<span class="w">                   </span>^^^^^^^^^^
If<span class="w"> </span>you<span class="w"> </span>need<span class="w"> </span>interactivity,<span class="w"> </span>consider<span class="w"> </span>converting<span class="w"> </span>part<span class="w"> </span>of<span class="w"> </span>this<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>Client<span class="w"> </span>Component.
</code></pre></div>

<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the developer experiences</strong>:</li>
<li>Expected: Button with click handler</li>
<li>
<p>Actual: Build error, app won't compile</p>
</li>
<li>
<p><strong>What the error reveals</strong>:</p>
</li>
<li>Key indicator: "Event handlers cannot be passed to Client Component props"</li>
<li>This means: Server Components can't handle browser events</li>
<li>
<p>The button is rendered, but the <code>onClick</code> can't work</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Server Components run on the server, where there are no click events</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: Server Components fundamentally can't handle interactivity</p>
</li>
<li>
<p><strong>What we need</strong>: A way to mix Server Components (for data) with Client Components (for interactivity)</p>
</li>
</ol>
<h3 id="iteration-3-hybrid-architecture-server-client-components">Iteration 3: Hybrid Architecture - Server + Client Components</h3>
<p>The solution is to use Server Components for data fetching and Client Components for interactivity. Let's split our component:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Server Component (data fetching)</span>
<span class="k">import</span><span class="w"> </span><span class="nx">AddToCartButton</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./AddToCartButton&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/products/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_SECRET_KEY</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to fetch product&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Server Component fetches data</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-500 mb-6&quot;</span><span class="p">&gt;</span><span class="nx">Category</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Client Component handles interactivity */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">AddToCartButton</span><span class="w"> </span><span class="na">productId</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">productName</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/AddToCartButton.tsx - Client Component (interactivity)</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// This makes it a Client Component</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">AddToCartButtonProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">productName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">AddToCartButton</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">productId</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">productName</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">AddToCartButtonProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isAdding</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsAdding</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isAdded</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsAdded</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddToCart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsAdding</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Simulate API call</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">500</span><span class="p">));</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Added to cart:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">productId</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setIsAdding</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setIsAdded</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Reset after 2 seconds</span>
<span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsAdded</span><span class="p">(</span><span class="kc">false</span><span class="p">),</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">      </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddToCart</span><span class="p">}</span>
<span class="w">      </span><span class="na">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isAdding</span><span class="p">}</span>
<span class="w">      </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="sb">`px-6 py-3 rounded-lg font-semibold transition-colors </span><span class="si">${</span>
<span class="w">        </span><span class="nx">isAdded</span><span class="w"> </span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;bg-green-600 text-white&#39;</span><span class="w"> </span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-blue-600 text-white hover:bg-blue-700&#39;</span>
<span class="w">      </span><span class="si">}</span><span class="sb"> disabled:opacity-50`</span><span class="p">}</span>
<span class="w">    </span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isAdding</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Adding...&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">isAdded</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Added!&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Add to Cart&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>: Run the app and test the button.</p>
<p><strong>Browser behavior</strong>:
- Page loads with full product data immediately (Server Component)
- Button is interactive (Client Component)
- Click "Add to Cart" ‚Üí Button shows "Adding..." ‚Üí "Added!" ‚Üí back to "Add to Cart"
- Console logs: "Added to cart: 1"</p>
<p><strong>Browser DevTools - Network Tab</strong>:
- Initial load: HTML includes product data
- JavaScript bundle: Only includes <code>AddToCartButton</code> code, not data fetching logic
- Bundle size: ~125KB (still smaller than full client-side approach)</p>
<p><strong>React DevTools - Components Tab</strong>:
- <code>ProductPage</code> not visible (it's a Server Component)
- <code>AddToCartButton</code> visible with state: <code>{ isAdding: false, isAdded: false }</code></p>
<p><strong>Expected vs. Actual improvement</strong>: We now have the best of both worlds‚Äîfast initial load with server-rendered data, plus full interactivity where needed.</p>
<h3 id="the-component-boundary-rules">The Component Boundary Rules</h3>
<p>Understanding where to place the <code>'use client'</code> directive is crucial:</p>
<p><strong>Rule 1: Client boundary is at the top of the file</strong></p>
<p>When you add <code>'use client'</code> to a file, that component and ALL components it imports become Client Components:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// components/ProductCard.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// This file and everything it imports is client-side</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">ProductImage</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ProductImage&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Also becomes Client Component</span>
<span class="k">import</span><span class="w"> </span><span class="nx">ProductPrice</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ProductPrice&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Also becomes Client Component</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductCard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isHovered</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsHovered</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Rule 2: Server Components can import Client Components</strong></p>
<p>This is the key to the hybrid architecture:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/page.tsx - Server Component</span>
<span class="k">import</span><span class="w"> </span><span class="nx">ProductCard</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/ProductCard&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Client Component</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchProducts</span><span class="p">();</span><span class="w">  </span><span class="c1">// Server-side fetch</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ProductCard</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">product</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Rule 3: Client Components CANNOT import Server Components</strong></p>
<p>This would fail:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// components/ProductCard.tsx - Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="nx">ProductDetails</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ProductDetails&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// If this is a Server Component, ERROR</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductCard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Server<span class="w"> </span>Component<span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>imported<span class="w"> </span>into<span class="w"> </span>Client<span class="w"> </span>Component.
</code></pre></div>

<p><strong>Rule 4: But you CAN pass Server Components as props</strong></p>
<p>This works:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// components/Modal.tsx - Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReactNode</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ModalProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="p">;</span><span class="w">  </span><span class="c1">// Can be a Server Component!</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Modal</span><span class="p">({</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ModalProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;modal&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">children</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Server Component</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Modal</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/Modal&#39;</span><span class="p">;</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Server-side fetch</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">Modal</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* This content is a Server Component, passed as children */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">Modal</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="common-failure-modes-and-their-signatures">Common Failure Modes and Their Signatures</h3>
<h4 id="symptom-cannot-use-hooks-in-server-component">Symptom: "Cannot use hooks in Server Component"</h4>
<p><strong>Browser behavior</strong>: Build fails, app won't start</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>useState<span class="w"> </span>can<span class="w"> </span>only<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span><span class="k">in</span><span class="w"> </span>Client<span class="w"> </span>Components.
Add<span class="w"> </span><span class="s1">&#39;use client&#39;</span><span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>top<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>file.
</code></pre></div>

<p><strong>Root cause</strong>: Trying to use <code>useState</code>, <code>useEffect</code>, or other hooks in a Server Component</p>
<p><strong>Solution</strong>: Add <code>'use client'</code> directive to the file, or move the stateful logic to a separate Client Component</p>
<h4 id="symptom-event-handlers-cannot-be-passed-to-client-component-props">Symptom: "Event handlers cannot be passed to Client Component props"</h4>
<p><strong>Browser behavior</strong>: Build fails</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Event<span class="w"> </span>handlers<span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>passed<span class="w"> </span>to<span class="w"> </span>Client<span class="w"> </span>Component<span class="w"> </span>props.
<span class="w">  </span>&lt;button<span class="w"> </span><span class="nv">onClick</span><span class="o">={</span><span class="k">function</span><span class="o">}</span><span class="w"> </span>...&gt;
</code></pre></div>

<p><strong>Root cause</strong>: Trying to pass a function (event handler) from Server Component to Client Component</p>
<p><strong>Solution</strong>: Move the event handler into the Client Component itself</p>
<h4 id="symptom-cannot-access-processenv-in-client-component">Symptom: "Cannot access process.env in Client Component"</h4>
<p><strong>Browser behavior</strong>: <code>process.env.API_KEY</code> is <code>undefined</code> in browser</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">process</span><span class="o">.</span><span class="na">env</span><span class="o">.</span><span class="na">API_KEY</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kc">undefined</span>
</code></pre></div>

<p><strong>Root cause</strong>: Environment variables are not available in Client Components (they run in the browser)</p>
<p><strong>Solution</strong>: 
- Use Server Components for server-only code
- Or prefix with <code>NEXT_PUBLIC_</code> to expose to browser (only for non-secret values)</p>
<h3 id="when-to-apply-server-vs-client-component-decision-framework">When to Apply: Server vs. Client Component Decision Framework</h3>
<p><strong>Use Server Components when</strong>:
- Fetching data from databases or APIs
- Accessing server-only resources (file system, environment variables)
- Keeping sensitive logic on the server (API keys, business logic)
- Reducing JavaScript bundle size
- Improving SEO (content in initial HTML)</p>
<p><strong>Use Client Components when</strong>:
- Using React hooks (<code>useState</code>, <code>useEffect</code>, etc.)
- Handling browser events (<code>onClick</code>, <code>onChange</code>, etc.)
- Using browser-only APIs (<code>localStorage</code>, <code>window</code>, etc.)
- Using libraries that depend on browser APIs</p>
<p><strong>Hybrid approach</strong> (most common):
- Server Component for data fetching and layout
- Client Components for interactive pieces (buttons, forms, modals)
- Pass data from Server to Client via props</p>
<p><strong>Code characteristics</strong>:
- <strong>Server Components</strong>: 
  - Setup complexity: Low
  - Maintenance burden: Low
  - Performance impact: Positive (smaller bundles, faster loads)
  - SEO impact: Positive (content in HTML)</p>
<ul>
<li><strong>Client Components</strong>:</li>
<li>Setup complexity: Low (just add <code>'use client'</code>)</li>
<li>Maintenance burden: Medium (manage state, effects)</li>
<li>Performance impact: Neutral to negative (larger bundles)</li>
<li>Interactivity: Required for user interactions</li>
</ul>
<p><strong>Limitation preview</strong>: We now understand Server and Client Components, but we haven't addressed how to share UI across multiple pages (navigation, footers) or handle loading states during data fetching. That's what layouts and special files solve, which we'll explore next.</p>
<h2 id="layouts-and-templates">Layouts and templates</h2>
<h2 id="layouts-and-templates_1">Layouts and templates</h2>
<p>Every application needs shared UI‚Äînavigation bars, footers, sidebars. In client-only React, we manually wrapped pages with these components. Next.js provides a better way: layouts that automatically wrap all pages in a route segment.</p>
<p>Layouts are Server Components by default, which means they can fetch data once and share it across multiple pages. They also preserve state during navigation, avoiding unnecessary re-renders.</p>
<h3 id="the-problem-repeating-navigation-on-every-page">The Problem: Repeating Navigation on Every Page</h3>
<p>Let's see what happens when we manually add navigation to each page:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/page.tsx - Home page with navigation</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">HomePage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">nav</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-gray-800 text-white p-4&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto flex gap-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/cart&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Cart</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-4xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">TechStore</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-lg text-gray-600&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="nx">Discover</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">latest</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">technology</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">gadgets</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/page.tsx - Products page with navigation</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Wireless Headphones&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Smart Watch&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">299.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Laptop Stand&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">49.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">];</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Exact same navigation code repeated */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">nav</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-gray-800 text-white p-4&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto flex gap-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/cart&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Cart</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-6&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;grid grid-cols-1 md:grid-cols-3 gap-6&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded-lg p-4&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-xl font-semibold mb-2&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span>
<span class="w">                </span><span class="na">href</span><span class="o">=</span><span class="p">{</span><span class="sb">`/products/</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">                </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-blue-600 hover:underline&quot;</span>
<span class="w">              </span><span class="p">&gt;</span>
<span class="w">                </span><span class="nx">View</span><span class="w"> </span><span class="nx">Details</span>
<span class="w">              </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Problems with this approach</strong>:</p>
<ol>
<li><strong>Code duplication</strong>: Navigation code repeated in every page</li>
<li><strong>Maintenance burden</strong>: Update navigation in one place, must update everywhere</li>
<li><strong>Re-render on navigation</strong>: Navigation re-renders even though it hasn't changed</li>
<li><strong>No state preservation</strong>: If navigation had state (e.g., mobile menu open), it would reset on every page change</li>
</ol>
<p><strong>Diagnostic Analysis: Reading the Re-render Evidence</strong></p>
<p><strong>React DevTools - Profiler</strong>:
1. Start recording
2. Navigate from Home to Products
3. Stop recording
4. Observe: Navigation component rendered twice (once for each page)</p>
<p><strong>Browser behavior</strong>:
- Navigate between pages
- Notice: Navigation briefly flickers (re-renders)
- If navigation had animations or state, they would reset</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Navigation stays stable during page transitions</li>
<li>
<p>Actual: Subtle flicker, any navigation state would be lost</p>
</li>
<li>
<p><strong>What React DevTools reveals</strong>:</p>
</li>
<li>Key indicator: Navigation component in both page trees</li>
<li>This means: Navigation is part of each page, not shared</li>
<li>
<p>Evidence: Two separate instances, not one preserved instance</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Navigation is duplicated in each page component</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: Manual duplication can't preserve component instances across routes</p>
</li>
<li>
<p><strong>What we need</strong>: A way to define shared UI once that wraps multiple pages</p>
</li>
</ol>
<h3 id="iteration-4-root-layout">Iteration 4: Root Layout</h3>
<p>Next.js provides <code>layout.tsx</code> files that automatically wrap all pages in their route segment:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/layout.tsx - Root layout (wraps ALL pages)</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;./globals.css&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TechStore&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Your one-stop shop for technology&#39;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">RootLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">html</span><span class="w"> </span><span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="cm">/* Navigation is now defined once */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">nav</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-gray-800 text-white p-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto flex gap-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/cart&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-300&quot;</span><span class="p">&gt;</span><span class="nx">Cart</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">{</span><span class="cm">/* Page content renders here */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">main</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">{</span><span class="cm">/* Footer also defined once */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">footer</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-gray-800 text-white p-4 mt-8&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto text-center&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="err">¬©</span><span class="w"> </span><span class="mf">2025</span><span class="w"> </span><span class="nx">TechStore</span><span class="p">.</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">rights</span><span class="w"> </span><span class="nx">reserved</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now simplify the pages:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/page.tsx - Home page (no navigation needed)</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">HomePage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-4xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">TechStore</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-lg text-gray-600&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Discover</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">latest</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">technology</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">gadgets</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/page.tsx - Products page (no navigation needed)</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Wireless Headphones&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Smart Watch&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">299.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Laptop Stand&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">49.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">];</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-6&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;grid grid-cols-1 md:grid-cols-3 gap-6&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded-lg p-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-xl font-semibold mb-2&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span>
<span class="w">              </span><span class="na">href</span><span class="o">=</span><span class="p">{</span><span class="sb">`/products/</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">              </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-blue-600 hover:underline&quot;</span>
<span class="w">            </span><span class="p">&gt;</span>
<span class="w">              </span><span class="nx">View</span><span class="w"> </span><span class="nx">Details</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>: Navigate between pages and watch React DevTools.</p>
<p><strong>React DevTools - Profiler</strong> (After fix):
1. Start recording
2. Navigate from Home to Products
3. Stop recording
4. Observe: Navigation component NOT in the render (it's preserved)
5. Only the page content (<code>children</code>) re-renders</p>
<p><strong>Browser behavior</strong>:
- Navigate between pages
- Notice: Navigation stays completely stable, no flicker
- Footer also stays stable</p>
<p><strong>Expected vs. Actual improvement</strong>: Navigation and footer no longer re-render during page transitions. Code is defined once, maintained in one place.</p>
<h3 id="nested-layouts-different-sections-different-ui">Nested Layouts: Different Sections, Different UI</h3>
<p>Sometimes different sections of your app need different layouts. For example, a dashboard might have a sidebar, while marketing pages don't.</p>
<p><strong>Project Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îú‚îÄ‚îÄ<span class="w"> </span>layout.tsx<span class="w">                 </span><span class="c1"># Root layout (navigation + footer)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">                   </span><span class="c1"># Home page</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>products/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>layout.tsx<span class="w">            </span><span class="c1"># Products layout (adds breadcrumbs)</span>
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">              </span><span class="c1"># Products list</span>
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">[</span>id<span class="o">]</span>/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Product detail</span>
‚îî‚îÄ‚îÄ<span class="w"> </span>dashboard/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>layout.tsx<span class="w">            </span><span class="c1"># Dashboard layout (adds sidebar)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">              </span><span class="c1"># Dashboard home</span>
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>settings/
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Dashboard settings</span>
</code></pre></div>

<p>Let's add a products layout with breadcrumbs:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/layout.tsx - Products section layout</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Breadcrumbs for products section */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-gray-100 py-2&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">nav</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-600&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-900&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mx-2&quot;</span><span class="p">&gt;</span><span class="o">/</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-900&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Page content */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">children</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now every page under <code>/products</code> automatically gets breadcrumbs:
- <code>/products</code> ‚Üí Home / Products
- <code>/products/1</code> ‚Üí Home / Products (breadcrumbs from layout)</p>
<p><strong>Layout nesting</strong>:
1. Root layout (<code>app/layout.tsx</code>) wraps everything
2. Products layout (<code>app/products/layout.tsx</code>) wraps products pages
3. Page content renders inside both layouts</p>
<p><strong>Visual hierarchy</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;RootLayout&gt;</span><span class="w">           </span>‚Üê<span class="w"> </span>Navigation<span class="w"> </span>+<span class="w"> </span>Footer
<span class="w">  </span><span class="nt">&lt;ProductsLayout&gt;</span><span class="w">     </span>‚Üê<span class="w"> </span>Breadcrumbs
<span class="w">    </span><span class="nt">&lt;ProductsPage</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">   </span>‚Üê<span class="w"> </span>Actual<span class="w"> </span>page<span class="w"> </span>content
<span class="w">  </span><span class="nt">&lt;/ProductsLayout&gt;</span>
<span class="nt">&lt;/RootLayout&gt;</span>
</code></pre></div>

<h3 id="the-failure-layout-re-renders-when-it-shouldnt">The Failure: Layout Re-renders When It Shouldn't</h3>
<p>Let's add a search input to the products layout:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/layout.tsx - With search (PROBLEMATIC)</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Need client component for state</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">search</span><span class="p">,</span><span class="w"> </span><span class="nx">setSearch</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-gray-100 py-2&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 flex justify-between items-center&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">nav</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-600&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-900&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mx-2&quot;</span><span class="p">&gt;</span><span class="o">/</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-900&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">            </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="w">            </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">search</span><span class="p">}</span>
<span class="w">            </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setSearch</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">            </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Search products...&quot;</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;px-3 py-1 border rounded&quot;</span>
<span class="w">          </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">children</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Diagnostic Analysis: Reading the Layout Re-render</strong></p>
<p><strong>Browser behavior</strong>:
1. Navigate to <code>/products</code>
2. Type "headphones" in search box
3. Click on a product to go to <code>/products/1</code>
4. Observe: Search box is empty (state was lost)</p>
<p><strong>React DevTools - Components Tab</strong>:
- Navigate between products pages
- Observe: <code>ProductsLayout</code> component unmounts and remounts
- State resets on every navigation</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Search input preserves text during navigation</li>
<li>
<p>Actual: Search input clears when navigating to product detail</p>
</li>
<li>
<p><strong>What React DevTools reveals</strong>:</p>
</li>
<li>Key indicator: Layout component unmounts/remounts</li>
<li>This means: Layout is treated as part of the page, not preserved</li>
<li>
<p>Evidence: State resets, component tree rebuilds</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Making the layout a Client Component causes it to re-render with each page change</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: Client Component layouts don't preserve state across navigations in the same way Server Component layouts do</p>
</li>
<li>
<p><strong>What we need</strong>: Keep layout as Server Component, move interactive parts to separate Client Components</p>
</li>
</ol>
<h3 id="iteration-5-hybrid-layout-with-client-component">Iteration 5: Hybrid Layout with Client Component</h3>
<p>Extract the search input into its own Client Component:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/SearchBar.tsx - Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">SearchBar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">search</span><span class="p">,</span><span class="w"> </span><span class="nx">setSearch</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">      </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="w">      </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">search</span><span class="p">}</span>
<span class="w">      </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setSearch</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">      </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Search products...&quot;</span>
<span class="w">      </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;px-3 py-1 border rounded&quot;</span>
<span class="w">    </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/layout.tsx - Server Component layout</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/link&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">SearchBar</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./SearchBar&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-gray-100 py-2&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 flex justify-between items-center&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">nav</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-600&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-900&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mx-2&quot;</span><span class="p">&gt;</span><span class="o">/</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/products&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;hover:text-gray-900&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">{</span><span class="cm">/* Client Component for interactivity */</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">SearchBar</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">children</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>: Test the search input across navigation.</p>
<p><strong>Browser behavior</strong>:
1. Navigate to <code>/products</code>
2. Type "headphones" in search box
3. Click on a product to go to <code>/products/1</code>
4. Observe: Search box STILL contains "headphones" (state preserved)</p>
<p><strong>React DevTools - Components Tab</strong>:
- <code>ProductsLayout</code> is not visible (Server Component)
- <code>SearchBar</code> is visible and maintains state across navigations</p>
<p><strong>Expected vs. Actual improvement</strong>: Search input now preserves state during navigation because it's a separate Client Component that Next.js keeps mounted.</p>
<h3 id="templates-when-you-do-want-to-re-render">Templates: When You DO Want to Re-render</h3>
<p>Sometimes you want layout-like behavior but WITH re-rendering on navigation. Use <code>template.tsx</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/template.tsx - Re-renders on every navigation</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsTemplate</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// This runs on EVERY navigation</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Products template mounted&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Example: Reset scroll position</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Example: Track page view</span>
<span class="w">    </span><span class="c1">// analytics.track(&#39;page_view&#39;);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Difference between layout and template</strong>:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th><code>layout.tsx</code></th>
<th><code>template.tsx</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Re-renders on navigation</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Preserves state</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Use for</td>
<td>Navigation, shared UI</td>
<td>Analytics, scroll reset</td>
</tr>
<tr>
<td>Performance</td>
<td>Better (no re-render)</td>
<td>Worse (re-renders)</td>
</tr>
</tbody>
</table>
<p><strong>When to use templates</strong>:
- Resetting scroll position on navigation
- Triggering analytics on every page view
- Animations that should replay on navigation
- Any side effect that should run on every route change</p>
<h3 id="route-groups-with-different-layouts">Route Groups with Different Layouts</h3>
<p>Remember route groups from section 16.1? They're especially useful with layouts:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îú‚îÄ‚îÄ<span class="w"> </span>layout.tsx<span class="w">                 </span><span class="c1"># Root layout (all pages)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="o">(</span>marketing<span class="o">)</span>/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>layout.tsx<span class="w">            </span><span class="c1"># Marketing layout (no sidebar)</span>
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">              </span><span class="c1"># Home (/)</span>
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>about/
‚îÇ<span class="w">   </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># About (/about)</span>
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>contact/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Contact (/contact)</span>
‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">(</span>shop<span class="o">)</span>/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>layout.tsx<span class="w">            </span><span class="c1"># Shop layout (with cart widget)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>products/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Products (/products)</span>
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>cart/
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx<span class="w">          </span><span class="c1"># Cart (/cart)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/(marketing)/layout.tsx - Marketing layout</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">MarketingLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;max-w-4xl mx-auto&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Centered content, no sidebar */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">children</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/(shop)/layout.tsx - Shop layout</span>
<span class="k">import</span><span class="w"> </span><span class="nx">CartWidget</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/CartWidget&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ShopLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Main content */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex-1&quot;</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Sticky cart widget */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">aside</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;w-64 sticky top-0 h-screen&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">CartWidget</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">aside</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now:
- Marketing pages (<code>/</code>, <code>/about</code>, <code>/contact</code>) use centered layout
- Shop pages (<code>/products</code>, <code>/cart</code>) use layout with cart widget
- Both share the root layout (navigation + footer)</p>
<h3 id="metadata-in-layouts">Metadata in Layouts</h3>
<p>Layouts can also define metadata (title, description, Open Graph tags):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/layout.tsx - Root layout with metadata</span>
<span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Metadata</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="kt">Metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TechStore&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">template</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;%s | TechStore&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Page title | TechStore</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Your one-stop shop for technology&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">openGraph</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TechStore&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Your one-stop shop for technology&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">images</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;/og-image.jpg&#39;</span><span class="p">],</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">RootLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">html</span><span class="w"> </span><span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Page with specific metadata</span>
<span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Metadata</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ProductPageProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">generateMetadata</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ProductPageProps</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Metadata</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Fetch product to get title</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">product.name</span><span class="p">,</span><span class="w">  </span><span class="c1">// Uses template: &quot;Wireless Headphones | TechStore&quot;</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">product.description</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ProductPageProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-to-apply-layout-vs-template-decision-framework">When to Apply: Layout vs. Template Decision Framework</h3>
<p><strong>Use <code>layout.tsx</code> when</strong>:
- Defining shared UI (navigation, sidebars, footers)
- You want to preserve state during navigation
- You want to avoid unnecessary re-renders
- Most common use case</p>
<p><strong>Use <code>template.tsx</code> when</strong>:
- You need side effects on every navigation (analytics, scroll reset)
- You want animations to replay on navigation
- You explicitly want state to reset
- Less common, specific use cases</p>
<p><strong>Use route groups when</strong>:
- Different sections need different layouts
- You want to organize code without affecting URLs
- You're building a large app with distinct sections</p>
<p><strong>Code characteristics</strong>:
- <strong>Layouts</strong>:
  - Setup complexity: Low (just create <code>layout.tsx</code>)
  - Maintenance burden: Low (define once, applies to all child routes)
  - Performance impact: Positive (no re-render on navigation)
  - State preservation: Yes</p>
<ul>
<li><strong>Templates</strong>:</li>
<li>Setup complexity: Low (just create <code>template.tsx</code>)</li>
<li>Maintenance burden: Low</li>
<li>Performance impact: Negative (re-renders on every navigation)</li>
<li>State preservation: No</li>
</ul>
<p><strong>Limitation preview</strong>: We now have shared layouts, but we haven't addressed what happens during data fetching (loading states) or when errors occur. That's what special files like <code>loading.tsx</code> and <code>error.tsx</code> solve, which we'll explore next.</p>
<h2 id="loading-and-error-states">Loading and error states</h2>
<h2 id="loading-and-error-states_1">Loading and error states</h2>
<p>In client-only React, we manually managed loading and error states with <code>useState</code> and <code>useEffect</code>. Next.js provides a better way: special files that automatically handle these states at the route level.</p>
<p>This isn't just about convenience‚Äîit enables <strong>streaming</strong>, where parts of your page can load independently, showing content as soon as it's ready rather than waiting for everything.</p>
<h3 id="the-problem-manual-loading-states-dont-scale">The Problem: Manual Loading States Don't Scale</h3>
<p>Let's see what happens when we fetch data without proper loading states:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - No loading state (PROBLEMATIC)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">reviews</span><span class="o">:</span><span class="w"> </span><span class="kt">Review</span><span class="p">[];</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Review</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">rating</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Simulate slow API call</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">2000</span><span class="p">));</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/products/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-8&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Reviews</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;space-y-4&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">reviews</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">review</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">review</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex justify-between mb-2&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;font-semibold&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">author</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-yellow-500&quot;</span><span class="p">&gt;{</span><span class="s1">&#39;‚≠ê&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">review</span><span class="p">.</span><span class="nx">rating</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">comment</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Diagnostic Analysis: Reading the Loading Void</strong></p>
<p><strong>Browser behavior</strong>:
1. Click on a product link
2. Observe: Page goes completely blank
3. Wait 2 seconds (simulated API delay)
4. Observe: Content suddenly appears</p>
<p><strong>Browser DevTools - Network Tab</strong>:
- Request to <code>/products/1</code> starts
- Response takes 2000ms
- During this time: No HTML sent, no content visible
- After 2000ms: Full HTML arrives</p>
<p><strong>User experience</strong>:
- Expected: Some indication that content is loading
- Actual: Blank white screen, no feedback
- User thinks: "Did my click work? Is the site broken?"</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Loading spinner or skeleton screen</li>
<li>
<p>Actual: Blank page for 2 seconds, then content appears</p>
</li>
<li>
<p><strong>What the Network tab reveals</strong>:</p>
</li>
<li>Key indicator: Single large response after 2 seconds</li>
<li>This means: Server waits for ALL data before sending ANY HTML</li>
<li>
<p>Evidence: No progressive rendering, all-or-nothing approach</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Server Component waits for <code>await getProduct()</code> to complete before rendering anything</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: No mechanism to show loading UI while data fetches</p>
</li>
<li>
<p><strong>What we need</strong>: A way to show loading UI immediately while data fetches in the background</p>
</li>
</ol>
<h3 id="iteration-6-loading-ui-with-loadingtsx">Iteration 6: Loading UI with <code>loading.tsx</code></h3>
<p>Next.js provides <code>loading.tsx</code> files that automatically wrap pages in a Suspense boundary:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/loading.tsx - Loading UI</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductLoading</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Skeleton for product details */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;animate-pulse&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-8 bg-gray-200 rounded w-3/4 mb-4&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-4 bg-gray-200 rounded w-full mb-2&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-4 bg-gray-200 rounded w-5/6 mb-4&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-6 bg-gray-200 rounded w-24 mb-8&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">{</span><span class="cm">/* Skeleton for reviews */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-6 bg-gray-200 rounded w-32 mb-4&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;space-y-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-4 bg-gray-200 rounded w-1/4 mb-2&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-4 bg-gray-200 rounded w-full&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>The page component stays the same‚ÄîNext.js automatically shows <code>loading.tsx</code> while the page loads:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Same as before</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">2000</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/products/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ... same rendering code</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>: Click on a product and watch the loading state.</p>
<p><strong>Browser behavior</strong>:
1. Click on a product link
2. Observe: Skeleton screen appears IMMEDIATELY
3. Wait 2 seconds
4. Observe: Skeleton smoothly transitions to actual content</p>
<p><strong>Browser DevTools - Network Tab</strong>:
- Initial HTML arrives immediately (~50ms)
- Contains the loading skeleton
- After 2000ms: Streaming update with actual product data</p>
<p><strong>User experience</strong>:
- Expected: Immediate feedback that something is happening
- Actual: Skeleton screen shows instantly, content loads progressively</p>
<p><strong>Expected vs. Actual improvement</strong>: User sees feedback immediately instead of staring at a blank screen. Perceived performance is much better even though actual load time is the same.</p>
<h3 id="the-failure-slow-component-blocks-everything">The Failure: Slow Component Blocks Everything</h3>
<p>Our product page has two data sources: product details and reviews. Currently, if reviews are slow, the entire page waits:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Everything waits for slowest data</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">500</span><span class="p">));</span><span class="w">  </span><span class="c1">// Fast</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/products/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getReviews</span><span class="p">(</span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Review</span><span class="err">[]</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">3000</span><span class="p">));</span><span class="w">  </span><span class="c1">// SLOW</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/reviews?productId=</span><span class="si">${</span><span class="nx">productId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Both fetches happen sequentially</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">reviews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getReviews</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Product details - ready after 500ms */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-8&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Reviews - not ready until 3500ms (500 + 3000) */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Reviews</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;space-y-4&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">reviews</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">review</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">review</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex justify-between mb-2&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;font-semibold&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">author</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-yellow-500&quot;</span><span class="p">&gt;{</span><span class="s1">&#39;‚≠ê&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">review</span><span class="p">.</span><span class="nx">rating</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">comment</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Diagnostic Analysis: Reading the Sequential Waterfall</strong></p>
<p><strong>Browser DevTools - Network Tab</strong>:
1. Request to <code>/products/1</code> starts
2. Server fetches product (500ms)
3. Server fetches reviews (3000ms)
4. Total time: 3500ms before ANY content appears</p>
<p><strong>Timeline</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="n">ms</span><span class="w">     </span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="w">        </span><span class="kr">Load</span><span class="n">ing</span><span class="w"> </span><span class="n">skeleton</span><span class="w"> </span><span class="n">visible</span>

<span class="mf">500</span><span class="n">ms</span><span class="w">   </span><span class="n">Product</span><span class="w"> </span><span class="kd">data</span><span class="w"> </span><span class="kr">read</span><span class="n">y</span><span class="w"> </span><span class="p">(</span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">shown</span><span class="w"> </span><span class="n">yet</span><span class="p">)</span>

<span class="mf">3500</span><span class="n">ms</span><span class="w">  </span><span class="n">Reviews</span><span class="w"> </span><span class="kd">data</span><span class="w"> </span><span class="kr">read</span><span class="n">y</span>
<span class="w">        </span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="w">        </span><span class="n">Full</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">appears</span>
</code></pre></div>

<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Product details appear quickly, reviews load separately</li>
<li>
<p>Actual: Everything waits for slowest component (reviews)</p>
</li>
<li>
<p><strong>What the Network tab reveals</strong>:</p>
</li>
<li>Key indicator: Single response after 3500ms</li>
<li>This means: Server waits for ALL data before sending ANY content</li>
<li>
<p>Evidence: Product details (ready at 500ms) are held hostage by reviews (ready at 3500ms)</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Sequential <code>await</code> statements block each other</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: Can't show partial content while waiting for slow data</p>
</li>
<li>
<p><strong>What we need</strong>: A way to stream content as it becomes ready</p>
</li>
</ol>
<h3 id="iteration-7-streaming-with-suspense">Iteration 7: Streaming with Suspense</h3>
<p>React's <code>Suspense</code> component allows parts of the page to load independently:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Streaming with Suspense</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Suspense</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">500</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/products/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getReviews</span><span class="p">(</span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Review</span><span class="err">[]</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">3000</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/reviews?productId=</span><span class="si">${</span><span class="nx">productId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Extract reviews into separate component</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductReviews</span><span class="p">({</span><span class="w"> </span><span class="nx">productId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">reviews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getReviews</span><span class="p">(</span><span class="nx">productId</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;space-y-4&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">reviews</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">review</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">review</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex justify-between mb-2&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;font-semibold&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">author</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-yellow-500&quot;</span><span class="p">&gt;{</span><span class="s1">&#39;‚≠ê&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">review</span><span class="p">.</span><span class="nx">rating</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">comment</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Loading fallback for reviews</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">ReviewsSkeleton</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;space-y-4 animate-pulse&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-4 bg-gray-200 rounded w-1/4 mb-2&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;h-4 bg-gray-200 rounded w-full&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Only wait for product details</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Product details - shows after 500ms */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-8&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Reviews - streams in after 3000ms */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Reviews</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">ReviewsSkeleton</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ProductReviews</span><span class="w"> </span><span class="na">productId</span><span class="o">=</span><span class="p">{</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>: Click on a product and watch the streaming behavior.</p>
<p><strong>Browser behavior</strong>:
1. Click on a product link
2. Observe: Page skeleton appears immediately
3. After 500ms: Product details appear, reviews show skeleton
4. After 3000ms more: Reviews appear</p>
<p><strong>Browser DevTools - Network Tab</strong>:
- Initial HTML arrives at ~500ms (with product details)
- Streaming update arrives at ~3500ms (with reviews)
- Two separate chunks, not one monolithic response</p>
<p><strong>Timeline</strong> (After fix):</p>
<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="n">ms</span><span class="w">     </span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="w">        </span><span class="kr">Load</span><span class="n">ing</span><span class="w"> </span><span class="n">skeleton</span><span class="w"> </span><span class="n">visible</span>

<span class="mf">500</span><span class="n">ms</span><span class="w">   </span><span class="n">Product</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="err">‚úì</span>
<span class="w">        </span><span class="n">Reviews</span><span class="w"> </span><span class="n">skeleton</span><span class="w"> </span><span class="n">visible</span>

<span class="mf">3500</span><span class="n">ms</span><span class="w">  </span><span class="n">Reviews</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="err">‚úì</span>
<span class="w">        </span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
</code></pre></div>

<p><strong>Performance Metrics</strong>:
- <strong>Before</strong> (no Suspense):
  - Time to first content: 3500ms
  - User sees: Nothing until everything is ready</p>
<ul>
<li><strong>After</strong> (with Suspense):</li>
<li>Time to first content: 500ms (7x faster)</li>
<li>Time to full content: 3500ms (same)</li>
<li>User sees: Product details immediately, reviews load progressively</li>
</ul>
<p><strong>Expected vs. Actual improvement</strong>: User can start reading product details 3 seconds earlier. Perceived performance is dramatically better.</p>
<h3 id="error-handling-with-errortsx">Error Handling with <code>error.tsx</code></h3>
<p>Just like <code>loading.tsx</code>, Next.js provides <code>error.tsx</code> for automatic error boundaries:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/error.tsx - Error UI</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Error components must be Client Components</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductError</span><span class="p">({</span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reset</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Log error to error reporting service</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Product page error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-red-50 border border-red-200 rounded-lg p-6&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold text-red-800 mb-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="nx">Something</span><span class="w"> </span><span class="nx">went</span><span class="w"> </span><span class="nx">wrong</span><span class="o">!</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-red-600 mb-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Failed to load product&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700&quot;</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's simulate an error:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - With error handling</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">500</span><span class="p">));</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.example.com/products/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Product not found&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// If this throws, error.tsx catches it</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-8&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>: Navigate to a non-existent product (e.g., <code>/products/999</code>).</p>
<p><strong>Browser behavior</strong>:
1. Navigate to <code>/products/999</code>
2. Observe: Loading skeleton appears
3. After 500ms: Error UI appears with "Product not found" message
4. Click "Try again" ‚Üí Retries the request</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Product page error: Error: Product not found
    at getProduct (page.tsx:8)
</code></pre></div>

<p><strong>React DevTools - Components Tab</strong>:
- <code>ProductError</code> component visible
- Props: <code>{ error: Error, reset: function }</code></p>
<h3 id="error-boundaries-at-different-levels">Error Boundaries at Different Levels</h3>
<p>You can have error boundaries at multiple levels:</p>
<div class="codehilite"><pre><span></span><code>app/
‚îú‚îÄ‚îÄ<span class="w"> </span>error.tsx<span class="w">                  </span><span class="c1"># Catches errors in entire app</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>products/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>error.tsx<span class="w">             </span><span class="c1"># Catches errors in products section</span>
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="o">[</span>id<span class="o">]</span>/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>error.tsx<span class="w">         </span><span class="c1"># Catches errors in specific product</span>
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>page.tsx
</code></pre></div>

<p>More specific error boundaries take precedence. This allows you to:
- Show generic error UI at the root level
- Show section-specific error UI (e.g., "Products unavailable")
- Show page-specific error UI (e.g., "Product not found")</p>
<h3 id="the-failure-error-in-suspense-boundary">The Failure: Error in Suspense Boundary</h3>
<p>What happens when a component inside <code>Suspense</code> throws an error?</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - Error in Suspense boundary</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductReviews</span><span class="p">({</span><span class="w"> </span><span class="nx">productId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">reviews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getReviews</span><span class="p">(</span><span class="nx">productId</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">reviews</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;No reviews available&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;space-y-4&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">reviews</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">review</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">review</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex justify-between mb-2&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;font-semibold&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">author</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-yellow-500&quot;</span><span class="p">&gt;{</span><span class="s1">&#39;‚≠ê&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">review</span><span class="p">.</span><span class="nx">rating</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;{</span><span class="nx">review</span><span class="p">.</span><span class="nx">comment</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-8&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Reviews</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">ReviewsSkeleton</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ProductReviews</span><span class="w"> </span><span class="na">productId</span><span class="o">=</span><span class="p">{</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser behavior</strong>:
1. Navigate to product with no reviews
2. Observe: Product details appear
3. Observe: Reviews section shows error UI from <code>error.tsx</code>
4. Product details remain visible (not affected by reviews error)</p>
<p><strong>Key insight</strong>: Errors inside <code>Suspense</code> boundaries are caught by the nearest error boundary, but don't affect sibling content. This is <strong>error isolation</strong>‚Äîone failing component doesn't crash the entire page.</p>
<h3 id="iteration-8-granular-error-boundaries">Iteration 8: Granular Error Boundaries</h3>
<p>For better error isolation, wrap Suspense boundaries in their own error handlers:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/ReviewsErrorBoundary.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ReviewsErrorBoundary</span><span class="p">({</span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reset</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">;</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;border border-red-200 rounded-lg p-4 bg-red-50&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-red-600 mb-2&quot;</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">reviews</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">        </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}</span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-red-600 hover:text-red-800 underline&quot;</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/products/[id]/page.tsx - With granular error boundary</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Suspense</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-error-boundary&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">ReviewsErrorBoundary</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReviewsErrorBoundary&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductPage</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;container mx-auto px-4 py-8&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-3xl font-bold mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 mb-4&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-8&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold mb-4&quot;</span><span class="p">&gt;</span><span class="nx">Reviews</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="w"> </span><span class="na">FallbackComponent</span><span class="o">=</span><span class="p">{</span><span class="nx">ReviewsErrorBoundary</span><span class="p">}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">ReviewsSkeleton</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">ProductReviews</span><span class="w"> </span><span class="na">productId</span><span class="o">=</span><span class="p">{</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now reviews errors show a small inline error message instead of replacing the entire page.</p>
<h3 id="common-failure-modes-and-their-signatures_1">Common Failure Modes and Their Signatures</h3>
<h4 id="symptom-entire-page-shows-loading-state-for-too-long">Symptom: Entire page shows loading state for too long</h4>
<p><strong>Browser behavior</strong>: Loading skeleton visible for 5+ seconds</p>
<p><strong>Network tab</strong>: Single large response after long delay</p>
<p><strong>Root cause</strong>: Not using Suspense to stream slow components</p>
<p><strong>Solution</strong>: Wrap slow components in <code>Suspense</code> boundaries</p>
<h4 id="symptom-error-in-one-component-crashes-entire-page">Symptom: Error in one component crashes entire page</h4>
<p><strong>Browser behavior</strong>: Whole page replaced with error UI</p>
<p><strong>React DevTools</strong>: Error boundary at root level caught the error</p>
<p><strong>Root cause</strong>: No granular error boundaries</p>
<p><strong>Solution</strong>: Add <code>error.tsx</code> files at appropriate route segments, or use <code>ErrorBoundary</code> components</p>
<h4 id="symptom-loading-state-never-disappears">Symptom: Loading state never disappears</h4>
<p><strong>Browser behavior</strong>: Skeleton screen stays forever</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">suspended</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">responding</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">synchronous</span><span class="w"> </span><span class="n">input</span><span class="o">.</span>
</code></pre></div>

<p><strong>Root cause</strong>: Component inside Suspense is stuck (infinite loop, never resolves)</p>
<p><strong>Solution</strong>: Check async function for proper error handling and resolution</p>
<h3 id="when-to-apply-loading-and-error-state-decision-framework">When to Apply: Loading and Error State Decision Framework</h3>
<p><strong>Use <code>loading.tsx</code> when</strong>:
- You want automatic loading UI for an entire route segment
- You're okay with the same loading UI for all pages in that segment
- You want the simplest possible setup</p>
<p><strong>Use <code>Suspense</code> when</strong>:
- You want to stream different parts of the page independently
- You have slow and fast data sources on the same page
- You want granular control over loading states
- You want to show partial content while other parts load</p>
<p><strong>Use <code>error.tsx</code> when</strong>:
- You want automatic error handling for an entire route segment
- You want consistent error UI across multiple pages
- You want the simplest possible setup</p>
<p><strong>Use <code>ErrorBoundary</code> when</strong>:
- You want granular error handling for specific components
- You want different error UIs for different failures
- You want to isolate errors (one component fails, others stay)</p>
<p><strong>Code characteristics</strong>:
- <strong><code>loading.tsx</code></strong>:
  - Setup complexity: Minimal (just create file)
  - Granularity: Route segment level
  - Performance impact: Positive (shows feedback immediately)</p>
<ul>
<li><strong><code>Suspense</code></strong>:</li>
<li>Setup complexity: Low (wrap components)</li>
<li>Granularity: Component level</li>
<li>
<p>Performance impact: Very positive (streaming, progressive rendering)</p>
</li>
<li>
<p><strong><code>error.tsx</code></strong>:</p>
</li>
<li>Setup complexity: Minimal (just create file)</li>
<li>Granularity: Route segment level</li>
<li>
<p>Error isolation: Moderate</p>
</li>
<li>
<p><strong><code>ErrorBoundary</code></strong>:</p>
</li>
<li>Setup complexity: Low (wrap components)</li>
<li>Granularity: Component level</li>
<li>Error isolation: Excellent</li>
</ul>
<h3 id="the-complete-journey-from-blank-screen-to-streaming">The Complete Journey: From Blank Screen to Streaming</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Problem</th>
<th>Solution</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Blank screen during load</td>
<td>None</td>
<td>Poor UX, no feedback</td>
</tr>
<tr>
<td>6</td>
<td>Need loading feedback</td>
<td><code>loading.tsx</code></td>
<td>Skeleton screen</td>
</tr>
<tr>
<td>7</td>
<td>Slow component blocks page</td>
<td><code>Suspense</code></td>
<td>Progressive rendering</td>
</tr>
<tr>
<td>8</td>
<td>Error crashes entire page</td>
<td>Granular error boundaries</td>
<td>Error isolation</td>
</tr>
</tbody>
</table>
<p><strong>Final Implementation</strong>: Our product page now:
- Shows loading skeleton immediately
- Streams product details as soon as ready (500ms)
- Streams reviews independently (3500ms)
- Handles errors gracefully without crashing the page
- Provides excellent perceived performance</p>
<p><strong>Decision Framework</strong>: When building a page:
1. Start with <code>loading.tsx</code> for basic loading UI
2. Add <code>Suspense</code> for components with slow data
3. Add <code>error.tsx</code> for route-level error handling
4. Add granular <code>ErrorBoundary</code> for critical components that should fail independently</p>
<p><strong>Lessons Learned</strong>:
- Loading states are not optional‚Äîthey're essential for good UX
- Streaming with Suspense dramatically improves perceived performance
- Error boundaries prevent one failure from crashing the entire app
- Granular boundaries (both Suspense and error) provide the best user experience</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 12:33:28 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>