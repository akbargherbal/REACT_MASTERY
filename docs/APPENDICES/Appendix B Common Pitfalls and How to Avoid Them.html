<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appendix B Common Pitfalls and How to Avoid Them</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">APPENDICES</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-appendix-b-common-pitfalls-and-how-to-avoid-them">Chapter Appendix B: Common Pitfalls and How to Avoid Them</h1>
<h2 id="introduction-the-catalog-of-failure">Introduction: The Catalog of Failure</h2>
<p>This appendix is your field guide to the most common ways React applications fail. Unlike the chapter-by-chapter progression where we built understanding through controlled failures, this is a reference catalog‚Äîorganized by symptom, not by concept.</p>
<p>When your application breaks, you don't think "I need to review Chapter 4 on useEffect." You think "Why is my component rendering infinitely?" or "Why isn't my state updating?" This appendix meets you at that moment of confusion.</p>
<h2 id="how-to-use-this-catalog">How to Use This Catalog</h2>
<p>Each pitfall follows this structure:</p>
<ol>
<li><strong>Symptom</strong>: What you observe in the browser</li>
<li><strong>Browser Evidence</strong>: Console output, DevTools observations, Network tab patterns</li>
<li><strong>Root Cause</strong>: The underlying mechanism causing the failure</li>
<li><strong>The Trap</strong>: Why this mistake is so common</li>
<li><strong>The Fix</strong>: Concrete solution with before/after code</li>
<li><strong>Prevention</strong>: How to avoid this in the future</li>
</ol>
<p><strong>Reference Implementation</strong>: Throughout this appendix, we'll use a <code>TaskManager</code> component as our recurring example‚Äîa realistic application that manages tasks with filtering, sorting, and real-time updates. This gives us a consistent context for demonstrating each pitfall.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - Our reference implementation</span>
<span class="c1">// We&#39;ll show how various pitfalls manifest in this component</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sortBy</span><span class="p">,</span><span class="w"> </span><span class="nx">setSortBy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="s1">&#39;date&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;priority&#39;</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// We&#39;ll see this component fail in many ways...</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span><span class="na">filter</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span><span class="w"> </span><span class="na">onFilterChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setFilter</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="state-management-pitfalls">State Management Pitfalls</h2>
<h2 id="pitfall-1-the-stale-closure-trap">Pitfall 1: The Stale Closure Trap</h2>
<h3 id="symptom">Symptom</h3>
<p>Event handlers or callbacks reference old state values even after state updates. Clicking a button multiple times shows the same old value in the console, or operations use outdated data.</p>
<h3 id="browser-evidence">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Current count: 0
Current count: 0
Current count: 0
// Expected: 0, 1, 2
</code></pre></div>

<p><strong>React DevTools - Components Tab</strong>:
- State shows correct value: <code>count: 3</code>
- But console logs show: <code>0, 0, 0</code>
- Indicates closure captured old state</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Stale closure in setTimeout</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">autoSaveEnabled</span><span class="p">,</span><span class="w"> </span><span class="nx">setAutoSaveEnabled</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">setTasks</span><span class="p">([...</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">newTask</span><span class="p">]);</span>

<span class="w">    </span><span class="c1">// Auto-save after 2 seconds</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">autoSaveEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// BUG: This captures the current `tasks` array</span>
<span class="w">        </span><span class="c1">// When setTimeout fires, it uses the OLD tasks array</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Saving tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">tasks</span><span class="p">);</span>
<span class="w">        </span><span class="nx">saveTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span><span class="w"> </span><span class="c1">// Saves stale data!</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause">Root Cause</h3>
<p>JavaScript closures capture variables from their surrounding scope at the time the function is created. When <code>setTimeout</code> creates its callback, it captures the current value of <code>tasks</code>. Even though <code>tasks</code> changes later, the callback still references the old array.</p>
<p>This is the <strong>closure trap</strong>: asynchronous operations (setTimeout, setInterval, event listeners, promises) capture state at creation time, not execution time.</p>
<h3 id="the-trap">The Trap</h3>
<p>This feels like it should work because:
1. The state update happens immediately: <code>setTasks([...tasks, newTask])</code>
2. The setTimeout is created after the update
3. You expect it to "see" the new state</p>
<p>But React state updates are asynchronous, and the closure captures the value at the moment the function is defined, not when it executes.</p>
<h3 id="the-fix-use-functional-updates">The Fix: Use Functional Updates</h3>
<p>When you need the latest state inside an async operation, use the functional form of setState:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Functional update</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">autoSaveEnabled</span><span class="p">,</span><span class="w"> </span><span class="nx">setAutoSaveEnabled</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">prevTasks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[...</span><span class="nx">prevTasks</span><span class="p">,</span><span class="w"> </span><span class="nx">newTask</span><span class="p">]);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">autoSaveEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Use functional update to get latest state</span>
<span class="w">        </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">currentTasks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Saving tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">currentTasks</span><span class="p">);</span>
<span class="w">          </span><span class="nx">saveTasks</span><span class="p">(</span><span class="nx">currentTasks</span><span class="p">);</span><span class="w"> </span><span class="c1">// Always has latest data</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nx">currentTasks</span><span class="p">;</span><span class="w"> </span><span class="c1">// No change, just reading</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="alternative-use-useref-for-reading-latest-state">Alternative: Use useRef for Reading Latest State</h3>
<p>If you need to read state without triggering updates:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - Alternative: useRef</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasksRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Keep ref in sync with state</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tasksRef</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">setTasks</span><span class="p">([...</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">newTask</span><span class="p">]);</span>

<span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// tasksRef.current always has the latest value</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Saving tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">tasksRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="w">      </span><span class="nx">saveTasks</span><span class="p">(</span><span class="nx">tasksRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="prevention">Prevention</h3>
<ol>
<li><strong>Default to functional updates</strong> when the new state depends on the old state</li>
<li><strong>Use useRef</strong> for values you need to read in async operations but don't need to trigger re-renders</li>
<li><strong>Avoid capturing state</strong> in setTimeout/setInterval‚Äîuse refs or functional updates</li>
<li><strong>ESLint rule</strong>: Enable <code>react-hooks/exhaustive-deps</code> to catch some closure issues</li>
</ol>
<hr />
<h2 id="pitfall-2-mutating-state-directly">Pitfall 2: Mutating State Directly</h2>
<h3 id="symptom_1">Symptom</h3>
<p>State appears to update in React DevTools, but the component doesn't re-render. Or the component re-renders, but the UI shows stale data. Arrays or objects seem to "lose" updates.</p>
<h3 id="browser-evidence_1">Browser Evidence</h3>
<p><strong>React DevTools - Components Tab</strong>:
- State value changes: <code>tasks: Array(5)</code> ‚Üí <code>tasks: Array(6)</code>
- But component doesn't re-render
- Or renders but shows old data</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>State before: [{ id: &#39;1&#39;, title: &#39;Task 1&#39;, completed: false }]
State after: [{ id: &#39;1&#39;, title: &#39;Task 1&#39;, completed: false }]
// Expected: completed: true
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Direct mutation</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleToggleTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">taskId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// BUG: Mutating the array directly</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">taskId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span><span class="w"> </span><span class="c1">// Direct mutation!</span>
<span class="w">      </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span><span class="w"> </span><span class="c1">// Same reference, React won&#39;t re-render</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// BUG: Mutating the array directly</span>
<span class="w">    </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newTask</span><span class="p">);</span><span class="w"> </span><span class="c1">// Direct mutation!</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span><span class="w"> </span><span class="c1">// Same reference, React won&#39;t re-render</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="na">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">handleToggleTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_1">Root Cause</h3>
<p>React uses <strong>reference equality</strong> to detect state changes. When you call <code>setTasks(tasks)</code> with the same array reference, React thinks nothing changed and skips the re-render.</p>
<p>Even if you mutate the array's contents, the array reference itself is the same:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">];</span>
<span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span><span class="w"> </span><span class="c1">// Mutates the array</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span><span class="w"> </span><span class="c1">// [1, 2, 3, 4]</span>
<span class="c1">// But `arr` is still the same reference!</span>
</code></pre></div>

<h3 id="the-trap_1">The Trap</h3>
<p>This feels natural because:
1. In regular JavaScript, you mutate arrays and objects all the time
2. The mutation "works"‚Äîthe data changes
3. React DevTools shows the new value
4. But React's reconciliation never triggers</p>
<h3 id="the-fix-create-new-references">The Fix: Create New References</h3>
<p>Always create new arrays/objects when updating state:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Immutable updates</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleToggleTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">taskId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Create a new array with the updated task</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">prevTasks</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">prevTasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">taskId</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// New object</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Create a new array with the new task</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">prevTasks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[...</span><span class="nx">prevTasks</span><span class="p">,</span><span class="w"> </span><span class="nx">newTask</span><span class="p">]);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDeleteTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">taskId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Create a new array without the deleted task</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">prevTasks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prevTasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">taskId</span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleUpdateTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">taskId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="p">&lt;</span><span class="nt">Task</span><span class="p">&gt;)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Create a new array with the updated task</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">prevTasks</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">prevTasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">taskId</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Merge updates into new object</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span>
<span class="w">        </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="na">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">handleToggleTask</span><span class="p">}</span>
<span class="w">        </span><span class="na">onDelete</span><span class="o">=</span><span class="p">{</span><span class="nx">handleDeleteTask</span><span class="p">}</span>
<span class="w">        </span><span class="na">onUpdate</span><span class="o">=</span><span class="p">{</span><span class="nx">handleUpdateTask</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="common-immutable-update-patterns">Common Immutable Update Patterns</h3>
<p><strong>Arrays</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Add item</span>
<span class="nx">setItems</span><span class="p">([...</span><span class="nx">items</span><span class="p">,</span><span class="w"> </span><span class="nx">newItem</span><span class="p">]);</span>
<span class="nx">setItems</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">newItem</span><span class="p">));</span>

<span class="c1">// Remove item</span>
<span class="nx">setItems</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">idToRemove</span><span class="p">));</span>

<span class="c1">// Update item</span>
<span class="nx">setItems</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">idToUpdate</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">item</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="nx">item</span>
<span class="p">));</span>

<span class="c1">// Insert at index</span>
<span class="nx">setItems</span><span class="p">([</span>
<span class="w">  </span><span class="p">...</span><span class="nx">items</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">),</span>
<span class="w">  </span><span class="nx">newItem</span><span class="p">,</span>
<span class="w">  </span><span class="p">...</span><span class="nx">items</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span>
<span class="p">]);</span>

<span class="c1">// Replace at index</span>
<span class="nx">setItems</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">i</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">newItem</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">item</span>
<span class="p">));</span>
</code></pre></div>

<p><strong>Objects</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Update property</span>
<span class="nx">setUser</span><span class="p">({</span><span class="w"> </span><span class="p">...</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;New Name&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Update nested property</span>
<span class="nx">setUser</span><span class="p">({</span>
<span class="w">  </span><span class="p">...</span><span class="nx">user</span><span class="p">,</span>
<span class="w">  </span><span class="nx">address</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
<span class="w">    </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;New City&#39;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Add property</span>
<span class="nx">setUser</span><span class="p">({</span><span class="w"> </span><span class="p">...</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">newProp</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Remove property</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">propToRemove</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">rest</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="p">;</span>
<span class="nx">setUser</span><span class="p">(</span><span class="nx">rest</span><span class="p">);</span>
</code></pre></div>

<h3 id="prevention_1">Prevention</h3>
<ol>
<li><strong>Never mutate state directly</strong>‚Äîalways create new references</li>
<li><strong>Use spread operators</strong> (<code>...</code>) for shallow copies</li>
<li><strong>Use <code>.map()</code>, <code>.filter()</code>, <code>.concat()</code></strong> instead of <code>.push()</code>, <code>.splice()</code>, <code>.pop()</code></li>
<li><strong>For deep updates</strong>, consider Immer library (used by Redux Toolkit)</li>
<li><strong>TypeScript</strong>: Use <code>readonly</code> arrays to catch mutations at compile time</li>
</ol>
<hr />
<h2 id="pitfall-3-batching-confusion-and-multiple-setstate-calls">Pitfall 3: Batching Confusion and Multiple setState Calls</h2>
<h3 id="symptom_2">Symptom</h3>
<p>Multiple state updates in the same function seem to "lose" some updates, or the component renders fewer times than expected. Or in React 18+, updates that used to batch now don't.</p>
<h3 id="browser-evidence_2">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Render</span><span class="w"> </span><span class="nv">count</span>:<span class="w"> </span><span class="mi">1</span>
<span class="o">//</span><span class="w"> </span><span class="nv">Expected</span>:<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ss">(</span><span class="nv">one</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">setState</span><span class="ss">)</span>
</code></pre></div>

<p><strong>React DevTools - Profiler</strong>:
- Shows 1 render instead of 3
- All state updates applied in single commit</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - Understanding batching</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sortBy</span><span class="p">,</span><span class="w"> </span><span class="nx">setSortBy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="s1">&#39;date&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;priority&#39;</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">renderCount</span><span class="p">,</span><span class="w"> </span><span class="nx">setRenderCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setRenderCount</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Render count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">renderCount</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleResetFilters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// In React 18+, these are automatically batched</span>
<span class="w">    </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setSortBy</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">([]);</span>
<span class="w">    </span><span class="c1">// Only 1 re-render, not 3!</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAsyncReset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchTasks</span><span class="p">();</span><span class="w"> </span><span class="c1">// Async operation</span>

<span class="w">    </span><span class="c1">// In React 17, these would NOT be batched (3 renders)</span>
<span class="w">    </span><span class="c1">// In React 18+, these ARE batched (1 render)</span>
<span class="w">    </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setSortBy</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">([]);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleResetFilters</span><span class="p">}&gt;</span><span class="nx">Reset</span><span class="w"> </span><span class="nx">Filters</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAsyncReset</span><span class="p">}&gt;</span><span class="nx">Async</span><span class="w"> </span><span class="nx">Reset</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Render</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">renderCount</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_2">Root Cause</h3>
<p><strong>React 18+ Automatic Batching</strong>: React automatically batches multiple state updates into a single re-render, even in async functions, timeouts, and event handlers. This is a performance optimization.</p>
<p><strong>React 17 Batching</strong>: Only batched updates inside React event handlers. Updates in promises, setTimeout, or native event handlers were not batched.</p>
<h3 id="the-trap_2">The Trap</h3>
<p>This causes confusion when:
1. You expect each <code>setState</code> to trigger a separate render (for debugging or side effects)
2. You're migrating from React 17 and see different behavior
3. You have side effects that depend on intermediate state values</p>
<h3 id="the-fix-use-flushsync-for-immediate-updates-rare">The Fix: Use flushSync for Immediate Updates (Rare)</h3>
<p>If you truly need to force a synchronous update (very rare):</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">flushSync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-dom&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleResetWithMeasurement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Force synchronous update</span>
<span class="w">    </span><span class="nx">flushSync</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// This reads the updated DOM immediately</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;task-list&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Height after filter reset:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// This will be a separate render</span>
<span class="w">    </span><span class="nx">flushSync</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setTasks</span><span class="p">([]);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleResetWithMeasurement</span><span class="p">}&gt;</span>
<span class="w">        </span><span class="nx">Reset</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">Measurement</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-batching-causes-issues">When Batching Causes Issues</h3>
<p><strong>Problem</strong>: You need to read DOM measurements between state updates.</p>
<p><strong>Solution</strong>: Use <code>flushSync</code> (but this is a performance hit‚Äîavoid if possible).</p>
<p><strong>Problem</strong>: You have a useEffect that depends on multiple state values and needs to run after each individual update.</p>
<p><strong>Solution</strong>: Rethink your effect dependencies. Usually, you want the effect to run after all updates anyway.</p>
<h3 id="prevention_2">Prevention</h3>
<ol>
<li><strong>Embrace batching</strong>‚Äîit's a performance win</li>
<li><strong>Don't rely on intermediate renders</strong> for side effects</li>
<li><strong>Use <code>flushSync</code> sparingly</strong>‚Äîonly when you must read DOM between updates</li>
<li><strong>In React 17</strong>, wrap async updates in <code>unstable_batchedUpdates</code> if needed</li>
</ol>
<hr />
<h2 id="pitfall-4-state-initialization-with-expensive-computation">Pitfall 4: State Initialization with Expensive Computation</h2>
<h3 id="symptom_3">Symptom</h3>
<p>Component initialization is slow. React DevTools Profiler shows long initial render time. The expensive computation runs on every render, not just the first one.</p>
<h3 id="browser-evidence_3">Browser Evidence</h3>
<p><strong>React DevTools - Profiler</strong>:
- Initial render: 450ms
- Subsequent renders: 440ms (still running expensive computation!)
- Expected: Initial 450ms, subsequent &lt;10ms</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Computing initial tasks... (runs on every render)
Computed 10000 tasks in 445ms
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Expensive computation on every render</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// BUG: This function runs on EVERY render!</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">generateInitialTasks</span><span class="p">(</span><span class="mf">10000</span><span class="p">));</span>

<span class="w">  </span><span class="c1">// Even though we only use the result once,</span>
<span class="w">  </span><span class="c1">// generateInitialTasks(10000) executes every time TaskManager renders</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">generateInitialTasks</span><span class="p">(</span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Computing initial tasks...&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`Task </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">][</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3</span><span class="p">)]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Task</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">86400000</span><span class="p">),</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Computed </span><span class="si">${</span><span class="nx">count</span><span class="si">}</span><span class="sb"> tasks in </span><span class="si">${</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_3">Root Cause</h3>
<p>When you pass a value to <code>useState</code>, React evaluates that expression on every render. Even though React only uses the initial value once, the computation still runs.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">expensiveFunction</span><span class="p">());</span>
<span class="c1">// expensiveFunction() runs on EVERY render</span>
</code></pre></div>

<h3 id="the-trap_3">The Trap</h3>
<p>This looks correct because:
1. You know <code>useState</code> only uses the initial value once
2. The state updates correctly
3. But the performance cost is hidden until you profile</p>
<h3 id="the-fix-lazy-initialization">The Fix: Lazy Initialization</h3>
<p>Pass a function to <code>useState</code> instead of a value:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Lazy initialization</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Pass a function, not a value</span>
<span class="w">  </span><span class="c1">// The function only runs once, on mount</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">generateInitialTasks</span><span class="p">(</span><span class="mf">10000</span><span class="p">));</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">generateInitialTasks</span><span class="p">(</span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Computing initial tasks...&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`Task </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">][</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3</span><span class="p">)]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Task</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">86400000</span><span class="p">),</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Computed </span><span class="si">${</span><span class="nx">count</span><span class="si">}</span><span class="sb"> tasks in </span><span class="si">${</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser Console</strong> (after fix):</p>
<div class="codehilite"><pre><span></span><code>Computing initial tasks... (only on mount)
Computed 10000 tasks in 445ms
// No more logs on subsequent renders
</code></pre></div>

<h3 id="when-to-use-lazy-initialization">When to Use Lazy Initialization</h3>
<p>Use lazy initialization when:
1. Initial state requires expensive computation
2. Initial state comes from localStorage or other I/O
3. Initial state involves complex object creation</p>
<p>Don't bother when:
1. Initial state is a simple value: <code>useState(0)</code>, <code>useState('')</code>
2. Initial state is a literal: <code>useState([])</code>, <code>useState({})</code></p>
<h3 id="prevention_3">Prevention</h3>
<ol>
<li><strong>Profile your components</strong> with React DevTools Profiler</li>
<li><strong>Use lazy initialization</strong> for any non-trivial computation</li>
<li><strong>ESLint rule</strong>: Create a custom rule to catch <code>useState(expensiveFunction())</code></li>
</ol>
<h2 id="useeffect-pitfalls">useEffect Pitfalls</h2>
<h2 id="pitfall-5-missing-dependencies-in-useeffect">Pitfall 5: Missing Dependencies in useEffect</h2>
<h3 id="symptom_4">Symptom</h3>
<p>Effect uses stale values. Component doesn't update when expected. Effect doesn't re-run when it should. ESLint warning: "React Hook useEffect has a missing dependency."</p>
<h3 id="browser-evidence_4">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Effect running with filter: all
// User changes filter to &quot;active&quot;
// Effect doesn&#39;t re-run, still uses &quot;all&quot;
</code></pre></div>

<p><strong>React DevTools - Components Tab</strong>:
- State shows: <code>filter: "active"</code>
- But effect behavior suggests: <code>filter: "all"</code></p>
<p><strong>ESLint Warning</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">React</span><span class="w"> </span><span class="nv">Hook</span><span class="w"> </span><span class="nv">useEffect</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">missing</span><span class="w"> </span><span class="nv">dependency</span>:<span class="w"> </span><span class="s1">&#39;filter&#39;</span>.<span class="w"> </span>
<span class="nv">Either</span><span class="w"> </span><span class="k">include</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">remove</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">dependency</span><span class="w"> </span><span class="nv">array</span>.
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Missing dependency</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// BUG: Effect uses `filter` but doesn&#39;t list it in dependencies</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Filtered tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">filtered</span><span class="p">);</span>
<span class="w">    </span><span class="nx">updateUI</span><span class="p">(</span><span class="nx">filtered</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Missing `filter`!</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span><span class="na">filter</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span><span class="w"> </span><span class="na">onFilterChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setFilter</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_4">Root Cause</h3>
<p>Effects capture values from their surrounding scope (closure). When dependencies are missing, the effect uses stale values from the render when it was created.</p>
<p>React's dependency array tells React when to re-run the effect. If you omit a dependency, React won't re-run the effect when that value changes.</p>
<h3 id="the-trap_4">The Trap</h3>
<p>You might omit dependencies because:
1. You want the effect to run only once (use <code>[]</code> instead)
2. You want to avoid infinite loops (fix the root cause instead)
3. ESLint warning seems wrong (it's usually right)
4. You think React will "figure it out" (it won't)</p>
<h3 id="the-fix-include-all-dependencies">The Fix: Include All Dependencies</h3>
<p>Always include every value from the component scope that the effect uses:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: All dependencies included</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Filtered tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">filtered</span><span class="p">);</span>
<span class="w">    </span><span class="nx">updateUI</span><span class="p">(</span><span class="nx">filtered</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filter</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Both dependencies included</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span><span class="na">filter</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span><span class="w"> </span><span class="na">onFilterChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setFilter</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-dependencies-cause-infinite-loops">When Dependencies Cause Infinite Loops</h3>
<p>If including a dependency causes an infinite loop, the problem is not the dependency‚Äîit's that your effect is creating a new reference on every render:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG: Infinite loop</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="c1">// This object is created on every render (new reference)</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">sortBy</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;asc&#39;</span><span class="w"> </span><span class="p">};</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sortTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">sorted</span><span class="p">);</span><span class="w"> </span><span class="c1">// Updates tasks</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">]);</span><span class="w"> </span><span class="c1">// config changes every render ‚Üí infinite loop!</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Fix 1</strong>: Move the object inside the effect:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// CORRECT: Object created inside effect</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">sortBy</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;asc&#39;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sortTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">sorted</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]);</span><span class="w"> </span><span class="c1">// No config dependency needed</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Fix 2</strong>: Use useMemo to stabilize the reference:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// CORRECT: Stable reference with useMemo</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">sortBy</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;asc&#39;</span><span class="w"> </span><span class="p">}),</span>
<span class="w">    </span><span class="p">[]</span><span class="w"> </span><span class="c1">// Only create once</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sortTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">sorted</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">]);</span><span class="w"> </span><span class="c1">// config is stable now</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Fix 3</strong>: Use primitive values instead of objects:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// CORRECT: Primitive dependencies</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sortBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;asc&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sortTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">sortBy</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">sorted</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">sortBy</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Primitives are stable</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="prevention_4">Prevention</h3>
<ol>
<li><strong>Always include all dependencies</strong>‚Äîtrust ESLint</li>
<li><strong>Use <code>eslint-plugin-react-hooks</code></strong> and don't disable the rule</li>
<li><strong>If you get an infinite loop</strong>, fix the root cause (unstable references)</li>
<li><strong>Move objects/functions inside effects</strong> when possible</li>
<li><strong>Use useMemo/useCallback</strong> to stabilize references when necessary</li>
</ol>
<hr />
<h2 id="pitfall-6-effects-that-should-be-event-handlers">Pitfall 6: Effects That Should Be Event Handlers</h2>
<h3 id="symptom_5">Symptom</h3>
<p>Effect runs on every render or at unexpected times. Logic that should run in response to user action runs automatically. Unnecessary API calls or side effects.</p>
<h3 id="browser-evidence_5">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Saving tasks... (runs on mount)
Saving tasks... (runs on every task change)
Saving tasks... (runs when filter changes)
// Expected: Only when user clicks &quot;Save&quot;
</code></pre></div>

<p><strong>Network Tab</strong>:
- POST /api/tasks (on mount)
- POST /api/tasks (on every keystroke)
- POST /api/tasks (on filter change)
- Expected: Only on explicit save action</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Effect for user action</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">shouldSave</span><span class="p">,</span><span class="w"> </span><span class="nx">setShouldSave</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// BUG: Using effect for something that should be an event handler</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">shouldSave</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Saving tasks...&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">saveTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setShouldSave</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">shouldSave</span><span class="p">,</span><span class="w"> </span><span class="nx">tasks</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">setTasks</span><span class="p">([...</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">newTask</span><span class="p">]);</span>
<span class="w">    </span><span class="nx">setShouldSave</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// Trigger effect</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setShouldSave</span><span class="p">(</span><span class="kc">true</span><span class="p">)}&gt;</span><span class="nx">Save</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_5">Root Cause</h3>
<p>Effects are for <strong>synchronizing with external systems</strong> (APIs, DOM, subscriptions), not for responding to user actions. When you use an effect for user-triggered logic, you're fighting React's model.</p>
<p>The effect runs:
1. On mount (usually not desired)
2. Whenever dependencies change (too often)
3. Not in direct response to the user action (confusing)</p>
<h3 id="the-trap_5">The Trap</h3>
<p>You might use effects for user actions because:
1. You want to "trigger" logic from multiple places
2. You're used to imperative programming (do X, then Y)
3. You think effects are "the React way" to do side effects
4. You want to avoid passing callbacks through props</p>
<h3 id="the-fix-use-event-handlers">The Fix: Use Event Handlers</h3>
<p>Put the logic directly in the event handler:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Event handler for user action</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Saving tasks...&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">saveTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span>
<span class="w">      </span><span class="nx">toast</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="s1">&#39;Tasks saved!&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Failed to save tasks&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">setTasks</span><span class="p">([...</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">newTask</span><span class="p">]);</span>
<span class="w">    </span><span class="c1">// Don&#39;t auto-save, let user decide</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSave</span><span class="p">}&gt;</span><span class="nx">Save</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-you-actually-need-auto-save">When You Actually Need Auto-Save</h3>
<p>If you truly want auto-save (save after every change), use a debounced effect:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - Auto-save with debounce</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Debounce: only save after user stops editing for 2 seconds</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeoutId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Auto-saving tasks...&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">saveTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Cleanup: cancel the timeout if tasks change again</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutId</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskInput</span><span class="w"> </span><span class="na">onAdd</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddTask</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="decision-framework-effect-vs-event-handler">Decision Framework: Effect vs. Event Handler</h3>
<p><strong>Use an event handler when</strong>:
- Logic runs in response to a specific user action
- Logic should run exactly once per action
- Logic is part of the user's intent (save, submit, delete)</p>
<p><strong>Use an effect when</strong>:
- Synchronizing with an external system (WebSocket, DOM, browser API)
- Logic should run whenever certain data changes
- Logic is about keeping things in sync, not responding to actions</p>
<h3 id="prevention_5">Prevention</h3>
<ol>
<li><strong>Default to event handlers</strong> for user actions</li>
<li><strong>Use effects for synchronization</strong> only</li>
<li><strong>Ask</strong>: "Is this responding to a user action or synchronizing state?"</li>
<li><strong>If you need auto-save</strong>, use debouncing</li>
</ol>
<hr />
<h2 id="pitfall-7-forgetting-effect-cleanup">Pitfall 7: Forgetting Effect Cleanup</h2>
<h3 id="symptom_6">Symptom</h3>
<p>Memory leaks. "Can't perform a React state update on an unmounted component" warning. Subscriptions or timers continue after component unmounts. Stale data from old requests.</p>
<h3 id="browser-evidence_6">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">Can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">React</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">unmounted</span><span class="w"> </span><span class="n">component</span><span class="o">.</span>
<span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">op</span><span class="o">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">leak</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">application</span><span class="o">.</span>
<span class="n">To</span><span class="w"> </span><span class="n">fix</span><span class="o">,</span><span class="w"> </span><span class="n">cancel</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">subscriptions</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">asynchronous</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">useEffect</span><span class="w"> </span><span class="n">cleanup</span><span class="w"> </span><span class="kd">function</span><span class="o">.</span>
</code></pre></div>

<p><strong>Network Tab</strong>:
- Multiple requests to /api/tasks
- Component unmounts
- Old requests complete and try to update state
- Warning appears</p>
<p><strong>Memory Profiler</strong>:
- Memory usage increases over time
- Event listeners not removed
- Timers still running</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: No cleanup</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// BUG: No cleanup for interval</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">intervalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">fetchTasks</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">setTasks</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// BUG: No cleanup for event listener</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;online&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">fetchTasks</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">setTasks</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// BUG: No cleanup for fetch</span>
<span class="w">    </span><span class="nx">fetchTasks</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">setTasks</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Missing cleanup function!</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_6">Root Cause</h3>
<p>When a component unmounts, any ongoing async operations (timers, subscriptions, fetch requests) continue running. If they try to update state after unmount, React warns about memory leaks.</p>
<p>Effects need cleanup to:
1. Cancel timers and intervals
2. Remove event listeners
3. Unsubscribe from subscriptions
4. Abort fetch requests
5. Close WebSocket connections</p>
<h3 id="the-trap_6">The Trap</h3>
<p>You forget cleanup because:
1. The component works fine initially
2. The warning only appears when navigating away
3. You don't test unmounting scenarios
4. You think React will "clean up automatically" (it won't)</p>
<h3 id="the-fix-return-a-cleanup-function">The Fix: Return a Cleanup Function</h3>
<p>Always return a cleanup function from effects that create subscriptions or timers:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Proper cleanup</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">isMounted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Track mount status</span>

<span class="w">    </span><span class="c1">// Set up interval</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">intervalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">fetchTasks</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isMounted</span><span class="p">)</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Set up event listener</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleOnline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">fetchTasks</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isMounted</span><span class="p">)</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;online&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleOnline</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Initial fetch with AbortController</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">abortController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AbortController</span><span class="p">();</span>
<span class="w">    </span><span class="nx">fetchTasks</span><span class="p">({</span><span class="w"> </span><span class="nx">signal</span><span class="o">:</span><span class="w"> </span><span class="kt">abortController.signal</span><span class="w"> </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isMounted</span><span class="p">)</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;AbortError&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetch aborted&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Cleanup function</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">isMounted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalId</span><span class="p">);</span>
<span class="w">      </span><span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;online&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleOnline</span><span class="p">);</span>
<span class="w">      </span><span class="nx">abortController</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="cleanup-patterns-for-common-scenarios">Cleanup Patterns for Common Scenarios</h3>
<p><strong>Timers</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeoutId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Do something</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutId</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">intervalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Do something repeatedly</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalId</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<p><strong>Event Listeners</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleResize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle resize</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<p><strong>Fetch Requests</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">abortController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AbortController</span><span class="p">();</span>

<span class="w">  </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/data&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">signal</span><span class="o">:</span><span class="w"> </span><span class="kt">abortController.signal</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setData</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;AbortError&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">abortController</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<p><strong>Subscriptions</strong> (WebSocket, Firebase, etc.):</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">unsubscribe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subscribeToTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">unsubscribe</span><span class="p">;</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<h3 id="prevention_6">Prevention</h3>
<ol>
<li><strong>Always return cleanup</strong> from effects with subscriptions/timers</li>
<li><strong>Use AbortController</strong> for fetch requests</li>
<li><strong>Test unmounting</strong> scenarios in development</li>
<li><strong>Use React Query</strong> for data fetching (handles cleanup automatically)</li>
<li><strong>ESLint rule</strong>: Create custom rule to catch missing cleanup</li>
</ol>
<hr />
<h2 id="pitfall-8-running-effects-on-every-render">Pitfall 8: Running Effects on Every Render</h2>
<h3 id="symptom_7">Symptom</h3>
<p>Effect runs constantly. Performance degrades. Infinite loops. Console flooded with logs. Network tab shows repeated requests.</p>
<h3 id="browser-evidence_7">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Effect running...
Effect running...
Effect running...
(repeats infinitely)
</code></pre></div>

<p><strong>React DevTools - Profiler</strong>:
- Component renders continuously
- Each render triggers effect
- Effect triggers state update
- State update triggers render
- Infinite loop</p>
<p><strong>Network Tab</strong>:
- Hundreds of requests per second
- Browser becomes unresponsive</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Effect runs on every render</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sortedTasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setSortedTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="c1">// BUG: No dependency array ‚Üí runs on every render</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Sorting tasks...&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">tasks</span><span class="p">].</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">a</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="nx">setSortedTasks</span><span class="p">(</span><span class="nx">sorted</span><span class="p">);</span><span class="w"> </span><span class="c1">// Triggers re-render</span>
<span class="w">  </span><span class="p">});</span><span class="w"> </span><span class="c1">// Missing dependency array!</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">sortedTasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_7">Root Cause</h3>
<p>Without a dependency array, effects run after <strong>every render</strong>. If the effect updates state, it triggers another render, which runs the effect again, creating an infinite loop.</p>
<p>Three forms of useEffect:</p>
<ol>
<li>
<p><strong>No dependency array</strong>: Runs after every render
   <code>typescript
   useEffect(() =&gt; {
     // Runs after every render
   });</code></p>
</li>
<li>
<p><strong>Empty dependency array</strong>: Runs once on mount
   <code>typescript
   useEffect(() =&gt; {
     // Runs once on mount
   }, []);</code></p>
</li>
<li>
<p><strong>With dependencies</strong>: Runs when dependencies change
   <code>typescript
   useEffect(() =&gt; {
     // Runs when dep1 or dep2 changes
   }, [dep1, dep2]);</code></p>
</li>
</ol>
<h3 id="the-trap_7">The Trap</h3>
<p>You omit the dependency array because:
1. You forget to add it
2. You don't understand the difference
3. You want it to run "all the time" (wrong approach)</p>
<h3 id="the-fix-add-dependency-array">The Fix: Add Dependency Array</h3>
<p>Specify when the effect should run:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Effect runs when tasks change</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sortedTasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setSortedTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Sorting tasks...&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">tasks</span><span class="p">].</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">a</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="nx">setSortedTasks</span><span class="p">(</span><span class="nx">sorted</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Only run when tasks changes</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">sortedTasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="better-dont-use-an-effect-at-all">Better: Don't Use an Effect at All</h3>
<p>For derived state (computed from existing state), don't use an effect‚Äîcompute during render:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - BEST: No effect needed</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="c1">// Compute during render, no effect needed</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sortedTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[...</span><span class="nx">tasks</span><span class="p">].</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">a</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">sortedTasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-to-use-each-pattern">When to Use Each Pattern</h3>
<p><strong>No dependency array</strong> (almost never):</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Runs after every render</span>
<span class="w">  </span><span class="c1">// Use case: Debugging, logging (remove in production)</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Empty dependency array</strong> (mount only):</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Runs once on mount</span>
<span class="w">  </span><span class="c1">// Use case: Initial data fetch, subscriptions, one-time setup</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<p><strong>With dependencies</strong> (most common):</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Runs when dependencies change</span>
<span class="w">  </span><span class="c1">// Use case: Sync with external system when data changes</span>
<span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">dep1</span><span class="p">,</span><span class="w"> </span><span class="nx">dep2</span><span class="p">]);</span>
</code></pre></div>

<h3 id="prevention_7">Prevention</h3>
<ol>
<li><strong>Always include dependency array</strong> (even if empty)</li>
<li><strong>For derived state</strong>, use useMemo instead of useEffect</li>
<li><strong>ESLint rule</strong>: <code>react-hooks/exhaustive-deps</code> catches missing arrays</li>
<li><strong>Ask</strong>: "Does this need to be an effect at all?"</li>
</ol>
<h2 id="component-rendering-pitfalls">Component Rendering Pitfalls</h2>
<h2 id="pitfall-9-creating-components-inside-components">Pitfall 9: Creating Components Inside Components</h2>
<h3 id="symptom_8">Symptom</h3>
<p>Component loses state on every render. Input fields lose focus while typing. Animations restart. React DevTools shows component unmounting and remounting constantly.</p>
<h3 id="browser-evidence_8">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>TaskItem mounted
TaskItem unmounted
TaskItem mounted
TaskItem unmounted
(repeats on every keystroke)
</code></pre></div>

<p><strong>React DevTools - Components Tab</strong>:
- Component tree shows TaskItem disappearing and reappearing
- State resets to initial values
- Keys change on every render</p>
<p><strong>User Experience</strong>:
- Typing in input loses focus after each character
- Checkboxes uncheck themselves
- Animations restart mid-way</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Component defined inside component</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="c1">// BUG: Component defined inside render</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isEditing</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsEditing</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">isEditing</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">input</span><span class="w"> </span><span class="na">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsEditing</span><span class="p">(</span><span class="o">!</span><span class="nx">isEditing</span><span class="p">)}&gt;</span>
<span class="w">          </span><span class="nx">Edit</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_8">Root Cause</h3>
<p>When you define a component inside another component, React creates a <strong>new component type</strong> on every render. React sees <code>TaskItem</code> as a different component each time, so it unmounts the old one and mounts a new one, losing all state.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Render 1: TaskItem is function A</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Render 2: TaskItem is function B (different reference!)</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// React thinks: &quot;This is a different component, unmount A and mount B&quot;</span>
</code></pre></div>

<h3 id="the-trap_8">The Trap</h3>
<p>You define components inside components because:
1. You want to access parent state without passing props
2. You think it's "scoped" or "private"
3. You're used to nested functions in regular JavaScript
4. It seems convenient</p>
<h3 id="the-fix-define-components-outside">The Fix: Define Components Outside</h3>
<p>Always define components at the top level:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskItem.tsx - CORRECT: Component defined outside</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">TaskItemProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onUpdate</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="p">&lt;</span><span class="nt">Task</span><span class="p">&gt;)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">onUpdate</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">TaskItemProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isEditing</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsEditing</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isEditing</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">input</span><span class="w"> </span>
<span class="w">          </span><span class="na">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
<span class="w">          </span><span class="na">onBlur</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">onUpdate</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">e.target.value</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="nx">setIsEditing</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">          </span><span class="p">}}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsEditing</span><span class="p">(</span><span class="o">!</span><span class="nx">isEditing</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="nx">Edit</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// TaskManager.tsx</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleUpdateTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="p">&lt;</span><span class="nt">Task</span><span class="p">&gt;)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span><span class="w"> </span>
<span class="w">          </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">          </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span>
<span class="w">          </span><span class="na">onUpdate</span><span class="o">=</span><span class="p">{</span><span class="nx">handleUpdateTask</span><span class="p">}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="if-you-need-to-access-parent-state">If You Need to Access Parent State</h3>
<p>Pass it as props or use context:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Using context for deeply nested access</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">TaskContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createContext</span><span class="o">&lt;</span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="p">&lt;</span><span class="nt">Task</span><span class="p">&gt;)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="p">&lt;</span><span class="nt">Task</span><span class="p">&gt;)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">TaskContext</span><span class="p">.</span><span class="na">Provider</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">updateTask</span><span class="w"> </span><span class="p">}}&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">TaskContext</span><span class="p">.</span><span class="na">Provider</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// TaskItem can now access context without prop drilling</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useContext</span><span class="p">(</span><span class="nx">TaskContext</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">context</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;TaskItem must be used within TaskContext&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isEditing</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsEditing</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isEditing</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">input</span><span class="w"> </span>
<span class="w">          </span><span class="na">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
<span class="w">          </span><span class="na">onBlur</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">context</span><span class="p">.</span><span class="nx">updateTask</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">e.target.value</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="nx">setIsEditing</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">          </span><span class="p">}}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="prevention_8">Prevention</h3>
<ol>
<li><strong>Never define components inside components</strong></li>
<li><strong>Define components at module level</strong> (top of file)</li>
<li><strong>Use props or context</strong> to share state</li>
<li><strong>ESLint rule</strong>: <code>react/no-unstable-nested-components</code> catches this</li>
</ol>
<hr />
<h2 id="pitfall-10-using-index-as-key">Pitfall 10: Using Index as Key</h2>
<h3 id="symptom_9">Symptom</h3>
<p>Wrong items get updated or deleted. Component state gets mixed up. Animations apply to wrong items. Checkboxes check wrong items after reordering.</p>
<h3 id="browser-evidence_9">Browser Evidence</h3>
<p><strong>User Experience</strong>:
1. User checks checkbox on "Task 1"
2. User deletes "Task 1"
3. Checkbox appears checked on "Task 2" (wrong item!)</p>
<p><strong>React DevTools - Components Tab</strong>:
- Keys are: <code>0, 1, 2, 3</code>
- After deletion: <code>0, 1, 2</code> (same keys, different items)
- React reuses components with same keys</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Index as key</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task 3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDeleteTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">index</span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="c1">// BUG: Using index as key</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span>
<span class="w">          </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span>
<span class="w">          </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span>
<span class="w">          </span><span class="na">onDelete</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">handleDeleteTask</span><span class="p">(</span><span class="nx">index</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">onDelete</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">;</span><span class="w"> </span><span class="nx">onDelete</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isChecked</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsChecked</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">input</span><span class="w"> </span>
<span class="w">        </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span>
<span class="w">        </span><span class="na">checked</span><span class="o">=</span><span class="p">{</span><span class="nx">isChecked</span><span class="p">}</span>
<span class="w">        </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsChecked</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">checked</span><span class="p">)}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onDelete</span><span class="p">}&gt;</span><span class="nx">Delete</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_9">Root Cause</h3>
<p>React uses keys to identify which items have changed, been added, or been removed. When you use index as key:</p>
<p><strong>Before deletion</strong>:</p>
<div class="codehilite"><pre><span></span><code>key=0 ‚Üí Task 1 (checkbox: unchecked)
key=1 ‚Üí Task 2 (checkbox: checked)
key=2 ‚Üí Task 3 (checkbox: unchecked)
</code></pre></div>

<p><strong>After deleting Task 1</strong>:</p>
<div class="codehilite"><pre><span></span><code>key=0 ‚Üí Task 2 (React reuses key=0 component, keeps its state: unchecked)
key=1 ‚Üí Task 3 (React reuses key=1 component, keeps its state: checked)
</code></pre></div>

<p>React thinks:
- "key=0 is still here, just update its props"
- "key=1 is still here, just update its props"
- "key=2 is gone, unmount it"</p>
<p>But the component state (checkbox) stays with the key, not the data!</p>
<h3 id="the-trap_9">The Trap</h3>
<p>You use index as key because:
1. It's the easiest thing to reach for
2. It "works" when you don't reorder/delete items
3. You don't understand what keys are for
4. ESLint doesn't warn (it only warns about missing keys)</p>
<h3 id="the-fix-use-stable-unique-ids">The Fix: Use Stable, Unique IDs</h3>
<p>Always use a stable, unique identifier from your data:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Stable ID as key</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task 3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDeleteTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="c1">// CORRECT: Using stable ID as key</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span>
<span class="w">          </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
<span class="w">          </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span>
<span class="w">          </span><span class="na">onDelete</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">handleDeleteTask</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-index-as-key-is-acceptable">When Index as Key is Acceptable</h3>
<p>Index as key is safe <strong>only when ALL of these are true</strong>:
1. The list is static (never reordered, added to, or removed from)
2. Items have no state
3. Items have no animations</p>
<p>Example of safe usage:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Safe: Static list, no state, no reordering</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">ColorPalette</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;green&#39;</span><span class="p">];</span><span class="w"> </span><span class="c1">// Never changes</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">colors</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="na">style</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="kt">color</span><span class="w"> </span><span class="p">}}&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">color</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="generating-stable-ids">Generating Stable IDs</h3>
<p>If your data doesn't have IDs, generate them once:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Generate IDs when creating items</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newTask</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span><span class="w"> </span><span class="c1">// Generate stable ID</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">setTasks</span><span class="p">([...</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">newTask</span><span class="p">]);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="prevention_9">Prevention</h3>
<ol>
<li><strong>Always use stable, unique IDs as keys</strong></li>
<li><strong>Never use index as key</strong> unless the list is truly static</li>
<li><strong>Generate IDs</strong> when creating items if they don't have them</li>
<li><strong>Use <code>crypto.randomUUID()</code></strong> or a library like <code>nanoid</code></li>
<li><strong>Test reordering and deletion</strong> to catch key issues</li>
</ol>
<hr />
<h2 id="pitfall-11-unnecessary-re-renders-from-objectarray-props">Pitfall 11: Unnecessary Re-renders from Object/Array Props</h2>
<h3 id="symptom_10">Symptom</h3>
<p>Child component re-renders even though its props "haven't changed." Performance degrades with many child components. React DevTools Profiler shows unnecessary renders.</p>
<h3 id="browser-evidence_10">Browser Evidence</h3>
<p><strong>React DevTools - Profiler</strong>:
- Parent renders
- All children render (highlighted in yellow)
- Props appear identical in Components tab
- But references are different</p>
<p><strong>Console logs</strong>:</p>
<div class="codehilite"><pre><span></span><code>Parent render
Child render (props: { filter: &#39;all&#39;, sort: &#39;date&#39; })
Parent render
Child render (props: { filter: &#39;all&#39;, sort: &#39;date&#39; })
// Props look the same, but child still re-renders
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: New object on every render</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filterValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilterValue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sortValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setSortValue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* BUG: New object created on every render */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span>
<span class="w">        </span><span class="na">config</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">filterValue</span><span class="p">,</span><span class="w"> </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kt">sortValue</span><span class="w"> </span><span class="p">}}</span>
<span class="w">        </span><span class="na">onConfigChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">config</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">setFilterValue</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">filter</span><span class="p">);</span>
<span class="w">          </span><span class="nx">setSortValue</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">sort</span><span class="p">);</span>
<span class="w">        </span><span class="p">}}</span>
<span class="w">      </span><span class="p">/&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* BUG: New array created on every render */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span>
<span class="w">        </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span>
<span class="w">        </span><span class="na">priorities</span><span class="o">=</span><span class="p">{[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">]}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Child component with React.memo</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">config</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onConfigChange</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">onConfigChange</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;TaskFilters render&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="cm">/* ... */</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="root-cause_10">Root Cause</h3>
<p>JavaScript objects and arrays are compared by <strong>reference</strong>, not by value. Even if two objects have identical contents, they're different if they're different instances:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">obj1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="w"> </span><span class="p">};</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">obj2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="w"> </span><span class="p">};</span>

<span class="nx">obj1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">obj2</span><span class="w"> </span><span class="c1">// false! Different references</span>
</code></pre></div>

<p>When you create a new object/array on every render, React.memo sees it as a "different" prop and re-renders the child.</p>
<h3 id="the-trap_10">The Trap</h3>
<p>You create new objects/arrays because:
1. It's convenient: <code>config={{ filter, sort }}</code>
2. You don't realize it creates a new reference
3. You think React.memo will "figure it out" (it won't)
4. You don't profile to see the unnecessary renders</p>
<h3 id="the-fix-stabilize-references-with-usememo">The Fix: Stabilize References with useMemo</h3>
<p>Use useMemo to create stable references:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Stable references</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filterValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilterValue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sortValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setSortValue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Stable config object</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">filterValue</span><span class="p">,</span><span class="w"> </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kt">sortValue</span><span class="w"> </span><span class="p">}),</span>
<span class="w">    </span><span class="p">[</span><span class="nx">filterValue</span><span class="p">,</span><span class="w"> </span><span class="nx">sortValue</span><span class="p">]</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Stable callback</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleConfigChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="nx">newConfig</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setFilterValue</span><span class="p">(</span><span class="nx">newConfig</span><span class="p">.</span><span class="nx">filter</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setSortValue</span><span class="p">(</span><span class="nx">newConfig</span><span class="p">.</span><span class="nx">sort</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">[]</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Stable array (only create once)</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">priorities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">,</span>
<span class="w">    </span><span class="p">[]</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span>
<span class="w">        </span><span class="na">config</span><span class="o">=</span><span class="p">{</span><span class="nx">config</span><span class="p">}</span>
<span class="w">        </span><span class="na">onConfigChange</span><span class="o">=</span><span class="p">{</span><span class="nx">handleConfigChange</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span>
<span class="w">        </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span>
<span class="w">        </span><span class="na">priorities</span><span class="o">=</span><span class="p">{</span><span class="nx">priorities</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="alternative-pass-primitive-values">Alternative: Pass Primitive Values</h3>
<p>Instead of objects, pass primitive values:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - Alternative: Primitives</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filterValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilterValue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sortValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setSortValue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Primitives are compared by value, not reference */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span>
<span class="w">        </span><span class="na">filter</span><span class="o">=</span><span class="p">{</span><span class="nx">filterValue</span><span class="p">}</span>
<span class="w">        </span><span class="na">sort</span><span class="o">=</span><span class="p">{</span><span class="nx">sortValue</span><span class="p">}</span>
<span class="w">        </span><span class="na">onFilterChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setFilterValue</span><span class="p">}</span>
<span class="w">        </span><span class="na">onSortChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setSortValue</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">filter</span><span class="p">,</span>
<span class="w">  </span><span class="nx">sort</span><span class="p">,</span>
<span class="w">  </span><span class="nx">onFilterChange</span><span class="p">,</span>
<span class="w">  </span><span class="nx">onSortChange</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onFilterChange</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onSortChange</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;TaskFilters render&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="cm">/* ... */</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="when-to-optimize">When to Optimize</h3>
<p>Don't optimize prematurely. Only use useMemo/useCallback when:
1. <strong>Profiling shows</strong> unnecessary re-renders
2. Child component is <strong>expensive to render</strong>
3. Child component is <strong>memoized</strong> with React.memo
4. List has <strong>many items</strong> (50+)</p>
<h3 id="prevention_10">Prevention</h3>
<ol>
<li><strong>Profile first</strong> with React DevTools Profiler</li>
<li><strong>Pass primitives</strong> when possible</li>
<li><strong>Use useMemo</strong> for objects/arrays passed to memoized components</li>
<li><strong>Use useCallback</strong> for functions passed to memoized components</li>
<li><strong>Don't optimize</strong> until you have evidence of a problem</li>
</ol>
<h2 id="typescript-pitfalls">TypeScript Pitfalls</h2>
<h2 id="pitfall-12-type-assertions-hiding-bugs">Pitfall 12: Type Assertions Hiding Bugs</h2>
<h3 id="symptom_11">Symptom</h3>
<p>Runtime errors that TypeScript should have caught. "Cannot read property of undefined" errors. Type errors in production but not development.</p>
<h3 id="browser-evidence_11">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Uncaught TypeError: Cannot read properties of undefined (reading &#39;title&#39;)
    at TaskItem.tsx:15
</code></pre></div>

<p><strong>TypeScript Compiler</strong>:</p>
<div class="codehilite"><pre><span></span><code>No errors found.
</code></pre></div>

<p><strong>The disconnect</strong>: TypeScript thinks the code is safe, but it crashes at runtime.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Type assertion hiding bug</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/tasks&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// BUG: Type assertion without validation</span>
<span class="w">        </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="cm">/* Runtime error if task.title is undefined */</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_11">Root Cause</h3>
<p>Type assertions (<code>as Type</code>) tell TypeScript "trust me, I know this is the right type." But TypeScript doesn't verify this‚Äîit just believes you. If the runtime data doesn't match the asserted type, you get runtime errors.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task&#39;</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// Missing &#39;title&#39;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Task</span><span class="p">;</span><span class="w"> </span><span class="c1">// TypeScript: &quot;OK, it&#39;s a Task&quot;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">());</span><span class="w"> </span><span class="c1">// Runtime error!</span>
</code></pre></div>

<h3 id="the-trap_11">The Trap</h3>
<p>You use type assertions because:
1. TypeScript complains and you want it to stop
2. You "know" the data is correct
3. You're dealing with external data (API, localStorage)
4. You think <code>as</code> is the same as validation (it's not)</p>
<h3 id="the-fix-validate-at-runtime">The Fix: Validate at Runtime</h3>
<p>Use runtime validation with a library like Zod:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Runtime validation</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zod&#39;</span><span class="p">;</span>

<span class="c1">// Define schema that matches your type</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">TaskSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">z.boolean</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="kt">z.enum</span><span class="p">([</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">]),</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">z.coerce.date</span><span class="p">(),</span><span class="w"> </span><span class="c1">// Coerce string to Date</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">TaskArraySchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">TaskSchema</span><span class="p">);</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">infer</span><span class="p">&lt;</span><span class="nt">typeof</span><span class="w"> </span><span class="na">TaskSchema</span><span class="p">&gt;;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/tasks&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Validate at runtime</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TaskArraySchema</span><span class="p">.</span><span class="nx">safeParse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Invalid task data:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
<span class="w">          </span><span class="nx">setError</span><span class="p">(</span><span class="s1">&#39;Failed to load tasks: invalid data format&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Fetch error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="s1">&#39;Failed to load tasks&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="ne">Error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="cm">/* Safe: TypeScript AND runtime guarantee title exists */</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="alternative-type-guards">Alternative: Type Guards</h3>
<p>For simpler cases, write type guard functions:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Type guard function</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">isTask</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">unknown</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">value</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="s1">&#39;title&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="s1">&#39;completed&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">completed</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;boolean&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="s1">&#39;priority&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="s1">&#39;createdAt&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">value</span><span class="p">.</span><span class="nx">createdAt</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Date</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">isTaskArray</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">unknown</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">isTask</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/tasks&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isTaskArray</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// TypeScript knows it&#39;s Task[]</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="s1">&#39;Invalid task data&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
</code></pre></div>

<h3 id="when-type-assertions-are-acceptable">When Type Assertions Are Acceptable</h3>
<p>Type assertions are safe when:
1. You're narrowing a type you already know: <code>event.target as HTMLInputElement</code>
2. You're working with DOM APIs: <code>document.getElementById('root') as HTMLDivElement</code>
3. You're dealing with library types that are too strict</p>
<p>But even then, prefer type guards when possible.</p>
<h3 id="prevention_11">Prevention</h3>
<ol>
<li><strong>Never use <code>as</code> with external data</strong> (API, localStorage, user input)</li>
<li><strong>Use Zod or similar</strong> for runtime validation</li>
<li><strong>Write type guards</strong> for complex validation logic</li>
<li><strong>Prefer <code>unknown</code></strong> over <code>any</code> to force validation</li>
<li><strong>ESLint rule</strong>: <code>@typescript-eslint/consistent-type-assertions</code> to restrict <code>as</code></li>
</ol>
<hr />
<h2 id="pitfall-13-the-any-escape-hatch">Pitfall 13: The <code>any</code> Escape Hatch</h2>
<h3 id="symptom_12">Symptom</h3>
<p>Type errors that should be caught at compile time appear at runtime. Autocomplete stops working. Refactoring breaks things silently.</p>
<h3 id="browser-evidence_12">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Uncaught TypeError: task.toggleComplete is not a function
    at TaskItem.tsx:23
</code></pre></div>

<p><strong>TypeScript Compiler</strong>:</p>
<div class="codehilite"><pre><span></span><code>No errors found.
</code></pre></div>

<p><strong>VS Code</strong>:
- No autocomplete for <code>task</code> properties
- No error when calling non-existent method</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: any disables type checking</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">any</span><span class="err">[]</span><span class="p">&gt;([]);</span><span class="w"> </span><span class="c1">// BUG: any</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/tasks&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// BUG: any</span>
<span class="w">        </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleToggle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// BUG: any</span>
<span class="w">    </span><span class="c1">// TypeScript doesn&#39;t catch this error</span>
<span class="w">    </span><span class="nx">task</span><span class="p">.</span><span class="nx">toggleComplete</span><span class="p">();</span><span class="w"> </span><span class="c1">// Runtime error: method doesn&#39;t exist</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="c1">// BUG: any</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">handleToggle</span><span class="p">(</span><span class="nx">task</span><span class="p">)}&gt;</span><span class="nx">Toggle</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_12">Root Cause</h3>
<p><code>any</code> disables all type checking. TypeScript treats <code>any</code> as "I don't care about types here." This defeats the entire purpose of TypeScript.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Task&#39;</span><span class="w"> </span><span class="p">};</span>

<span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span><span class="w"> </span><span class="c1">// OK</span>
<span class="nx">task</span><span class="p">.</span><span class="nx">nonExistent</span><span class="p">.</span><span class="nx">method</span><span class="p">();</span><span class="w"> </span><span class="c1">// OK (but crashes at runtime!)</span>
<span class="nx">task</span><span class="p">.</span><span class="nx">anything</span><span class="p">.</span><span class="nx">you</span><span class="p">.</span><span class="nx">want</span><span class="p">.</span><span class="nx">here</span><span class="p">();</span><span class="w"> </span><span class="c1">// OK (but crashes at runtime!)</span>
</code></pre></div>

<h3 id="the-trap_12">The Trap</h3>
<p>You use <code>any</code> because:
1. TypeScript errors are frustrating
2. You don't know the correct type
3. You're dealing with complex third-party types
4. You think "I'll fix it later" (you won't)</p>
<h3 id="the-fix-use-proper-types">The Fix: Use Proper Types</h3>
<p>Define proper types for your data:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Proper types</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/tasks&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">unknown</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Use unknown, not any</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TaskArraySchema</span><span class="p">.</span><span class="nx">safeParse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleToggle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// TypeScript catches this error at compile time</span>
<span class="w">    </span><span class="nx">task</span><span class="p">.</span><span class="nx">toggleComplete</span><span class="p">();</span><span class="w"> </span><span class="c1">// Error: Property &#39;toggleComplete&#39; does not exist</span>

<span class="w">    </span><span class="c1">// Correct approach</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span>
<span class="w">        </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">completed</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="nx">t</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">handleToggle</span><span class="p">(</span><span class="nx">task</span><span class="p">)}&gt;</span><span class="nx">Toggle</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="use-unknown-instead-of-any">Use <code>unknown</code> Instead of <code>any</code></h3>
<p>When you truly don't know the type, use <code>unknown</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG: any allows anything</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">processData</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span><span class="w"> </span><span class="c1">// No error, crashes at runtime</span>
<span class="p">}</span>

<span class="c1">// CORRECT: unknown forces validation</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">processData</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">unknown</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Error: Object is of type &#39;unknown&#39;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Must validate first</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="s1">&#39;value&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span><span class="w"> </span><span class="c1">// OK now</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Invalid data&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-any-is-acceptable-rarely">When <code>any</code> is Acceptable (Rarely)</h3>
<p><code>any</code> is acceptable when:
1. <strong>Migrating JavaScript to TypeScript</strong>: Use <code>any</code> temporarily, add <code>// TODO: type this</code> comment
2. <strong>Dealing with truly dynamic data</strong>: JSON.parse result (but validate immediately)
3. <strong>Working around library bugs</strong>: When library types are wrong (but file an issue)</p>
<h3 id="prevention_12">Prevention</h3>
<ol>
<li><strong>Ban <code>any</code> in your codebase</strong>: Use ESLint rule <code>@typescript-eslint/no-explicit-any</code></li>
<li><strong>Use <code>unknown</code></strong> when you don't know the type</li>
<li><strong>Define proper interfaces</strong> for your data</li>
<li><strong>Use Zod</strong> to generate types from schemas</li>
<li><strong>Gradually type</strong> existing code instead of using <code>any</code></li>
</ol>
<h2 id="nextjs-specific-pitfalls">Next.js-Specific Pitfalls</h2>
<h2 id="pitfall-14-using-client-only-apis-in-server-components">Pitfall 14: Using Client-Only APIs in Server Components</h2>
<h3 id="symptom_13">Symptom</h3>
<p>Build fails with cryptic errors. "window is not defined" or "document is not defined" errors. Component works in development but fails in production build.</p>
<h3 id="browser-evidence_13">Browser Evidence</h3>
<p><strong>Terminal Output</strong> (during build):</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Unhandled<span class="w"> </span>Runtime<span class="w"> </span>Error
ReferenceError:<span class="w"> </span>window<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>defined

Call<span class="w"> </span>Stack:
<span class="w">  </span>TaskManager.tsx<span class="w"> </span><span class="o">(</span><span class="m">15</span>:23<span class="o">)</span>
</code></pre></div>

<p><strong>Development</strong>: Works fine
<strong>Production build</strong>: Fails</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/tasks/page.tsx - WRONG: Client API in Server Component</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// BUG: Server Components can&#39;t access window</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">savedFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;taskFilter&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// BUG: Server Components can&#39;t access document</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;dark&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;dark&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;light&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">savedFilter</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Theme</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">theme</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_13">Root Cause</h3>
<p>Next.js App Router uses <strong>Server Components by default</strong>. Server Components render on the server (Node.js), which doesn't have browser APIs like <code>window</code>, <code>document</code>, <code>localStorage</code>, etc.</p>
<p>In development, Next.js might render on the client for fast refresh, hiding the issue. In production, it fails during build.</p>
<h3 id="the-trap_13">The Trap</h3>
<p>You use browser APIs because:
1. You forget you're in a Server Component
2. You're used to client-only React
3. Development works fine (false confidence)
4. The error message is confusing</p>
<h3 id="the-fix-use-client-components">The Fix: Use Client Components</h3>
<p>Add <code>'use client'</code> directive for components that need browser APIs:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/tasks/page.tsx - Server Component (no browser APIs)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TaskList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./TaskList&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Server Component: Can fetch data, but no browser APIs</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchTasks</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">initialTasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// components/TaskList.tsx - Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskList</span><span class="p">({</span><span class="w"> </span><span class="nx">initialTasks</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">initialTasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">initialTasks</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Client Component: Can use browser APIs</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">savedFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;taskFilter&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">savedFilter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setFilter</span><span class="p">(</span><span class="nx">savedFilter</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;taskFilter&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Client-side interactivity */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">select</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span><span class="w"> </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">&gt;</span><span class="nx">All</span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;</span><span class="nx">Active</span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;completed&quot;</span><span class="p">&gt;</span><span class="nx">Completed</span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="decision-framework-server-vs-client-component">Decision Framework: Server vs. Client Component</h3>
<p><strong>Use Server Component when</strong>:
- Fetching data from database/API
- Accessing backend resources
- Keeping sensitive logic on server
- Reducing client bundle size
- No interactivity needed</p>
<p><strong>Use Client Component when</strong>:
- Using browser APIs (localStorage, window, document)
- Using React hooks (useState, useEffect, useContext)
- Handling user interactions (onClick, onChange)
- Using browser-only libraries</p>
<h3 id="prevention_13">Prevention</h3>
<ol>
<li><strong>Default to Server Components</strong> in App Router</li>
<li><strong>Add <code>'use client'</code></strong> only when needed</li>
<li><strong>Check build output</strong> for errors before deploying</li>
<li><strong>Use <code>typeof window !== 'undefined'</code></strong> for conditional browser code</li>
<li><strong>Test production builds</strong> locally with <code>npm run build &amp;&amp; npm start</code></li>
</ol>
<hr />
<h2 id="pitfall-15-hydration-mismatches">Pitfall 15: Hydration Mismatches</h2>
<h3 id="symptom_14">Symptom</h3>
<p>Warning in console: "Hydration failed because the initial UI does not match what was rendered on the server." Content flashes or changes after page load. Styles apply incorrectly initially.</p>
<h3 id="browser-evidence_14">Browser Evidence</h3>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">Hydration</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">match</span><span class="w"> </span>
<span class="n">what</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">rendered</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="o">.</span>

<span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">Expected</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">HTML</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;.</span>
</code></pre></div>

<p><strong>User Experience</strong>:
- Page loads with one layout
- Suddenly shifts to different layout
- Flash of unstyled content
- Cumulative Layout Shift (CLS) issues</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/tasks/page.tsx - WRONG: Hydration mismatch</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* BUG: Different content on server vs. client */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Current</span><span class="w"> </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleTimeString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* BUG: Random content differs between renders */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Random</span><span class="w"> </span><span class="kt">number</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* BUG: Browser-only API returns different values */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Screen</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">}</span><span class="nx">px</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_14">Root Cause</h3>
<p>Next.js renders your component twice:
1. <strong>On the server</strong>: Generates HTML
2. <strong>On the client</strong>: "Hydrates" the HTML (attaches event listeners, state)</p>
<p>If the server HTML doesn't match the client HTML, React can't hydrate correctly. This happens when:
- Using <code>Date.now()</code>, <code>Math.random()</code>, or other non-deterministic values
- Using browser APIs that don't exist on server
- Conditionally rendering based on browser state</p>
<h3 id="the-trap_14">The Trap</h3>
<p>You create hydration mismatches because:
1. You don't understand server vs. client rendering
2. You use time-based or random values
3. You check browser state during render
4. You use third-party libraries that assume browser environment</p>
<h3 id="the-fix-ensure-consistent-rendering">The Fix: Ensure Consistent Rendering</h3>
<p><strong>Option 1</strong>: Move dynamic content to Client Component with useEffect:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// components/CurrentTime.tsx - Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">CurrentTime</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">time</span><span class="p">,</span><span class="w"> </span><span class="nx">setTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Only set time on client, after hydration</span>
<span class="w">    </span><span class="nx">setTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleTimeString</span><span class="p">());</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleTimeString</span><span class="p">());</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="c1">// Server renders null, client renders time after hydration</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">time</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">time</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Current</span><span class="w"> </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">time</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="c1">// app/tasks/page.tsx - Server Component</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">CurrentTime</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/CurrentTime&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">CurrentTime</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Option 2</strong>: Use <code>suppressHydrationWarning</code> for known mismatches:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Only use this when you KNOW the mismatch is intentional</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">suppressHydrationWarning</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Current</span><span class="w"> </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleTimeString</span><span class="p">()}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Option 3</strong>: Use consistent data from server:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/tasks/page.tsx - Pass server time to client</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">serverTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TimeDisplay</span><span class="w"> </span><span class="na">initialTime</span><span class="o">=</span><span class="p">{</span><span class="nx">serverTime</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// components/TimeDisplay.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TimeDisplay</span><span class="p">({</span><span class="w"> </span><span class="nx">initialTime</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">initialTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">time</span><span class="p">,</span><span class="w"> </span><span class="nx">setTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">initialTime</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">());</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Time</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">time</span><span class="p">).</span><span class="nx">toLocaleTimeString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="common-hydration-mismatch-causes">Common Hydration Mismatch Causes</h3>
<p><strong>1. Browser-only APIs</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Width</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">}</span><span class="nx">px</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="c1">// CORRECT</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">number</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">setWidth</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<p><strong>2. Date/Time</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="c1">// CORRECT</span>
<span class="nx">Pass</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">useEffect</span>
</code></pre></div>

<p><strong>3. Random values</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()}&gt;...&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c1">// CORRECT</span>
<span class="nx">Use</span><span class="w"> </span><span class="nx">stable</span><span class="w"> </span><span class="nx">IDs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">data</span>
</code></pre></div>

<p><strong>4. Conditional rendering based on browser state</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="p">{</span><span class="ow">typeof</span><span class="w"> </span><span class="nb">window</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Component</span><span class="w"> </span><span class="p">/&gt;}</span>

<span class="c1">// CORRECT</span>
<span class="nx">Use</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">conditionally</span><span class="w"> </span><span class="nx">render</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">hydration</span>
</code></pre></div>

<h3 id="prevention_14">Prevention</h3>
<ol>
<li><strong>Avoid non-deterministic values</strong> during render</li>
<li><strong>Use useEffect</strong> for browser-only logic</li>
<li><strong>Pass server data</strong> to client components as props</li>
<li><strong>Test with JavaScript disabled</strong> to see server HTML</li>
<li><strong>Check Lighthouse</strong> for CLS issues caused by hydration mismatches</li>
</ol>
<hr />
<h2 id="pitfall-16-mixing-server-and-client-component-patterns">Pitfall 16: Mixing Server and Client Component Patterns</h2>
<h3 id="symptom_15">Symptom</h3>
<p>"You're importing a component that needs X. It only works in a Client Component but none of its parents are marked with 'use client'." Build errors about importing client-only code in server components.</p>
<h3 id="browser-evidence_15">Browser Evidence</h3>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>You<span class="s1">&#39;re importing a component that needs useState. </span>
<span class="s1">It only works in a Client Component but none of its parents </span>
<span class="s1">are marked with &quot;use client&quot;, so they&#39;</span>re<span class="w"> </span>Server<span class="w"> </span>Components<span class="w"> </span>by<span class="w"> </span>default.

Import<span class="w"> </span>trace:
<span class="w">  </span>./app/tasks/page.tsx
<span class="w">  </span>./components/TaskList.tsx
<span class="w">  </span>./components/TaskItem.tsx
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// app/tasks/page.tsx - Server Component</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TaskList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/TaskList&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchTasks</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// components/TaskList.tsx - Server Component (no &#39;use client&#39;)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TaskItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./TaskItem&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskList</span><span class="p">({</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// components/TaskItem.tsx - BUG: Uses hooks but no &#39;use client&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// BUG: useState in Server Component</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isExpanded</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsExpanded</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsExpanded</span><span class="p">(</span><span class="o">!</span><span class="nx">isExpanded</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">isExpanded</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Collapse&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Expand&#39;</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isExpanded</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="root-cause_15">Root Cause</h3>
<p>In Next.js App Router:
- Components are <strong>Server Components by default</strong>
- Server Components <strong>cannot use hooks</strong> (useState, useEffect, etc.)
- Server Components <strong>cannot use browser APIs</strong>
- When a Server Component imports a component that uses hooks, build fails</p>
<p>The <code>'use client'</code> directive marks a component and <strong>all its children</strong> as Client Components.</p>
<h3 id="the-trap_15">The Trap</h3>
<p>You mix patterns because:
1. You forget to add <code>'use client'</code>
2. You don't understand the Server/Client boundary
3. You import a Client Component from a Server Component (this is fine)
4. You import a Server Component from a Client Component (this is problematic)</p>
<h3 id="the-fix-add-use-client-to-interactive-components">The Fix: Add 'use client' to Interactive Components</h3>
<p>Mark components that need interactivity as Client Components:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// app/tasks/page.tsx - Server Component (can fetch data)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TaskList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/TaskList&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TasksPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchTasks</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Tasks</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">tasks</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// components/TaskList.tsx - Server Component (no interactivity)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TaskItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./TaskItem&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskList</span><span class="p">({</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// components/TaskItem.tsx - CORRECT: Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isExpanded</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsExpanded</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsExpanded</span><span class="p">(</span><span class="o">!</span><span class="nx">isExpanded</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">isExpanded</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Collapse&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Expand&#39;</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isExpanded</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="component-composition-patterns">Component Composition Patterns</h3>
<p><strong>Pattern 1: Server Component ‚Üí Client Component</strong> (‚úÖ Allowed):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Server Component</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Page</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ClientComponent</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="c1">// Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ClientComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Pattern 2: Client Component ‚Üí Server Component</strong> (‚ùå Not directly):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG: Can&#39;t import Server Component into Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ClientComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ServerComponent</span><span class="w"> </span><span class="p">/&gt;;</span><span class="w"> </span><span class="c1">// Error!</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Pattern 3: Client Component with Server Component as children</strong> (‚úÖ Allowed):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Server Component</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Page</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">ClientWrapper</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">ServerComponent</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">ClientWrapper</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ClientWrapper</span><span class="p">({</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="decision-framework-where-to-place-use-client">Decision Framework: Where to Place 'use client'</h3>
<p><strong>Place <code>'use client'</code> as low as possible in the tree</strong>:
- ‚úÖ Only mark interactive components
- ‚úÖ Keep data fetching in Server Components
- ‚úÖ Pass data down as props</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ GOOD: Client boundary at leaf</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Page</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">();</span><span class="w"> </span><span class="c1">// Server</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">StaticHeader</span><span class="w"> </span><span class="p">/&gt;</span><span class="w"> </span><span class="p">{</span><span class="cm">/* Server */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">InteractiveWidget</span><span class="w"> </span><span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span><span class="w"> </span><span class="p">{</span><span class="cm">/* Client */</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ‚ùå BAD: Client boundary at root</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Page</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">setData</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">();</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetchData</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">setData</span><span class="p">);</span><span class="w"> </span><span class="c1">// Client-side fetch</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">StaticHeader</span><span class="w"> </span><span class="p">/&gt;</span><span class="w"> </span><span class="p">{</span><span class="cm">/* Unnecessarily client-side */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">InteractiveWidget</span><span class="w"> </span><span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="prevention_15">Prevention</h3>
<ol>
<li><strong>Default to Server Components</strong></li>
<li><strong>Add <code>'use client'</code> only when needed</strong> (hooks, browser APIs, interactivity)</li>
<li><strong>Push <code>'use client'</code> down the tree</strong> as far as possible</li>
<li><strong>Pass data as props</strong> from Server to Client Components</li>
<li><strong>Use composition</strong> to nest Server Components inside Client Components</li>
</ol>
<h2 id="performance-pitfalls">Performance Pitfalls</h2>
<h2 id="pitfall-17-premature-optimization">Pitfall 17: Premature Optimization</h2>
<h3 id="symptom_16">Symptom</h3>
<p>Code is complex and hard to maintain. Performance is not noticeably better. Time spent optimizing instead of building features. Over-use of useMemo, useCallback, React.memo.</p>
<h3 id="browser-evidence_16">Browser Evidence</h3>
<p><strong>React DevTools - Profiler</strong>:
- Render time: 2.3ms (before optimization)
- Render time: 2.1ms (after optimization)
- Improvement: 0.2ms (negligible)</p>
<p><strong>Code Complexity</strong>:
- Before: 50 lines, easy to understand
- After: 120 lines, wrapped in useMemo/useCallback everywhere</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - WRONG: Over-optimized</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sort</span><span class="p">,</span><span class="w"> </span><span class="nx">setSort</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Unnecessary useMemo for simple filter</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filter</span><span class="p">]);</span>

<span class="w">  </span><span class="c1">// Unnecessary useMemo for simple sort</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sortedTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[...</span><span class="nx">filteredTasks</span><span class="p">].</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sort</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">filteredTasks</span><span class="p">,</span><span class="w"> </span><span class="nx">sort</span><span class="p">]);</span>

<span class="w">  </span><span class="c1">// Unnecessary useCallback for simple function</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleToggle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]);</span>

<span class="w">  </span><span class="c1">// Unnecessary useCallback for simple function</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">));</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span>
<span class="w">        </span><span class="na">filter</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="na">onFilterChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setFilter</span><span class="p">}</span>
<span class="w">        </span><span class="na">sort</span><span class="o">=</span><span class="p">{</span><span class="nx">sort</span><span class="p">}</span>
<span class="w">        </span><span class="na">onSortChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setSort</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span>
<span class="w">        </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">sortedTasks</span><span class="p">}</span>
<span class="w">        </span><span class="na">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">handleToggle</span><span class="p">}</span>
<span class="w">        </span><span class="na">onDelete</span><span class="o">=</span><span class="p">{</span><span class="nx">handleDelete</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Unnecessary React.memo for simple component</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">TaskList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskList</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onToggle</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onDelete</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">onToggle</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onDelete</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span><span class="w"> </span>
<span class="w">          </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
<span class="w">          </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span>
<span class="w">          </span><span class="na">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">onToggle</span><span class="p">}</span>
<span class="w">          </span><span class="na">onDelete</span><span class="o">=</span><span class="p">{</span><span class="nx">onDelete</span><span class="p">}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="root-cause_16">Root Cause</h3>
<p>Premature optimization makes code more complex without measurable benefit. The overhead of useMemo/useCallback (checking dependencies, comparing values) can be <strong>more expensive</strong> than the computation you're trying to optimize.</p>
<p>React is already fast. Most components render in &lt;5ms. Optimizing a 2ms render to 1ms is not worth the complexity.</p>
<h3 id="the-trap_16">The Trap</h3>
<p>You over-optimize because:
1. You've heard "always use useMemo/useCallback"
2. You think optimization is always good
3. You don't measure before optimizing
4. You follow cargo-cult patterns without understanding</p>
<h3 id="the-fix-optimize-only-when-needed">The Fix: Optimize Only When Needed</h3>
<p>Start simple, optimize only when profiling shows a problem:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// TaskManager.tsx - CORRECT: Simple, readable, fast enough</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">setTasks</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Task</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sort</span><span class="p">,</span><span class="w"> </span><span class="nx">setSort</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Compute during render - fast enough for most cases</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sortedTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">filteredTasks</span><span class="p">].</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sort</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleToggle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">completed</span><span class="o">:</span><span class="w"> </span><span class="o">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">completed</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">));</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskFilters</span><span class="w"> </span>
<span class="w">        </span><span class="na">filter</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="na">onFilterChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setFilter</span><span class="p">}</span>
<span class="w">        </span><span class="na">sort</span><span class="o">=</span><span class="p">{</span><span class="nx">sort</span><span class="p">}</span>
<span class="w">        </span><span class="na">onSortChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setSort</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskList</span><span class="w"> </span>
<span class="w">        </span><span class="na">tasks</span><span class="o">=</span><span class="p">{</span><span class="nx">sortedTasks</span><span class="p">}</span>
<span class="w">        </span><span class="na">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">handleToggle</span><span class="p">}</span>
<span class="w">        </span><span class="na">onDelete</span><span class="o">=</span><span class="p">{</span><span class="nx">handleDelete</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// No React.memo needed unless profiling shows re-render issues</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">TaskList</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onToggle</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onDelete</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">onToggle</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onDelete</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">TaskItem</span><span class="w"> </span>
<span class="w">          </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
<span class="w">          </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span>
<span class="w">          </span><span class="na">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">onToggle</span><span class="p">}</span>
<span class="w">          </span><span class="na">onDelete</span><span class="o">=</span><span class="p">{</span><span class="nx">onDelete</span><span class="p">}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-to-actually-optimize">When to Actually Optimize</h3>
<p>Optimize when <strong>profiling shows</strong> these issues:</p>
<p><strong>1. Expensive computation</strong> (&gt;50ms):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Profile shows this takes 80ms</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">expensiveResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computeExpensiveValue</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

<span class="c1">// Optimize with useMemo</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">expensiveResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(</span>
<span class="w">  </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">computeExpensiveValue</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="w">  </span><span class="p">[</span><span class="nx">data</span><span class="p">]</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>2. Large lists</strong> (&gt;100 items):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 1000 items, each re-renders unnecessarily</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">TaskItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">TaskItem</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>3. Frequent re-renders</strong> (&gt;10/second):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Parent re-renders every 100ms, child doesn&#39;t need to</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ExpensiveChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">ExpensiveChild</span><span class="p">({</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ComplexVisualization</span><span class="w"> </span><span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="optimization-decision-framework">Optimization Decision Framework</h3>
<p><strong>Before optimizing, ask</strong>:
1. <strong>Is there a performance problem?</strong> (Measure with Profiler)
2. <strong>Is it noticeable to users?</strong> (&gt;100ms is noticeable)
3. <strong>Is this the bottleneck?</strong> (Profile to find the real issue)
4. <strong>Will optimization help?</strong> (Sometimes the problem is elsewhere)</p>
<p><strong>If yes to all, then optimize. Otherwise, keep it simple.</strong></p>
<h3 id="prevention_16">Prevention</h3>
<ol>
<li><strong>Profile first</strong> with React DevTools Profiler</li>
<li><strong>Measure impact</strong> before and after optimization</li>
<li><strong>Start simple</strong>, optimize only when needed</li>
<li><strong>Focus on user-perceived performance</strong> (loading states, responsiveness)</li>
<li><strong>Remember</strong>: Readable code &gt; Premature optimization</li>
</ol>
<h2 id="quick-reference-diagnostic-decision-tree">Quick Reference: Diagnostic Decision Tree</h2>
<h2 id="diagnostic-decision-tree">Diagnostic Decision Tree</h2>
<p>When your React app breaks, follow this decision tree to identify the issue:</p>
<h3 id="1-component-not-rendering">1. Component Not Rendering</h3>
<p><strong>Symptom</strong>: Blank screen, component doesn't appear</p>
<p><strong>Check</strong>:
- Browser console for errors
- React DevTools: Is component in tree?
- Network tab: Did data fetch fail?</p>
<p><strong>Common causes</strong>:
- JavaScript error (check console)
- Conditional rendering hiding component
- CSS hiding component (check computed styles)
- Data not loaded yet (add loading state)</p>
<hr />
<h3 id="2-component-not-updating">2. Component Not Updating</h3>
<p><strong>Symptom</strong>: UI doesn't reflect state changes</p>
<p><strong>Check</strong>:
- React DevTools: Does state change?
- Console log: Is setState being called?
- React DevTools Profiler: Is component re-rendering?</p>
<p><strong>Common causes</strong>:
- <strong>Pitfall 2</strong>: Mutating state directly
- <strong>Pitfall 1</strong>: Stale closure in event handler
- <strong>Pitfall 10</strong>: Wrong key causing React to reuse component
- <strong>Pitfall 9</strong>: Component defined inside component</p>
<hr />
<h3 id="3-infinite-renders">3. Infinite Renders</h3>
<p><strong>Symptom</strong>: Browser freezes, console floods with logs</p>
<p><strong>Check</strong>:
- React DevTools Profiler: Render count
- Console: What's logging repeatedly?
- React DevTools: Which component is rendering?</p>
<p><strong>Common causes</strong>:
- <strong>Pitfall 8</strong>: useEffect with no dependency array
- <strong>Pitfall 5</strong>: useEffect with missing dependencies causing loop
- <strong>Pitfall 11</strong>: New object/array created on every render
- setState inside render (without condition)</p>
<hr />
<h3 id="4-memory-leak-warning">4. Memory Leak Warning</h3>
<p><strong>Symptom</strong>: "Can't perform a React state update on an unmounted component"</p>
<p><strong>Check</strong>:
- Console: Which component?
- Network tab: Are requests completing after unmount?
- Code: Are there timers or subscriptions?</p>
<p><strong>Common causes</strong>:
- <strong>Pitfall 7</strong>: Missing cleanup in useEffect
- Fetch request completing after unmount
- Timer/interval not cleared
- Event listener not removed</p>
<hr />
<h3 id="5-type-error-at-runtime">5. Type Error at Runtime</h3>
<p><strong>Symptom</strong>: "Cannot read property of undefined", "X is not a function"</p>
<p><strong>Check</strong>:
- Console: Exact error message and stack trace
- React DevTools: Component props and state
- Network tab: Is API returning expected data?</p>
<p><strong>Common causes</strong>:
- <strong>Pitfall 12</strong>: Type assertion hiding bug
- <strong>Pitfall 13</strong>: Using <code>any</code> instead of proper types
- API returning different data than expected
- Missing null/undefined check</p>
<hr />
<h3 id="6-hydration-mismatch">6. Hydration Mismatch</h3>
<p><strong>Symptom</strong>: "Hydration failed" warning, content flashes</p>
<p><strong>Check</strong>:
- Console: Hydration warning details
- View source: What's the server HTML?
- React DevTools: What's the client HTML?</p>
<p><strong>Common causes</strong>:
- <strong>Pitfall 15</strong>: Using Date.now(), Math.random(), or browser APIs
- Conditional rendering based on browser state
- Third-party library assuming browser environment</p>
<hr />
<h3 id="7-build-fails">7. Build Fails</h3>
<p><strong>Symptom</strong>: <code>npm run build</code> fails with error</p>
<p><strong>Check</strong>:
- Terminal: Full error message
- Error location: File and line number
- TypeScript errors vs. runtime errors</p>
<p><strong>Common causes</strong>:
- <strong>Pitfall 14</strong>: Using browser APIs in Server Component
- <strong>Pitfall 16</strong>: Missing 'use client' directive
- TypeScript errors
- Missing environment variables</p>
<hr />
<h3 id="8-slow-performance">8. Slow Performance</h3>
<p><strong>Symptom</strong>: App feels sluggish, interactions lag</p>
<p><strong>Check</strong>:
- React DevTools Profiler: Which components render slowly?
- Chrome Performance tab: What's blocking the main thread?
- Network tab: Are there slow requests?</p>
<p><strong>Common causes</strong>:
- <strong>Pitfall 17</strong>: Premature optimization making code complex
- Missing React.memo on expensive components
- Large lists without virtualization
- Expensive computation in render
- Too many re-renders</p>
<hr />
<h2 id="quick-diagnostic-checklist">Quick Diagnostic Checklist</h2>
<p>When debugging, systematically check:</p>
<ol>
<li><strong>Browser Console</strong>: Any errors or warnings?</li>
<li><strong>React DevTools - Components</strong>: </li>
<li>Is component in tree?</li>
<li>What are props/state values?</li>
<li>Is component highlighted (re-rendering)?</li>
<li><strong>React DevTools - Profiler</strong>:</li>
<li>How long does render take?</li>
<li>How many times does it render?</li>
<li>What triggered the render?</li>
<li><strong>Network Tab</strong>:</li>
<li>Did requests complete?</li>
<li>What's the response data?</li>
<li>Are there failed requests?</li>
<li><strong>Console Logs</strong>:</li>
<li>Add strategic logs to trace execution</li>
<li>Log state before and after updates</li>
<li>Log effect runs and cleanups</li>
</ol>
<hr />
<h2 id="common-error-messages-decoded">Common Error Messages Decoded</h2>
<h3 id="cannot-read-properties-of-undefined-reading-x">"Cannot read properties of undefined (reading 'X')"</h3>
<p><strong>Meaning</strong>: You're accessing a property on <code>undefined</code></p>
<p><strong>Fix</strong>: Add null check or optional chaining</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="c1">// CORRECT</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;Guest&#39;</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</code></pre></div>

<hr />
<h3 id="maximum-update-depth-exceeded">"Maximum update depth exceeded"</h3>
<p><strong>Meaning</strong>: Infinite render loop</p>
<p><strong>Fix</strong>: Check useEffect dependencies and setState calls</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">setState</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span><span class="w"> </span><span class="c1">// Runs on every render</span>
<span class="p">});</span>

<span class="c1">// CORRECT</span>
<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">setState</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">dependency</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Only runs when dependency changes</span>
</code></pre></div>

<hr />
<h3 id="objects-are-not-valid-as-a-react-child">"Objects are not valid as a React child"</h3>
<p><strong>Meaning</strong>: Trying to render an object directly</p>
<p><strong>Fix</strong>: Render object properties, not the object itself</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c1">// CORRECT</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<hr />
<h3 id="each-child-in-a-list-should-have-a-unique-key-prop">"Each child in a list should have a unique 'key' prop"</h3>
<p><strong>Meaning</strong>: Missing or duplicate keys in list</p>
<p><strong>Fix</strong>: Use stable, unique IDs as keys</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}&gt;...&lt;/</span><span class="nt">div</span><span class="p">&gt;)}</span>

<span class="c1">// CORRECT</span>
<span class="p">{</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;...&lt;/</span><span class="nt">div</span><span class="p">&gt;)}</span>
</code></pre></div>

<hr />
<h3 id="cant-perform-a-react-state-update-on-an-unmounted-component">"Can't perform a React state update on an unmounted component"</h3>
<p><strong>Meaning</strong>: setState called after component unmounted</p>
<p><strong>Fix</strong>: Add cleanup to useEffect</p>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">isMounted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">  </span><span class="nx">fetchData</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isMounted</span><span class="p">)</span><span class="w"> </span><span class="nx">setState</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isMounted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<hr />
<h3 id="rendered-fewer-hooks-than-expected">"Rendered fewer hooks than expected"</h3>
<p><strong>Meaning</strong>: Conditional hook call</p>
<p><strong>Fix</strong>: Never call hooks conditionally</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// WRONG</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// CORRECT</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Use state here</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="conclusion-building-your-debugging-intuition">Conclusion: Building Your Debugging Intuition</h2>
<h2 id="building-your-debugging-intuition">Building Your Debugging Intuition</h2>
<p>The pitfalls in this appendix represent the most common ways React applications fail. But memorizing them isn't enough‚Äîyou need to develop <strong>debugging intuition</strong>.</p>
<h3 id="the-experts-debugging-process">The Expert's Debugging Process</h3>
<p>When an expert React developer encounters a bug, they follow this mental model:</p>
<p><strong>1. Observe the symptom</strong>
- What does the user see?
- What's the expected behavior?
- What's the actual behavior?</p>
<p><strong>2. Gather evidence</strong>
- Browser console: Errors, warnings, logs
- React DevTools: Component tree, props, state, render count
- Network tab: Request/response data, timing
- Performance tab: What's blocking the main thread?</p>
<p><strong>3. Form a hypothesis</strong>
- Based on the evidence, what's the most likely cause?
- Which pitfall does this match?
- What would confirm or refute this hypothesis?</p>
<p><strong>4. Test the hypothesis</strong>
- Add strategic console.logs
- Use React DevTools to inspect state
- Simplify the code to isolate the issue
- Try the fix and verify it works</p>
<p><strong>5. Understand the root cause</strong>
- Why did this happen?
- What mechanism caused this failure?
- How can I prevent this in the future?</p>
<h3 id="from-pitfall-to-pattern">From Pitfall to Pattern</h3>
<p>Each pitfall teaches a deeper lesson:</p>
<ul>
<li><strong>Pitfall 1 (Stale Closure)</strong> ‚Üí Understand JavaScript closures and React's render cycle</li>
<li><strong>Pitfall 2 (Direct Mutation)</strong> ‚Üí Understand immutability and reference equality</li>
<li><strong>Pitfall 5 (Missing Dependencies)</strong> ‚Üí Understand effect dependencies and closures</li>
<li><strong>Pitfall 7 (Missing Cleanup)</strong> ‚Üí Understand component lifecycle and memory management</li>
<li><strong>Pitfall 10 (Index as Key)</strong> ‚Üí Understand React's reconciliation algorithm</li>
<li><strong>Pitfall 14 (Client APIs in Server)</strong> ‚Üí Understand Next.js rendering model</li>
</ul>
<h3 id="the-path-to-mastery">The Path to Mastery</h3>
<p>Mastery comes from:
1. <strong>Encountering failures</strong> and understanding why they happened
2. <strong>Reading error messages</strong> systematically to extract all information
3. <strong>Using DevTools</strong> to observe what's actually happening
4. <strong>Building mental models</strong> of how React works under the hood
5. <strong>Recognizing patterns</strong> across different failures</p>
<h3 id="your-debugging-toolkit">Your Debugging Toolkit</h3>
<p>Keep these tools sharp:</p>
<p><strong>Browser DevTools</strong>:
- Console: Read every error message carefully
- Network: Understand request/response patterns
- Performance: Profile slow interactions
- Elements: Inspect computed styles and DOM</p>
<p><strong>React DevTools</strong>:
- Components: Inspect props, state, hooks
- Profiler: Measure render performance
- Highlight updates: See what's re-rendering</p>
<p><strong>Code Techniques</strong>:
- Strategic console.logs
- Simplification: Remove code until it works
- Isolation: Test components in isolation
- Type checking: Let TypeScript catch errors early</p>
<h3 id="final-wisdom">Final Wisdom</h3>
<p>The best debugging skill is <strong>prevention</strong>. Write code that:
- Uses TypeScript to catch errors at compile time
- Validates external data at runtime
- Follows React's rules (immutability, stable keys, proper dependencies)
- Is simple and readable (complexity breeds bugs)</p>
<p>When bugs do occur (and they will), approach them systematically:
1. Don't guess‚Äîgather evidence
2. Don't fix symptoms‚Äîunderstand root causes
3. Don't move on‚Äîlearn the lesson</p>
<p>Every bug you encounter and fix makes you a better React developer. This appendix is your field guide, but experience is your teacher.</p>
<p><strong>Happy debugging!</strong></p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 12:33:34 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>