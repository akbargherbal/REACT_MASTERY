<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11 Zustand- Global State Without the Ceremony</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">03 Modern State Management</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-11-zustand-global-state-without-the-ceremony">Chapter 11: Zustand: Global State Without the Ceremony</h1>
<h2 id="why-not-redux-in-2025">Why not Redux (in 2025)</h2>
<h2 id="why-not-redux-in-2025_1">Why not Redux (in 2025)</h2>
<p>In Chapter 10, we built a Task Board using Context API. It worked‚Äîuntil it didn't. When we added real-time updates and complex filtering, every state change triggered re-renders across the entire component tree. Context is powerful for dependency injection and theming, but it's not optimized for frequently changing application state.</p>
<p>For years, Redux was the default answer to global state management in React. But Redux comes with significant ceremony: actions, action creators, reducers, dispatch, connect/useSelector, middleware setup, and a steep learning curve. In 2025, we have better options that give us Redux's power without its complexity.</p>
<h3 id="the-redux-tax-what-you-pay-for-power">The Redux Tax: What You Pay for Power</h3>
<p>Let's see what managing a simple counter looks like in Redux:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// store/counterSlice.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">PayloadAction</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@reduxjs/toolkit&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">CounterState</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">initialState</span><span class="o">:</span><span class="w"> </span><span class="kt">CounterState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">counterSlice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createSlice</span><span class="p">({</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;counter&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">initialState</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reducers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">increment</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">decrement</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">incrementByAmount</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">PayloadAction</span><span class="o">&lt;</span><span class="kt">number</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">increment</span><span class="p">,</span><span class="w"> </span><span class="nx">decrement</span><span class="p">,</span><span class="w"> </span><span class="nx">incrementByAmount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">counterSlice</span><span class="p">.</span><span class="nx">actions</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">counterSlice</span><span class="p">.</span><span class="nx">reducer</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// store/store.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">configureStore</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@reduxjs/toolkit&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">counterReducer</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./counterSlice&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">configureStore</span><span class="p">({</span>
<span class="w">  </span><span class="nx">reducer</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">counter</span><span class="o">:</span><span class="w"> </span><span class="kt">counterReducer</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>

<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">RootState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ReturnType</span><span class="o">&lt;</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">AppDispatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// store/hooks.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TypedUseSelectorHook</span><span class="p">,</span><span class="w"> </span><span class="nx">useDispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">useSelector</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-redux&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RootState</span><span class="p">,</span><span class="w"> </span><span class="nx">AppDispatch</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./store&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useAppDispatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">useDispatch</span><span class="o">&lt;</span><span class="nx">AppDispatch</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useAppSelector</span><span class="o">:</span><span class="w"> </span><span class="kt">TypedUseSelectorHook</span><span class="o">&lt;</span><span class="nx">RootState</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useSelector</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// App.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Provider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-redux&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">store</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./store/store&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Counter</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/Counter&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">Provider</span><span class="w"> </span><span class="na">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Counter</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">Provider</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// components/Counter.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAppDispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">useAppSelector</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/hooks&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">increment</span><span class="p">,</span><span class="w"> </span><span class="nx">decrement</span><span class="p">,</span><span class="w"> </span><span class="nx">incrementByAmount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/counterSlice&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Counter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAppSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">dispatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAppDispatch</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">increment</span><span class="p">())}&gt;</span><span class="o">+</span><span class="mf">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">decrement</span><span class="p">())}&gt;</span><span class="o">-</span><span class="mf">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">incrementByAmount</span><span class="p">(</span><span class="mf">5</span><span class="p">))}&gt;</span><span class="o">+</span><span class="mf">5</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">Counter</span><span class="p">;</span>
</code></pre></div>

<p><strong>What we just wrote</strong>:
- 5 separate files
- ~100 lines of code
- Type definitions for state, actions, and dispatch
- Custom hooks for type-safe access
- Provider wrapper in the root component</p>
<p><strong>What we got</strong>: A counter that increments and decrements.</p>
<p>This is Redux Toolkit (RTK), the modern, simplified version of Redux. Classic Redux was even more verbose. RTK is excellent for large applications with complex state interactions, time-travel debugging requirements, and teams that need strict patterns. But for most applications, this is overkill.</p>
<h3 id="what-we-actually-need">What We Actually Need</h3>
<p>Most applications need:
1. <strong>Global state</strong> that multiple components can access
2. <strong>Selective subscriptions</strong> so components only re-render when their specific data changes
3. <strong>Simple updates</strong> without action creators and reducers
4. <strong>TypeScript support</strong> without fighting the type system
5. <strong>DevTools</strong> for debugging
6. <strong>Minimal boilerplate</strong> so we can focus on features</p>
<p>Redux provides all of this, but at a high cost. Context API provides #1 but fails at #2. We need something in between.</p>
<h3 id="enter-zustand">Enter Zustand</h3>
<p>Zustand (German for "state") is a small, fast state management library that gives you Redux's power with a fraction of the code. Here's the same counter in Zustand:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// store/useCounterStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">CounterState</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">increment</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">decrement</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">incrementByAmount</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useCounterStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">CounterState</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<span class="w">  </span><span class="nx">increment</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">state.count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">})),</span>
<span class="w">  </span><span class="nx">decrement</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">state.count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">})),</span>
<span class="w">  </span><span class="nx">incrementByAmount</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">state.count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="p">})),</span>
<span class="p">}));</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// components/Counter.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useCounterStore</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/useCounterStore&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Counter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCounterStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCounterStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">increment</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">decrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCounterStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">decrement</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">incrementByAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCounterStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">incrementByAmount</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">increment</span><span class="p">}&gt;</span><span class="o">+</span><span class="mf">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">decrement</span><span class="p">}&gt;</span><span class="o">-</span><span class="mf">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">incrementByAmount</span><span class="p">(</span><span class="mf">5</span><span class="p">)}&gt;</span><span class="o">+</span><span class="mf">5</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">Counter</span><span class="p">;</span>
</code></pre></div>

<p><strong>What we just wrote</strong>:
- 2 files
- ~30 lines of code
- No providers, no reducers, no action creators
- Full TypeScript support
- Automatic selective subscriptions</p>
<p><strong>What we got</strong>: The exact same functionality.</p>
<h3 id="the-zustand-philosophy">The Zustand Philosophy</h3>
<p>Zustand's design philosophy:
1. <strong>Hooks-first</strong>: Use it like <code>useState</code>, but global
2. <strong>No providers</strong>: No wrapping your app in context providers
3. <strong>Selector-based subscriptions</strong>: Components only re-render when their selected data changes
4. <strong>Immutable updates</strong>: Use the <code>set</code> function, which handles immutability
5. <strong>Minimal API surface</strong>: Learn 3 functions, use them everywhere</p>
<h3 id="when-to-choose-what">When to Choose What</h3>
<p><strong>Use Context API when</strong>:
- State rarely changes (theme, locale, auth user)
- You need dependency injection
- State is truly tree-scoped (not global)
- You're okay with all consumers re-rendering</p>
<p><strong>Use Zustand when</strong>:
- State changes frequently
- Multiple unrelated components need the same data
- You need selective subscriptions for performance
- You want simple, readable code</p>
<p><strong>Use Redux when</strong>:
- You need time-travel debugging
- Your team requires strict patterns and conventions
- You have complex state interactions that benefit from reducers
- You're integrating with Redux-specific middleware (Redux Saga, Redux Observable)</p>
<p><strong>Use React Query when</strong>:
- You're managing server state (API data)
- You need caching, background refetching, and optimistic updates
- The data's source of truth is the server, not the client</p>
<p>In this chapter, we'll build a real-world application with Zustand and see how it handles the challenges that broke Context API in Chapter 10.</p>
<h2 id="setting-up-zustand">Setting up Zustand</h2>
<h2 id="setting-up-zustand_1">Setting up Zustand</h2>
<h3 id="reference-implementation-multi-user-task-board">Reference Implementation: Multi-User Task Board</h3>
<p>We're building a collaborative task management application. Think Trello or Linear, but simplified. Our requirements:</p>
<p><strong>Features</strong>:
- Create, update, delete tasks
- Assign tasks to users
- Filter tasks by status, assignee, and priority
- Real-time updates (simulated with polling)
- Optimistic updates for instant feedback
- Undo/redo for task operations</p>
<p><strong>Why this example</strong>:
- Complex state with multiple entities (tasks, users, filters)
- Frequent updates (drag-and-drop, status changes)
- Performance-critical (many components reading the same data)
- Real-world patterns (optimistic updates, undo/redo)</p>
<p><strong>Project Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">src</span><span class="o">/</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">components</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">TaskBoard</span><span class="p">.</span><span class="nx">tsx</span><span class="w">          </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Main</span><span class="w"> </span><span class="nx">board</span><span class="w"> </span><span class="nx">component</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">TaskColumn</span><span class="p">.</span><span class="nx">tsx</span><span class="w">         </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Column</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">status</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">TaskCard</span><span class="p">.</span><span class="nx">tsx</span><span class="w">           </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Individual</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="nx">card</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="p">.</span><span class="nx">tsx</span><span class="w">        </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Filter</span><span class="w"> </span><span class="nx">controls</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">CreateTaskForm</span><span class="p">.</span><span class="nx">tsx</span><span class="w">     </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">New</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="nx">form</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">store</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">.</span><span class="nx">ts</span><span class="w">        </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Our</span><span class="w"> </span><span class="nx">Zustand</span><span class="w"> </span><span class="nx">store</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">types</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">ts</span><span class="w">                </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">TypeScript</span><span class="w"> </span><span class="nx">types</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">App</span><span class="p">.</span><span class="nx">tsx</span>
</code></pre></div>

<h3 id="installation">Installation</h3>
<p>First, install Zustand:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>zustand
</code></pre></div>

<p>That's it. No peer dependencies, no configuration files, no setup ceremony.</p>
<h3 id="defining-our-types">Defining Our Types</h3>
<p>Before building the store, let's define our domain types:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/types/task.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">TaskPriority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStatus</span><span class="p">;</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskPriority</span><span class="p">;</span>
<span class="w">  </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStatus</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskPriority</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="creating-our-first-store-naive-version">Creating Our First Store (Naive Version)</h3>
<p>Let's start with a simple store that just holds tasks:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="p">,</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/task&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">TaskState</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskFilters</span><span class="p">;</span>
<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Omit</span><span class="o">&lt;</span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;createdAt&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;updatedAt&#39;</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">TaskFilters</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskState</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="c1">// Initial state</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë©&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë®&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üßë&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// Actions</span>
<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">taskData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">,</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="p">...</span><span class="nx">taskData</span><span class="p">,</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">newFilters</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">newFilters</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">})),</span>
<span class="p">}));</span>
</code></pre></div>

<p><strong>What we just created</strong>:
- A store with state (<code>tasks</code>, <code>users</code>, <code>filters</code>)
- Actions that modify state (<code>addTask</code>, <code>updateTask</code>, <code>deleteTask</code>, <code>setFilters</code>)
- Immutable updates using spread operators
- TypeScript types for everything</p>
<p><strong>How it works</strong>:
1. <code>create&lt;TaskState&gt;()</code> creates a hook that components can use
2. The function receives <code>set</code>, which updates the store
3. <code>set</code> takes a function that receives current state and returns new state
4. Updates are shallow-merged (like <code>setState</code> in class components)</p>
<h3 id="using-the-store-in-components">Using the Store in Components</h3>
<p>Now let's build a simple task list to see the store in action:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/TaskBoard.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/useTaskStore&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">TaskCard</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./TaskCard&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">CreateTaskForm</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./CreateTaskForm&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskBoard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Filter tasks based on current filters</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-board&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Task</span><span class="w"> </span><span class="nx">Board</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">CreateTaskForm</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">filteredTasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">TaskCard</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">TaskBoard</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/TaskCard.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/useTaskStore&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/task&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">TaskCardProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskCard</span><span class="p">({</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">TaskCardProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">updateTask</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">deleteTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">deleteTask</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">users</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">assignee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">u</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-card&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-meta&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="sb">`priority-</span><span class="si">${</span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="si">}</span><span class="sb">`</span><span class="p">}&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="sb">`status-</span><span class="si">${</span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">}&gt;{</span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">assignee</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">assignee</span><span class="p">.</span><span class="nx">avatar</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">assignee</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-actions&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">updateTask</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="w"> </span><span class="p">})}&gt;</span>
<span class="w">          </span><span class="nx">Mark</span><span class="w"> </span><span class="nx">Done</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">deleteTask</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">)}&gt;</span><span class="nx">Delete</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">TaskCard</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/CreateTaskForm.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/useTaskStore&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TaskPriority</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/task&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">CreateTaskForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">addTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">addTask</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">users</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">title</span><span class="p">,</span><span class="w"> </span><span class="nx">setTitle</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">description</span><span class="p">,</span><span class="w"> </span><span class="nx">setDescription</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">priority</span><span class="p">,</span><span class="w"> </span><span class="nx">setPriority</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">TaskPriority</span><span class="p">&gt;(</span><span class="s1">&#39;medium&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">assigneeId</span><span class="p">,</span><span class="w"> </span><span class="nx">setAssigneeId</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FormEvent</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">title</span><span class="p">.</span><span class="nx">trim</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="nx">addTask</span><span class="p">({</span>
<span class="w">      </span><span class="nx">title</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="p">,</span>
<span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">priority</span><span class="p">,</span>
<span class="w">      </span><span class="nx">assigneeId</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Reset form</span>
<span class="w">    </span><span class="nx">setTitle</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setDescription</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setPriority</span><span class="p">(</span><span class="s1">&#39;medium&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setAssigneeId</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">form</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;create-task-form&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">        </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="w">        </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Task title&quot;</span>
<span class="w">        </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span>
<span class="w">        </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTitle</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">textarea</span>
<span class="w">        </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Description&quot;</span>
<span class="w">        </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">description</span><span class="p">}</span>
<span class="w">        </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setDescription</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">select</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">priority</span><span class="p">}</span><span class="w"> </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setPriority</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">TaskPriority</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;low&quot;</span><span class="p">&gt;</span><span class="nx">Low</span><span class="w"> </span><span class="nx">Priority</span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;medium&quot;</span><span class="p">&gt;</span><span class="nx">Medium</span><span class="w"> </span><span class="nx">Priority</span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;high&quot;</span><span class="p">&gt;</span><span class="nx">High</span><span class="w"> </span><span class="nx">Priority</span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">select</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span><span class="w"> </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setAssigneeId</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">null</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span><span class="nx">Unassigned</span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">option</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">avatar</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span><span class="nx">Create</span><span class="w"> </span><span class="nx">Task</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">CreateTaskForm</span><span class="p">;</span>
</code></pre></div>

<h3 id="running-the-application">Running the Application</h3>
<p>Let's test what we've built:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="nx">TaskBoard</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/TaskBoard&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;./App.css&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;app&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">TaskBoard</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Form appears at the top
- Create a task: "Implement authentication"
- Task appears immediately in the list
- Click "Mark Done": Status updates instantly
- Click "Delete": Task disappears</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No errors, no warnings)
</code></pre></div>

<p><strong>React DevTools - Components Tab</strong>:
- <code>TaskBoard</code> component
  - Props: (none)
  - Hooks: (none - using Zustand, not useState)
- <code>TaskCard</code> components (one per task)
  - Props: <code>{ task: {...} }</code>
  - Hooks: (none)</p>
<p><strong>What's happening</strong>:
1. Components call <code>useTaskStore</code> with a selector function
2. Zustand subscribes the component to only the selected data
3. When <code>addTask</code> is called, Zustand updates the store
4. Only components that selected <code>tasks</code> re-render
5. Components that only selected <code>users</code> or <code>filters</code> don't re-render</p>
<p>This is the key difference from Context API: <strong>selective subscriptions</strong>.</p>
<h3 id="the-selector-pattern">The Selector Pattern</h3>
<p>Notice how we use the store:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">addTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">addTask</span><span class="p">);</span>
</code></pre></div>

<p><strong>Not</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">addTask</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">();</span>
</code></pre></div>

<p><strong>Why?</strong> The second approach subscribes the component to the entire store. Any change to any part of the store triggers a re-render. The first approach (selector pattern) subscribes only to the specific data you select.</p>
<p><strong>Rule of thumb</strong>: Always use selectors. Always.</p>
<h3 id="current-limitations">Current Limitations</h3>
<p>Our store works, but it has problems:</p>
<ol>
<li><strong>No derived state</strong>: We're filtering tasks in the component, which means every component that needs filtered tasks must duplicate this logic</li>
<li><strong>No computed values</strong>: We can't efficiently compute things like "number of tasks per status"</li>
<li><strong>No persistence</strong>: Refresh the page, lose all tasks</li>
<li><strong>No optimistic updates</strong>: When we add a task, we wait for the store update</li>
<li><strong>No undo/redo</strong>: Can't reverse actions</li>
</ol>
<p>In the next sections, we'll solve these problems using Zustand's advanced features.</p>
<h2 id="slices-selectors-and-middleware">Slices, selectors, and middleware</h2>
<h2 id="slices-selectors-and-middleware_1">Slices, selectors, and middleware</h2>
<p>Our basic store works, but as the application grows, we'll face new challenges. Let's encounter them one by one and solve them with Zustand's advanced features.</p>
<h3 id="the-failure-duplicated-filter-logic">The Failure: Duplicated Filter Logic</h3>
<p><strong>Current problem</strong>: Every component that needs filtered tasks must duplicate the filtering logic.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// In TaskBoard.tsx</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// In TaskColumn.tsx (if we had one)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Same logic duplicated</span>
<span class="p">});</span>

<span class="c1">// In TaskStats.tsx (if we had one)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Same logic duplicated again</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Let's see this fail</strong>: Add a new component that needs filtered tasks:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/TaskStats.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/useTaskStore&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskStats</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Duplicated filtering logic</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">todoCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">inProgressCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">doneCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-stats&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Todo</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">todoCount</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">In</span><span class="w"> </span><span class="nx">Progress</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">inProgressCount</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Done</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">doneCount</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">TaskStats</span><span class="p">;</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Stats display correctly
- But we've now written the same filtering logic three times</p>
<p><strong>The problem</strong>:
1. Code duplication (DRY violation)
2. Inconsistency risk (if we update one, we must update all)
3. Performance waste (filtering happens in every component)
4. Testing burden (must test filtering in multiple places)</p>
<h3 id="diagnostic-analysis-reading-the-duplication">Diagnostic Analysis: Reading the Duplication</h3>
<p><strong>What the code reveals</strong>:
- Same filtering logic in <code>TaskBoard.tsx</code>, <code>TaskColumn.tsx</code>, <code>TaskStats.tsx</code>
- Each component subscribes to <code>tasks</code> and <code>filters</code>
- Each component re-runs filtering on every render
- No memoization, no caching</p>
<p><strong>Root cause identified</strong>: Filtering is business logic, not view logic. It belongs in the store, not in components.</p>
<p><strong>What we need</strong>: Derived state‚Äîcomputed values that automatically update when their dependencies change.</p>
<h3 id="solution-selectors-for-derived-state">Solution: Selectors for Derived State</h3>
<p>Zustand doesn't have built-in computed values like MobX or Vue, but we can create them using selector functions:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="p">,</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/task&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">TaskState</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskFilters</span><span class="p">;</span>
<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Omit</span><span class="o">&lt;</span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;createdAt&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;updatedAt&#39;</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">TaskFilters</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskState</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë©&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë®&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üßë&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">taskData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">,</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="p">...</span><span class="nx">taskData</span><span class="p">,</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">newFilters</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">newFilters</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">})),</span>
<span class="p">}));</span>

<span class="c1">// Selector functions (outside the store)</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">todo</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">inProgress</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">done</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTaskStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">todoCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.todo.length</span><span class="p">,</span>
<span class="w">    </span><span class="nx">inProgressCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.inProgress.length</span><span class="p">,</span>
<span class="w">    </span><span class="nx">doneCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.done.length</span><span class="p">,</span>
<span class="w">    </span><span class="nx">totalCount</span><span class="o">:</span><span class="w"> </span><span class="kt">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Created <code>selectFilteredTasks</code> function that encapsulates filtering logic
- Created <code>selectTasksByStatus</code> that groups tasks by status
- Created <code>selectTaskStats</code> that computes counts
- All selectors are pure functions that take state and return derived data</p>
<p>Now update the components to use these selectors:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/TaskBoard.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">,</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/useTaskStore&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">TaskCard</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./TaskCard&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">CreateTaskForm</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./CreateTaskForm&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskBoard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">(</span><span class="nx">selectFilteredTasks</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-board&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Task</span><span class="w"> </span><span class="nx">Board</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">CreateTaskForm</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">filteredTasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">TaskCard</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">task</span><span class="o">=</span><span class="p">{</span><span class="nx">task</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">TaskBoard</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/TaskStats.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">,</span><span class="w"> </span><span class="nx">selectTaskStats</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../store/useTaskStore&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">TaskStats</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="p">(</span><span class="nx">selectTaskStats</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;task-stats&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Todo</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="p">.</span><span class="nx">todoCount</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">In</span><span class="w"> </span><span class="nx">Progress</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="p">.</span><span class="nx">inProgressCount</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Done</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="p">.</span><span class="nx">doneCount</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Total</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="p">.</span><span class="nx">totalCount</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">TaskStats</span><span class="p">;</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Same functionality as before
- But now filtering logic is centralized</p>
<p><strong>React DevTools - Profiler</strong>:
- Record a render
- Change filters
- Both <code>TaskBoard</code> and <code>TaskStats</code> re-render
- But filtering logic runs only once per component (not duplicated)</p>
<p><strong>Improvement</strong>: Code is DRY, maintainable, and testable in one place.</p>
<h3 id="the-failure-performance-degradation-with-many-tasks">The Failure: Performance Degradation with Many Tasks</h3>
<p><strong>New scenario</strong>: Let's add 1000 tasks and see what happens:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Add this to your store initialization for testing</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generateMockTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">statuses</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStatus</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">];</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">priorities</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskPriority</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">];</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">];</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="kt">count</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="sb">`task-</span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`Task </span><span class="si">${</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Description for task </span><span class="si">${</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">statuses</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="kt">priorities</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span>
<span class="w">    </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="kt">userIds</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span>
<span class="w">    </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">,</span>
<span class="w">  </span><span class="p">}));</span>
<span class="p">};</span>

<span class="c1">// In your store</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskState</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">generateMockTasks</span><span class="p">(</span><span class="mf">1000</span><span class="p">),</span><span class="w"> </span><span class="c1">// ‚Üê Add 1000 tasks for testing</span>
<span class="w">  </span><span class="c1">// ... rest of store</span>
<span class="p">}));</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Page loads slowly
- Scrolling feels janky
- Changing filters has noticeable lag</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No errors, but performance is poor)
</code></pre></div>

<p><strong>React DevTools - Profiler</strong>:
- Record interaction: Change filter from "all" to "todo"
- <code>TaskBoard</code> render time: 245ms
- <code>TaskStats</code> render time: 180ms
- Both components re-rendered
- Filtering ran twice (once per component)</p>
<p><strong>Chrome Performance Tab</strong>:
- Main thread blocked for 400ms
- Scripting: 380ms (filtering arrays)
- Rendering: 20ms</p>
<h3 id="diagnostic-analysis-reading-the-performance-problem">Diagnostic Analysis: Reading the Performance Problem</h3>
<p><strong>What the profiler reveals</strong>:
1. Both components subscribe to different selectors
2. Both selectors call <code>selectFilteredTasks</code>
3. Filtering 1000 tasks twice = 2000 filter operations
4. No memoization = filtering runs on every render</p>
<p><strong>Root cause identified</strong>: Selectors are pure functions, but they're not memoized. Every time a component calls <code>useTaskStore(selectFilteredTasks)</code>, the selector runs from scratch.</p>
<p><strong>What we need</strong>: Memoization‚Äîcache the result and only recompute when dependencies change.</p>
<h3 id="solution-memoized-selectors-with-zustand-middleware">Solution: Memoized Selectors with Zustand Middleware</h3>
<p>Zustand doesn't include memoization by default, but we can add it easily. Let's use a simple memoization approach:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>zustand
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="p">,</span><span class="w"> </span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/task&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">TaskState</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskFilters</span><span class="p">;</span>
<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Omit</span><span class="o">&lt;</span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;createdAt&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;updatedAt&#39;</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">TaskFilters</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskState</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">generateMockTasks</span><span class="p">(</span><span class="mf">1000</span><span class="p">),</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë©&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë®&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üßë&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">taskData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">,</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="p">...</span><span class="nx">taskData</span><span class="p">,</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">newFilters</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">newFilters</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">})),</span>
<span class="p">}));</span>

<span class="c1">// Simple memoization helper</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">R</span><span class="p">,</span>
<span class="w">  </span><span class="nx">equalityFn</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastState</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastResult</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">R</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selector</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">equalityFn</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">lastState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Memoized selectors</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Custom equality: compare array length and first/last items</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todo</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">inProgress</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">done</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTaskStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todoCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.todo.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">inProgressCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.inProgress.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doneCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.done.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">totalCount</span><span class="o">:</span><span class="w"> </span><span class="kt">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">generateMockTasks</span><span class="p">(</span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">statuses</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStatus</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">];</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">priorities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">];</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="kt">count</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="sb">`task-</span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`Task </span><span class="si">${</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Description for task </span><span class="si">${</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">statuses</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="kt">priorities</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span>
<span class="w">    </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="kt">userIds</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span>
<span class="w">    </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">,</span>
<span class="w">  </span><span class="p">}));</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Created <code>createMemoizedSelector</code> helper that caches results
- Wrapped all selectors with memoization
- Added custom equality function for array comparison
- Selectors now return cached results when inputs haven't changed</p>
<p><strong>Browser Behavior</strong>:
- Page loads faster
- Scrolling is smooth
- Filter changes are instant</p>
<p><strong>React DevTools - Profiler</strong>:
- Record interaction: Change filter from "all" to "todo"
- <code>TaskBoard</code> render time: 12ms (was 245ms)
- <code>TaskStats</code> render time: 8ms (was 180ms)
- Filtering ran once, result was cached</p>
<p><strong>Performance Metrics</strong>:
- <strong>Before</strong>:
  - Filter change: 400ms blocked time
  - Filtering: 2000 operations
  - Render time: 425ms total</p>
<ul>
<li><strong>After</strong>:</li>
<li>Filter change: 20ms blocked time (95% improvement)</li>
<li>Filtering: 1000 operations (cached for second component)</li>
<li>Render time: 20ms total (95% improvement)</li>
</ul>
<p><strong>Improvement</strong>: Memoization eliminated redundant computation. The first component computes, subsequent components use the cached result.</p>
<h3 id="the-failure-lost-state-on-page-refresh">The Failure: Lost State on Page Refresh</h3>
<p><strong>Current problem</strong>: Create some tasks, refresh the page‚Äîeverything's gone.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Create tasks in the UI</span>
<span class="c1">// Refresh the page</span>
<span class="c1">// All tasks disappear</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Tasks exist in memory only
- Page refresh resets to initial state
- No persistence</p>
<p><strong>What we need</strong>: Middleware to persist state to localStorage and rehydrate on load.</p>
<h3 id="solution-persist-middleware">Solution: Persist Middleware</h3>
<p>Zustand provides a <code>persist</code> middleware for this exact use case:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">persist</span><span class="p">,</span><span class="w"> </span><span class="nx">createJSONStorage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand/middleware&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="p">,</span><span class="w"> </span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/task&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">TaskState</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskFilters</span><span class="p">;</span>
<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Omit</span><span class="o">&lt;</span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;createdAt&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;updatedAt&#39;</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">TaskFilters</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskState</span><span class="o">&gt;</span><span class="p">()(</span>
<span class="w">  </span><span class="nx">persist</span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">      </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë©&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë®&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üßë&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>

<span class="w">      </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">taskData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">,</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="p">...</span><span class="nx">taskData</span><span class="p">,</span>
<span class="w">              </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">              </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">              </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">        </span><span class="p">})),</span>

<span class="w">      </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">            </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span>
<span class="w">              </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">              </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">          </span><span class="p">),</span>
<span class="w">        </span><span class="p">})),</span>

<span class="w">      </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">),</span>
<span class="w">        </span><span class="p">})),</span>

<span class="w">      </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">newFilters</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">newFilters</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">})),</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;task-storage&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// localStorage key</span>
<span class="w">      </span><span class="nx">storage</span><span class="o">:</span><span class="w"> </span><span class="kt">createJSONStorage</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">),</span>
<span class="w">      </span><span class="nx">partialize</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks</span><span class="p">,</span>
<span class="w">        </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">state.filters</span><span class="p">,</span>
<span class="w">        </span><span class="c1">// Don&#39;t persist users (they&#39;re static)</span>
<span class="w">      </span><span class="p">}),</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Selectors remain the same</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todo</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">inProgress</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">done</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTaskStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todoCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.todo.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">inProgressCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.inProgress.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doneCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.done.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">totalCount</span><span class="o">:</span><span class="w"> </span><span class="kt">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">R</span><span class="p">,</span>
<span class="w">  </span><span class="nx">equalityFn</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastState</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastResult</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">R</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selector</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">equalityFn</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">lastState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Wrapped store with <code>persist</code> middleware
- Specified <code>name</code> for localStorage key
- Used <code>partialize</code> to choose what to persist (tasks and filters, not users)
- State now automatically saves to localStorage on every change</p>
<p><strong>Browser Behavior</strong>:
- Create tasks
- Refresh page
- Tasks persist!</p>
<p><strong>Browser DevTools - Application Tab</strong>:
- Navigate to Local Storage
- See key: <code>task-storage</code>
- Value: JSON with tasks and filters</p>
<p><strong>Verification</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;tasks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Implement authentication&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;todo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="err">...</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;assigneeId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Improvement</strong>: State persists across page refreshes. Users don't lose their work.</p>
<h3 id="slicing-the-store-organizing-complex-state">Slicing the Store: Organizing Complex State</h3>
<p>As our store grows, keeping everything in one object becomes unwieldy. Let's organize it into slices:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/slices/taskSlice.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StateCreator</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../types/task&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Omit</span><span class="o">&lt;</span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;createdAt&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;updatedAt&#39;</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createTaskSlice</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">TaskSlice</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>

<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">taskData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">,</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="p">...</span><span class="nx">taskData</span><span class="p">,</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">          </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">),</span>
<span class="w">    </span><span class="p">})),</span>
<span class="p">});</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/slices/filterSlice.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StateCreator</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TaskFilters</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../types/task&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">FilterSlice</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskFilters</span><span class="p">;</span>
<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">TaskFilters</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">resetFilters</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">defaultFilters</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskFilters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">assigneeId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createFilterSlice</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">FilterSlice</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">defaultFilters</span><span class="p">,</span>

<span class="w">  </span><span class="nx">setFilters</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">newFilters</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">newFilters</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">})),</span>

<span class="w">  </span><span class="nx">resetFilters</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">defaultFilters</span><span class="p">,</span>
<span class="w">    </span><span class="p">})),</span>
<span class="p">});</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/slices/userSlice.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StateCreator</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../types/task&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">UserSlice</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">addUser</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createUserSlice</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">UserSlice</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë©&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üë®&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">avatar</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üßë&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">],</span>

<span class="w">  </span><span class="nx">addUser</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="p">[...</span><span class="nx">state</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">],</span>
<span class="w">    </span><span class="p">})),</span>
<span class="p">});</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">persist</span><span class="p">,</span><span class="w"> </span><span class="nx">createJSONStorage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand/middleware&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createTaskSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/taskSlice&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createFilterSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">FilterSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/filterSlice&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createUserSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">UserSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/userSlice&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">TaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FilterSlice</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskStore</span><span class="o">&gt;</span><span class="p">()(</span>
<span class="w">  </span><span class="nx">persist</span><span class="p">(</span>
<span class="w">    </span><span class="p">(...</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="p">...</span><span class="nx">createTaskSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">      </span><span class="p">...</span><span class="nx">createFilterSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">      </span><span class="p">...</span><span class="nx">createUserSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;task-storage&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">storage</span><span class="o">:</span><span class="w"> </span><span class="kt">createJSONStorage</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">),</span>
<span class="w">      </span><span class="nx">partialize</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks</span><span class="p">,</span>
<span class="w">        </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">state.filters</span><span class="p">,</span>
<span class="w">      </span><span class="p">}),</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Selectors remain the same</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todo</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">inProgress</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">done</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTaskStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todoCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.todo.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">inProgressCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.inProgress.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doneCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.done.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">totalCount</span><span class="o">:</span><span class="w"> </span><span class="kt">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">R</span><span class="p">,</span>
<span class="w">  </span><span class="nx">equalityFn</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastState</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastResult</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">R</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selector</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">equalityFn</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">lastState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Split store into three slices: tasks, filters, users
- Each slice is a separate file with its own types and logic
- Combined slices in the main store using spread operator
- Store remains a single source of truth, but code is organized</p>
<p><strong>Project Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code>src/
‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îú‚îÄ‚îÄ slices/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ taskSlice.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filterSlice.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userSlice.ts
‚îÇ   ‚îî‚îÄ‚îÄ useTaskStore.ts
</code></pre></div>

<p><strong>Benefits</strong>:
- Each slice is independently testable
- Clear separation of concerns
- Easy to add new slices without touching existing code
- Type safety maintained across slices</p>
<h3 id="when-to-apply-slices-vs-single-store">When to Apply: Slices vs. Single Store</h3>
<p><strong>Use slices when</strong>:
- Store has multiple distinct domains (tasks, users, settings)
- Different team members work on different parts of state
- You want to test state logic in isolation
- Store file exceeds ~200 lines</p>
<p><strong>Use single store when</strong>:
- State is simple and cohesive
- All state is tightly coupled
- Store is small (&lt;100 lines)
- Splitting would create artificial boundaries</p>
<p><strong>Code characteristics</strong>:
- Slices: More files, better organization, easier testing
- Single store: Fewer files, simpler mental model, faster to navigate</p>
<h2 id="devtools-and-debugging">Devtools and debugging</h2>
<h2 id="devtools-and-debugging_1">Devtools and debugging</h2>
<p>Our store is now feature-complete, but debugging state changes is still difficult. Let's add proper debugging tools and learn how to diagnose problems in Zustand stores.</p>
<h3 id="the-failure-invisible-state-changes">The Failure: Invisible State Changes</h3>
<p><strong>Current problem</strong>: When a bug occurs, we can't see what changed in the store or why.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// User reports: &quot;I clicked &#39;Mark Done&#39; but the task didn&#39;t update&quot;</span>
<span class="c1">// We have no visibility into:</span>
<span class="c1">// - Was the action called?</span>
<span class="c1">// - Did the state change?</span>
<span class="c1">// - Did the component re-render?</span>
<span class="c1">// - Was the selector correct?</span>
</code></pre></div>

<p><strong>Let's create this failure</strong>: Add a bug to the <code>updateTask</code> action:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/slices/taskSlice.ts</span>
<span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span>
<span class="w">        </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">  </span><span class="p">})),</span>
</code></pre></div>

<p>Now introduce a typo:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;typo&#39;</span><span class="w"> </span><span class="c1">// ‚Üê Bug: id will never match</span>
<span class="w">        </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">  </span><span class="p">})),</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Click "Mark Done" on a task
- Nothing happens
- No error in console
- Task status doesn't change</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No output - silent failure)
</code></pre></div>

<p><strong>React DevTools - Components Tab</strong>:
- <code>TaskCard</code> component selected
- Props: <code>{ task: { id: "task-1", status: "todo", ... } }</code>
- No indication of what went wrong</p>
<h3 id="diagnostic-analysis-reading-the-silent-failure">Diagnostic Analysis: Reading the Silent Failure</h3>
<p><strong>What the user experiences</strong>:
- Expected: Task status changes to "done"
- Actual: Task status remains "todo"</p>
<p><strong>What the console reveals</strong>: Nothing. No errors, no warnings.</p>
<p><strong>What DevTools shows</strong>: Component didn't re-render because state didn't change.</p>
<p><strong>Root cause identified</strong>: The action ran, but the condition <code>task.id === id + 'typo'</code> never matched, so no task was updated. State remained unchanged, so no re-render occurred.</p>
<p><strong>Why the current approach can't solve this</strong>: We have no visibility into:
1. Whether the action was called
2. What the action received as arguments
3. What the state was before the action
4. What the state is after the action
5. Whether the state actually changed</p>
<p><strong>What we need</strong>: Logging middleware to trace all state changes.</p>
<h3 id="solution-devtools-middleware">Solution: DevTools Middleware</h3>
<p>Zustand provides a <code>devtools</code> middleware that integrates with Redux DevTools:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install Redux DevTools browser extension first</span>
<span class="c1"># Chrome: https://chrome.google.com/webstore/detail/redux-devtools/</span>
<span class="c1"># Firefox: https://addons.mozilla.org/en-US/firefox/addon/reduxdevtools/</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">persist</span><span class="p">,</span><span class="w"> </span><span class="nx">createJSONStorage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand/middleware&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">devtools</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand/middleware&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createTaskSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/taskSlice&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createFilterSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">FilterSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/filterSlice&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createUserSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">UserSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/userSlice&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">TaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FilterSlice</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskStore</span><span class="o">&gt;</span><span class="p">()(</span>
<span class="w">  </span><span class="nx">devtools</span><span class="p">(</span>
<span class="w">    </span><span class="nx">persist</span><span class="p">(</span>
<span class="w">      </span><span class="p">(...</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="p">...</span><span class="nx">createTaskSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">        </span><span class="p">...</span><span class="nx">createFilterSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">        </span><span class="p">...</span><span class="nx">createUserSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">      </span><span class="p">}),</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;task-storage&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">storage</span><span class="o">:</span><span class="w"> </span><span class="kt">createJSONStorage</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">),</span>
<span class="w">        </span><span class="nx">partialize</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks</span><span class="p">,</span>
<span class="w">          </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">state.filters</span><span class="p">,</span>
<span class="w">        </span><span class="p">}),</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TaskStore&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Name shown in DevTools</span>
<span class="w">      </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="c1">// Enable in development</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Selectors remain the same</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todo</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">inProgress</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">done</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTaskStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todoCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.todo.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">inProgressCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.inProgress.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doneCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.done.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">totalCount</span><span class="o">:</span><span class="w"> </span><span class="kt">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">R</span><span class="p">,</span>
<span class="w">  </span><span class="nx">equalityFn</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastState</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastResult</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">R</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selector</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">equalityFn</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">lastState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Wrapped store with <code>devtools</code> middleware
- Specified store name for DevTools
- Middleware order matters: <code>devtools(persist(...))</code> not <code>persist(devtools(...))</code></p>
<p>Now let's add action names to make debugging clearer:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/slices/taskSlice.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StateCreator</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../types/task&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">Task</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">task</span><span class="o">:</span><span class="w"> </span><span class="kt">Omit</span><span class="o">&lt;</span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;createdAt&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;updatedAt&#39;</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createTaskSlice</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">TaskSlice</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">set</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>

<span class="w">  </span><span class="nx">addTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">taskData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">,</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="p">...</span><span class="nx">taskData</span><span class="p">,</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">crypto.randomUUID</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">      </span><span class="p">}),</span>
<span class="w">      </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;tasks/add&#39;</span><span class="w"> </span><span class="c1">// ‚Üê Action name for DevTools</span>
<span class="w">    </span><span class="p">),</span>

<span class="w">  </span><span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">          </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;typo&#39;</span><span class="w"> </span><span class="c1">// ‚Üê Bug still present</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">}),</span>
<span class="w">      </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;tasks/update&#39;</span><span class="w"> </span><span class="c1">// ‚Üê Action name for DevTools</span>
<span class="w">    </span><span class="p">),</span>

<span class="w">  </span><span class="nx">deleteTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">),</span>
<span class="w">      </span><span class="p">}),</span>
<span class="w">      </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;tasks/delete&#39;</span><span class="w"> </span><span class="c1">// ‚Üê Action name for DevTools</span>
<span class="w">    </span><span class="p">),</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Open Redux DevTools (browser extension)
- Click "Mark Done" on a task
- DevTools shows action: <code>tasks/update</code></p>
<p><strong>Redux DevTools - Action Tab</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Action</span><span class="o">:</span><span class="w"> </span><span class="n">tasks</span><span class="o">/</span><span class="n">update</span>
<span class="n">State</span><span class="w"> </span><span class="o">(</span><span class="n">before</span><span class="o">):</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">tasks</span><span class="o">:</span><span class="w"> </span><span class="o">[...],</span><span class="w"> </span><span class="n">filters</span><span class="o">:</span><span class="w"> </span><span class="o">{...},</span><span class="w"> </span><span class="n">users</span><span class="o">:</span><span class="w"> </span><span class="o">[...]</span><span class="w"> </span><span class="o">}</span>
<span class="n">State</span><span class="w"> </span><span class="o">(</span><span class="n">after</span><span class="o">):</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">tasks</span><span class="o">:</span><span class="w"> </span><span class="o">[...],</span><span class="w"> </span><span class="n">filters</span><span class="o">:</span><span class="w"> </span><span class="o">{...},</span><span class="w"> </span><span class="n">users</span><span class="o">:</span><span class="w"> </span><span class="o">[...]</span><span class="w"> </span><span class="o">}</span>
<span class="n">Diff</span><span class="o">:</span><span class="w"> </span><span class="o">(</span><span class="n">no</span><span class="w"> </span><span class="n">changes</span><span class="o">)</span>
</code></pre></div>

<p><strong>Redux DevTools - State Tab</strong>:
- Can inspect full state tree
- Can see that <code>tasks</code> array is identical before and after
- Can see the specific task that should have changed</p>
<p><strong>Redux DevTools - Diff Tab</strong>:</p>
<div class="codehilite"><pre><span></span><code>(no changes detected)
</code></pre></div>

<p><strong>Diagnostic insight</strong>: The action ran, but state didn't change. This tells us the problem is in the action logic, not in the component or selector.</p>
<h3 id="debugging-workflow-using-devtools-to-find-the-bug">Debugging Workflow: Using DevTools to Find the Bug</h3>
<p><strong>Step 1: Verify the action was called</strong>
- Redux DevTools shows <code>tasks/update</code> action
- ‚úì Action was called</p>
<p><strong>Step 2: Check the action payload</strong>
- DevTools doesn't show payload by default
- Let's add payload logging</p>
<p><strong>Step 3: Add custom logging</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/slices/taskSlice.ts</span>
<span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">set</span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;updateTask called:&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="w"> </span><span class="p">});</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Current tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">updatedTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;typo&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Checking task </span><span class="si">${</span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">: matches=</span><span class="si">${</span><span class="nx">matches</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">matches</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Updated tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedTasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">t.id</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">t.status</span><span class="w"> </span><span class="p">})));</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">updatedTasks</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;tasks/update&#39;</span>
<span class="w">  </span><span class="p">),</span>
</code></pre></div>

<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>updateTask called: { id: &quot;task-1&quot;, updates: { status: &quot;done&quot; } }
Current tasks: [&quot;task-1&quot;, &quot;task-2&quot;, &quot;task-3&quot;]
Checking task task-1: matches=false
Checking task task-2: matches=false
Checking task task-3: matches=false
Updated tasks: [
  { id: &quot;task-1&quot;, status: &quot;todo&quot; },
  { id: &quot;task-2&quot;, status: &quot;in-progress&quot; },
  { id: &quot;task-3&quot;, status: &quot;done&quot; }
]
</code></pre></div>

<p><strong>Diagnostic insight</strong>: 
- Action received correct <code>id</code>: <code>"task-1"</code>
- But <code>task.id === id + 'typo'</code> evaluates to <code>"task-1" === "task-1typo"</code> ‚Üí <code>false</code>
- No task matched, so no task was updated</p>
<p><strong>Bug found</strong>: The condition has <code>+ 'typo'</code> appended to <code>id</code>.</p>
<p><strong>Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/slices/taskSlice.ts</span>
<span class="nx">updateTask</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">set</span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks.map</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">task</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="c1">// ‚Üê Fixed: removed &#39;typo&#39;</span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">updates</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="nx">task</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">    </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;tasks/update&#39;</span>
<span class="w">  </span><span class="p">),</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
- Click "Mark Done"
- Task status changes to "done"
- Redux DevTools shows state change</p>
<p><strong>Redux DevTools - Diff Tab</strong>:</p>
<div class="codehilite"><pre><span></span><code>tasks[0].status: &quot;todo&quot; ‚Üí &quot;done&quot;
tasks[0].updatedAt: 1704067200000 ‚Üí 1704067201000
</code></pre></div>

<p><strong>Verification</strong>: Bug fixed. DevTools helped us trace the exact problem.</p>
<h3 id="custom-logging-middleware">Custom Logging Middleware</h3>
<p>For more control over logging, we can create custom middleware:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/middleware/logger.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StateCreator</span><span class="p">,</span><span class="w"> </span><span class="nx">StoreMutatorIdentifier</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">Logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span>
<span class="w">  </span><span class="nx">T</span><span class="p">,</span>
<span class="w">  </span><span class="nx">Mps</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="p">[</span><span class="nx">StoreMutatorIdentifier</span><span class="p">,</span><span class="w"> </span><span class="nx">unknown</span><span class="p">][]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nx">Mcs</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="p">[</span><span class="nx">StoreMutatorIdentifier</span><span class="p">,</span><span class="w"> </span><span class="nx">unknown</span><span class="p">][]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">f</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">Mps</span><span class="p">,</span><span class="w"> </span><span class="nx">Mcs</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span>
<span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">Mps</span><span class="p">,</span><span class="w"> </span><span class="nx">Mcs</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">LoggerImpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">f</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="p">[]</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span>
<span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">loggerImpl</span><span class="o">:</span><span class="w"> </span><span class="kt">LoggerImpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">set</span><span class="p">,</span><span class="w"> </span><span class="nx">get</span><span class="p">,</span><span class="w"> </span><span class="nx">store</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">loggedSet</span><span class="o">:</span><span class="w"> </span><span class="kt">typeof</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(...</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">prevState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">get</span><span class="p">();</span>
<span class="w">    </span><span class="nx">set</span><span class="p">(...</span><span class="nx">a</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">nextState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">get</span><span class="p">();</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="sb">`üîÑ </span><span class="si">${</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Store&#39;</span><span class="si">}</span><span class="sb"> Update`</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Previous State:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">prevState</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Next State:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">nextState</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Changed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">findChanges</span><span class="p">(</span><span class="nx">prevState</span><span class="p">,</span><span class="w"> </span><span class="nx">nextState</span><span class="p">));</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">groupEnd</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">store</span><span class="p">.</span><span class="nx">setState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loggedSet</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">loggedSet</span><span class="p">,</span><span class="w"> </span><span class="nx">get</span><span class="p">,</span><span class="w"> </span><span class="nx">store</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loggerImpl</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Logger</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">findChanges</span><span class="o">&lt;</span><span class="nx">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">object</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">prev</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Partial</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">changes</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prev</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">next</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">changes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">next</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">changes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">persist</span><span class="p">,</span><span class="w"> </span><span class="nx">createJSONStorage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand/middleware&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">devtools</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand/middleware&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middleware/logger&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createTaskSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/taskSlice&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createFilterSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">FilterSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/filterSlice&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createUserSlice</span><span class="p">,</span><span class="w"> </span><span class="nx">UserSlice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./slices/userSlice&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">TaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TaskSlice</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FilterSlice</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskStore</span><span class="o">&gt;</span><span class="p">()(</span>
<span class="w">  </span><span class="nx">logger</span><span class="p">(</span>
<span class="w">    </span><span class="nx">devtools</span><span class="p">(</span>
<span class="w">      </span><span class="nx">persist</span><span class="p">(</span>
<span class="w">        </span><span class="p">(...</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="p">...</span><span class="nx">createTaskSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">          </span><span class="p">...</span><span class="nx">createFilterSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">          </span><span class="p">...</span><span class="nx">createUserSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">        </span><span class="p">}),</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;task-storage&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">storage</span><span class="o">:</span><span class="w"> </span><span class="kt">createJSONStorage</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">),</span>
<span class="w">          </span><span class="nx">partialize</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">            </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks</span><span class="p">,</span>
<span class="w">            </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">state.filters</span><span class="p">,</span>
<span class="w">          </span><span class="p">}),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TaskStore&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="s1">&#39;TaskStore&#39;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Selectors remain the same</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tasks</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">task</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">assigneeId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">assigneeId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">priority</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todo</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;todo&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">inProgress</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;in-progress&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">done</span><span class="o">:</span><span class="w"> </span><span class="kt">filteredTasks.filter</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;done&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectTaskStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">TaskStore</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tasksByStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectTasksByStatus</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">todoCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.todo.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">inProgressCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.inProgress.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doneCount</span><span class="o">:</span><span class="w"> </span><span class="kt">tasksByStatus.done.length</span><span class="p">,</span>
<span class="w">      </span><span class="nx">totalCount</span><span class="o">:</span><span class="w"> </span><span class="kt">selectFilteredTasks</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">createMemoizedSelector</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">R</span><span class="p">,</span>
<span class="w">  </span><span class="nx">equalityFn</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastState</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastResult</span><span class="o">:</span><span class="w"> </span><span class="kt">R</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">R</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selector</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">equalityFn</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">lastResult</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">lastState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="w">    </span><span class="nx">lastResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser Console</strong> (when updating a task):</p>
<div class="codehilite"><pre><span></span><code>üîÑ<span class="w"> </span><span class="nv">TaskStore</span><span class="w"> </span><span class="nv">Update</span>
<span class="w">  </span><span class="nv">Previous</span><span class="w"> </span><span class="nv">State</span>:<span class="w"> </span>{<span class="w"> </span><span class="nv">tasks</span>:<span class="w"> </span>[...],<span class="w"> </span><span class="nv">filters</span>:<span class="w"> </span>{...},<span class="w"> </span><span class="nv">users</span>:<span class="w"> </span>[...]<span class="w"> </span>}
<span class="w">  </span><span class="k">Next</span><span class="w"> </span><span class="nv">State</span>:<span class="w"> </span>{<span class="w"> </span><span class="nv">tasks</span>:<span class="w"> </span>[...],<span class="w"> </span><span class="nv">filters</span>:<span class="w"> </span>{...},<span class="w"> </span><span class="nv">users</span>:<span class="w"> </span>[...]<span class="w"> </span>}
<span class="w">  </span><span class="nv">Changed</span>:<span class="w"> </span>{<span class="w"> </span><span class="nv">tasks</span>:<span class="w"> </span>[...]<span class="w"> </span>}
</code></pre></div>

<p><strong>When to use custom logging</strong>:
- Development environment only
- Debugging complex state interactions
- Tracing performance issues
- Understanding re-render patterns</p>
<p><strong>Production considerations</strong>:
- Disable logging in production builds
- Use environment variables to control logging
- Consider using a proper logging service (Sentry, LogRocket)</p>
<h3 id="common-failure-modes-and-their-signatures">Common Failure Modes and Their Signatures</h3>
<h4 id="symptom-component-doesnt-re-render-when-state-changes">Symptom: Component doesn't re-render when state changes</h4>
<p><strong>Browser behavior</strong>: State updates in DevTools, but UI doesn't change</p>
<p><strong>Console pattern</strong>: No errors</p>
<p><strong>DevTools clues</strong>:
- Redux DevTools shows state change
- React DevTools shows component didn't re-render
- Component's selector might be returning the same reference</p>
<p><strong>Root cause</strong>: Selector is not detecting the change (reference equality issue)</p>
<p><strong>Solution</strong>: Check selector's equality function or use a different selector</p>
<h4 id="symptom-state-updates-but-immediately-reverts">Symptom: State updates but immediately reverts</h4>
<p><strong>Browser behavior</strong>: UI flashes the new state, then reverts</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>üîÑ TaskStore Update
  Changed: { tasks: [...] }
üîÑ TaskStore Update
  Changed: { tasks: [...] }  ‚Üê Reverted
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Two rapid state updates
- Second update undoes the first</p>
<p><strong>Root cause</strong>: Multiple sources of truth or competing updates</p>
<p><strong>Solution</strong>: Ensure single source of truth, use optimistic updates correctly</p>
<h4 id="symptom-entire-app-re-renders-on-any-state-change">Symptom: Entire app re-renders on any state change</h4>
<p><strong>Browser behavior</strong>: App feels sluggish, all components flash in React DevTools</p>
<p><strong>Console pattern</strong>: No errors, but many render logs</p>
<p><strong>DevTools clues</strong>:
- React Profiler shows all components re-rendering
- Components are selecting entire store instead of specific slices</p>
<p><strong>Root cause</strong>: Components using <code>useTaskStore()</code> instead of <code>useTaskStore(selector)</code></p>
<p><strong>Solution</strong>: Always use selectors, never subscribe to entire store</p>
<h3 id="debugging-workflow-when-your-store-fails">Debugging Workflow: When Your Store Fails</h3>
<p><strong>Step 1: Verify the action was called</strong>
- Check Redux DevTools for action name
- If no action appears, the problem is in the component (event handler not firing)</p>
<p><strong>Step 2: Check the action payload</strong>
- Add console.log in the action
- Verify the action received correct arguments</p>
<p><strong>Step 3: Inspect state before and after</strong>
- Use Redux DevTools Diff tab
- Verify state actually changed</p>
<p><strong>Step 4: Check component subscriptions</strong>
- Use React DevTools to see which components re-rendered
- Verify components are using correct selectors</p>
<p><strong>Step 5: Verify selector logic</strong>
- Add console.log in selector
- Check if selector is returning expected data</p>
<p><strong>Step 6: Check for reference equality issues</strong>
- If selector returns new object/array every time, component will always re-render
- Use memoization or custom equality function</p>
<h3 id="performance-debugging-with-zustand">Performance Debugging with Zustand</h3>
<p>Let's add performance tracking to our store:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/middleware/performance.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StateCreator</span><span class="p">,</span><span class="w"> </span><span class="nx">StoreMutatorIdentifier</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">Performance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span>
<span class="w">  </span><span class="nx">T</span><span class="p">,</span>
<span class="w">  </span><span class="nx">Mps</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="p">[</span><span class="nx">StoreMutatorIdentifier</span><span class="p">,</span><span class="w"> </span><span class="nx">unknown</span><span class="p">][]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nx">Mcs</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="p">[</span><span class="nx">StoreMutatorIdentifier</span><span class="p">,</span><span class="w"> </span><span class="nx">unknown</span><span class="p">][]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">f</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">Mps</span><span class="p">,</span><span class="w"> </span><span class="nx">Mcs</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span>
<span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">Mps</span><span class="p">,</span><span class="w"> </span><span class="nx">Mcs</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">PerformanceImpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">f</span><span class="o">:</span><span class="w"> </span><span class="kt">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="p">[]</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span>
<span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">StateCreator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">performanceImpl</span><span class="o">:</span><span class="w"> </span><span class="kt">PerformanceImpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">set</span><span class="p">,</span><span class="w"> </span><span class="nx">get</span><span class="p">,</span><span class="w"> </span><span class="nx">store</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">perfSet</span><span class="o">:</span><span class="w"> </span><span class="kt">typeof</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(...</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">    </span><span class="nx">set</span><span class="p">(...</span><span class="nx">a</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">duration</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Longer than one frame (60fps)</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span>
<span class="w">        </span><span class="sb">`‚ö†Ô∏è Slow state update in </span><span class="si">${</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Store&#39;</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">duration</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">ms`</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">store</span><span class="p">.</span><span class="nx">setState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">perfSet</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">perfSet</span><span class="p">,</span><span class="w"> </span><span class="nx">get</span><span class="p">,</span><span class="w"> </span><span class="nx">store</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">performance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performanceImpl</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Performance</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/store/useTaskStore.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">performance</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middleware/performance&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useTaskStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">TaskStore</span><span class="o">&gt;</span><span class="p">()(</span>
<span class="w">  </span><span class="nx">performance</span><span class="p">(</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">(</span>
<span class="w">      </span><span class="nx">devtools</span><span class="p">(</span>
<span class="w">        </span><span class="nx">persist</span><span class="p">(</span>
<span class="w">          </span><span class="p">(...</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">            </span><span class="p">...</span><span class="nx">createTaskSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">            </span><span class="p">...</span><span class="nx">createFilterSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">            </span><span class="p">...</span><span class="nx">createUserSlice</span><span class="p">(...</span><span class="nx">a</span><span class="p">),</span>
<span class="w">          </span><span class="p">}),</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;task-storage&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">storage</span><span class="o">:</span><span class="w"> </span><span class="kt">createJSONStorage</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">),</span>
<span class="w">            </span><span class="nx">partialize</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">              </span><span class="nx">tasks</span><span class="o">:</span><span class="w"> </span><span class="kt">state.tasks</span><span class="p">,</span>
<span class="w">              </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="kt">state.filters</span><span class="p">,</span>
<span class="w">            </span><span class="p">}),</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TaskStore&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">      </span><span class="s1">&#39;TaskStore&#39;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="s1">&#39;TaskStore&#39;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>Browser Console</strong> (if state update is slow):</p>
<div class="codehilite"><pre><span></span><code>‚ö†Ô∏è Slow state update in TaskStore: 23.45ms
</code></pre></div>

<p><strong>When this appears</strong>: State update took longer than 16ms (one frame at 60fps), which could cause jank.</p>
<p><strong>What to do</strong>:
1. Check if you're doing expensive computation in the action
2. Consider moving computation to a selector
3. Use memoization for expensive operations
4. Profile with React DevTools Profiler to find the bottleneck</p>
<h3 id="the-complete-debugging-toolkit">The Complete Debugging Toolkit</h3>
<p><strong>Browser DevTools</strong>:
- Console: Action logs, error messages
- Network: API calls (if fetching data)
- Performance: Main thread activity, frame rate</p>
<p><strong>React DevTools</strong>:
- Components: Props, state, hooks
- Profiler: Render timing, why components rendered</p>
<p><strong>Redux DevTools</strong>:
- Action: All state changes with action names
- State: Full state tree inspection
- Diff: What changed between states
- Trace: Stack trace for each action</p>
<p><strong>Custom Middleware</strong>:
- Logger: Detailed state change logs
- Performance: Timing for state updates
- Error boundary: Catch and log errors in actions</p>
<h3 id="when-to-apply-debugging-strategies">When to Apply: Debugging Strategies</h3>
<p><strong>Use Redux DevTools when</strong>:
- Debugging state changes
- Understanding action flow
- Time-travel debugging (undo/redo)
- Inspecting state tree</p>
<p><strong>Use custom logging when</strong>:
- Need more detailed output than DevTools provides
- Debugging specific action logic
- Tracking performance issues
- Development environment only</p>
<p><strong>Use performance middleware when</strong>:
- App feels sluggish
- Investigating render performance
- Optimizing state updates
- Identifying bottlenecks</p>
<p><strong>Disable all debugging in production</strong>:
- Use environment variables
- Strip logging in build process
- Keep DevTools for development only</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 12:42:29 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>