<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14 Advanced Routing Patterns</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">04 Routing and Navigation</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-14-advanced-routing-patterns">Chapter 14: Advanced Routing Patterns</h1>
<h2 id="code-splitting-and-lazy-loading">Code splitting and lazy loading</h2>
<h2 id="the-problem-everything-loads-at-once">The Problem: Everything Loads at Once</h2>
<p>In Chapter 13, we built a multi-page documentation site with React Router. It works‚Äîusers can navigate between pages without full page reloads. But there's a hidden performance problem that becomes obvious as the application grows.</p>
<p>Let's establish our reference implementation: a documentation site with multiple sections. This will be our anchor example throughout this chapter.</p>
<p><strong>Project Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code>src/
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ Home.tsx           ‚Üê Landing page
‚îÇ   ‚îú‚îÄ‚îÄ GettingStarted.tsx ‚Üê Tutorial content
‚îÇ   ‚îú‚îÄ‚îÄ APIReference.tsx   ‚Üê Large API docs
‚îÇ   ‚îú‚îÄ‚îÄ Examples.tsx       ‚Üê Code examples
‚îÇ   ‚îî‚îÄ‚îÄ Changelog.tsx      ‚Üê Version history
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ Navigation.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Layout.tsx
‚îî‚îÄ‚îÄ App.tsx               ‚Üê Router setup
</code></pre></div>

<p>Here's our initial implementation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">BrowserRouter</span><span class="p">,</span><span class="w"> </span><span class="nx">Routes</span><span class="p">,</span><span class="w"> </span><span class="nx">Route</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Layout</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/Layout&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Home</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/Home&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">GettingStarted</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/GettingStarted&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">APIReference</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/APIReference&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Examples</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/Examples&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Changelog</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/Changelog&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">BrowserRouter</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Routes</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">index</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">Home</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;getting-started&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">GettingStarted</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;api&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">APIReference</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;examples&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">Examples</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;changelog&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">Changelog</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">Route</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Routes</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">BrowserRouter</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<h2 id="route-based-data-loading">Route-based data loading</h2>
<h2 id="the-problem-data-fetching-waterfalls">The Problem: Data Fetching Waterfalls</h2>
<p>Our routes load quickly now, but there's another performance problem. Let's add data fetching to our API Reference page:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/APIReference.tsx - Initial Implementation</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">APIMethod</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">examples</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">APIReference</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">methods</span><span class="p">,</span><span class="w"> </span><span class="nx">setMethods</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">APIMethod</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/methods&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setMethods</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">API</span><span class="w"> </span><span class="nx">methods</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="ne">Error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;api-reference&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">API</span><span class="w"> </span><span class="nx">Reference</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">methods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">method</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">method</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;method&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">method</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">method</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="cm">/* Render method details */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Let's see what happens when a user navigates to the API Reference page:</p>
<p><strong>Browser DevTools - Network Tab</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Timeline</span><span class="p">:</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="s2">&quot;API Reference&quot;</span><span class="w"> </span><span class="n">link</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">starts</span>
<span class="mf">1.9</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">finishes</span><span class="w"> </span><span class="n">downloading</span>
<span class="mf">1.9</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">React</span><span class="w"> </span><span class="n">renders</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">useEffect</span><span class="w"> </span><span class="n">runs</span>
<span class="mf">1.9</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">methods</span><span class="w"> </span><span class="n">starts</span>
<span class="mf">3.2</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">methods</span><span class="w"> </span><span class="n">finishes</span><span class="w"> </span><span class="p">(</span><span class="mf">1.3</span><span class="n">s</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">time</span><span class="p">)</span>
<span class="mf">3.2</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Content</span><span class="w"> </span><span class="n">appears</span>
</code></pre></div>

<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">React</span><span class="w"> </span><span class="n">Router</span><span class="p">]</span><span class="w"> </span><span class="n">Navigating</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">/</span><span class="n">api</span>
<span class="p">[</span><span class="n">Suspense</span><span class="p">]</span><span class="w"> </span><span class="n">APIReference</span><span class="w"> </span><span class="n">suspended</span>
<span class="p">[</span><span class="n">Suspense</span><span class="p">]</span><span class="w"> </span><span class="n">APIReference</span><span class="w"> </span><span class="n">resolved</span>
<span class="p">[</span><span class="n">Component</span><span class="p">]</span><span class="w"> </span><span class="n">APIReference</span><span class="w"> </span><span class="n">mounted</span>
<span class="p">[</span><span class="n">Network</span><span class="p">]</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">methods</span>
<span class="p">[</span><span class="n">Component</span><span class="p">]</span><span class="w"> </span><span class="n">APIReference</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">data</span>
</code></pre></div>

<h3 id="diagnostic-analysis-the-waterfall-problem">Diagnostic Analysis: The Waterfall Problem</h3>
<p><strong>Browser Behavior</strong>:
User clicks "API Reference". They see "Loading page..." for 1.9 seconds. Then they see "Loading API methods..." for another 1.3 seconds. Total wait: 3.2 seconds before seeing content.</p>
<p><strong>Network Tab Evidence</strong>:
The smoking gun: Sequential requests.
1. First: Download the component code (1.9s)
2. Then: Download the data (1.3s)
3. Total: 3.2 seconds</p>
<p>This is a <strong>waterfall</strong>: The second request can't start until the first completes.</p>
<p><strong>Performance Metrics</strong>:
- Time to First Byte (TTFB): 1.9s (waiting for component)
- Time to Content: 3.2s (waiting for component + data)
- Largest Contentful Paint (LCP): 3.4s (poor)</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Page loads in ~2 seconds</li>
<li>
<p>Actual: Two separate loading states, 3.2 seconds total</p>
</li>
<li>
<p><strong>What the Network tab reveals</strong>:</p>
</li>
<li>Key indicator: Sequential requests (waterfall pattern)</li>
<li>Component code must download before data request starts</li>
<li>
<p>Each request blocks the next</p>
</li>
<li>
<p><strong>Root cause identified</strong>: The component code contains the data fetching logic. React can't fetch data until the component code downloads and executes. The data request is blocked by the code request.</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: <code>useEffect</code> runs after component mounts. Component can't mount until its code downloads. This creates an unavoidable waterfall.</p>
</li>
<li>
<p><strong>What we need</strong>: A way to start fetching data before the component code downloads. Ideally, both requests should start simultaneously.</p>
</li>
</ol>
<h3 id="solution-1-loader-functions-react-router-64">Solution 1: Loader Functions (React Router 6.4+)</h3>
<p>React Router 6.4 introduced <strong>loaders</strong>: functions that run before a route renders. They can fetch data in parallel with component code.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/loaders/apiReferenceLoader.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoaderFunctionArgs</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">APIMethod</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">examples</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">apiReferenceLoader</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">LoaderFunctionArgs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/methods&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to load API methods: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">methods</span><span class="o">:</span><span class="w"> </span><span class="kt">APIMethod</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/APIReference.tsx - Iteration 1: Using Loader</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useLoaderData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">APIMethod</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../loaders/apiReferenceLoader&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">APIReference</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Data is already loaded by the time component renders</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLoaderData</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">methods</span><span class="o">:</span><span class="w"> </span><span class="kt">APIMethod</span><span class="p">[]</span><span class="w"> </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;api-reference&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">API</span><span class="w"> </span><span class="nx">Reference</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">methods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">method</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">method</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;method&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">method</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">method</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="cm">/* Render method details */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Iteration 4: Adding Loader to Route</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">createBrowserRouter</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">RouterProvider</span><span class="p">,</span>
<span class="w">  </span><span class="nx">Outlet</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">lazy</span><span class="p">,</span><span class="w"> </span><span class="nx">Suspense</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Layout</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/Layout&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Home</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/Home&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">GettingStarted</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/GettingStarted&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">apiReferenceLoader</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./loaders/apiReferenceLoader&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">APIReference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/APIReference&#39;</span><span class="p">));</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Examples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/Examples&#39;</span><span class="p">));</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Changelog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/Changelog&#39;</span><span class="p">));</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">RouteLoadingFallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;route-loading&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Create router with loader</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createBrowserRouter</span><span class="p">([</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;,</span>
<span class="w">    </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Home</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;getting-started&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">GettingStarted</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;api&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">RouteLoadingFallback</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">APIReference</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nx">loader</span><span class="o">:</span><span class="w"> </span><span class="kt">apiReferenceLoader</span><span class="w"> </span><span class="c1">// ‚Üê Loader runs before component renders</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;examples&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">RouteLoadingFallback</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Examples</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;changelog&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">RouteLoadingFallback</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Changelog</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">RouterProvider</span><span class="w"> </span><span class="na">router</span><span class="o">=</span><span class="p">{</span><span class="nx">router</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<p>Now let's see what happens when a user navigates to the API Reference page:</p>
<p><strong>Browser DevTools - Network Tab</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Timeline</span><span class="o">:</span>
<span class="mf">0.0</span><span class="n">s</span><span class="o">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="s2">&quot;API Reference&quot;</span><span class="w"> </span><span class="n">link</span>
<span class="mf">0.0</span><span class="n">s</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="na">js</span><span class="w"> </span><span class="n">starts</span>
<span class="mf">0.0</span><span class="n">s</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="sr">/api/</span><span class="n">methods</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="o">(</span><span class="n">parallel</span><span class="o">!)</span>
<span class="mf">1.3</span><span class="n">s</span><span class="o">:</span><span class="w"> </span><span class="sr">/api/</span><span class="n">methods</span><span class="w"> </span><span class="n">finishes</span>
<span class="mf">1.9</span><span class="n">s</span><span class="o">:</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="na">js</span><span class="w"> </span><span class="n">finishes</span>
<span class="mf">1.9</span><span class="n">s</span><span class="o">:</span><span class="w"> </span><span class="n">Content</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="o">(</span><span class="n">data</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">available</span><span class="o">)</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement</strong>:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Before (useEffect)</th>
<th>After (Loader)</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time to Content</td>
<td>3.2s</td>
<td>1.9s</td>
<td>41% faster</td>
</tr>
<tr>
<td>Number of loading states</td>
<td>2</td>
<td>1</td>
<td>Simpler UX</td>
</tr>
<tr>
<td>Waterfall eliminated</td>
<td>No</td>
<td>Yes</td>
<td>Parallel loading</td>
</tr>
</tbody>
</table>
<p><strong>What changed</strong>:
1. Loader function runs when navigation starts (before component code downloads)
2. Data request and component code request happen in parallel
3. Component renders only after both complete
4. User sees single loading state, then content</p>
<h3 id="handling-loader-errors">Handling Loader Errors</h3>
<p>Loaders can throw errors. React Router catches them and renders an error boundary:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/loaders/apiReferenceLoader.ts - Iteration 2: Error Handling</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoaderFunctionArgs</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">apiReferenceLoader</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">LoaderFunctionArgs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/methods&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Throw with structured error data</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Failed to load API methods&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">response.status</span><span class="p">,</span>
<span class="w">      </span><span class="nx">statusText</span><span class="o">:</span><span class="w"> </span><span class="kt">response.statusText</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ErrorBoundary.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useRouteError</span><span class="p">,</span><span class="w"> </span><span class="nx">isRouteErrorResponse</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRouteError</span><span class="p">();</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isRouteErrorResponse</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-boundary&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">statusText</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">.</span><span class="nx">data</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-boundary&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Oops</span><span class="o">!</span><span class="w"> </span><span class="nx">Something</span><span class="w"> </span><span class="nx">went</span><span class="w"> </span><span class="nx">wrong</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Adding Error Boundary</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createBrowserRouter</span><span class="p">([</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;,</span>
<span class="w">    </span><span class="nx">errorElement</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="w"> </span><span class="p">/&gt;,</span><span class="w"> </span><span class="c1">// ‚Üê Catches loader errors</span>
<span class="w">    </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="c1">// ... routes</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;api&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">RouteLoadingFallback</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">APIReference</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nx">loader</span><span class="o">:</span><span class="w"> </span><span class="kt">apiReferenceLoader</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]);</span>
</code></pre></div>

<h3 id="loading-states-with-loaders">Loading States with Loaders</h3>
<p>Loaders don't show loading states by default. The navigation waits until the loader completes. For slow loaders, this creates a "frozen" UI. Let's add a loading indicator:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/Layout.tsx - Iteration 5: Navigation Loading State</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Outlet</span><span class="p">,</span><span class="w"> </span><span class="nx">useNavigation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Navigation</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Navigation&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Layout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">navigation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useNavigation</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isLoading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">navigation</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;layout&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Navigation</span><span class="w"> </span><span class="p">/&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Show loading bar during navigation */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isLoading</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;loading-bar&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;loading-bar-progress&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Outlet</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
User clicks "API Reference". A loading bar appears at the top of the page. The current page remains visible. After 1.9 seconds, the loading bar disappears and the new page appears.</p>
<p><strong>Improvement</strong>: User sees immediate feedback (loading bar) while keeping the current page visible. Better than a blank screen or full-page spinner.</p>
<h3 id="solution-2-prefetching-data-advanced">Solution 2: Prefetching Data (Advanced)</h3>
<p>For even better performance, we can prefetch data before the user clicks:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/Navigation.tsx - Iteration 6: Prefetch on Hover</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Link</span><span class="p">,</span><span class="w"> </span><span class="nx">useNavigate</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">apiReferenceLoader</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../loaders/apiReferenceLoader&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Navigation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">navigate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useNavigate</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Prefetch data when user hovers over link</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleMouseEnter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Start loading data before user clicks</span>
<span class="w">    </span><span class="nx">apiReferenceLoader</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nx">request</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nx">Request</span><span class="p">(</span><span class="s1">&#39;/api&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/getting-started&quot;</span><span class="p">&gt;</span><span class="nx">Getting</span><span class="w"> </span><span class="nx">Started</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span>
<span class="w">        </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/api&quot;</span><span class="w"> </span>
<span class="w">        </span><span class="na">onMouseEnter</span><span class="o">=</span><span class="p">{</span><span class="nx">handleMouseEnter</span><span class="p">}</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="na">Prefetch</span><span class="w"> </span><span class="na">on</span><span class="w"> </span><span class="na">hover</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">API</span><span class="w"> </span><span class="nx">Reference</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/examples&quot;</span><span class="p">&gt;</span><span class="nx">Examples</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/changelog&quot;</span><span class="p">&gt;</span><span class="nx">Changelog</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser DevTools - Network Tab</strong> (with prefetch):</p>
<div class="codehilite"><pre><span></span><code><span class="n">Timeline</span><span class="p">:</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">hovers</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="s2">&quot;API Reference&quot;</span><span class="w"> </span><span class="n">link</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">methods</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="p">(</span><span class="n">prefetch</span><span class="p">)</span>
<span class="mf">0.5</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="n">link</span>
<span class="mf">0.5</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">starts</span>
<span class="mf">1.3</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">methods</span><span class="w"> </span><span class="n">finishes</span><span class="w"> </span><span class="p">(</span><span class="n">already</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">cache</span><span class="p">)</span>
<span class="mf">1.4</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">finishes</span>
<span class="mf">1.4</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Content</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">instantly</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">loaded</span><span class="p">)</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement</strong>:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Loader Only</th>
<th>Loader + Prefetch</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time to Content</td>
<td>1.9s</td>
<td>1.4s</td>
<td>26% faster</td>
</tr>
<tr>
<td>Perceived speed</td>
<td>Fast</td>
<td>Instant</td>
<td>Feels immediate</td>
</tr>
</tbody>
</table>
<p><strong>When to Apply Prefetching</strong>:</p>
<p><strong>What it optimizes for</strong>:
- Perceived performance (feels instant)
- User experience on fast connections
- Frequently accessed routes</p>
<p><strong>What it sacrifices</strong>:
- Bandwidth (may fetch data user doesn't need)
- Server load (more requests)
- Complexity (more code to maintain)</p>
<p><strong>When to prefetch</strong>:
- High-probability navigation (user hovering over link)
- Fast data endpoints (&lt; 500ms response time)
- Small data payloads (&lt; 100 KB)
- Frequently accessed routes (&gt; 50% of users visit)</p>
<p><strong>When NOT to prefetch</strong>:
- Slow data endpoints (&gt; 1s response time)
- Large data payloads (&gt; 500 KB)
- Rarely accessed routes
- Mobile users on metered connections
- Data that changes frequently (risk of stale data)</p>
<h3 id="combining-loaders-with-react-query">Combining Loaders with React Query</h3>
<p>For more sophisticated data management, combine loaders with React Query:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/loaders/apiReferenceLoader.ts - Iteration 3: React Query Integration</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">QueryClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@tanstack/react-query&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoaderFunctionArgs</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">queryClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">QueryClient</span><span class="p">();</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchAPIMethods</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/methods&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to load API methods&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">apiReferenceLoader</span><span class="p">({</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">LoaderFunctionArgs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Ensure data is in React Query cache</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">queryClient</span><span class="p">.</span><span class="nx">ensureQueryData</span><span class="p">({</span>
<span class="w">    </span><span class="nx">queryKey</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;api-methods&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">queryFn</span><span class="o">:</span><span class="w"> </span><span class="kt">fetchAPIMethods</span><span class="p">,</span>
<span class="w">    </span><span class="nx">staleTime</span><span class="o">:</span><span class="w"> </span><span class="kt">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="c1">// 5 minutes</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/APIReference.tsx - Iteration 2: React Query in Component</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useQuery</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@tanstack/react-query&#39;</span><span class="p">;</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchAPIMethods</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/methods&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to load API methods&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">APIReference</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Data is already in cache from loader</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">methods</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useQuery</span><span class="p">({</span>
<span class="w">    </span><span class="nx">queryKey</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;api-methods&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">queryFn</span><span class="o">:</span><span class="w"> </span><span class="kt">fetchAPIMethods</span><span class="p">,</span>
<span class="w">    </span><span class="nx">staleTime</span><span class="o">:</span><span class="w"> </span><span class="kt">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;api-reference&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">API</span><span class="w"> </span><span class="nx">Reference</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">methods</span><span class="o">?</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">method</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">method</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;method&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">method</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">method</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Benefits of React Query + Loaders</strong>:
1. Loader ensures data is available before render
2. React Query provides caching, revalidation, and refetching
3. Subsequent navigations to the same route are instant (cached)
4. Data stays fresh with automatic background refetching</p>
<p><strong>This solves the data loading problem, but we still need to handle scroll position...</strong></p>
<h2 id="scroll-restoration-and-focus-management">Scroll restoration and focus management</h2>
<h2 id="the-problem-lost-scroll-position-and-focus">The Problem: Lost Scroll Position and Focus</h2>
<p>Our routes load fast, data loads in parallel, but there's a subtle UX problem. Let's see what happens when users navigate:</p>
<p><strong>User Journey</strong>:
1. User visits home page
2. Scrolls down to read content (scroll position: 800px)
3. Clicks "API Reference" link
4. Reads API docs, scrolls down (scroll position: 1200px)
5. Clicks browser back button
6. <strong>Expected</strong>: Returns to home page at scroll position 800px
7. <strong>Actual</strong>: Returns to home page at scroll position 0px (top)</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">React</span><span class="w"> </span><span class="n">Router</span><span class="p">]</span><span class="w"> </span><span class="n">Navigating</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">/</span><span class="n">api</span>
<span class="p">[</span><span class="n">Window</span><span class="p">]</span><span class="w"> </span><span class="n">Scroll</span><span class="w"> </span><span class="n">position</span><span class="o">:</span><span class="w"> </span><span class="mi">800</span><span class="n">px</span>
<span class="p">[</span><span class="n">React</span><span class="w"> </span><span class="n">Router</span><span class="p">]</span><span class="w"> </span><span class="n">Navigation</span><span class="w"> </span><span class="n">complete</span>
<span class="p">[</span><span class="n">Window</span><span class="p">]</span><span class="w"> </span><span class="n">Scroll</span><span class="w"> </span><span class="n">position</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="n">px</span><span class="w"> </span><span class="p">(</span><span class="n">reset</span><span class="o">!</span><span class="p">)</span>
</code></pre></div>

<h3 id="diagnostic-analysis-the-scroll-position-failure">Diagnostic Analysis: The Scroll Position Failure</h3>
<p><strong>Browser Behavior</strong>:
User navigates back to a page they were reading. They expect to return to where they left off. Instead, they're scrolled to the top. They must scroll down again to find their place. Frustrating.</p>
<p><strong>React DevTools Evidence</strong>:
- Component unmounts on navigation
- New component mounts
- Scroll position resets to 0</p>
<p><strong>Root cause identified</strong>: React Router doesn't restore scroll position by default. When a route changes, the browser scrolls to the top (default behavior). The previous scroll position is lost.</p>
<p><strong>Why the current approach can't solve this</strong>: React Router has no built-in scroll restoration. The browser's native scroll restoration is disabled in single-page applications. We must implement it ourselves.</p>
<p><strong>What we need</strong>: A way to:
1. Save scroll position before navigation
2. Restore scroll position after navigation
3. Handle edge cases (scroll to top for new pages, restore for back/forward)</p>
<h3 id="solution-scroll-restoration">Solution: Scroll Restoration</h3>
<p>React Router provides <code>ScrollRestoration</code> component for this:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Iteration 7: Adding Scroll Restoration</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">createBrowserRouter</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">RouterProvider</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ScrollRestoration</span>
<span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Layout</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/Layout&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createBrowserRouter</span><span class="p">([</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ScrollRestoration</span><span class="w"> </span><span class="p">/&gt;</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ‚Üê Handles scroll restoration */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/&gt;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="c1">// ... routes</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">RouterProvider</span><span class="w"> </span><span class="na">router</span><span class="o">=</span><span class="p">{</span><span class="nx">router</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<p><strong>Browser Behavior</strong> (after adding ScrollRestoration):
1. User scrolls to 800px on home page
2. Navigates to API Reference
3. Scrolls to 1200px
4. Clicks back button
5. <strong>Result</strong>: Returns to home page at scroll position 800px ‚úì</p>
<p><strong>How it works</strong>:
- <code>ScrollRestoration</code> saves scroll position in <code>sessionStorage</code> before navigation
- After navigation, it restores the saved position
- For forward navigation (clicking links), it scrolls to top
- For back/forward navigation (browser buttons), it restores position</p>
<h3 id="customizing-scroll-behavior">Customizing Scroll Behavior</h3>
<p>Sometimes you want different behavior:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Iteration 8: Custom Scroll Behavior</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">createBrowserRouter</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">RouterProvider</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ScrollRestoration</span>
<span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createBrowserRouter</span><span class="p">([</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ScrollRestoration</span><span class="w"> </span>
<span class="w">          </span><span class="na">getKey</span><span class="o">=</span><span class="p">{(</span><span class="nx">location</span><span class="p">,</span><span class="w"> </span><span class="nx">matches</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Custom key for scroll position storage</span>
<span class="w">            </span><span class="c1">// Same key = restore position, different key = scroll to top</span>

<span class="w">            </span><span class="c1">// For API Reference, restore position even on forward navigation</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;/api&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// For other routes, use default behavior</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">location</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
<span class="w">          </span><span class="p">}}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/&gt;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="c1">// ... routes</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]);</span>
</code></pre></div>

<h3 id="scrolling-to-top-on-route-change">Scrolling to Top on Route Change</h3>
<p>For some routes, you always want to scroll to top:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/hooks/useScrollToTop.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useLocation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useScrollToTop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">pathname</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLocation</span><span class="p">();</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">pathname</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/Examples.tsx - Using useScrollToTop</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useScrollToTop</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../hooks/useScrollToTop&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Examples</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useScrollToTop</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‚Üê Always scroll to top when this route renders</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;examples&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Code</span><span class="w"> </span><span class="nx">Examples</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Content */</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="the-focus-management-problem">The Focus Management Problem</h3>
<p>Scroll position is only half the story. Let's see what happens with keyboard navigation:</p>
<p><strong>User Journey</strong> (keyboard user):
1. User tabs through navigation links
2. Presses Enter on "API Reference" (focus on link)
3. Page changes to API Reference
4. <strong>Expected</strong>: Focus moves to main content (for screen reader announcement)
5. <strong>Actual</strong>: Focus stays on navigation link (now invisible/wrong page)</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">Focus</span><span class="p">]</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="n">element</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">a</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="s">&quot;/api&quot;</span><span class="o">&gt;</span><span class="n">API</span><span class="w"> </span><span class="n">Reference</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="p">[</span><span class="n">React</span><span class="w"> </span><span class="n">Router</span><span class="p">]</span><span class="w"> </span><span class="n">Navigating</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">/</span><span class="n">api</span>
<span class="p">[</span><span class="n">Focus</span><span class="p">]</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="n">element</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">a</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="s">&quot;/api&quot;</span><span class="o">&gt;</span><span class="n">API</span><span class="w"> </span><span class="n">Reference</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">still</span><span class="o">!</span><span class="p">)</span>
</code></pre></div>

<h3 id="diagnostic-analysis-the-focus-management-failure">Diagnostic Analysis: The Focus Management Failure</h3>
<p><strong>Browser Behavior</strong>:
Keyboard user navigates to a new page. Focus remains on the navigation link. Screen reader doesn't announce the new page. User must tab through navigation again to reach content. Poor accessibility.</p>
<p><strong>Accessibility Audit</strong> (Lighthouse):</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="n">Accessibility</span><span class="o">]</span><span class="w"> </span><span class="n">Focus</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">managed</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">change</span>
<span class="o">[</span><span class="n">Accessibility</span><span class="o">]</span><span class="w"> </span><span class="n">Screen</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">changed</span>
<span class="nl">Score</span><span class="p">:</span><span class="w"> </span><span class="mi">78</span><span class="o">/</span><span class="mi">100</span><span class="w"> </span><span class="p">(</span><span class="n">down</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">95</span><span class="p">)</span>
</code></pre></div>

<p><strong>Root cause identified</strong>: React Router doesn't manage focus on route changes. The browser keeps focus on the element that triggered navigation (the link). This breaks keyboard navigation and screen reader experience.</p>
<p><strong>Why the current approach can't solve this</strong>: Focus management requires explicit code. We must programmatically move focus to the new content.</p>
<p><strong>What we need</strong>: A way to move focus to the main content area when the route changes, so screen readers announce the new page and keyboard users can immediately interact with content.</p>
<h3 id="solution-focus-management">Solution: Focus Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/Layout.tsx - Iteration 9: Focus Management</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Outlet</span><span class="p">,</span><span class="w"> </span><span class="nx">useLocation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Navigation</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Navigation&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Layout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLocation</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mainRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">HTMLElement</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Move focus to main content on route change</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;layout&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Navigation</span><span class="w"> </span><span class="p">/&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">main</span><span class="w"> </span>
<span class="w">        </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">mainRef</span><span class="p">}</span>
<span class="w">        </span><span class="na">tabIndex</span><span class="o">=</span><span class="p">{</span><span class="o">-</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="na">Makes</span><span class="w"> </span><span class="na">element</span><span class="w"> </span><span class="na">focusable</span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;main-content&quot;</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Outlet</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser Behavior</strong> (after adding focus management):
1. User presses Enter on "API Reference" link
2. Page changes
3. Focus moves to <code>&lt;main&gt;</code> element
4. Screen reader announces: "API Reference, main content"
5. User can immediately interact with content</p>
<p><strong>Accessibility Audit</strong> (after fix):</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="n">Accessibility</span><span class="o">]</span><span class="w"> </span><span class="n">Focus</span><span class="w"> </span><span class="n">managed</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">change</span>
<span class="o">[</span><span class="n">Accessibility</span><span class="o">]</span><span class="w"> </span><span class="n">Screen</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="n">announces</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">changes</span>
<span class="nl">Score</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="o">/</span><span class="mi">100</span><span class="w"> </span><span class="err">‚úì</span>
</code></pre></div>

<h3 id="skip-links-for-keyboard-users">Skip Links for Keyboard Users</h3>
<p>For even better accessibility, add a skip link:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/Layout.tsx - Iteration 10: Skip Link</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Outlet</span><span class="p">,</span><span class="w"> </span><span class="nx">useLocation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Navigation</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Navigation&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Layout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLocation</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mainRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">HTMLElement</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;layout&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Skip link - visible only on keyboard focus */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span>
<span class="w">        </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;#main-content&quot;</span><span class="w"> </span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skip-link&quot;</span>
<span class="w">        </span><span class="na">onClick</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">          </span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="o">?</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">        </span><span class="p">}}</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Skip</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="nx">content</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">Navigation</span><span class="w"> </span><span class="p">/&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">main</span><span class="w"> </span>
<span class="w">        </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;main-content&quot;</span>
<span class="w">        </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">mainRef</span><span class="p">}</span>
<span class="w">        </span><span class="na">tabIndex</span><span class="o">=</span><span class="p">{</span><span class="o">-</span><span class="mf">1</span><span class="p">}</span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;main-content&quot;</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Outlet</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c">/* src/styles/layout.css */</span>
<span class="p">.</span><span class="nc">skip-link</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">  </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">-40</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#000</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">  </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">skip-link</span><span class="p">:</span><span class="nd">focus</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c">/* Becomes visible when focused */</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>User Experience</strong>:
Keyboard user presses Tab on page load. Skip link appears at top of page. User presses Enter. Focus jumps directly to main content, bypassing navigation. Saves time and keystrokes.</p>
<h3 id="announcing-route-changes-to-screen-readers">Announcing Route Changes to Screen Readers</h3>
<p>For screen reader users, we can add live region announcements:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/RouteAnnouncer.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useLocation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">RouteAnnouncer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLocation</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">announceRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">HTMLDivElement</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Extract page title from pathname</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pageName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span>
<span class="w">      </span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;home&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Announce to screen readers</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">announceRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">announceRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`Navigated to </span><span class="si">${</span><span class="nx">pageName</span><span class="si">}</span><span class="sb"> page`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span>
<span class="w">      </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">announceRef</span><span class="p">}</span>
<span class="w">      </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;status&quot;</span>
<span class="w">      </span><span class="na">aria-live</span><span class="o">=</span><span class="s">&quot;polite&quot;</span>
<span class="w">      </span><span class="na">aria-atomic</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
<span class="w">      </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;sr-only&quot;</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="na">Visually</span><span class="w"> </span><span class="na">hidden</span><span class="err">,</span><span class="w"> </span><span class="na">but</span><span class="w"> </span><span class="na">announced</span>
<span class="w">    </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Adding Route Announcer</span>
<span class="k">import</span><span class="w"> </span><span class="nx">RouteAnnouncer</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/RouteAnnouncer&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createBrowserRouter</span><span class="p">([</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ScrollRestoration</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">RouteAnnouncer</span><span class="w"> </span><span class="p">/&gt;</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ‚Üê Announces route changes */</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/&gt;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="c1">// ... routes</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]);</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c">/* src/styles/accessibility.css */</span>
<span class="p">.</span><span class="nc">sr-only</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">  </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
<span class="w">  </span><span class="k">clip</span><span class="p">:</span><span class="w"> </span><span class="nb">rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">white-space</span><span class="p">:</span><span class="w"> </span><span class="kc">nowrap</span><span class="p">;</span>
<span class="w">  </span><span class="k">border-width</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Screen Reader Experience</strong>:
User navigates to API Reference page. Screen reader announces: "Navigated to API Reference page." User knows the navigation succeeded without visual confirmation.</p>
<h3 id="when-to-apply-scroll-and-focus-management">When to Apply Scroll and Focus Management</h3>
<p><strong>What it optimizes for</strong>:
- User experience (returning to where they left off)
- Accessibility (keyboard and screen reader users)
- Professional polish (attention to detail)</p>
<p><strong>What it sacrifices</strong>:
- Slightly more complex code
- Need to test with keyboard and screen readers</p>
<p><strong>When to apply</strong>:
- All production applications (accessibility is not optional)
- Long-form content (articles, documentation)
- Applications with deep navigation hierarchies
- Any application used by keyboard or screen reader users</p>
<p><strong>When NOT to apply</strong>:
- Never. Always implement scroll restoration and focus management.</p>
<p><strong>Code characteristics</strong>:
- Setup complexity: Low (built-in components + a few hooks)
- Maintenance burden: Very low (set it and forget it)
- Accessibility impact: Critical (makes app usable for all users)</p>
<p><strong>This solves scroll and focus, but we still need to optimize navigation performance...</strong></p>
<h2 id="when-to-prefetch">When to prefetch</h2>
<h2 id="the-problem-slow-navigation-on-slow-connections">The Problem: Slow Navigation on Slow Connections</h2>
<p>Our application loads efficiently, but on slow connections, navigation still feels sluggish. Let's see what happens when a user on 3G tries to navigate:</p>
<p><strong>Browser DevTools - Network Tab</strong> (throttled to 3G):</p>
<div class="codehilite"><pre><span></span><code><span class="n">Timeline</span><span class="p">:</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="s2">&quot;Examples&quot;</span><span class="w"> </span><span class="n">link</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Examples</span><span class="o">-</span><span class="n">d3e4f5g6</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">starts</span>
<span class="mf">2.1</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Examples</span><span class="o">-</span><span class="n">d3e4f5g6</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">finishes</span><span class="w"> </span><span class="n">downloading</span>
<span class="mf">2.1</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Content</span><span class="w"> </span><span class="n">appears</span>
</code></pre></div>

<p><strong>User Experience</strong>:
User clicks link. Loading indicator appears. They wait 2.1 seconds. Content appears. On fast connections, this is fine. On slow connections, it feels broken.</p>
<h3 id="diagnostic-analysis-the-slow-navigation-problem">Diagnostic Analysis: The Slow Navigation Problem</h3>
<p><strong>Browser Behavior</strong>:
User on mobile 3G connection clicks a link. They see a loading indicator for 2+ seconds. The wait feels long. They wonder if the click registered. They might click again (double navigation).</p>
<p><strong>Network Tab Evidence</strong>:
- 3G connection: 750 Kbps download speed
- Examples chunk: 312 KB (105 KB gzipped)
- Download time: 2.1 seconds
- Parse/compile time: 0.3 seconds
- Total: 2.4 seconds to interactive</p>
<p><strong>Performance Metrics</strong>:
- Time to Interactive: 2.4s (poor on 3G)
- User frustration: High
- Perceived performance: Slow</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Instant or near-instant navigation</li>
<li>
<p>Actual: 2+ second wait on slow connections</p>
</li>
<li>
<p><strong>What the Network tab reveals</strong>:</p>
</li>
<li>Key indicator: Large chunk size + slow connection = long wait</li>
<li>
<p>Download time dominates (2.1s of 2.4s total)</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Code splitting creates on-demand loading. On slow connections, "on-demand" means "wait 2+ seconds." The user must wait for the chunk to download before seeing content.</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>: Lazy loading is reactive. It starts loading when the user clicks. On slow connections, this creates noticeable delay.</p>
</li>
<li>
<p><strong>What we need</strong>: Proactive loading. Start downloading chunks before the user clicks, so they're ready when needed.</p>
</li>
</ol>
<h3 id="solution-link-prefetching">Solution: Link Prefetching</h3>
<p>Prefetching loads resources before they're needed. There are several strategies:</p>
<h3 id="strategy-1-prefetch-on-hover">Strategy 1: Prefetch on Hover</h3>
<p>Load the chunk when the user hovers over a link:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/PrefetchLink.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Link</span><span class="p">,</span><span class="w"> </span><span class="nx">LinkProps</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">PrefetchLinkProps</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">LinkProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">prefetch</span><span class="o">?:</span><span class="w"> </span><span class="s1">&#39;hover&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;intent&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;render&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">PrefetchLink</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">prefetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;hover&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">to</span><span class="p">,</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="w">  </span><span class="p">...</span><span class="nx">props</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">PrefetchLinkProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isPrefetched</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsPrefetched</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeoutRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleMouseEnter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isPrefetched</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">prefetch</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Wait 100ms before prefetching (user might just be passing through)</span>
<span class="w">    </span><span class="nx">timeoutRef</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">prefetchRoute</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">      </span><span class="nx">setIsPrefetched</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleMouseLeave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Cancel prefetch if user moves away quickly</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">timeoutRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Prefetch on render if specified</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prefetch</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;render&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">prefetchRoute</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">      </span><span class="nx">setIsPrefetched</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">timeoutRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">prefetch</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">Link</span>
<span class="w">      </span><span class="na">to</span><span class="o">=</span><span class="p">{</span><span class="nx">to</span><span class="p">}</span>
<span class="w">      </span><span class="na">onMouseEnter</span><span class="o">=</span><span class="p">{</span><span class="nx">handleMouseEnter</span><span class="p">}</span>
<span class="w">      </span><span class="na">onMouseLeave</span><span class="o">=</span><span class="p">{</span><span class="nx">handleMouseLeave</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="na">...props</span><span class="p">}</span>
<span class="w">    </span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">children</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Prefetch route chunk</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">prefetchRoute</span><span class="p">(</span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// This is a simplified version - in production, you&#39;d use React Router&#39;s</span>
<span class="w">  </span><span class="c1">// internal prefetching or a more sophisticated approach</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">routeMap</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="p">&lt;</span><span class="nt">string</span><span class="err">,</span><span class="w"> </span><span class="err">()</span><span class="w"> </span><span class="err">=</span><span class="p">&gt;</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;/examples&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/Examples&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="s1">&#39;/api&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/APIReference&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="s1">&#39;/changelog&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/Changelog&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">prefetchFn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">routeMap</span><span class="p">[</span><span class="nx">path</span><span class="p">];</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prefetchFn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">prefetchFn</span><span class="p">().</span><span class="k">catch</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Silently fail - user will load on click if prefetch fails</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/Navigation.tsx - Using PrefetchLink</span>
<span class="k">import</span><span class="w"> </span><span class="nx">PrefetchLink</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./PrefetchLink&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Navigation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">PrefetchLink</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">PrefetchLink</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">PrefetchLink</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/getting-started&quot;</span><span class="p">&gt;</span><span class="nx">Getting</span><span class="w"> </span><span class="nx">Started</span><span class="p">&lt;/</span><span class="nt">PrefetchLink</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">PrefetchLink</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/api&quot;</span><span class="w"> </span><span class="na">prefetch</span><span class="o">=</span><span class="s">&quot;hover&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">API</span><span class="w"> </span><span class="nx">Reference</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">PrefetchLink</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">PrefetchLink</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/examples&quot;</span><span class="w"> </span><span class="na">prefetch</span><span class="o">=</span><span class="s">&quot;hover&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Examples</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">PrefetchLink</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">PrefetchLink</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/changelog&quot;</span><span class="p">&gt;</span><span class="nx">Changelog</span><span class="p">&lt;/</span><span class="nt">PrefetchLink</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser DevTools - Network Tab</strong> (with hover prefetch):</p>
<div class="codehilite"><pre><span></span><code><span class="n">Timeline</span><span class="p">:</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">hovers</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="s2">&quot;Examples&quot;</span><span class="w"> </span><span class="n">link</span>
<span class="mf">0.1</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Examples</span><span class="o">-</span><span class="n">d3e4f5g6</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="p">(</span><span class="n">prefetch</span><span class="p">)</span>
<span class="mf">0.5</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="n">link</span>
<span class="mf">2.2</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Examples</span><span class="o">-</span><span class="n">d3e4f5g6</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">finishes</span><span class="w"> </span><span class="n">downloading</span>
<span class="mf">2.2</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Content</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="p">(</span><span class="n">chunk</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">loaded</span><span class="o">!</span><span class="p">)</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement</strong>:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>No Prefetch</th>
<th>Hover Prefetch</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time to Interactive (3G)</td>
<td>2.4s</td>
<td>0.2s</td>
<td>92% faster</td>
</tr>
<tr>
<td>Perceived speed</td>
<td>Slow</td>
<td>Instant</td>
<td>Feels immediate</td>
</tr>
<tr>
<td>Wasted bandwidth</td>
<td>0 KB</td>
<td>~10 KB (hover without click)</td>
<td>Minimal</td>
</tr>
</tbody>
</table>
<p><strong>How it works</strong>:
1. User hovers over link
2. After 100ms delay (to avoid prefetching on accidental hovers), prefetch starts
3. Chunk downloads in background
4. When user clicks, chunk is already loaded
5. Navigation feels instant</p>
<h3 id="strategy-2-prefetch-on-viewport-visibility">Strategy 2: Prefetch on Viewport Visibility</h3>
<p>Load chunks when links become visible:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/hooks/useIntersectionPrefetch.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useIntersectionPrefetch</span><span class="p">(</span>
<span class="w">  </span><span class="nx">prefetchFn</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">,</span>
<span class="w">  </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">HTMLElement</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasPrefetched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">enabled</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">hasPrefetched</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">IntersectionObserver</span><span class="p">(</span>
<span class="w">      </span><span class="p">(</span><span class="nx">entries</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">entry</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">hasPrefetched</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">prefetchFn</span><span class="p">();</span>
<span class="w">            </span><span class="nx">hasPrefetched</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">rootMargin</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;50px&#39;</span><span class="w"> </span><span class="c1">// Start prefetching 50px before element is visible</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">prefetchFn</span><span class="p">,</span><span class="w"> </span><span class="nx">enabled</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">ref</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/Navigation.tsx - Using Intersection Prefetch</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useIntersectionPrefetch</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../hooks/useIntersectionPrefetch&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Navigation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">examplesLinkRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useIntersectionPrefetch</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/Examples&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="kc">true</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/getting-started&quot;</span><span class="p">&gt;</span><span class="nx">Getting</span><span class="w"> </span><span class="nx">Started</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/api&quot;</span><span class="p">&gt;</span><span class="nx">API</span><span class="w"> </span><span class="nx">Reference</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span>
<span class="w">        </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/examples&quot;</span><span class="w"> </span>
<span class="w">        </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">examplesLinkRef</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">}</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Examples</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Link</span><span class="w"> </span><span class="na">to</span><span class="o">=</span><span class="s">&quot;/changelog&quot;</span><span class="p">&gt;</span><span class="nx">Changelog</span><span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>When to use viewport prefetching</strong>:
- Links in footer or below the fold
- Long pages with navigation at bottom
- Mobile layouts where navigation is collapsed</p>
<h3 id="strategy-3-prefetch-on-idle">Strategy 3: Prefetch on Idle</h3>
<p>Load chunks when the browser is idle:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/hooks/useIdlePrefetch.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useIdlePrefetch</span><span class="p">(</span>
<span class="w">  </span><span class="nx">prefetchFn</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">,</span>
<span class="w">  </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">enabled</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Use requestIdleCallback if available, otherwise setTimeout</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">idleCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;requestIdleCallback&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">window</span>
<span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestIdleCallback</span>
<span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">cb</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">idleCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">prefetchFn</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;cancelIdleCallback&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">window</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">cancelIdleCallback</span><span class="p">(</span><span class="nx">handle</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">handle</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">prefetchFn</span><span class="p">,</span><span class="w"> </span><span class="nx">enabled</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Prefetch Heavy Routes on Idle</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useIdlePrefetch</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./hooks/useIdlePrefetch&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Prefetch heavy routes when browser is idle</span>
<span class="w">  </span><span class="nx">useIdlePrefetch</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/APIReference&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/Examples&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">RouterProvider</span><span class="w"> </span><span class="na">router</span><span class="o">=</span><span class="p">{</span><span class="nx">router</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>When to use idle prefetching</strong>:
- Heavy routes that most users will visit
- After initial page load completes
- When you want to optimize for subsequent navigation
- Desktop users with fast connections</p>
<h3 id="strategy-4-prefetch-on-intent-advanced">Strategy 4: Prefetch on Intent (Advanced)</h3>
<p>Predict user intent and prefetch accordingly:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/hooks/useIntentPrefetch.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">IntentPrefetchOptions</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">prefetchFn</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">enabled?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">threshold?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="c1">// Mouse movement threshold in pixels</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useIntentPrefetch</span><span class="p">({</span>
<span class="w">  </span><span class="nx">prefetchFn</span><span class="p">,</span>
<span class="w">  </span><span class="nx">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">IntentPrefetchOptions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">HTMLElement</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasPrefetched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">({</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="w"> </span><span class="p">});</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">enabled</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">hasPrefetched</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">element</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleMouseMove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">element</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">mousePosition</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">mousePosition</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

<span class="w">      </span><span class="nx">mousePosition</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">e.clientX</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">e.clientY</span><span class="w"> </span><span class="p">};</span>

<span class="w">      </span><span class="c1">// Check if mouse is moving toward the element</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">isMovingToward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">threshold</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">right</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">threshold</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">threshold</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">bottom</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">threshold</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="p">(</span><span class="nx">dx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Moving right or down</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isMovingToward</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">hasPrefetched</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">prefetchFn</span><span class="p">();</span>
<span class="w">        </span><span class="nx">hasPrefetched</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleMouseMove</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleMouseMove</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">prefetchFn</span><span class="p">,</span><span class="w"> </span><span class="nx">enabled</span><span class="p">,</span><span class="w"> </span><span class="nx">threshold</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">ref</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>When to use intent prefetching</strong>:
- High-value routes (checkout, dashboard)
- When hover prefetching is too aggressive
- Desktop applications with mouse interaction
- When you want to minimize wasted bandwidth</p>
<h3 id="the-failure-prefetching-everything">The Failure: Prefetching Everything</h3>
<p>Let's see what happens when we prefetch too aggressively:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - ANTI-PATTERN: Prefetch Everything</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Prefetch all routes immediately</span>
<span class="w">    </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/GettingStarted&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/APIReference&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/Examples&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/Changelog&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">RouterProvider</span><span class="w"> </span><span class="na">router</span><span class="o">=</span><span class="p">{</span><span class="nx">router</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser DevTools - Network Tab</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Timeline</span><span class="p">:</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Page</span><span class="w"> </span><span class="n">loads</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="n">loads</span><span class="w"> </span><span class="p">(</span><span class="mi">187</span><span class="w"> </span><span class="n">KB</span><span class="p">)</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="n">finishes</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Prefetch</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="p">(</span><span class="n">all</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">once</span><span class="p">)</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">GettingStarted</span><span class="o">-</span><span class="n">b1c2d3e4</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="p">(</span><span class="mi">46</span><span class="w"> </span><span class="n">KB</span><span class="p">)</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="p">(</span><span class="mi">523</span><span class="w"> </span><span class="n">KB</span><span class="p">)</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Examples</span><span class="o">-</span><span class="n">d3e4f5g6</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="p">(</span><span class="mi">313</span><span class="w"> </span><span class="n">KB</span><span class="p">)</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Changelog</span><span class="o">-</span><span class="n">e4f5g6h7</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="p">(</span><span class="mi">79</span><span class="w"> </span><span class="n">KB</span><span class="p">)</span>
<span class="mf">3.9</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="n">prefetch</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">complete</span>
</code></pre></div>

<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="n">Network</span><span class="o">]</span><span class="w"> </span><span class="n">Downloading</span><span class="w"> </span><span class="mi">961</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">prefetch</span><span class="w"> </span><span class="k">data</span>
<span class="o">[</span><span class="n">Performance</span><span class="o">]</span><span class="w"> </span><span class="n">Main</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">blocked</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mf">1.2</span><span class="n">s</span><span class="w"> </span><span class="n">parsing</span><span class="w"> </span><span class="n">prefetched</span><span class="w"> </span><span class="n">code</span>
<span class="o">[</span><span class="n">Memory</span><span class="o">]</span><span class="w"> </span><span class="n">Heap</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="n">increased</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="n">MB</span>
</code></pre></div>

<h3 id="diagnostic-analysis-the-over-prefetching-failure">Diagnostic Analysis: The Over-Prefetching Failure</h3>
<p><strong>Browser Behavior</strong>:
User loads the home page. It appears quickly (0.7s). But then the browser starts downloading 961 KB of additional JavaScript. The page feels sluggish. Scrolling is janky. Interactions are delayed.</p>
<p><strong>Network Tab Evidence</strong>:
- 4 simultaneous prefetch requests
- Total: 961 KB (328 KB gzipped)
- On 3G: 3.2 seconds additional download time
- Blocks bandwidth for other resources (images, fonts)</p>
<p><strong>Performance Metrics</strong>:
- Time to Interactive: 3.9s (worse than no prefetching!)
- Main thread blocked: 1.2s (parsing prefetched code)
- Memory usage: +45 MB
- User experience: Janky, slow</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Fast initial load, instant navigation</li>
<li>
<p>Actual: Fast initial load, then sluggish page, then fast navigation</p>
</li>
<li>
<p><strong>What the Network tab reveals</strong>:</p>
</li>
<li>Key indicator: 961 KB downloaded immediately</li>
<li>Bandwidth saturated with prefetch requests</li>
<li>
<p>Other resources (images, fonts) delayed</p>
</li>
<li>
<p><strong>Root cause identified</strong>: Prefetching everything defeats the purpose of code splitting. We split the code to reduce initial load, then immediately download it all anyway. The user pays the cost upfront, making the initial experience worse.</p>
</li>
<li>
<p><strong>Why this approach fails</strong>: Prefetching has costs:</p>
</li>
<li>Bandwidth (downloads data user may not need)</li>
<li>CPU (parsing and compiling prefetched code)</li>
<li>Memory (storing prefetched modules)</li>
<li>
<p>Battery (mobile devices)</p>
</li>
<li>
<p><strong>What we need</strong>: Strategic prefetching. Prefetch only what's likely to be used, when the browser has spare resources.</p>
</li>
</ol>
<h3 id="the-goldilocks-principle-strategic-prefetching">The Goldilocks Principle: Strategic Prefetching</h3>
<p><strong>Good prefetching strategy</strong>:
1. Prefetch high-probability routes (&gt; 50% of users visit)
2. Prefetch on user intent (hover, viewport visibility)
3. Prefetch during idle time (after initial load completes)
4. Respect user preferences (prefers-reduced-data, save-data)
5. Monitor and adjust based on analytics</p>
<p><strong>Our final, balanced approach</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/hooks/useStrategicPrefetch.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">PrefetchStrategy</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">condition</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;idle&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;hover&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;viewport&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;immediate&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">probability?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0-1, likelihood user will visit</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">strategies</span><span class="o">:</span><span class="w"> </span><span class="kt">PrefetchStrategy</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/getting-started&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">condition</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;immediate&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Most users visit this</span>
<span class="w">    </span><span class="nx">probability</span><span class="o">:</span><span class="w"> </span><span class="kt">0.85</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/api&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">condition</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hover&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Large chunk, prefetch on intent</span>
<span class="w">    </span><span class="nx">probability</span><span class="o">:</span><span class="w"> </span><span class="kt">0.45</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/examples&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">condition</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hover&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">probability</span><span class="o">:</span><span class="w"> </span><span class="kt">0.40</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/changelog&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">condition</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;idle&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Rarely visited, prefetch when idle</span>
<span class="w">    </span><span class="nx">probability</span><span class="o">:</span><span class="w"> </span><span class="kt">0.15</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useStrategicPrefetch</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">prefetchedRoutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;());</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check if user prefers reduced data</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">prefersReducedData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">      </span><span class="s1">&#39;connection&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">navigator</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">      </span><span class="p">(</span><span class="nx">navigator</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">).</span><span class="nx">connection</span><span class="o">?</span><span class="p">.</span><span class="nx">saveData</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prefersReducedData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Don&#39;t prefetch on metered connections</span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Prefetch immediate priority routes</span>
<span class="w">    </span><span class="nx">strategies</span>
<span class="w">      </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">condition</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;immediate&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">strategy</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">prefetchRoute</span><span class="p">(</span><span class="nx">strategy</span><span class="p">.</span><span class="nx">route</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Prefetch idle priority routes when browser is idle</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">idleCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;requestIdleCallback&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">window</span>
<span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestIdleCallback</span>
<span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">cb</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">idleCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">strategies</span>
<span class="w">        </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">condition</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;idle&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">strategy</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">prefetchRoute</span><span class="p">(</span><span class="nx">strategy</span><span class="p">.</span><span class="nx">route</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;cancelIdleCallback&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">window</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">cancelIdleCallback</span><span class="p">(</span><span class="nx">handle</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">handle</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">prefetchRoute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prefetchedRoutes</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">route</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">routeMap</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="p">&lt;</span><span class="nt">string</span><span class="err">,</span><span class="w"> </span><span class="err">()</span><span class="w"> </span><span class="err">=</span><span class="p">&gt;</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s1">&#39;/getting-started&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/GettingStarted&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="s1">&#39;/api&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/APIReference&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="s1">&#39;/examples&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/Examples&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="s1">&#39;/changelog&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../pages/Changelog&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">prefetchFn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">routeMap</span><span class="p">[</span><span class="nx">route</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prefetchFn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">prefetchFn</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">prefetchedRoutes</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">route</span><span class="p">);</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">        </span><span class="p">.</span><span class="k">catch</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="c1">// Silently fail</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Final: Strategic Prefetching</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useStrategicPrefetch</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./hooks/useStrategicPrefetch&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useStrategicPrefetch</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">RouterProvider</span><span class="w"> </span><span class="na">router</span><span class="o">=</span><span class="p">{</span><span class="nx">router</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Browser DevTools - Network Tab</strong> (with strategic prefetching):</p>
<div class="codehilite"><pre><span></span><code><span class="n">Timeline</span><span class="p">:</span>
<span class="mf">0.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Page</span><span class="w"> </span><span class="n">loads</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="n">finishes</span>
<span class="mf">0.7</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">GettingStarted</span><span class="o">-</span><span class="n">b1c2d3e4</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">prefetches</span><span class="w"> </span><span class="p">(</span><span class="n">immediate</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">probability</span><span class="p">)</span>
<span class="mf">1.2</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">GettingStarted</span><span class="w"> </span><span class="n">finishes</span>
<span class="mf">2.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Browser</span><span class="w"> </span><span class="n">idle</span><span class="p">,</span><span class="w"> </span><span class="n">Changelog</span><span class="o">-</span><span class="n">e4f5g6h7</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">prefetches</span><span class="w"> </span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span>
<span class="mf">2.5</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">Changelog</span><span class="w"> </span><span class="n">finishes</span>
<span class="p">[</span><span class="n">User</span><span class="w"> </span><span class="n">hovers</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="s2">&quot;API Reference&quot;</span><span class="p">]</span>
<span class="mf">3.0</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="n">APIReference</span><span class="o">-</span><span class="n">c2d3e4f5</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">prefetches</span><span class="w"> </span><span class="p">(</span><span class="n">on</span><span class="w"> </span><span class="n">hover</span><span class="p">)</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement</strong>:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>No Prefetch</th>
<th>Prefetch All</th>
<th>Strategic Prefetch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Initial load</td>
<td>0.7s</td>
<td>0.7s</td>
<td>0.7s</td>
</tr>
<tr>
<td>Time to Interactive</td>
<td>0.9s</td>
<td>3.9s</td>
<td>0.9s</td>
</tr>
<tr>
<td>Bandwidth used (first 5s)</td>
<td>187 KB</td>
<td>1,148 KB</td>
<td>233 KB</td>
</tr>
<tr>
<td>Navigation to /getting-started</td>
<td>0.8s</td>
<td>0.1s</td>
<td>0.1s</td>
</tr>
<tr>
<td>Navigation to /api (after hover)</td>
<td>2.1s</td>
<td>0.1s</td>
<td>0.2s</td>
</tr>
<tr>
<td>Navigation to /changelog</td>
<td>1.5s</td>
<td>0.1s</td>
<td>0.1s</td>
</tr>
</tbody>
</table>
<h3 id="when-to-apply-prefetching">When to Apply Prefetching</h3>
<p><strong>What it optimizes for</strong>:
- Perceived performance (navigation feels instant)
- User experience on fast connections
- Frequently accessed routes</p>
<p><strong>What it sacrifices</strong>:
- Bandwidth (may download unused code)
- Battery life (mobile devices)
- Initial page performance (if too aggressive)</p>
<p><strong>When to prefetch</strong>:</p>
<p><strong>Immediate prefetch</strong>:
- Routes with &gt; 70% visit probability
- Small chunks (&lt; 50 KB)
- Critical user flows (onboarding, checkout)</p>
<p><strong>Hover prefetch</strong>:
- Routes with 30-70% visit probability
- Medium chunks (50-200 KB)
- Desktop users (mouse interaction)</p>
<p><strong>Idle prefetch</strong>:
- Routes with &lt; 30% visit probability
- Large chunks (&gt; 200 KB)
- After initial page load completes</p>
<p><strong>Viewport prefetch</strong>:
- Links below the fold
- Footer navigation
- Mobile layouts</p>
<p><strong>When NOT to prefetch</strong>:
- User on metered connection (save-data header)
- User on slow connection (&lt; 2G)
- Routes with &lt; 10% visit probability
- Very large chunks (&gt; 500 KB)
- Routes with personalized content (may be stale)</p>
<p><strong>Code characteristics</strong>:
- Setup complexity: Medium (need analytics to determine probabilities)
- Maintenance burden: Medium (adjust based on user behavior)
- Performance impact: High (when done right), Negative (when done wrong)</p>
<h3 id="respecting-user-preferences">Respecting User Preferences</h3>
<p>Always check for user preferences before prefetching:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/utils/shouldPrefetch.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">shouldPrefetch</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Check for Save-Data header</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">navigator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">navigator</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">).</span><span class="nx">connection</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">connection</span><span class="o">?</span><span class="p">.</span><span class="nx">saveData</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check for slow connection</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">effectiveType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">connection</span><span class="o">?</span><span class="p">.</span><span class="nx">effectiveType</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">effectiveType</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;slow-2g&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">effectiveType</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;2g&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Check for reduced motion preference (may indicate low-power mode)</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">prefersReducedMotion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;(prefers-reduced-motion: reduce)&#39;</span>
<span class="w">  </span><span class="p">).</span><span class="nx">matches</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prefersReducedMotion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Check battery status (if available)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;getBattery&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">navigator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="nx">navigator</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">).</span><span class="nx">getBattery</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">battery</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">battery</span><span class="p">.</span><span class="nx">level</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.2</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">battery</span><span class="p">.</span><span class="nx">charging</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Ethical prefetching</strong>: Respect user constraints. Don't waste bandwidth on metered connections. Don't drain battery on mobile devices. Prefetching is an optimization, not a requirement.</p>
<h2 id="the-journey-from-basic-routing-to-optimized-navigation">The Journey: From Basic Routing to Optimized Navigation</h2>
<h2 id="the-complete-journey">The Complete Journey</h2>
<p>Let's trace the evolution of our documentation site from basic routing to a fully optimized navigation experience:</p>
<h3 id="the-journey-from-problem-to-solution">The Journey: From Problem to Solution</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Problem</th>
<th>Technique Applied</th>
<th>Result</th>
<th>Performance Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>All code loads upfront</td>
<td>None</td>
<td>1.25 MB initial bundle</td>
<td>2.8s load on 3G</td>
</tr>
<tr>
<td>1</td>
<td>Bundle too large</td>
<td>Route-based code splitting</td>
<td>187 KB initial bundle</td>
<td>0.7s load on 3G (75% faster)</td>
</tr>
<tr>
<td>2</td>
<td>Data fetching waterfall</td>
<td>Loader functions</td>
<td>Parallel loading</td>
<td>1.9s to content (41% faster)</td>
</tr>
<tr>
<td>3</td>
<td>Lost scroll position</td>
<td>ScrollRestoration</td>
<td>Position restored</td>
<td>Better UX</td>
</tr>
<tr>
<td>4</td>
<td>Poor keyboard navigation</td>
<td>Focus management</td>
<td>Focus moves to content</td>
<td>Accessible</td>
</tr>
<tr>
<td>5</td>
<td>Slow navigation on 3G</td>
<td>Strategic prefetching</td>
<td>Instant navigation</td>
<td>Feels immediate</td>
</tr>
</tbody>
</table>
<h3 id="final-implementation">Final Implementation</h3>
<p>Here's our complete, production-ready routing setup:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/App.tsx - Production-Ready Routing</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">createBrowserRouter</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">RouterProvider</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ScrollRestoration</span>
<span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">lazy</span><span class="p">,</span><span class="w"> </span><span class="nx">Suspense</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Layout</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/Layout&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">RouteAnnouncer</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/RouteAnnouncer&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/ErrorBoundary&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useStrategicPrefetch</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./hooks/useStrategicPrefetch&#39;</span><span class="p">;</span>

<span class="c1">// Loaders</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">apiReferenceLoader</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./loaders/apiReferenceLoader&#39;</span><span class="p">;</span>

<span class="c1">// Critical path: load immediately</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Home</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/Home&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">GettingStarted</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/GettingStarted&#39;</span><span class="p">;</span>

<span class="c1">// Heavy routes: lazy load</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">APIReference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/APIReference&#39;</span><span class="p">));</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Examples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/Examples&#39;</span><span class="p">));</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Changelog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./pages/Changelog&#39;</span><span class="p">));</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">RouteLoadingFallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;route-loading&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">page</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createBrowserRouter</span><span class="p">([</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ScrollRestoration</span><span class="w"> </span>
<span class="w">          </span><span class="na">getKey</span><span class="o">=</span><span class="p">{(</span><span class="nx">location</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Restore scroll position for API Reference</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;/api&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">location</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
<span class="w">          </span><span class="p">}}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">RouteAnnouncer</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/&gt;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="nx">errorElement</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="w"> </span><span class="p">/&gt;,</span>
<span class="w">    </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Home</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;getting-started&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">GettingStarted</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;api&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">RouteLoadingFallback</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">APIReference</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nx">loader</span><span class="o">:</span><span class="w"> </span><span class="kt">apiReferenceLoader</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;examples&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">RouteLoadingFallback</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Examples</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;changelog&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">element</span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">RouteLoadingFallback</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">Changelog</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useStrategicPrefetch</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">RouterProvider</span><span class="w"> </span><span class="na">router</span><span class="o">=</span><span class="p">{</span><span class="nx">router</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/Layout.tsx - Production-Ready Layout</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Outlet</span><span class="p">,</span><span class="w"> </span><span class="nx">useLocation</span><span class="p">,</span><span class="w"> </span><span class="nx">useNavigation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Navigation</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Navigation&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Layout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLocation</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">navigation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useNavigation</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mainRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">HTMLElement</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isLoading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">navigation</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Focus management</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;layout&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Skip link for keyboard users */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span>
<span class="w">        </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;#main-content&quot;</span><span class="w"> </span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skip-link&quot;</span>
<span class="w">        </span><span class="na">onClick</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">          </span><span class="nx">mainRef</span><span class="p">.</span><span class="nx">current</span><span class="o">?</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">        </span><span class="p">}}</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="nx">Skip</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="nx">content</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">Navigation</span><span class="w"> </span><span class="p">/&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Loading indicator */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isLoading</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;loading-bar&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;loading-bar-progress&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">main</span><span class="w"> </span>
<span class="w">        </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;main-content&quot;</span>
<span class="w">        </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">mainRef</span><span class="p">}</span>
<span class="w">        </span><span class="na">tabIndex</span><span class="o">=</span><span class="p">{</span><span class="o">-</span><span class="mf">1</span><span class="p">}</span>
<span class="w">        </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;main-content&quot;</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Outlet</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="decision-framework-routing-optimization-strategies">Decision Framework: Routing Optimization Strategies</h3>
<p>When building a React application with routing, use this framework to decide which optimizations to apply:</p>
<h4 id="code-splitting-decision-tree">Code Splitting Decision Tree</h4>
<div class="codehilite"><pre><span></span><code><span class="n">Is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="n">KB</span><span class="err">?</span>
<span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="n">Yes</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Split</span><span class="w"> </span><span class="n">it</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">visited</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">70</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">users</span><span class="err">?</span>
<span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="n">Yes</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">prefetch</span><span class="w"> </span><span class="n">immediately</span>
<span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Lazy</span><span class="w"> </span><span class="nb">load</span>
<span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">bundle</span>
</code></pre></div>

<h4 id="data-loading-decision-tree">Data Loading Decision Tree</h4>
<div class="codehilite"><pre><span></span><code><span class="n">Does</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">data</span><span class="err">?</span>
<span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="n">Yes</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">loader</span><span class="w"> </span><span class="n">function</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="p">(</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="n">ms</span><span class="p">)</span><span class="err">?</span>
<span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="n">Yes</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Show</span><span class="w"> </span><span class="n">loading</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">consider</span><span class="w"> </span><span class="n">prefetching</span>
<span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Loader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">sufficient</span>
<span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">loader</span><span class="w"> </span><span class="n">needed</span>
</code></pre></div>

<h4 id="prefetching-decision-tree">Prefetching Decision Tree</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">What</span><span class="err">&#39;s the visit probability?</span>
<span class="err">‚îú‚îÄ &gt; 70% ‚Üí Prefetch immediately (or include in initial bundle)</span>
<span class="err">‚îú‚îÄ 30-70% ‚Üí Prefetch on hover/intent</span>
<span class="err">‚îú‚îÄ 10-30% ‚Üí Prefetch on idle</span>
‚îî‚îÄ<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="o">%</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="nv">Don</span><span class="err">&#39;t prefetch</span>

<span class="err">AND</span>

<span class="err">Is the user on a fast connection?</span>
<span class="err">‚îú‚îÄ Yes ‚Üí Prefetch according to probability</span>
<span class="err">‚îî‚îÄ No ‚Üí Only prefetch high-probability routes (&gt; 70%)</span>

<span class="err">AND</span>

<span class="err">Does the user prefer reduced data?</span>
‚îú‚îÄ<span class="w"> </span><span class="nv">Yes</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="nv">Don</span><span class="err">&#39;t prefetch</span>
<span class="err">‚îî‚îÄ No ‚Üí Prefetch according to strategy</span>
</code></pre></div>

<h3 id="performance-metrics-before-and-after">Performance Metrics: Before and After</h3>
<p><strong>Initial State</strong> (no optimizations):
- Initial bundle: 1.25 MB (412 KB gzipped)
- Time to Interactive: 3.2s on 3G
- Navigation time: 0s (all code loaded)
- Lighthouse Score: 72
- Accessibility Score: 78</p>
<p><strong>Final State</strong> (all optimizations):
- Initial bundle: 187 KB (64 KB gzipped)
- Time to Interactive: 0.9s on 3G
- Navigation time: 0.2s average (with prefetching)
- Lighthouse Score: 94
- Accessibility Score: 95</p>
<p><strong>Improvements</strong>:
- 85% smaller initial bundle
- 72% faster Time to Interactive
- 22 point Lighthouse improvement
- 17 point Accessibility improvement
- Navigation feels instant for most routes</p>
<h3 id="lessons-learned">Lessons Learned</h3>
<h4 id="1-code-splitting-is-essential-but-strategic">1. Code Splitting is Essential, But Strategic</h4>
<p>Don't split everything. Split large, rarely-used routes. Keep small, frequently-used code together. The goal is to optimize initial load without making navigation slow.</p>
<h4 id="2-data-loading-waterfalls-kill-performance">2. Data Loading Waterfalls Kill Performance</h4>
<p>Use loader functions to fetch data in parallel with component code. Don't wait for the component to mount before fetching data.</p>
<h4 id="3-accessibility-is-not-optional">3. Accessibility is Not Optional</h4>
<p>Scroll restoration and focus management are not "nice to have" features. They're essential for keyboard and screen reader users. Implement them from the start.</p>
<h4 id="4-prefetching-is-powerful-but-respect-user-constraints">4. Prefetching is Powerful, But Respect User Constraints</h4>
<p>Prefetch strategically based on visit probability and user intent. Always check for metered connections and user preferences. Don't waste bandwidth or battery.</p>
<h4 id="5-measure-dont-guess">5. Measure, Don't Guess</h4>
<p>Use analytics to determine which routes to prefetch. Use React DevTools Profiler to find performance bottlenecks. Use Lighthouse to validate improvements. Data beats intuition.</p>
<h3 id="common-failure-modes-and-their-signatures">Common Failure Modes and Their Signatures</h3>
<h4 id="symptom-navigation-feels-slow-despite-code-splitting">Symptom: Navigation feels slow despite code splitting</h4>
<p><strong>Browser behavior</strong>: User clicks link, waits 2+ seconds, content appears</p>
<p><strong>Console pattern</strong>: No errors, just slow network requests</p>
<p><strong>DevTools clues</strong>:
- Network tab shows large chunks downloading
- No prefetching happening
- Sequential requests (waterfall)</p>
<p><strong>Root cause</strong>: No prefetching strategy, or chunks are too large</p>
<p><strong>Solution</strong>: Implement strategic prefetching based on user intent and visit probability</p>
<h4 id="symptom-initial-page-load-is-slow-despite-code-splitting">Symptom: Initial page load is slow despite code splitting</h4>
<p><strong>Browser behavior</strong>: Blank screen for 2+ seconds on initial load</p>
<p><strong>Console pattern</strong>: Multiple chunk requests immediately after initial bundle</p>
<p><strong>DevTools clues</strong>:
- Network tab shows many simultaneous requests
- Coverage tab shows low code usage
- Performance tab shows long parse time</p>
<p><strong>Root cause</strong>: Over-aggressive prefetching or too many immediate imports</p>
<p><strong>Solution</strong>: Reduce prefetching, increase code splitting granularity, defer non-critical code</p>
<h4 id="symptom-user-loses-scroll-position-on-back-navigation">Symptom: User loses scroll position on back navigation</h4>
<p><strong>Browser behavior</strong>: User navigates back, page scrolls to top</p>
<p><strong>Console pattern</strong>: No errors</p>
<p><strong>DevTools clues</strong>:
- React Router navigation events fire
- Scroll position resets to 0</p>
<p><strong>Root cause</strong>: Missing ScrollRestoration component</p>
<p><strong>Solution</strong>: Add <code>&lt;ScrollRestoration /&gt;</code> to router configuration</p>
<h4 id="symptom-keyboard-users-cant-navigate-efficiently">Symptom: Keyboard users can't navigate efficiently</h4>
<p><strong>Browser behavior</strong>: Focus stays on navigation link after route change</p>
<p><strong>Console pattern</strong>: No errors</p>
<p><strong>DevTools clues</strong>:
- Active element doesn't change on navigation
- Screen reader doesn't announce page change</p>
<p><strong>Root cause</strong>: Missing focus management</p>
<p><strong>Solution</strong>: Implement focus management with <code>useEffect</code> and <code>ref.current.focus()</code></p>
<h3 id="when-to-apply-these-patterns">When to Apply These Patterns</h3>
<p><strong>Always apply</strong>:
- Route-based code splitting (for routes &gt; 50 KB)
- Scroll restoration
- Focus management
- Error boundaries</p>
<p><strong>Apply when appropriate</strong>:
- Loader functions (when routes need data)
- Prefetching (based on visit probability and user constraints)
- Component-level code splitting (for heavy components)</p>
<p><strong>Rarely apply</strong>:
- Aggressive prefetching (only for high-probability routes)
- Complex prefetching strategies (only when analytics justify it)</p>
<h3 id="the-professional-react-developers-routing-checklist">The Professional React Developer's Routing Checklist</h3>
<p>Before deploying a React application with routing:</p>
<p>‚úÖ <strong>Code Splitting</strong>
- [ ] Routes &gt; 50 KB are lazy loaded
- [ ] Initial bundle &lt; 200 KB (gzipped)
- [ ] Suspense boundaries provide loading feedback</p>
<p>‚úÖ <strong>Data Loading</strong>
- [ ] Loader functions fetch data in parallel with code
- [ ] Loading states are visible to users
- [ ] Error boundaries catch loader failures</p>
<p>‚úÖ <strong>Accessibility</strong>
- [ ] ScrollRestoration restores scroll position
- [ ] Focus moves to main content on navigation
- [ ] Skip link allows keyboard users to bypass navigation
- [ ] Route changes are announced to screen readers</p>
<p>‚úÖ <strong>Performance</strong>
- [ ] Prefetching strategy based on analytics
- [ ] User preferences respected (save-data, slow connection)
- [ ] Lighthouse score &gt; 90
- [ ] Time to Interactive &lt; 2s on 3G</p>
<p>‚úÖ <strong>User Experience</strong>
- [ ] Navigation feels instant (&lt; 300ms perceived delay)
- [ ] Loading states are clear and consistent
- [ ] Error states are user-friendly
- [ ] Back/forward navigation works correctly</p>
<p>This is the foundation of professional React routing. Master these patterns, and your applications will feel fast, accessible, and polished.</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 12:33:27 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>