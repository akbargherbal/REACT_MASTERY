<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Testing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">06 Production-Ready Patterns</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-23-testing">Chapter 23: Testing</h1>
<h2 id="vitest-modern-fast-testing">Vitest: modern, fast testing</h2>
<h2 id="the-problem-testing-solves">The Problem Testing Solves</h2>
<p>You've built a payment form. It works perfectly‚Äîyou've clicked through it dozens of times. You ship it to production. Two weeks later, you add a discount code feature. You test the discount code. It works. You ship it.</p>
<p>The next day, your support team reports that users can't submit payments anymore. The submit button is disabled even when the form is valid. You investigate and discover that your discount code logic accidentally broke the form validation. The bug was there for 12 hours before anyone noticed.</p>
<p><strong>This is the failure manual testing doesn't catch: regressions.</strong></p>
<p>Every time you change code, you risk breaking something that used to work. Manual testing can't scale‚Äîyou can't click through every feature after every change. Automated tests catch regressions before they reach production.</p>
<h2 id="reference-implementation-payment-form-component">Reference Implementation: Payment Form Component</h2>
<p>We'll build a realistic payment form that accepts credit card information, validates input, and handles submission. This component will evolve through the chapter as we add tests that catch real bugs.</p>
<p><strong>Project Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">src</span><span class="o">/</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">components</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">PaymentForm</span><span class="p">.</span><span class="nx">tsx</span><span class="w">          </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Our</span><span class="w"> </span><span class="nx">reference</span><span class="w"> </span><span class="nx">implementation</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">PaymentForm</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">tsx</span><span class="w">     </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Tests</span><span class="w"> </span><span class="nx">we</span><span class="err">&#39;</span><span class="nx">ll</span><span class="w"> </span><span class="nx">build</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">CreditCardInput</span><span class="p">.</span><span class="nx">tsx</span><span class="w">      </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Child</span><span class="w"> </span><span class="nx">component</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">lib</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">validation</span><span class="p">.</span><span class="nx">ts</span><span class="w">            </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Validation</span><span class="w"> </span><span class="nx">logic</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">validation</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">ts</span><span class="w">       </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Unit</span><span class="w"> </span><span class="nx">tests</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">__tests__</span><span class="o">/</span>
<span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">setup</span><span class="p">.</span><span class="nx">ts</span><span class="w">                 </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Test</span><span class="w"> </span><span class="nx">configuration</span>
</code></pre></div>

<h3 id="initial-implementation-the-untested-form">Initial Implementation: The Untested Form</h3>
<p>Here's our starting point‚Äîa payment form that works but has no tests:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/PaymentForm.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">PaymentFormProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">onSubmit</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">PaymentData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">void</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">PaymentData</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">expiryDate</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">cvv</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">cardholderName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">PaymentForm</span><span class="p">({</span><span class="w"> </span><span class="nx">onSubmit</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">PaymentFormProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">cardNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">setCardNumber</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">expiryDate</span><span class="p">,</span><span class="w"> </span><span class="nx">setExpiryDate</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">cvv</span><span class="p">,</span><span class="w"> </span><span class="nx">setCvv</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">cardholderName</span><span class="p">,</span><span class="w"> </span><span class="nx">setCardholderName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isSubmitting</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsSubmitting</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="nx">cardNumber</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">16</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">expiryDate</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">cvv</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">cardholderName</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FormEvent</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isValid</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="nx">setIsSubmitting</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">onSubmit</span><span class="p">({</span>
<span class="w">        </span><span class="nx">cardNumber</span><span class="p">,</span>
<span class="w">        </span><span class="nx">expiryDate</span><span class="p">,</span>
<span class="w">        </span><span class="nx">cvv</span><span class="p">,</span>
<span class="w">        </span><span class="nx">cardholderName</span><span class="p">,</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Payment failed&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setIsSubmitting</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">form</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;payment-form&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Payment</span><span class="w"> </span><span class="nx">Details</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;amount&quot;</span><span class="p">&gt;</span><span class="nx">Amount</span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">{</span><span class="nx">amount</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">label</span><span class="w"> </span><span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;cardNumber&quot;</span><span class="p">&gt;</span><span class="nx">Card</span><span class="w"> </span><span class="nb">Number</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">          </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;cardNumber&quot;</span>
<span class="w">          </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="w">          </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">cardNumber</span><span class="p">}</span>
<span class="w">          </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setCardNumber</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">          </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;1234567812345678&quot;</span>
<span class="w">          </span><span class="na">maxLength</span><span class="o">=</span><span class="p">{</span><span class="mf">16</span><span class="p">}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;form-row&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">label</span><span class="w"> </span><span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;expiryDate&quot;</span><span class="p">&gt;</span><span class="nx">Expiry</span><span class="w"> </span><span class="nb">Date</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">            </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;expiryDate&quot;</span>
<span class="w">            </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="w">            </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">expiryDate</span><span class="p">}</span>
<span class="w">            </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setExpiryDate</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">            </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;MM/YY&quot;</span>
<span class="w">            </span><span class="na">maxLength</span><span class="o">=</span><span class="p">{</span><span class="mf">5</span><span class="p">}</span>
<span class="w">          </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">label</span><span class="w"> </span><span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;cvv&quot;</span><span class="p">&gt;</span><span class="nx">CVV</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">            </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;cvv&quot;</span>
<span class="w">            </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="w">            </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">cvv</span><span class="p">}</span>
<span class="w">            </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setCvv</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">            </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;123&quot;</span>
<span class="w">            </span><span class="na">maxLength</span><span class="o">=</span><span class="p">{</span><span class="mf">3</span><span class="p">}</span>
<span class="w">          </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">label</span><span class="w"> </span><span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;cardholderName&quot;</span><span class="p">&gt;</span><span class="nx">Cardholder</span><span class="w"> </span><span class="nx">Name</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">          </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;cardholderName&quot;</span>
<span class="w">          </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="w">          </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">cardholderName</span><span class="p">}</span>
<span class="w">          </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setCardholderName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">          </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;John Doe&quot;</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="w"> </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">error</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">        </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
<span class="w">        </span><span class="na">disabled</span><span class="o">=</span><span class="p">{</span><span class="o">!</span><span class="nx">isValid</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">isSubmitting</span><span class="p">}</span>
<span class="w">      </span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">isSubmitting</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Processing...&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="sb">`Pay $</span><span class="si">${</span><span class="nx">amount</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This form works. You can fill it out, submit it, see loading states, and handle errors. But how do you know it will keep working after you make changes?</p>
<h2 id="setting-up-vitest">Setting Up Vitest</h2>
<p>Vitest is a modern test runner built for Vite projects. It's fast, has excellent TypeScript support, and provides a Jest-compatible API that most developers already know.</p>
<h3 id="installation">Installation</h3>
<p>First, install Vitest and testing utilities:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>vitest<span class="w"> </span>@testing-library/react<span class="w"> </span>@testing-library/jest-dom<span class="w"> </span>@testing-library/user-event<span class="w"> </span>jsdom
</code></pre></div>

<p><strong>What each package does</strong>:
- <code>vitest</code> - The test runner itself
- <code>@testing-library/react</code> - Utilities for testing React components
- <code>@testing-library/jest-dom</code> - Custom matchers for DOM assertions
- <code>@testing-library/user-event</code> - Simulates real user interactions
- <code>jsdom</code> - Simulates a browser environment in Node.js</p>
<h3 id="configuration">Configuration</h3>
<p>Add Vitest configuration to your <code>vite.config.ts</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// vite.config.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">defineConfig</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vite&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">react</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@vitejs/plugin-react&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">defineConfig</span><span class="p">({</span>
<span class="w">  </span><span class="nx">plugins</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">react</span><span class="p">()],</span>
<span class="w">  </span><span class="nx">test</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">globals</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;jsdom&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">setupFiles</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;./src/__tests__/setup.ts&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">css</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Configuration explained</strong>:
- <code>globals: true</code> - Makes <code>describe</code>, <code>it</code>, <code>expect</code> available without imports
- <code>environment: 'jsdom'</code> - Simulates browser APIs (DOM, window, etc.)
- <code>setupFiles</code> - Runs before each test file
- <code>css: true</code> - Processes CSS imports (needed for styled components)</p>
<h3 id="test-setup-file">Test Setup File</h3>
<p>Create the setup file that runs before all tests:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/__tests__/setup.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">afterEach</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cleanup</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">matchers</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/jest-dom/matchers&#39;</span><span class="p">;</span>

<span class="c1">// Extend Vitest&#39;s expect with jest-dom matchers</span>
<span class="nx">expect</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">matchers</span><span class="p">);</span>

<span class="c1">// Cleanup after each test</span>
<span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">cleanup</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p>This setup:
1. Adds custom matchers like <code>toBeInTheDocument()</code>, <code>toHaveValue()</code>, etc.
2. Automatically cleans up rendered components after each test
3. Prevents test pollution (one test affecting another)</p>
<h3 id="packagejson-scripts">Package.json Scripts</h3>
<p>Add test scripts to <code>package.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vitest&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:ui&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vitest --ui&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:coverage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vitest --coverage&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Script purposes</strong>:
- <code>test</code> - Runs tests in watch mode (re-runs on file changes)
- <code>test:ui</code> - Opens a browser UI for exploring tests
- <code>test:coverage</code> - Generates code coverage report</p>
<h2 id="your-first-test-does-it-render">Your First Test: Does It Render?</h2>
<p>The simplest test verifies that the component renders without crashing:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/PaymentForm.test.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">render</span><span class="p">,</span><span class="w"> </span><span class="nx">screen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentForm</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./PaymentForm&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentForm&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;renders the form with all fields&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">    </span><span class="c1">// Check that key elements are present</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Payment Details&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>What this test does</strong>:
1. Creates a mock function for <code>onSubmit</code> using <code>vi.fn()</code>
2. Renders the component with test props
3. Queries the DOM for expected elements
4. Asserts they exist using <code>toBeInTheDocument()</code></p>
<p><strong>Run the test</strong>:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span><span class="nb">test</span>
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/PaymentForm.test.tsx (1)
   ‚úì PaymentForm (1)
     ‚úì renders the form with all fields

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  10:23:45
   Duration  234ms
</code></pre></div>

<p><strong>Success!</strong> The test passes. But this test is shallow‚Äîit only checks that elements exist. It doesn't verify behavior.</p>
<h2 id="the-anatomy-of-a-vitest-test">The Anatomy of a Vitest Test</h2>
<p>Let's break down the structure:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ComponentName&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Test suite - groups related tests</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;describes what the test verifies&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Individual test case</span>

<span class="w">    </span><span class="c1">// 1. Arrange - Set up test data and render component</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockFn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>
<span class="w">    </span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Component</span><span class="w"> </span><span class="nx">prop</span><span class="o">=</span><span class="p">{</span><span class="nx">mockFn</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 2. Act - Perform user actions</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">button</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 3. Assert - Verify expected outcomes</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockFn</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>The AAA Pattern</strong>:
- <strong>Arrange</strong> - Set up the test scenario
- <strong>Act</strong> - Trigger the behavior you're testing
- <strong>Assert</strong> - Verify the outcome</p>
<p>This pattern makes tests readable and maintainable.</p>
<h2 id="vitests-key-features">Vitest's Key Features</h2>
<h3 id="fast-execution">Fast Execution</h3>
<p>Vitest runs tests in parallel and only re-runs tests affected by code changes:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Watch mode automatically re-runs tests on file changes</span>
npm<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Run tests once (CI mode)</span>
npm<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--<span class="w"> </span>--run
</code></pre></div>

<p><strong>Terminal Output (Watch Mode)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="nv">RERUN</span><span class="w">  </span><span class="nv">src</span><span class="o">/</span><span class="nv">components</span><span class="o">/</span><span class="nv">PaymentForm</span>.<span class="nv">test</span>.<span class="nv">tsx</span>

<span class="w"> </span>‚úì<span class="w"> </span><span class="nv">src</span><span class="o">/</span><span class="nv">components</span><span class="o">/</span><span class="nv">PaymentForm</span>.<span class="nv">test</span>.<span class="nv">tsx</span><span class="w"> </span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span><span class="w"> </span><span class="mi">89</span><span class="nv">ms</span>

<span class="w"> </span><span class="nv">Test</span><span class="w"> </span><span class="nv">Files</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="nv">passed</span><span class="w"> </span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span>
<span class="w">      </span><span class="nv">Tests</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="nv">passed</span><span class="w"> </span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span>
<span class="w">   </span><span class="nv">Start</span><span class="w"> </span><span class="nv">at</span><span class="w">  </span><span class="mi">10</span>:<span class="mi">25</span>:<span class="mi">12</span>
<span class="w">   </span><span class="nv">Duration</span><span class="w">  </span><span class="mi">89</span><span class="nv">ms</span><span class="w"> </span><span class="ss">(</span><span class="nv">in</span><span class="w"> </span><span class="nv">thread</span><span class="w"> </span><span class="mi">45</span><span class="nv">ms</span>,<span class="w"> </span><span class="mi">197</span>.<span class="mi">78</span><span class="o">%</span><span class="ss">)</span>

<span class="w"> </span><span class="nv">PASS</span><span class="w">  </span><span class="nv">Waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="nv">changes</span>...
<span class="w">       </span><span class="nv">press</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="nv">help</span>,<span class="w"> </span><span class="nv">press</span><span class="w"> </span><span class="nv">q</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">quit</span>
</code></pre></div>

<h3 id="mocking-with-vi">Mocking with vi</h3>
<p>Vitest provides <code>vi</code> for creating mocks, spies, and stubs:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>

<span class="c1">// Mock a function</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">mockFn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>
<span class="nx">mockFn</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">mockFn</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>

<span class="c1">// Mock a function with return value</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">mockFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">({</span><span class="w"> </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Spy on an existing function</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">spy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;log&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">spy</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="nx">spy</span><span class="p">.</span><span class="nx">mockRestore</span><span class="p">();</span>

<span class="c1">// Mock a module</span>
<span class="nx">vi</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;./api&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">fetchUser</span><span class="o">:</span><span class="w"> </span><span class="kt">vi.fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test User&#39;</span><span class="w"> </span><span class="p">}),</span>
<span class="p">}));</span>
</code></pre></div>

<h3 id="snapshot-testing">Snapshot Testing</h3>
<p>Vitest supports snapshot testing for catching unintended UI changes:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;matches snapshot&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">container</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">PaymentForm</span><span class="w"> </span><span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="nx">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">toMatchSnapshot</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>When to use snapshots</strong>:
- ‚úÖ Testing component structure that shouldn't change often
- ‚úÖ Catching unintended layout changes
- ‚ùå Testing dynamic content (dates, IDs, random values)
- ‚ùå As a substitute for meaningful assertions</p>
<h3 id="coverage-reports">Coverage Reports</h3>
<p>Generate coverage to see what code is tested:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--<span class="w"> </span>--coverage
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c"> % Coverage report from v8</span>
<span class="nb">--------------------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">----------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">-------------------</span>
<span class="c">File                | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s</span>
<span class="nb">--------------------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">----------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">-------------------</span>
<span class="c">All files           |   45</span><span class="nt">.</span><span class="c">45 |       50 |      40 |   45</span><span class="nt">.</span><span class="c">45 |</span>
<span class="c"> PaymentForm</span><span class="nt">.</span><span class="c">tsx    |   45</span><span class="nt">.</span><span class="c">45 |       50 |      40 |   45</span><span class="nt">.</span><span class="c">45 | 28</span><span class="nb">-</span><span class="c">45</span>
<span class="nb">--------------------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">----------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">-------------------</span>
</code></pre></div>

<p><strong>What this tells you</strong>:
- Only 45% of statements are executed by tests
- Lines 28-45 (the submit handler) are untested
- We need more tests to cover error handling and submission</p>
<h2 id="why-vitest-over-jest">Why Vitest Over Jest?</h2>
<p><strong>Vitest advantages</strong>:
- <strong>Faster</strong> - Native ESM support, no transpilation needed
- <strong>Better DX</strong> - Instant HMR for tests, built-in TypeScript support
- <strong>Vite integration</strong> - Uses your existing Vite config
- <strong>Modern</strong> - Designed for 2025, not 2015</p>
<p><strong>When to use Jest instead</strong>:
- Legacy projects already using Jest
- Need specific Jest plugins not available for Vitest
- Team familiarity outweighs technical benefits</p>
<p>For new projects in 2025, Vitest is the pragmatic choice.</p>
<h2 id="react-testing-library-user-centric-tests">React Testing Library: user-centric tests</h2>
<h2 id="the-failure-testing-implementation-details">The Failure: Testing Implementation Details</h2>
<p>Let's write a test the wrong way first. Many developers test React components like this:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå BAD: Testing implementation details</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;updates state when card number changes&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">renderHook</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">cardNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">setCardNumber</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>

<span class="w">  </span><span class="nx">act</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setCardNumber</span><span class="p">(</span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">[</span><span class="mf">0</span><span class="p">]).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run this test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/PaymentForm.test.tsx (2)
   ‚úì PaymentForm (2)
     ‚úì renders the form with all fields
     ‚úì updates state when card number changes

 Test Files  1 passed (1)
      Tests  2 passed (2)
</code></pre></div>

<p><strong>The test passes. So what's wrong?</strong></p>
<h3 id="diagnostic-analysis-why-this-test-is-useless">Diagnostic Analysis: Why This Test Is Useless</h3>
<p><strong>The problem</strong>: This test verifies that <code>useState</code> works. But <code>useState</code> is React's code, not yours. You're testing the framework, not your component.</p>
<p><strong>What happens when you refactor</strong>:</p>
<p>Imagine you refactor to use <code>useReducer</code> instead of <code>useState</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Refactored to useReducer</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span><span class="w"> </span><span class="nx">initialState</span><span class="p">);</span>

<span class="c1">// Your test breaks even though the component still works</span>
<span class="c1">// The test was coupled to implementation details</span>
</code></pre></div>

<p><strong>The test breaks</strong> even though the component behavior is identical from the user's perspective. The user doesn't care whether you use <code>useState</code> or <code>useReducer</code>‚Äîthey only care that typing in the input updates the value.</p>
<p><strong>This is the fundamental problem with testing implementation details</strong>: Tests break when you refactor, even when behavior doesn't change.</p>
<h2 id="react-testing-library-philosophy">React Testing Library Philosophy</h2>
<p>React Testing Library enforces a simple principle:</p>
<blockquote>
<p><strong>Test your components the way users interact with them.</strong></p>
</blockquote>
<p>Users don't call <code>setState</code>. Users don't access component internals. Users:
- See text on the screen
- Click buttons
- Type in inputs
- Read error messages</p>
<p>Your tests should do the same.</p>
<h2 id="iteration-1-testing-user-interactions">Iteration 1: Testing User Interactions</h2>
<p>Let's rewrite our test to focus on user behavior:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/PaymentForm.test.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">render</span><span class="p">,</span><span class="w"> </span><span class="nx">screen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">userEvent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/user-event&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentForm</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./PaymentForm&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentForm&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;enables submit button when all fields are valid&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">    </span><span class="c1">// Initially, button should be disabled</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">submitButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">submitButton</span><span class="p">).</span><span class="nx">toBeDisabled</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Fill out the form as a user would</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Now button should be enabled</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">submitButton</span><span class="p">).</span><span class="nx">toBeEnabled</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run the test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/PaymentForm.test.tsx (1)
   ‚úì PaymentForm (1)
     ‚úì enables submit button when all fields are valid

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  10:45:23
   Duration  312ms
</code></pre></div>

<p><strong>What changed</strong>:
1. We use <code>userEvent</code> to simulate real typing
2. We query elements by their accessible labels (what users see)
3. We verify the button state (what users experience)
4. We never touch component internals</p>
<p><strong>This test is resilient</strong>: You can refactor the component's state management, and this test will still pass as long as the user experience remains the same.</p>
<h2 id="the-react-testing-library-query-priority">The React Testing Library Query Priority</h2>
<p>React Testing Library provides multiple ways to query elements. Use them in this order:</p>
<h3 id="1-queries-accessible-to-everyone">1. Queries Accessible to Everyone</h3>
<p><strong>Prefer these</strong> - they reflect how users and assistive technologies interact:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ BEST: By role (most accessible)</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/submit/i</span><span class="w"> </span><span class="p">});</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;textbox&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/email/i</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// ‚úÖ GOOD: By label text (what users see)</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Email Address&#39;</span><span class="p">);</span>

<span class="c1">// ‚úÖ GOOD: By placeholder text</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByPlaceholderText</span><span class="p">(</span><span class="s1">&#39;Enter your email&#39;</span><span class="p">);</span>

<span class="c1">// ‚úÖ GOOD: By text content</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Welcome back!&#39;</span><span class="p">);</span>
</code></pre></div>

<h3 id="2-semantic-queries">2. Semantic Queries</h3>
<p><strong>Use when accessible queries don't work</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ö†Ô∏è OK: By alt text (for images)</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByAltText</span><span class="p">(</span><span class="s1">&#39;User avatar&#39;</span><span class="p">);</span>

<span class="c1">// ‚ö†Ô∏è OK: By title attribute</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByTitle</span><span class="p">(</span><span class="s1">&#39;Close dialog&#39;</span><span class="p">);</span>
</code></pre></div>

<h3 id="3-test-ids-last-resort">3. Test IDs (Last Resort)</h3>
<p><strong>Only when nothing else works</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå AVOID: By test ID (not user-facing)</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">getByTestId</span><span class="p">(</span><span class="s1">&#39;submit-button&#39;</span><span class="p">);</span>

<span class="c1">// In component:</span>
<span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">data</span><span class="o">-</span><span class="nx">testid</span><span class="o">=</span><span class="s2">&quot;submit-button&quot;</span><span class="o">&gt;</span><span class="nx">Submit</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</code></pre></div>

<p><strong>Why avoid test IDs?</strong>
- They don't reflect user experience
- They add noise to your markup
- They can hide accessibility issues</p>
<p>If you need a test ID, it often means your component lacks proper semantic HTML or ARIA attributes.</p>
<h2 id="query-variants-get-query-find">Query Variants: get, query, find</h2>
<p>React Testing Library provides three query variants:</p>
<h3 id="getby-throws-if-not-found">getBy - Throws if not found</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Throws error immediately if element doesn&#39;t exist</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
<span class="c1">// Use when: Element should definitely be present</span>
</code></pre></div>

<h3 id="queryby-returns-null-if-not-found">queryBy - Returns null if not found</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Returns null if element doesn&#39;t exist</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">queryByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">error</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="c1">// Use when: Testing that element is NOT present</span>
</code></pre></div>

<h3 id="findby-waits-for-element-to-appear">findBy - Waits for element to appear</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Waits up to 1000ms for element to appear</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;Payment successful&#39;</span><span class="p">);</span>
<span class="c1">// Use when: Element appears asynchronously</span>
</code></pre></div>

<h2 id="iteration-2-testing-form-submission">Iteration 2: Testing Form Submission</h2>
<p>Now let's test the actual submission flow:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/PaymentForm.test.tsx</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentForm&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;calls onSubmit with form data when submitted&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">    </span><span class="c1">// Fill out the form</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Submit the form</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">    </span><span class="c1">// Verify onSubmit was called with correct data</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockOnSubmit</span><span class="p">).</span><span class="nx">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockOnSubmit</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">({</span>
<span class="w">      </span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">expiryDate</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">cvv</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">cardholderName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run the test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/PaymentForm.test.tsx (2)
   ‚úì PaymentForm (2)
     ‚úì enables submit button when all fields are valid
     ‚úì calls onSubmit with form data when submitted

 Test Files  1 passed (1)
      Tests  2 passed (2)
   Start at  10:52:18
   Duration  445ms
</code></pre></div>

<p><strong>What we verified</strong>:
1. User can fill out all fields
2. User can click submit button
3. Component calls <code>onSubmit</code> with correct data
4. Component calls <code>onSubmit</code> exactly once (no double submission)</p>
<h2 id="the-failure-async-state-updates">The Failure: Async State Updates</h2>
<p>Let's test the loading state during submission:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;shows loading state during submission&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockImplementation</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">))</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill and submit form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="c1">// Check for loading state</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/processing/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run the test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="n">FAIL</span><span class="w">  </span><span class="n">src</span><span class="o">/</span><span class="n">components</span><span class="o">/</span><span class="n">PaymentForm</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">tsx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">PaymentForm</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">shows</span><span class="w"> </span><span class="n">loading</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">submission</span>
<span class="n">TestingLibraryElementError</span><span class="p">:</span><span class="w"> </span><span class="n">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">accessible</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="s2">&quot;button&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">processing</span><span class="o">/</span><span class="n">i</span><span class="err">`</span>

<span class="n">Here</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">accessible</span><span class="w"> </span><span class="n">roles</span><span class="p">:</span>

<span class="w">  </span><span class="n">button</span><span class="p">:</span>

<span class="w">  </span><span class="n">Name</span><span class="w"> </span><span class="s2">&quot;Pay $99.99&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">button</span>
<span class="w">    </span><span class="n">disabled</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="n">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span>
<span class="w">  </span><span class="o">/&gt;</span>
</code></pre></div>

<h3 id="diagnostic-analysis-race-condition-in-test">Diagnostic Analysis: Race Condition in Test</h3>
<p><strong>What happened</strong>:
1. We clicked the submit button
2. The component started the async <code>onSubmit</code> call
3. We immediately queried for the "Processing..." button
4. But React hadn't re-rendered yet with the loading state
5. The test found the old "Pay $99.99" button instead</p>
<p><strong>The problem</strong>: We're testing async behavior synchronously.</p>
<p><strong>The solution</strong>: Use <code>findBy</code> to wait for the loading state:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;shows loading state during submission&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockImplementation</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">))</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill and submit form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="c1">// Wait for loading state to appear</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/processing/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Wait for loading state to disappear</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">waitFor</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">queryByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/processing/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run the test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/PaymentForm.test.tsx (3)
   ‚úì PaymentForm (3)
     ‚úì enables submit button when all fields are valid
     ‚úì calls onSubmit with form data when submitted
     ‚úì shows loading state during submission

 Test Files  1 passed (1)
      Tests  3 passed (3)
   Start at  11:05:42
   Duration  612ms
</code></pre></div>

<p><strong>Success!</strong> The test now properly waits for async state updates.</p>
<h2 id="iteration-3-testing-error-handling">Iteration 3: Testing Error Handling</h2>
<p>Let's test what happens when submission fails:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;displays error message when submission fails&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockRejectedValue</span><span class="p">(</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Payment declined&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill and submit form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="c1">// Wait for error message to appear</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">).</span><span class="nx">toHaveTextContent</span><span class="p">(</span><span class="s1">&#39;Payment declined&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Button should be enabled again for retry</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeEnabled</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run the test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/PaymentForm.test.tsx (4)
   ‚úì PaymentForm (4)
     ‚úì enables submit button when all fields are valid
     ‚úì calls onSubmit with form data when submitted
     ‚úì shows loading state during submission
     ‚úì displays error message when submission fails

 Test Files  1 passed (1)
      Tests  4 passed (4)
   Start at  11:12:35
   Duration  723ms
</code></pre></div>

<p><strong>What we verified</strong>:
1. Error message appears with correct text
2. Error has <code>role="alert"</code> for accessibility
3. Button re-enables after error (user can retry)</p>
<h2 id="testing-accessibility">Testing Accessibility</h2>
<p>React Testing Library encourages accessible components by making inaccessible components hard to test:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has accessible form labels&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// These queries will fail if labels aren&#39;t properly associated</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has accessible button text&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Button text should be descriptive</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">button</span><span class="p">).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;announces errors to screen readers&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Payment declined&#39;</span><span class="p">));</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="c1">// Error should have role=&quot;alert&quot; for screen reader announcement</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">error</span><span class="p">).</span><span class="nx">toHaveTextContent</span><span class="p">(</span><span class="s1">&#39;Payment declined&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>If these tests fail</strong>, it means your component has accessibility issues. Fix the component, not the test.</p>
<h2 id="common-testing-library-patterns">Common Testing Library Patterns</h2>
<h3 id="testing-conditional-rendering">Testing Conditional Rendering</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;hides error message initially&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Use queryBy when testing absence</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">queryByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">)).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="testing-input-validation">Testing Input Validation</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;keeps submit button disabled with invalid card number&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill form with invalid card number (too short)</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12345&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Button should remain disabled</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeDisabled</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="testing-focus-management">Testing Focus Management</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;focuses first input on mount&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cardNumberInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">cardNumberInput</span><span class="p">).</span><span class="nx">toHaveFocus</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="testing-keyboard-navigation">Testing Keyboard Navigation</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;submits form on Enter key&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Press Enter in last field</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">keyboard</span><span class="p">(</span><span class="s1">&#39;{Enter}&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockOnSubmit</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="when-to-apply-testing-library-decision-framework">When to Apply: Testing Library Decision Framework</h2>
<p><strong>Use React Testing Library when</strong>:
- Testing user-facing behavior
- Verifying accessibility
- Testing component integration
- Building confidence in user experience</p>
<p><strong>Don't use React Testing Library for</strong>:
- Testing pure functions (use plain Vitest)
- Testing implementation details
- Testing third-party libraries
- Performance benchmarking</p>
<p><strong>The rule</strong>: If a user can't do it, don't test it. If a user can do it, test it.</p>
<h2 id="what-to-test-and-what-to-skip">What to test (and what to skip)</h2>
<h2 id="the-failure-testing-everything">The Failure: Testing Everything</h2>
<p>You're excited about testing. You write tests for everything:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå Testing React internals</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;useState returns array with two elements&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">([</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">])).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">([</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">]).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ‚ùå Testing third-party libraries</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;React Router navigates correctly&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">navigate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useNavigate</span><span class="p">();</span>
<span class="w">  </span><span class="nx">navigate</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ‚ùå Testing CSS</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;button has correct background color&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">Button</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">button</span><span class="p">).</span><span class="nx">toHaveStyle</span><span class="p">({</span><span class="w"> </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;blue&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// ‚ùå Testing implementation details</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;component uses useEffect&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">spy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;useEffect&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">Component</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">spy</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run these tests</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/BadTests.test.tsx (4)
   ‚úì useState returns array with two elements
   ‚úì React Router navigates correctly
   ‚úì button has correct background color
   ‚úì component uses useEffect

 Test Files  1 passed (1)
      Tests  4 passed (4)
   Start at  11:45:23
   Duration  234ms
</code></pre></div>

<p><strong>All tests pass. But they're all useless.</strong></p>
<h3 id="diagnostic-analysis-why-these-tests-waste-time">Diagnostic Analysis: Why These Tests Waste Time</h3>
<p><strong>Problem 1: Testing React internals</strong>
- You're testing that React works, not that your code works
- React is already tested by the React team
- These tests add no value</p>
<p><strong>Problem 2: Testing third-party libraries</strong>
- React Router is tested by its maintainers
- Your tests duplicate their work
- If React Router breaks, their tests will catch it</p>
<p><strong>Problem 3: Testing CSS</strong>
- CSS is visual, not logical
- Tests can't verify that something "looks good"
- Visual regression testing tools (Percy, Chromatic) are better for this</p>
<p><strong>Problem 4: Testing implementation details</strong>
- Tests break when you refactor
- Tests don't verify user experience
- Tests become maintenance burden</p>
<p><strong>The cost</strong>: You spend time writing and maintaining tests that provide no value. When you refactor, these tests break even though behavior is unchanged. You lose trust in your test suite.</p>
<h2 id="the-testing-pyramid">The Testing Pyramid</h2>
<p>Not all tests are created equal. The testing pyramid shows the ideal distribution:</p>
<div class="codehilite"><pre><span></span><code>        /\
       /  \
      / E2E \         ‚Üê Few, slow, expensive
     /--------\
    /          \
   / Integration \    ‚Üê Some, moderate speed
  /--------------\
 /                \
/   Unit Tests     \  ‚Üê Many, fast, cheap
--------------------
</code></pre></div>

<p><strong>Unit Tests (70%)</strong>:
- Test individual functions and components in isolation
- Fast to run (milliseconds)
- Easy to write and maintain
- Provide specific failure messages</p>
<p><strong>Integration Tests (20%)</strong>:
- Test how multiple components work together
- Moderate speed (seconds)
- More realistic than unit tests
- Catch integration bugs</p>
<p><strong>E2E Tests (10%)</strong>:
- Test complete user flows in real browser
- Slow to run (minutes)
- Expensive to maintain
- Catch bugs that only appear in production environment</p>
<h2 id="what-to-test-the-decision-framework">What to Test: The Decision Framework</h2>
<h3 id="test-user-facing-behavior">‚úÖ Test User-Facing Behavior</h3>
<p><strong>Test what users can see and do</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ GOOD: User can submit form</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;submits payment when form is valid&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockOnSubmit</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="test-edge-cases-and-error-states">‚úÖ Test Edge Cases and Error States</h3>
<p><strong>Test what happens when things go wrong</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ GOOD: User sees error message on failure</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;displays error when payment fails&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Insufficient funds&#39;</span><span class="p">));</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill and submit form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">)).</span><span class="nx">toHaveTextContent</span><span class="p">(</span><span class="s1">&#39;Insufficient funds&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="test-accessibility">‚úÖ Test Accessibility</h3>
<p><strong>Test that assistive technologies work</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ GOOD: Screen readers can navigate form</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has accessible form labels&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="test-business-logic">‚úÖ Test Business Logic</h3>
<p><strong>Test pure functions that contain logic</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/lib/validation.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Remove spaces and dashes</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cleaned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cardNumber</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\s-]/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Check length</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cleaned</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Check if all digits</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="sr">/^\d+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">cleaned</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Luhn algorithm</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">isEven</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cleaned</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">cleaned</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isEven</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">digit</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">digit</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">9</span><span class="p">)</span><span class="w"> </span><span class="nx">digit</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mf">9</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">digit</span><span class="p">;</span>
<span class="w">    </span><span class="nx">isEven</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="nx">isEven</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/lib/validation.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">validateCardNumber</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./validation&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;validateCardNumber&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;accepts valid card numbers&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;6011514433546201&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects invalid card numbers&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532015112830367&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// Wrong checksum</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;handles card numbers with spaces&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532 0151 1283 0366&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;handles card numbers with dashes&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532-0151-1283-0366&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects non-numeric characters&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532015112830abc&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects wrong length&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;453201511283036&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// 15 digits</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;45320151128303666&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// 17 digits</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Why test this function</strong>:
- Contains complex logic (Luhn algorithm)
- Has multiple edge cases
- Pure function (no side effects)
- Easy to test thoroughly</p>
<h3 id="dont-test-implementation-details">‚ùå Don't Test Implementation Details</h3>
<p><strong>Don't test how the component works internally</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå BAD: Testing state variable names</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has cardNumber state&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">renderHook</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">[</span><span class="mf">0</span><span class="p">]).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ‚ùå BAD: Testing that useEffect was called</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;uses useEffect&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">spy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;useEffect&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">Component</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">spy</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// ‚ùå BAD: Testing component structure</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;renders a div with class name&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">container</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">Component</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.payment-form&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="dont-test-third-party-libraries">‚ùå Don't Test Third-Party Libraries</h3>
<p><strong>Don't test code you didn't write</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå BAD: Testing React Router</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;useNavigate returns function&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">navigate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useNavigate</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">navigate</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ‚ùå BAD: Testing React Query</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;useQuery returns data&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useQuery</span><span class="p">([</span><span class="s1">&#39;key&#39;</span><span class="p">],</span><span class="w"> </span><span class="nx">fetchFn</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="dont-test-trivial-code">‚ùå Don't Test Trivial Code</h3>
<p><strong>Don't test code that can't reasonably break</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå BAD: Testing that props are passed</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;passes amount prop to child&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;$99.99&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// ‚ùå BAD: Testing constant values</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has correct title&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Payment Details&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="dont-test-styles">‚ùå Don't Test Styles</h3>
<p><strong>Don't test CSS unless it affects functionality</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå BAD: Testing CSS classes</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has correct class name&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">container</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">Button</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">).</span><span class="nx">toHaveClass</span><span class="p">(</span><span class="s1">&#39;btn-primary&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ‚ùå BAD: Testing computed styles</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;button is blue&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">Button</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">button</span><span class="p">).</span><span class="nx">toHaveStyle</span><span class="p">({</span><span class="w"> </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;blue&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Exception</strong>: Test styles that affect functionality:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ OK: Testing visibility (affects functionality)</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;hides error message initially&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">queryByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">)).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// ‚úÖ OK: Testing disabled state (affects functionality)</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;disables submit button when form is invalid&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)).</span><span class="nx">toBeDisabled</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="the-8020-rule-of-testing">The 80/20 Rule of Testing</h2>
<p><strong>Focus on the 20% of tests that catch 80% of bugs</strong>:</p>
<h3 id="high-value-tests-write-these">High-Value Tests (Write These)</h3>
<ol>
<li><strong>Happy path</strong>: User completes primary task successfully</li>
<li><strong>Error states</strong>: User sees helpful error messages</li>
<li><strong>Edge cases</strong>: Boundary conditions and unusual inputs</li>
<li><strong>Accessibility</strong>: Screen readers and keyboard navigation work</li>
<li><strong>Business logic</strong>: Complex calculations and validations</li>
</ol>
<h3 id="low-value-tests-skip-these">Low-Value Tests (Skip These)</h3>
<ol>
<li><strong>Framework behavior</strong>: Testing that React/libraries work</li>
<li><strong>Trivial code</strong>: Simple prop passing and constant values</li>
<li><strong>Implementation details</strong>: Internal state and lifecycle methods</li>
<li><strong>Styles</strong>: CSS classes and computed styles</li>
<li><strong>Third-party code</strong>: Libraries you didn't write</li>
</ol>
<h2 id="coverage-targets-the-pragmatic-approach">Coverage Targets: The Pragmatic Approach</h2>
<p><strong>Don't aim for 100% coverage</strong>. Aim for high coverage of high-value code.</p>
<p><strong>Realistic targets</strong>:
- <strong>Business logic</strong>: 90-100% coverage
- <strong>UI components</strong>: 60-80% coverage
- <strong>Integration points</strong>: 70-90% coverage
- <strong>Overall project</strong>: 70-80% coverage</p>
<p><strong>Why not 100%?</strong>
- Diminishing returns after 80%
- Last 20% is often trivial code
- Time better spent on other quality measures</p>
<p><strong>Check coverage</strong>:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--<span class="w"> </span>--coverage
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c"> % Coverage report from v8</span>
<span class="nb">--------------------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">----------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">-------------------</span>
<span class="c">File                | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s</span>
<span class="nb">--------------------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">----------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">-------------------</span>
<span class="c">All files           |   78</span><span class="nt">.</span><span class="c">26 |    75</span><span class="nt">.</span><span class="c">00 |   80</span><span class="nt">.</span><span class="c">00 |   78</span><span class="nt">.</span><span class="c">26 |</span>
<span class="c"> PaymentForm</span><span class="nt">.</span><span class="c">tsx    |   85</span><span class="nt">.</span><span class="c">71 |    83</span><span class="nt">.</span><span class="c">33 |   100</span><span class="nt">.</span><span class="c">00|   85</span><span class="nt">.</span><span class="c">71 | 45</span><span class="nb">-</span><span class="c">48</span>
<span class="c"> validation</span><span class="nt">.</span><span class="c">ts      |   95</span><span class="nt">.</span><span class="c">00 |    90</span><span class="nt">.</span><span class="c">00 |   100</span><span class="nt">.</span><span class="c">00|   95</span><span class="nt">.</span><span class="c">00 | 67</span>
<span class="nb">--------------------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">----------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">-------------------</span>
</code></pre></div>

<p><strong>What to do with this</strong>:
- ‚úÖ 85% coverage on PaymentForm is good
- ‚úÖ 95% coverage on validation is excellent
- ‚ö†Ô∏è Lines 45-48 uncovered - check if they're important
- ‚ùå Don't write tests just to hit 100%</p>
<h2 id="when-to-apply-testing-decision-tree">When to Apply: Testing Decision Tree</h2>
<p><strong>Before writing a test, ask</strong>:</p>
<ol>
<li><strong>Can a user do this?</strong></li>
<li>Yes ‚Üí Write the test</li>
<li>
<p>No ‚Üí Don't test it</p>
</li>
<li>
<p><strong>Does this contain business logic?</strong></p>
</li>
<li>Yes ‚Üí Write the test</li>
<li>
<p>No ‚Üí Consider skipping</p>
</li>
<li>
<p><strong>Is this code I wrote?</strong></p>
</li>
<li>Yes ‚Üí Consider testing</li>
<li>
<p>No ‚Üí Don't test it</p>
</li>
<li>
<p><strong>Will this test catch real bugs?</strong></p>
</li>
<li>Yes ‚Üí Write the test</li>
<li>
<p>No ‚Üí Skip it</p>
</li>
<li>
<p><strong>Will this test break when I refactor?</strong></p>
</li>
<li>Yes ‚Üí Reconsider the test</li>
<li>No ‚Üí Write the test</li>
</ol>
<p><strong>The golden rule</strong>: Test behavior, not implementation. Test outcomes, not mechanisms.</p>
<h2 id="integration-tests-that-matter">Integration tests that matter</h2>
<h2 id="the-failure-unit-tests-miss-integration-bugs">The Failure: Unit Tests Miss Integration Bugs</h2>
<p>You have excellent unit test coverage. Every component works perfectly in isolation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ All unit tests pass</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentForm&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;submits payment data&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">    </span><span class="c1">// ... test passes</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentConfirmation&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;displays confirmation message&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentConfirmation</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>
<span class="w">    </span><span class="c1">// ... test passes</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/components/PaymentForm.test.tsx (5)
 ‚úì src/components/PaymentConfirmation.test.tsx (3)

 Test Files  2 passed (2)
      Tests  8 passed (8)
</code></pre></div>

<p><strong>All tests pass. You ship to production.</strong></p>
<p><strong>Production failure</strong>:</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Uncaught TypeError: Cannot read properties of undefined (reading &#39;transactionId&#39;)
    at PaymentConfirmation.tsx:12
    at PaymentPage.tsx:45
</code></pre></div>

<p><strong>What happened</strong>: <code>PaymentForm</code> calls <code>onSubmit</code> with payment data, but <code>PaymentPage</code> expects the response to include a <code>transactionId</code>. The unit tests mocked both sides independently, so they never caught the mismatch.</p>
<h3 id="diagnostic-analysis-the-integration-gap">Diagnostic Analysis: The Integration Gap</h3>
<p><strong>Unit tests verified</strong>:
- ‚úÖ PaymentForm calls onSubmit with correct data
- ‚úÖ PaymentConfirmation displays confirmation message</p>
<p><strong>Unit tests didn't verify</strong>:
- ‚ùå PaymentForm and PaymentPage communicate correctly
- ‚ùå PaymentPage and PaymentConfirmation pass correct props
- ‚ùå The complete payment flow works end-to-end</p>
<p><strong>The problem</strong>: Components work in isolation but fail when integrated. Unit tests can't catch this because they mock all dependencies.</p>
<p><strong>The solution</strong>: Integration tests that render multiple components together.</p>
<h2 id="integration-tests-testing-component-collaboration">Integration Tests: Testing Component Collaboration</h2>
<p>Integration tests render multiple components together to verify they work as a system:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/PaymentPage.test.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">render</span><span class="p">,</span><span class="w"> </span><span class="nx">screen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">userEvent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/user-event&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentPage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./PaymentPage&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentPage - Integration&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;completes full payment flow&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Mock the API call</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockProcessPayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">      </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">transactionId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;txn_123456&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentPage</span><span class="w"> </span><span class="na">processPayment</span><span class="o">=</span><span class="p">{</span><span class="nx">mockProcessPayment</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">    </span><span class="c1">// User fills out payment form</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// User submits payment</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">    </span><span class="c1">// Verify API was called with correct data</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockProcessPayment</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">({</span>
<span class="w">      </span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">expiryDate</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">cvv</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">cardholderName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Verify confirmation screen appears</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/transaction id: txn_123456/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/amount: \$99\.99/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>What this test verifies</strong>:
1. PaymentForm renders and accepts input
2. PaymentForm calls the API with correct data
3. PaymentPage handles the API response
4. PaymentConfirmation receives and displays correct data
5. The complete flow works end-to-end</p>
<p><strong>Run the test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/pages/PaymentPage.test.tsx (1)
   ‚úì PaymentPage - Integration (1)
     ‚úì completes full payment flow

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  14:23:45
   Duration  567ms
</code></pre></div>

<h2 id="reference-implementation-complete-payment-page">Reference Implementation: Complete Payment Page</h2>
<p>Let's build the complete payment page that our integration test verifies:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/PaymentPage.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentForm</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../components/PaymentForm&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentConfirmation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../components/PaymentConfirmation&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">PaymentPageProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">processPayment</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">PaymentData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">PaymentResponse</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">PaymentData</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">expiryDate</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">cvv</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">cardholderName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">PaymentResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">transactionId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">PaymentPage</span><span class="p">({</span><span class="w"> </span><span class="nx">processPayment</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">PaymentPageProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">paymentResult</span><span class="p">,</span><span class="w"> </span><span class="nx">setPaymentResult</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">PaymentResponse</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handlePayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">PaymentData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">processPayment</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setPaymentResult</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">paymentResult</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">PaymentConfirmation</span>
<span class="w">        </span><span class="na">transactionId</span><span class="o">=</span><span class="p">{</span><span class="nx">paymentResult</span><span class="p">.</span><span class="nx">transactionId</span><span class="p">}</span>
<span class="w">        </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="nx">paymentResult</span><span class="p">.</span><span class="nx">amount</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handlePayment</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/PaymentConfirmation.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">PaymentConfirmationProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">transactionId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">PaymentConfirmation</span><span class="p">({</span><span class="w"> </span><span class="nx">transactionId</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">PaymentConfirmationProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;confirmation&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Payment</span><span class="w"> </span><span class="nx">Successful</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Your</span><span class="w"> </span><span class="nx">payment</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">processed</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span><span class="nx">Transaction</span><span class="w"> </span><span class="nx">ID</span><span class="o">:</span><span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;{</span><span class="nx">transactionId</span><span class="p">}&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span><span class="nx">Amount</span><span class="o">:</span><span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">amount</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)}&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="iteration-1-testing-error-flow-integration">Iteration 1: Testing Error Flow Integration</h2>
<p>Let's test what happens when payment fails:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;handles payment failure&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockProcessPayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockRejectedValue</span><span class="p">(</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Payment declined: Insufficient funds&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentPage</span><span class="w"> </span><span class="na">processPayment</span><span class="o">=</span><span class="p">{</span><span class="nx">mockProcessPayment</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill and submit form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="c1">// Verify error message appears</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">).</span><span class="nx">toHaveTextContent</span><span class="p">(</span><span class="s1">&#39;Payment declined: Insufficient funds&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Verify we&#39;re still on payment form (not confirmation)</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">queryByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run the test</strong>:</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code> ‚úì src/pages/PaymentPage.test.tsx (2)
   ‚úì PaymentPage - Integration (2)
     ‚úì completes full payment flow
     ‚úì handles payment failure

 Test Files  1 passed (1)
      Tests  2 passed (2)
   Start at  14:35:12
   Duration  623ms
</code></pre></div>

<h2 id="iteration-2-testing-loading-states-across-components">Iteration 2: Testing Loading States Across Components</h2>
<p>Let's verify that loading states propagate correctly:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;shows loading state during payment processing&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Create a promise we can control</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">resolvePayment</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">PaymentResponse</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">paymentPromise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">PaymentResponse</span><span class="p">&gt;((</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resolvePayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">resolve</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockProcessPayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockReturnValue</span><span class="p">(</span><span class="nx">paymentPromise</span><span class="p">);</span>

<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentPage</span><span class="w"> </span><span class="na">processPayment</span><span class="o">=</span><span class="p">{</span><span class="nx">mockProcessPayment</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Fill and submit form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">  </span><span class="c1">// Verify loading state</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/processing/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/processing/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeDisabled</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Resolve the payment</span>
<span class="w">  </span><span class="nx">resolvePayment</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">transactionId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;txn_123456&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="p">,</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// Verify confirmation appears</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>What this test verifies</strong>:
1. Loading state appears immediately after submission
2. Submit button is disabled during processing
3. Confirmation appears after processing completes
4. The entire state transition works correctly</p>
<h2 id="testing-with-react-router">Testing with React Router</h2>
<p>When components use routing, integration tests need to provide router context:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/CheckoutFlow.test.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">render</span><span class="p">,</span><span class="w"> </span><span class="nx">screen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">MemoryRouter</span><span class="p">,</span><span class="w"> </span><span class="nx">Routes</span><span class="p">,</span><span class="w"> </span><span class="nx">Route</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">userEvent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/user-event&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">CheckoutFlow</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./CheckoutFlow&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;CheckoutFlow - Integration&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;navigates through checkout steps&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">MemoryRouter</span><span class="w"> </span><span class="na">initialEntries</span><span class="o">=</span><span class="p">{[</span><span class="s1">&#39;/checkout&#39;</span><span class="p">]}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Routes</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/checkout&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">CheckoutFlow</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/checkout/payment&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">PaymentPage</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">Route</span><span class="w"> </span><span class="na">path</span><span class="o">=</span><span class="s">&quot;/checkout/confirmation&quot;</span><span class="w"> </span><span class="na">element</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">ConfirmationPage</span><span class="w"> </span><span class="p">/&gt;}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">Routes</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">MemoryRouter</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Start at shipping address step</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/shipping address/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Fill shipping form</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Street Address&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123 Main St&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;San Francisco&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;ZIP Code&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;94102&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/continue to payment/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">    </span><span class="c1">// Verify navigation to payment step</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/payment details/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Fill payment form</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/complete purchase/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">    </span><span class="c1">// Verify navigation to confirmation</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/order confirmed/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Key points</strong>:
- Use <code>MemoryRouter</code> for testing (doesn't require browser)
- Set <code>initialEntries</code> to control starting route
- Render complete route structure
- Test navigation between routes</p>
<h2 id="testing-with-context-providers">Testing with Context Providers</h2>
<p>When components use context, integration tests need to provide that context:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/contexts/CartContext.test.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">render</span><span class="p">,</span><span class="w"> </span><span class="nx">screen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">userEvent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/user-event&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">CartProvider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./CartContext&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ProductList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../components/ProductList&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Cart</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../components/Cart&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Cart Integration&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;adds products to cart and displays total&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">CartProvider</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ProductList</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">Cart</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">CartProvider</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Initially cart is empty</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/cart is empty/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Add first product</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">addButtons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">getAllByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/add to cart/i</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">addButtons</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>

<span class="w">    </span><span class="c1">// Verify product appears in cart</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/product 1/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/\$29\.99/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Add second product</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">addButtons</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>

<span class="w">    </span><span class="c1">// Verify total is calculated correctly</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/total: \$59\.98/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>What this test verifies</strong>:
1. Multiple components share cart state via context
2. Adding products updates cart display
3. Cart total is calculated correctly
4. Context provider works as expected</p>
<h2 id="testing-with-api-mocking">Testing with API Mocking</h2>
<p>For integration tests that make API calls, use MSW (Mock Service Worker):</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>msw
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/__tests__/mocks/handlers.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">http</span><span class="p">,</span><span class="w"> </span><span class="nx">HttpResponse</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;msw&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">handlers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/payment&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Simulate payment processing</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">HttpResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
<span class="w">      </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">transactionId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;txn_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">9</span><span class="p">),</span>
<span class="w">      </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}),</span>

<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">HttpResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">([</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Product 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">29.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Product 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">39.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]);</span>
<span class="w">  </span><span class="p">}),</span>
<span class="p">];</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/__tests__/setup.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">afterEach</span><span class="p">,</span><span class="w"> </span><span class="nx">beforeAll</span><span class="p">,</span><span class="w"> </span><span class="nx">afterAll</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cleanup</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">matchers</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/jest-dom/matchers&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">setupServer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;msw/node&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">handlers</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./mocks/handlers&#39;</span><span class="p">;</span>

<span class="nx">expect</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">matchers</span><span class="p">);</span>

<span class="c1">// Setup MSW server</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setupServer</span><span class="p">(...</span><span class="nx">handlers</span><span class="p">);</span>

<span class="nx">beforeAll</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">({</span><span class="w"> </span><span class="nx">onUnhandledRequest</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="p">}));</span>
<span class="nx">afterAll</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">());</span>
<span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">cleanup</span><span class="p">();</span>
<span class="w">  </span><span class="nx">server</span><span class="p">.</span><span class="nx">resetHandlers</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p>Now integration tests can make real API calls that are intercepted by MSW:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;fetches and displays products&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">ProductList</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">  </span><span class="c1">// Wait for products to load</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;Product 1&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Product 2&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;$29.99&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;$39.99&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Benefits of MSW</strong>:
- Tests use real fetch/axios calls (no mocking)
- Responses are realistic (proper HTTP structure)
- Can simulate network errors and delays
- Works in both tests and browser (for development)</p>
<h2 id="when-to-write-integration-tests">When to Write Integration Tests</h2>
<p><strong>Write integration tests for</strong>:
- ‚úÖ Multi-step user flows (checkout, registration)
- ‚úÖ Components that communicate via context
- ‚úÖ Components that share state
- ‚úÖ Navigation between routes
- ‚úÖ API integration points</p>
<p><strong>Don't write integration tests for</strong>:
- ‚ùå Simple components with no dependencies
- ‚ùå Pure functions (use unit tests)
- ‚ùå Third-party library behavior
- ‚ùå Every possible component combination</p>
<p><strong>The rule</strong>: Write integration tests for critical user journeys. If a flow breaking would be a serious bug, write an integration test.</p>
<h2 id="integration-vs-unit-tests-when-to-use-each">Integration vs. Unit Tests: When to Use Each</h2>
<p><strong>Unit Tests</strong>:
- Fast (milliseconds)
- Test one component in isolation
- Mock all dependencies
- Specific failure messages
- Easy to write and maintain</p>
<p><strong>Integration Tests</strong>:
- Slower (seconds)
- Test multiple components together
- Minimal mocking
- Catch integration bugs
- More realistic</p>
<p><strong>The balance</strong>: 70% unit tests, 20% integration tests, 10% E2E tests.</p>
<p><strong>Example distribution for a payment feature</strong>:
- <strong>Unit tests (7)</strong>: PaymentForm validation, formatCardNumber, validateCVV, etc.
- <strong>Integration tests (2)</strong>: Complete payment flow, error handling flow
- <strong>E2E test (1)</strong>: Full checkout in real browser</p>
<p>This gives you confidence without excessive test maintenance.</p>
<h2 id="playwright-for-e2e-when-necessary">Playwright for E2E (when necessary)</h2>
<h2 id="the-failure-integration-tests-miss-browser-specific-bugs">The Failure: Integration Tests Miss Browser-Specific Bugs</h2>
<p>Your integration tests pass. Your unit tests pass. You deploy to production.</p>
<p><strong>Production bug report</strong>:</p>
<blockquote>
<p>"Payment form doesn't work in Safari. Submit button does nothing."</p>
</blockquote>
<p>You investigate. The form works in Chrome. Works in Firefox. Fails in Safari.</p>
<h3 id="diagnostic-analysis-the-browser-compatibility-gap">Diagnostic Analysis: The Browser Compatibility Gap</h3>
<p><strong>What integration tests verified</strong>:
- ‚úÖ Form validation logic works
- ‚úÖ API calls are made correctly
- ‚úÖ State updates propagate
- ‚úÖ Components render expected output</p>
<p><strong>What integration tests didn't verify</strong>:
- ‚ùå Form works in actual Safari browser
- ‚ùå CSS doesn't break layout in Safari
- ‚ùå JavaScript features are supported in Safari
- ‚ùå Form submission works with real browser events</p>
<p><strong>The problem</strong>: Integration tests run in jsdom, a simulated browser environment. jsdom doesn't perfectly replicate real browser behavior, especially browser-specific quirks.</p>
<p><strong>The solution</strong>: End-to-end (E2E) tests that run in real browsers.</p>
<h2 id="when-you-actually-need-e2e-tests">When You Actually Need E2E Tests</h2>
<p><strong>E2E tests are expensive</strong>:
- Slow to run (minutes vs. milliseconds)
- Flaky (network issues, timing problems)
- Expensive to maintain (break on UI changes)
- Require infrastructure (browsers, servers)</p>
<p><strong>Write E2E tests only for</strong>:
- ‚úÖ Critical user flows (checkout, payment, registration)
- ‚úÖ Browser-specific features (file uploads, camera access)
- ‚úÖ Third-party integrations (OAuth, payment processors)
- ‚úÖ Features that have failed in production before</p>
<p><strong>Don't write E2E tests for</strong>:
- ‚ùå Every feature (too slow, too expensive)
- ‚ùå Edge cases (use integration tests)
- ‚ùå Unit-level logic (use unit tests)
- ‚ùå Styling and layout (use visual regression tools)</p>
<p><strong>The rule</strong>: If integration tests give you 95% confidence, E2E tests give you the final 5%. Use them sparingly.</p>
<h2 id="playwright-modern-e2e-testing">Playwright: Modern E2E Testing</h2>
<p>Playwright is a modern E2E testing framework that runs tests in real browsers (Chrome, Firefox, Safari, Edge).</p>
<h3 id="installation_1">Installation</h3>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>@playwright/test
npx<span class="w"> </span>playwright<span class="w"> </span>install
</code></pre></div>

<p>This installs Playwright and downloads browser binaries.</p>
<h3 id="configuration_1">Configuration</h3>
<p>Create <code>playwright.config.ts</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// playwright.config.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">defineConfig</span><span class="p">,</span><span class="w"> </span><span class="nx">devices</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@playwright/test&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">defineConfig</span><span class="p">({</span>
<span class="w">  </span><span class="nx">testDir</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;./e2e&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fullyParallel</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">forbidOnly</span><span class="o">:</span><span class="w"> </span><span class="o">!!</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CI</span><span class="p">,</span>
<span class="w">  </span><span class="nx">retries</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.CI</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<span class="w">  </span><span class="nx">workers</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.CI</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">undefined</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reporter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;html&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">use</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">baseURL</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http://localhost:5173&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">trace</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;on-first-retry&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">screenshot</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;only-on-failure&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">projects</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;chromium&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">use</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">devices</span><span class="p">[</span><span class="s1">&#39;Desktop Chrome&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;firefox&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">use</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">devices</span><span class="p">[</span><span class="s1">&#39;Desktop Firefox&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;webkit&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">use</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">devices</span><span class="p">[</span><span class="s1">&#39;Desktop Safari&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nx">webServer</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;npm run dev&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http://localhost:5173&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">reuseExistingServer</span><span class="o">:</span><span class="w"> </span><span class="o">!</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CI</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Configuration explained</strong>:
- <code>testDir</code> - Where E2E tests live
- <code>projects</code> - Run tests in multiple browsers
- <code>webServer</code> - Automatically start dev server
- <code>trace</code> - Record test execution for debugging
- <code>screenshot</code> - Capture screenshots on failure</p>
<h3 id="project-structure">Project Structure</h3>
<div class="codehilite"><pre><span></span><code>e2e/
‚îú‚îÄ‚îÄ<span class="w"> </span>payment.spec.ts<span class="w">          </span>‚Üê<span class="w"> </span>E2E<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>payment<span class="w"> </span>flow
‚îú‚îÄ‚îÄ<span class="w"> </span>checkout.spec.ts<span class="w">         </span>‚Üê<span class="w"> </span>E2E<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>checkout<span class="w"> </span>flow
‚îî‚îÄ‚îÄ<span class="w"> </span>fixtures/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test-data.ts<span class="w">         </span>‚Üê<span class="w"> </span>Shared<span class="w"> </span><span class="nb">test</span><span class="w"> </span>data
</code></pre></div>

<h2 id="your-first-e2e-test-payment-flow">Your First E2E Test: Payment Flow</h2>
<p>Let's write an E2E test for the complete payment flow:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// e2e/payment.spec.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">test</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@playwright/test&#39;</span><span class="p">;</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Payment Flow&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;completes payment successfully&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Navigate to payment page</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Fill out payment form</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Submit payment</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Wait for confirmation page</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/transaction id:/i</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Verify URL changed</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">toHaveURL</span><span class="p">(</span><span class="sr">/\/checkout\/confirmation/</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Run the test</strong>:</p>
<div class="codehilite"><pre><span></span><code>npx<span class="w"> </span>playwright<span class="w"> </span><span class="nb">test</span>
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Running</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">workers</span>

<span class="w">  </span><span class="err">‚úì</span><span class="w">  </span><span class="o">[</span><span class="n">chromium</span><span class="o">]</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">payment</span><span class="p">.</span><span class="n">spec</span><span class="p">.</span><span class="nl">ts</span><span class="p">:</span><span class="mi">3</span><span class="err">:</span><span class="mi">3</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">Payment</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">completes</span><span class="w"> </span><span class="n">payment</span><span class="w"> </span><span class="n">successfully</span><span class="w"> </span><span class="p">(</span><span class="mf">2.3</span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚úì</span><span class="w">  </span><span class="o">[</span><span class="n">firefox</span><span class="o">]</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">payment</span><span class="p">.</span><span class="n">spec</span><span class="p">.</span><span class="nl">ts</span><span class="p">:</span><span class="mi">3</span><span class="err">:</span><span class="mi">3</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">Payment</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">completes</span><span class="w"> </span><span class="n">payment</span><span class="w"> </span><span class="n">successfully</span><span class="w"> </span><span class="p">(</span><span class="mf">2.1</span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚úì</span><span class="w">  </span><span class="o">[</span><span class="n">webkit</span><span class="o">]</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">payment</span><span class="p">.</span><span class="n">spec</span><span class="p">.</span><span class="nl">ts</span><span class="p">:</span><span class="mi">3</span><span class="err">:</span><span class="mi">3</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">Payment</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">completes</span><span class="w"> </span><span class="n">payment</span><span class="w"> </span><span class="n">successfully</span><span class="w"> </span><span class="p">(</span><span class="mf">2.5</span><span class="n">s</span><span class="p">)</span>

<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="p">(</span><span class="mf">7.2</span><span class="n">s</span><span class="p">)</span>
</code></pre></div>

<p><strong>What happened</strong>:
1. Playwright started your dev server
2. Opened Chrome, Firefox, and Safari
3. Ran the test in all three browsers
4. Verified the payment flow works in each</p>
<h2 id="playwright-vs-react-testing-library">Playwright vs. React Testing Library</h2>
<p><strong>Key differences</strong>:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>React Testing Library</th>
<th>Playwright</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Environment</strong></td>
<td>jsdom (simulated)</td>
<td>Real browsers</td>
</tr>
<tr>
<td><strong>Speed</strong></td>
<td>Fast (milliseconds)</td>
<td>Slow (seconds)</td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Component-level</td>
<td>Full application</td>
</tr>
<tr>
<td><strong>Network</strong></td>
<td>Mocked</td>
<td>Real or mocked</td>
</tr>
<tr>
<td><strong>Browser APIs</strong></td>
<td>Limited</td>
<td>Full support</td>
</tr>
<tr>
<td><strong>Flakiness</strong></td>
<td>Rare</td>
<td>More common</td>
</tr>
<tr>
<td><strong>Cost</strong></td>
<td>Low</td>
<td>High</td>
</tr>
</tbody>
</table>
<p><strong>Use React Testing Library for</strong>: Component behavior, user interactions, state management</p>
<p><strong>Use Playwright for</strong>: Critical flows, browser compatibility, third-party integrations</p>
<h2 id="iteration-1-testing-error-scenarios">Iteration 1: Testing Error Scenarios</h2>
<p>Let's test what happens when payment fails:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;displays error when payment fails&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Mock API to return error</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;**/api/payment&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">route</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">route</span><span class="p">.</span><span class="nx">fulfill</span><span class="p">({</span>
<span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">400</span><span class="p">,</span>
<span class="w">      </span><span class="nx">contentType</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Payment declined: Insufficient funds&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">}),</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Fill and submit form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Verify error message appears</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">)).</span><span class="nx">toContainText</span><span class="p">(</span><span class="s1">&#39;Insufficient funds&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Verify we&#39;re still on payment page</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">toHaveURL</span><span class="p">(</span><span class="sr">/\/checkout\/payment/</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Verify form is still editable</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeEditable</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>What this test verifies</strong>:
1. Error message displays in real browser
2. User stays on payment page
3. Form remains editable for retry
4. Error handling works across browsers</p>
<h2 id="iteration-2-testing-browser-specific-features">Iteration 2: Testing Browser-Specific Features</h2>
<p>Let's test file upload (a feature that requires real browser):</p>
<div class="codehilite"><pre><span></span><code><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;uploads receipt image&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Fill payment form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Upload receipt</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Upload Receipt (optional)&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">fileInput</span><span class="p">.</span><span class="nx">setInputFiles</span><span class="p">(</span><span class="s1">&#39;./e2e/fixtures/receipt.jpg&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Verify preview appears</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByAltText</span><span class="p">(</span><span class="s1">&#39;Receipt preview&#39;</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Submit payment</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Verify receipt was uploaded</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/receipt uploaded/i</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Why this needs E2E</strong>:
- File upload requires real browser file system
- Image preview requires real image rendering
- jsdom can't simulate this accurately</p>
<h2 id="iteration-3-testing-third-party-integrations">Iteration 3: Testing Third-Party Integrations</h2>
<p>Let's test Stripe payment integration:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;processes payment through Stripe&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Fill payment form</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;4242424242424242&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Stripe test card</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;Test User&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Submit payment</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Wait for Stripe iframe to load</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">stripeFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">frameLocator</span><span class="p">(</span><span class="s1">&#39;iframe[name^=&quot;__privateStripeFrame&quot;]&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Verify Stripe processed payment</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">({</span><span class="w"> </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="kt">10000</span><span class="w"> </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// Verify transaction ID from Stripe</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/pi_/</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span><span class="w"> </span><span class="c1">// Stripe payment intent ID</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Why this needs E2E</strong>:
- Stripe loads in iframe (can't test in jsdom)
- Real network calls to Stripe API
- Verifies actual integration works</p>
<h2 id="debugging-failed-e2e-tests">Debugging Failed E2E Tests</h2>
<p>When E2E tests fail, Playwright provides powerful debugging tools:</p>
<h3 id="1-screenshots-on-failure">1. Screenshots on Failure</h3>
<p>Playwright automatically captures screenshots when tests fail:</p>
<div class="codehilite"><pre><span></span><code>npx<span class="w"> </span>playwright<span class="w"> </span><span class="nb">test</span>
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="err">‚úó</span><span class="w">  </span><span class="o">[</span><span class="n">chromium</span><span class="o">]</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">payment</span><span class="p">.</span><span class="n">spec</span><span class="p">.</span><span class="nl">ts</span><span class="p">:</span><span class="mi">3</span><span class="err">:</span><span class="mi">3</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">Payment</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="err">‚Ä∫</span><span class="w"> </span><span class="n">completes</span><span class="w"> </span><span class="n">payment</span><span class="w"> </span><span class="n">successfully</span><span class="w"> </span><span class="p">(</span><span class="mf">2.3</span><span class="n">s</span><span class="p">)</span>

<span class="w">  </span><span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">expect</span><span class="p">(</span><span class="k">locator</span><span class="p">).</span><span class="n">toBeVisible</span><span class="p">()</span>

<span class="w">  </span><span class="k">Call</span><span class="w"> </span><span class="nf">log</span><span class="err">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">expect</span><span class="p">.</span><span class="n">toBeVisible</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="mi">5000</span><span class="n">ms</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">getByText</span><span class="p">(</span><span class="o">/</span><span class="n">payment</span><span class="w"> </span><span class="n">successful</span><span class="o">/</span><span class="n">i</span><span class="p">)</span>

<span class="w">  </span><span class="nl">Screenshot</span><span class="p">:</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">results</span><span class="o">/</span><span class="n">payment</span><span class="o">-</span><span class="n">Payment</span><span class="o">-</span><span class="n">Flow</span><span class="o">-</span><span class="n">completes</span><span class="o">-</span><span class="n">payment</span><span class="o">-</span><span class="n">successfully</span><span class="o">-</span><span class="n">chromium</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">failed</span><span class="o">-</span><span class="mf">1.</span><span class="n">png</span>
</code></pre></div>

<p>The screenshot shows exactly what the browser looked like when the test failed.</p>
<h3 id="2-trace-viewer">2. Trace Viewer</h3>
<p>Playwright records a trace of test execution:</p>
<div class="codehilite"><pre><span></span><code>npx<span class="w"> </span>playwright<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--trace<span class="w"> </span>on
npx<span class="w"> </span>playwright<span class="w"> </span>show-report
</code></pre></div>

<p>This opens a UI showing:
- Every action taken
- Screenshots at each step
- Network requests
- Console logs
- DOM snapshots</p>
<h3 id="3-debug-mode">3. Debug Mode</h3>
<p>Run tests in debug mode to step through them:</p>
<div class="codehilite"><pre><span></span><code>npx<span class="w"> </span>playwright<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--debug
</code></pre></div>

<p>This opens Playwright Inspector where you can:
- Step through test line by line
- Inspect page state at each step
- Try selectors in real-time
- See what the test sees</p>
<h3 id="4-headed-mode">4. Headed Mode</h3>
<p>Run tests with visible browser:</p>
<div class="codehilite"><pre><span></span><code>npx<span class="w"> </span>playwright<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--headed
</code></pre></div>

<p>Watch the test run in a real browser window. Useful for understanding what's happening.</p>
<h2 id="common-e2e-test-patterns">Common E2E Test Patterns</h2>
<h3 id="waiting-for-navigation">Waiting for Navigation</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Wait for URL to change</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForURL</span><span class="p">(</span><span class="s1">&#39;**/confirmation&#39;</span><span class="p">);</span>

<span class="c1">// Wait for navigation to complete</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForLoadState</span><span class="p">(</span><span class="s1">&#39;networkidle&#39;</span><span class="p">);</span>
</code></pre></div>

<h3 id="handling-dialogs">Handling Dialogs</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Accept confirmation dialog</span>
<span class="nx">page</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;dialog&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">dialog</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dialog</span><span class="p">.</span><span class="nx">accept</span><span class="p">());</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/delete/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>
</code></pre></div>

<h3 id="testing-responsive-design">Testing Responsive Design</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;works on mobile&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">setViewportSize</span><span class="p">({</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">375</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">667</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Test mobile-specific behavior</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/menu/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="testing-keyboard-navigation_1">Testing Keyboard Navigation</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;supports keyboard navigation&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Tab through form fields</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">press</span><span class="p">(</span><span class="s1">&#39;Tab&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeFocused</span><span class="p">();</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">press</span><span class="p">(</span><span class="s1">&#39;Tab&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">)).</span><span class="nx">toBeFocused</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="testing-accessibility_1">Testing Accessibility</h3>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">test</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@playwright/test&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">AxeBuilder</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@axe-core/playwright&#39;</span><span class="p">;</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;has no accessibility violations&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">accessibilityScanResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AxeBuilder</span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">}).</span><span class="nx">analyze</span><span class="p">();</span>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">accessibilityScanResults</span><span class="p">.</span><span class="nx">violations</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([]);</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="e2e-test-maintenance-keeping-tests-stable">E2E Test Maintenance: Keeping Tests Stable</h2>
<p>E2E tests are notoriously flaky. Here's how to keep them stable:</p>
<h3 id="1-use-stable-selectors">1. Use Stable Selectors</h3>
<p><strong>Bad</strong> (brittle):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå Breaks when CSS changes</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">locator</span><span class="p">(</span><span class="s1">&#39;.btn-primary&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>

<span class="c1">// ‚ùå Breaks when text changes</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">locator</span><span class="p">(</span><span class="s1">&#39;text=Submit Payment&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>
</code></pre></div>

<p><strong>Good</strong> (stable):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ Uses semantic role</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>

<span class="c1">// ‚úÖ Uses label association</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;4242424242424242&#39;</span><span class="p">);</span>

<span class="c1">// ‚úÖ Uses test ID as last resort</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByTestId</span><span class="p">(</span><span class="s1">&#39;payment-submit&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>
</code></pre></div>

<h3 id="2-wait-for-conditions-not-timeouts">2. Wait for Conditions, Not Timeouts</h3>
<p><strong>Bad</strong> (flaky):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå Arbitrary timeout</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForTimeout</span><span class="p">(</span><span class="mf">2000</span><span class="p">);</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Success&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>
</code></pre></div>

<p><strong>Good</strong> (reliable):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ Wait for specific condition</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Success&#39;</span><span class="p">).</span><span class="nx">waitFor</span><span class="p">({</span><span class="w"> </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;visible&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Success&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>

<span class="c1">// ‚úÖ Or use expect with auto-waiting</span>
<span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Success&#39;</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
</code></pre></div>

<h3 id="3-isolate-tests">3. Isolate Tests</h3>
<p><strong>Bad</strong> (tests depend on each other):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå Test 2 depends on Test 1</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;creates account&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Creates user</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;logs in&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Assumes user exists from previous test</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Good</strong> (tests are independent):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úÖ Each test sets up its own data</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;logs in&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Create user via API</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">createTestUser</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Now test login</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="4-use-page-object-model">4. Use Page Object Model</h3>
<p>Encapsulate page interactions in reusable classes:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// e2e/pages/PaymentPage.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">PaymentPage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="kt">Page</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="kr">goto</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">fillCardNumber</span><span class="p">(</span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="nx">cardNumber</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">fillExpiryDate</span><span class="p">(</span><span class="nx">expiryDate</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="nx">expiryDate</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">fillCVV</span><span class="p">(</span><span class="nx">cvv</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="nx">cvv</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">fillCardholderName</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">expectSuccess</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// e2e/payment.spec.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentPage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./pages/PaymentPage&#39;</span><span class="p">;</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;completes payment&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">paymentPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PaymentPage</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">paymentPage</span><span class="p">.</span><span class="kr">goto</span><span class="p">();</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">paymentPage</span><span class="p">.</span><span class="nx">fillCardNumber</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">paymentPage</span><span class="p">.</span><span class="nx">fillExpiryDate</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">paymentPage</span><span class="p">.</span><span class="nx">fillCVV</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">paymentPage</span><span class="p">.</span><span class="nx">fillCardholderName</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">paymentPage</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">paymentPage</span><span class="p">.</span><span class="nx">expectSuccess</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Benefits</strong>:
- Tests are more readable
- Page changes only require updating one place
- Reusable across multiple tests</p>
<h2 id="when-to-apply-e2e-testing-decision-framework">When to Apply: E2E Testing Decision Framework</h2>
<p><strong>Write E2E tests for</strong>:
- ‚úÖ Critical user flows (checkout, payment, registration)
- ‚úÖ Features that have failed in production
- ‚úÖ Browser-specific functionality (file upload, camera)
- ‚úÖ Third-party integrations (OAuth, Stripe)
- ‚úÖ Flows that span multiple pages</p>
<p><strong>Don't write E2E tests for</strong>:
- ‚ùå Every feature (too slow, too expensive)
- ‚ùå Unit-level logic (use unit tests)
- ‚ùå Component behavior (use integration tests)
- ‚ùå Edge cases (use integration tests)
- ‚ùå Styling (use visual regression tools)</p>
<p><strong>The rule</strong>: E2E tests are your last line of defense. Use them for the 5% of functionality where integration tests aren't enough.</p>
<h2 id="the-complete-testing-strategy">The Complete Testing Strategy</h2>
<p>For a production application, use all three types of tests:</p>
<p><strong>Example: Payment Feature</strong></p>
<p><strong>Unit Tests (70%)</strong>:
- <code>validateCardNumber()</code> - 6 tests for edge cases
- <code>formatExpiryDate()</code> - 4 tests for formatting
- <code>calculateTotal()</code> - 5 tests for calculations
- <code>PaymentForm</code> component - 8 tests for behavior</p>
<p><strong>Integration Tests (20%)</strong>:
- Complete payment flow - 1 test
- Error handling flow - 1 test
- Loading states - 1 test
- Cart integration - 1 test</p>
<p><strong>E2E Tests (10%)</strong>:
- End-to-end checkout in Chrome - 1 test
- End-to-end checkout in Safari - 1 test</p>
<p><strong>Total</strong>: 23 unit tests, 4 integration tests, 2 E2E tests</p>
<p><strong>Run time</strong>:
- Unit tests: 2 seconds
- Integration tests: 5 seconds
- E2E tests: 15 seconds
- <strong>Total</strong>: 22 seconds</p>
<p>This gives you comprehensive coverage without excessive maintenance burden.</p>
<h2 id="the-complete-testing-journey">The Complete Testing Journey</h2>
<h2 id="the-journey-from-no-tests-to-comprehensive-coverage">The Journey: From No Tests to Comprehensive Coverage</h2>
<p>Let's trace the evolution of our payment form testing strategy:</p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Testing Approach</th>
<th>What We Caught</th>
<th>What We Missed</th>
<th>Run Time</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0. No Tests</strong></td>
<td>Manual testing only</td>
<td>Nothing automatically</td>
<td>Everything</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>1. Basic Unit Tests</strong></td>
<td>Component renders</td>
<td>Rendering crashes</td>
<td>User interactions, integration bugs</td>
<td>0.5s</td>
</tr>
<tr>
<td><strong>2. Interaction Tests</strong></td>
<td>User can fill form</td>
<td>Form validation, submission</td>
<td>Integration with API, browser bugs</td>
<td>2s</td>
</tr>
<tr>
<td><strong>3. Integration Tests</strong></td>
<td>Complete payment flow</td>
<td>API integration, state management</td>
<td>Browser-specific bugs</td>
<td>7s</td>
</tr>
<tr>
<td><strong>4. E2E Tests</strong></td>
<td>Real browser testing</td>
<td>Safari compatibility, file upload</td>
<td>Nothing (comprehensive)</td>
<td>22s</td>
</tr>
</tbody>
</table>
<h2 id="final-implementation-complete-test-suite">Final Implementation: Complete Test Suite</h2>
<p>Here's the complete test suite for our payment form:</p>
<h3 id="unit-tests-paymentformtesttsx">Unit Tests (PaymentForm.test.tsx)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/PaymentForm.test.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">render</span><span class="p">,</span><span class="w"> </span><span class="nx">screen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">userEvent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/user-event&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentForm</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./PaymentForm&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentForm&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Rendering&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;renders all form fields&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$99\.99/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;displays correct amount&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">149.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="s1">&#39;Amount: $149.99&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay \$149\.99/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Validation&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;disables submit button when form is empty&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeDisabled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;enables submit button when all fields are valid&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeEnabled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;keeps button disabled with invalid card number&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12345&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Too short</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeDisabled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Submission&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;calls onSubmit with form data&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>

<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockOnSubmit</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">({</span>
<span class="w">        </span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">expiryDate</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">cvv</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">cardholderName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;shows loading state during submission&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockImplementation</span><span class="p">(</span>
<span class="w">        </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">))</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/processing/i</span><span class="w"> </span><span class="p">})).</span><span class="nx">toBeDisabled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;displays error message on failure&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockRejectedValue</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Payment declined&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">)).</span><span class="nx">toHaveTextContent</span><span class="p">(</span><span class="s1">&#39;Payment declined&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Accessibility&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has accessible form labels&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">()}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;announces errors to screen readers&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockOnSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">));</span>

<span class="w">      </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentForm</span><span class="w"> </span><span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span><span class="w"> </span><span class="na">amount</span><span class="o">=</span><span class="p">{</span><span class="mf">99.99</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">error</span><span class="p">).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="unit-tests-validationtestts">Unit Tests (validation.test.ts)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/lib/validation.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">validateCardNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">validateExpiryDate</span><span class="p">,</span><span class="w"> </span><span class="nx">validateCVV</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./validation&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;validateCardNumber&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;accepts valid card numbers&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;6011514433546201&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects invalid card numbers&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;1234567812345678&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;handles spaces and dashes&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532 0151 1283 0366&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;4532-0151-1283-0366&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects wrong length&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;453201511283036&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCardNumber</span><span class="p">(</span><span class="s1">&#39;45320151128303666&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;validateExpiryDate&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;accepts valid future dates&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateExpiryDate</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateExpiryDate</span><span class="p">(</span><span class="s1">&#39;01/30&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects past dates&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateExpiryDate</span><span class="p">(</span><span class="s1">&#39;01/20&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects invalid format&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateExpiryDate</span><span class="p">(</span><span class="s1">&#39;13/25&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// Invalid month</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateExpiryDate</span><span class="p">(</span><span class="s1">&#39;12/2025&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// Wrong format</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;validateCVV&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;accepts 3-digit CVV&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCVV</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;accepts 4-digit CVV (Amex)&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCVV</span><span class="p">(</span><span class="s1">&#39;1234&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;rejects invalid CVV&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCVV</span><span class="p">(</span><span class="s1">&#39;12&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCVV</span><span class="p">(</span><span class="s1">&#39;12345&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">validateCVV</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="integration-tests-paymentpagetesttsx">Integration Tests (PaymentPage.test.tsx)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/pages/PaymentPage.test.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">render</span><span class="p">,</span><span class="w"> </span><span class="nx">screen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">userEvent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@testing-library/user-event&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PaymentPage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./PaymentPage&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;PaymentPage - Integration&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;completes full payment flow&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockProcessPayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">      </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">transactionId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;txn_123456&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="kt">99.99</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentPage</span><span class="w"> </span><span class="na">processPayment</span><span class="o">=</span><span class="p">{</span><span class="nx">mockProcessPayment</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">    </span><span class="c1">// Fill form</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Submit</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">    </span><span class="c1">// Verify API call</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockProcessPayment</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">({</span>
<span class="w">      </span><span class="nx">cardNumber</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">expiryDate</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">cvv</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">cardholderName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Verify confirmation</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/txn_123456/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;handles payment failure&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userEvent</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockProcessPayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockRejectedValue</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Insufficient funds&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">PaymentPage</span><span class="w"> </span><span class="na">processPayment</span><span class="o">=</span><span class="p">{</span><span class="nx">mockProcessPayment</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="kr">type</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}));</span>

<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">findByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">)).</span><span class="nx">toHaveTextContent</span><span class="p">(</span><span class="s1">&#39;Insufficient funds&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">queryByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="e2e-tests-paymentspects">E2E Tests (payment.spec.ts)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// e2e/payment.spec.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">test</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@playwright/test&#39;</span><span class="p">;</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Payment Flow - E2E&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;completes payment in Chrome&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/payment successful/i</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">toHaveURL</span><span class="p">(</span><span class="sr">/\/checkout\/confirmation/</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;handles payment failure&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;**/api/payment&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">route</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">route</span><span class="p">.</span><span class="nx">fulfill</span><span class="p">({</span>
<span class="w">        </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">400</span><span class="p">,</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Payment declined&#39;</span><span class="w"> </span><span class="p">}),</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;/checkout/payment&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Card Number&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;4532015112830366&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Expiry Date&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;12/25&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;CVV&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByLabel</span><span class="p">(</span><span class="s1">&#39;Cardholder Name&#39;</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/pay/i</span><span class="w"> </span><span class="p">}).</span><span class="nx">click</span><span class="p">();</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">)).</span><span class="nx">toContainText</span><span class="p">(</span><span class="s1">&#39;Payment declined&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="decision-framework-which-test-type-when">Decision Framework: Which Test Type When?</h2>
<p>Use this flowchart to decide which type of test to write:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Is</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">dependencies</span>?
‚îú‚îÄ<span class="w"> </span><span class="nv">Yes</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="nv">Unit</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="ss">(</span><span class="nv">Vitest</span><span class="ss">)</span>
‚îî‚îÄ<span class="w"> </span><span class="nv">No</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="k">Continue</span>

<span class="nv">Does</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">involve</span><span class="w"> </span><span class="nv">multiple</span><span class="w"> </span><span class="nv">components</span><span class="w"> </span><span class="nv">working</span><span class="w"> </span><span class="nv">together</span>?
‚îú‚îÄ<span class="w"> </span><span class="nv">Yes</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="nv">Integration</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="ss">(</span><span class="nv">React</span><span class="w"> </span><span class="nv">Testing</span><span class="w"> </span><span class="nv">Library</span><span class="ss">)</span>
‚îî‚îÄ<span class="w"> </span><span class="nv">No</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="k">Continue</span>

<span class="nv">Does</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">require</span><span class="w"> </span><span class="nv">real</span><span class="w"> </span><span class="nv">browser</span><span class="w"> </span><span class="nv">behavior</span>?
‚îú‚îÄ<span class="w"> </span><span class="nv">Yes</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="nv">E2E</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="ss">(</span><span class="nv">Playwright</span><span class="ss">)</span>
‚îî‚îÄ<span class="w"> </span><span class="nv">No</span><span class="w"> </span>‚Üí<span class="w"> </span><span class="nv">Unit</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="ss">(</span><span class="nv">React</span><span class="w"> </span><span class="nv">Testing</span><span class="w"> </span><span class="nv">Library</span><span class="ss">)</span>
</code></pre></div>

<p><strong>Specific scenarios</strong>:</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Test Type</th>
<th>Tool</th>
</tr>
</thead>
<tbody>
<tr>
<td>Validation function</td>
<td>Unit</td>
<td>Vitest</td>
</tr>
<tr>
<td>Single component behavior</td>
<td>Unit</td>
<td>React Testing Library</td>
</tr>
<tr>
<td>Form submission flow</td>
<td>Integration</td>
<td>React Testing Library</td>
</tr>
<tr>
<td>Multi-page checkout</td>
<td>E2E</td>
<td>Playwright</td>
</tr>
<tr>
<td>File upload</td>
<td>E2E</td>
<td>Playwright</td>
</tr>
<tr>
<td>API integration</td>
<td>Integration</td>
<td>React Testing Library + MSW</td>
</tr>
<tr>
<td>Browser compatibility</td>
<td>E2E</td>
<td>Playwright</td>
</tr>
<tr>
<td>Accessibility</td>
<td>Unit/Integration</td>
<td>React Testing Library</td>
</tr>
</tbody>
</table>
<h2 id="lessons-learned-from-no-tests-to-comprehensive-coverage">Lessons Learned: From No Tests to Comprehensive Coverage</h2>
<h3 id="1-start-with-high-value-tests">1. Start with High-Value Tests</h3>
<p>Don't try to test everything at once. Start with:
- Critical user flows (payment, registration)
- Complex business logic (calculations, validations)
- Features that have broken before</p>
<h3 id="2-test-behavior-not-implementation">2. Test Behavior, Not Implementation</h3>
<p>Tests should verify what users experience, not how code works internally. If you can refactor without changing behavior, tests shouldn't break.</p>
<h3 id="3-use-the-right-tool-for-the-job">3. Use the Right Tool for the Job</h3>
<ul>
<li><strong>Unit tests</strong> for logic and isolated components</li>
<li><strong>Integration tests</strong> for component collaboration</li>
<li><strong>E2E tests</strong> for critical flows in real browsers</li>
</ul>
<h3 id="4-make-tests-readable">4. Make Tests Readable</h3>
<p>Tests are documentation. A developer should be able to read a test and understand what the feature does.</p>
<h3 id="5-keep-tests-fast">5. Keep Tests Fast</h3>
<p>Slow tests don't get run. Optimize for speed:
- Mock external dependencies
- Use parallel execution
- Run E2E tests only in CI</p>
<h3 id="6-maintain-tests-like-production-code">6. Maintain Tests Like Production Code</h3>
<p>Tests are code. They need:
- Clear naming
- DRY principles (Page Object Model)
- Refactoring when they become brittle
- Regular maintenance</p>
<h3 id="7-coverage-is-a-guide-not-a-goal">7. Coverage Is a Guide, Not a Goal</h3>
<p>Don't aim for 100% coverage. Aim for:
- High coverage of critical paths
- Confidence in deployments
- Fast feedback on regressions</p>
<h2 id="the-professional-react-developers-testing-mindset">The Professional React Developer's Testing Mindset</h2>
<p><strong>Before writing code</strong>:
- "How will I test this?"
- "What could go wrong?"
- "What's the user experience?"</p>
<p><strong>While writing code</strong>:
- Write the test first (TDD) or immediately after
- Run tests frequently
- Fix failing tests before moving on</p>
<p><strong>Before deploying</strong>:
- All tests pass
- Coverage meets team standards
- Critical flows have E2E tests</p>
<p><strong>After deployment</strong>:
- Monitor for failures
- Add tests for production bugs
- Refactor tests as code evolves</p>
<p><strong>The goal</strong>: Ship with confidence. Tests are your safety net.</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 12:33:32 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>