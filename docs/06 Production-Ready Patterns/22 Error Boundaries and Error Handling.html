<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>22 Error Boundaries and Error Handling</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">06 Production-Ready Patterns</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-22-error-boundaries-and-error-handling">Chapter 22: Error Boundaries and Error Handling</h1>
<h2 id="error-boundaries-in-react">Error boundaries in React</h2>
<h2 id="the-failure-when-one-component-crashes-the-entire-app">The Failure: When One Component Crashes the Entire App</h2>
<p>Let's start with a realistic scenario that will serve as our reference implementation throughout this chapter. We're building a product dashboard that displays multiple widgets: user statistics, recent orders, and a revenue chart. Each widget fetches its own data independently.</p>
<p>Here's our initial implementation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/page.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">UserStats</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">totalUsers</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">activeUsers</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">newToday</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">UserStatsWidget</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">stats</span><span class="p">,</span><span class="w"> </span><span class="nx">setStats</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">UserStats</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">setLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/stats/users&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setStats</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">stats</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="c1">// This will crash if stats.totalUsers is undefined</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">User</span><span class="w"> </span><span class="nx">Statistics</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Total</span><span class="w"> </span><span class="nx">Users</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="p">.</span><span class="nx">totalUsers</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Active</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="p">.</span><span class="nx">activeUsers</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">New</span><span class="w"> </span><span class="nx">Today</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="p">.</span><span class="nx">newToday</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">RecentOrdersWidget</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">orders</span><span class="p">,</span><span class="w"> </span><span class="nx">setOrders</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">setLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/orders/recent&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setOrders</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">orders</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Orders</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">orders</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">order</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">li</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">order</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
<span class="w">            </span><span class="nx">Order</span><span class="w"> </span><span class="err">#</span><span class="p">{</span><span class="nx">order</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">$</span><span class="p">{</span><span class="nx">order</span><span class="p">.</span><span class="nx">total</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">RevenueChartWidget</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">revenue</span><span class="p">,</span><span class="w"> </span><span class="nx">setRevenue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">setLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/stats/revenue&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setRevenue</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">revenue</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Revenue</span><span class="w"> </span><span class="nx">Chart</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Today</span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">{</span><span class="nx">revenue</span><span class="p">.</span><span class="nx">today</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">This</span><span class="w"> </span><span class="nx">Week</span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">{</span><span class="nx">revenue</span><span class="p">.</span><span class="nx">week</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">This</span><span class="w"> </span><span class="nx">Month</span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">{</span><span class="nx">revenue</span><span class="p">.</span><span class="nx">month</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">DashboardPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;dashboard&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Dashboard</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widgets-grid&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">UserStatsWidget</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">RecentOrdersWidget</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">RevenueChartWidget</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's see what happens when the user stats API returns malformed data. We'll simulate this by having the API return <code>null</code> for <code>totalUsers</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// API response from /api/stats/users (malformed)</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;totalUsers&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;activeUsers&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1250</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;newToday&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-catastrophic-failure">Diagnostic Analysis: Reading the Catastrophic Failure</h3>
<p><strong>Browser Behavior</strong>:
The entire dashboard disappears. The user sees a blank white screen with no indication of what went wrong. All three widgets vanish, even though only one had a problem.</p>
<p><strong>Browser Console Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Uncaught TypeError: Cannot read properties of null (reading &#39;toLocaleString&#39;)
    at UserStatsWidget (page.tsx:23)
    at renderWithHooks (react-dom.development.js:16305)
    at updateFunctionComponent (react-dom.development.js:19588)
    at beginWork (react-dom.development.js:21601)

The above error occurred in the &lt;UserStatsWidget&gt; component:
    at UserStatsWidget (http://localhost:3000/dashboard/page.tsx:12:5)
    at div
    at DashboardPage (http://localhost:3000/dashboard/page.tsx:65:3)

Consider adding an error boundary to your tree to customize error handling behavior.
</code></pre></div>

<p><strong>React DevTools Evidence</strong>:
- Component tree shows <code>DashboardPage</code> rendered
- <code>UserStatsWidget</code>, <code>RecentOrdersWidget</code>, and <code>RevenueChartWidget</code> all show as unmounted
- No components visible in the tree after the error
- Props/State inspection unavailable (components unmounted)</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: See the dashboard with three widgets, possibly with one showing an error</li>
<li>
<p>Actual: Blank screen, no content, no error message, no way to recover</p>
</li>
<li>
<p><strong>What the console reveals</strong>:</p>
</li>
<li>Key indicator: <code>Cannot read properties of null (reading 'toLocaleString')</code></li>
<li>Error location: <code>UserStatsWidget</code> at line 23</li>
<li>
<p>The error occurred when trying to call <code>.toLocaleString()</code> on <code>null</code></p>
</li>
<li>
<p><strong>What DevTools shows</strong>:</p>
</li>
<li>Component state: All components unmounted after error</li>
<li>Render behavior: React stopped rendering the entire tree</li>
<li>
<p>The error in one component caused React to unmount everything</p>
</li>
<li>
<p><strong>Root cause identified</strong>: 
   When <code>stats.totalUsers</code> is <code>null</code>, calling <code>.toLocaleString()</code> throws an error. React's default behavior is to unmount the entire component tree when an unhandled error occurs during rendering.</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>:
   We have no mechanism to catch rendering errors. Try-catch blocks don't work in React components because rendering is asynchronous. We need a React-specific error handling mechanism.</p>
</li>
<li>
<p><strong>What we need</strong>:
   A way to catch errors in component rendering and prevent them from crashing the entire application. React provides <strong>Error Boundaries</strong> for exactly this purpose.</p>
</li>
</ol>
<h2 id="understanding-error-boundaries">Understanding Error Boundaries</h2>
<p>Error boundaries are React components that catch JavaScript errors anywhere in their child component tree, log those errors, and display a fallback UI instead of crashing the entire application.</p>
<p><strong>Key characteristics</strong>:
- Error boundaries catch errors during <strong>rendering</strong>, in <strong>lifecycle methods</strong>, and in <strong>constructors</strong> of child components
- They do NOT catch errors in event handlers, async code (setTimeout, promises), or Server Components
- They must be class components (as of React 18, no hooks equivalent exists)
- They work by implementing <code>static getDerivedStateFromError()</code> or <code>componentDidCatch()</code></p>
<h3 id="creating-a-basic-error-boundary">Creating a Basic Error Boundary</h3>
<p>Let's create our first error boundary:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ErrorBoundary.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Component</span><span class="p">,</span><span class="w"> </span><span class="nx">ReactNode</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Props</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="p">;</span>
<span class="w">  </span><span class="nx">fallback?</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">Component</span><span class="p">&lt;</span><span class="nt">Props</span><span class="err">,</span><span class="w"> </span><span class="na">State</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">props</span><span class="o">:</span><span class="w"> </span><span class="kt">Props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// This lifecycle method is called when an error is thrown</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">getDerivedStateFromError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Update state so the next render shows the fallback UI</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// This lifecycle method is called after an error is caught</span>
<span class="w">  </span><span class="nx">componentDidCatch</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ErrorInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Log the error to console (we&#39;ll add proper logging later)</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error caught by boundary:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Component stack:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="p">.</span><span class="nx">componentStack</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">hasError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Render custom fallback UI</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">fallback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">fallback</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-boundary-fallback&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Something</span><span class="w"> </span><span class="nx">went</span><span class="w"> </span><span class="nx">wrong</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="w"> </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span><span class="w"> </span><span class="p">})}&gt;</span>
<span class="w">            </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's wrap each widget in its own error boundary:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/page.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/ErrorBoundary&#39;</span><span class="p">;</span>

<span class="c1">// ... (UserStatsWidget, RecentOrdersWidget, RevenueChartWidget remain the same)</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">DashboardPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;dashboard&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Dashboard</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widgets-grid&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">WidgetError</span><span class="w"> </span><span class="na">name</span><span class="o">=</span><span class="s">&quot;User Stats&quot;</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">UserStatsWidget</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">WidgetError</span><span class="w"> </span><span class="na">name</span><span class="o">=</span><span class="s">&quot;Recent Orders&quot;</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">RecentOrdersWidget</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">WidgetError</span><span class="w"> </span><span class="na">name</span><span class="o">=</span><span class="s">&quot;Revenue Chart&quot;</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">RevenueChartWidget</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">WidgetError</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget widget-error&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-message&quot;</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">data</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">()}&gt;</span>
<span class="w">        </span><span class="nx">Reload</span><span class="w"> </span><span class="nx">Dashboard</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-error-boundary-in-action">Verification: Error Boundary in Action</h3>
<p>Now when the user stats API returns malformed data:</p>
<p><strong>Browser Behavior</strong>:
- The dashboard remains visible
- User Stats widget shows the error fallback UI
- Recent Orders and Revenue Chart widgets continue to function normally
- User can still interact with working widgets</p>
<p><strong>Browser Console Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error caught by boundary: TypeError: Cannot read properties of null (reading &#39;toLocaleString&#39;)
Component stack:
    at UserStatsWidget (http://localhost:3000/dashboard/page.tsx:12:5)
    at ErrorBoundary (http://localhost:3000/components/ErrorBoundary.tsx:15:3)
    at div
    at DashboardPage (http://localhost:3000/dashboard/page.tsx:65:3)
</code></pre></div>

<p><strong>React DevTools Evidence</strong>:
- <code>DashboardPage</code> component still mounted
- <code>ErrorBoundary</code> (wrapping UserStatsWidget) shows <code>hasError: true</code> in state
- <code>RecentOrdersWidget</code> and <code>RevenueChartWidget</code> continue rendering normally
- Component tree remains intact</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Entire dashboard crashes, blank screen
- After: Only the failing widget shows an error, rest of the dashboard works
- User experience: Degraded but functional instead of completely broken</p>
<h3 id="limitation-preview">Limitation Preview</h3>
<p>This solves the catastrophic failure problem, but we still have issues:
1. The error message is generic and unhelpful
2. We're logging to console instead of a proper monitoring service
3. The "Try again" button doesn't actually retry the failed component
4. We have no way to differentiate between different types of errors
5. Error boundaries don't catch errors in event handlers or async code</p>
<p>Let's address these limitations in the next iteration.</p>
<h2 id="iteration-2-granular-error-boundaries-with-recovery">Iteration 2: Granular Error Boundaries with Recovery</h2>
<p><strong>Current limitation</strong>: Our error boundary is too generic. It treats all errors the same way and doesn't provide meaningful recovery options.</p>
<p><strong>New scenario</strong>: What if we want different error handling strategies for different types of failures? Network errors should be retryable, but programming errors (like null reference) might need different handling.</p>
<p>Let's create a more sophisticated error boundary:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ErrorBoundary.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Component</span><span class="p">,</span><span class="w"> </span><span class="nx">ReactNode</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Props</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="p">;</span>
<span class="w">  </span><span class="nx">fallback</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onError</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ErrorInfo</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">resetKeys?</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">number</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">Component</span><span class="p">&lt;</span><span class="nt">Props</span><span class="err">,</span><span class="w"> </span><span class="na">State</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">props</span><span class="o">:</span><span class="w"> </span><span class="kt">Props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">getDerivedStateFromError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">componentDidCatch</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ErrorInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Call custom error handler if provided</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error caught by boundary:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Component stack:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="p">.</span><span class="nx">componentStack</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">componentDidUpdate</span><span class="p">(</span><span class="nx">prevProps</span><span class="o">:</span><span class="w"> </span><span class="kt">Props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Reset error state if resetKeys change</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">hasError</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">resetKeys</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">prevKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prevProps</span><span class="p">.</span><span class="nx">resetKeys</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">resetKeys</span><span class="p">;</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentKeys</span><span class="p">.</span><span class="nx">some</span><span class="p">((</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">prevKeys</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hasChanged</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">hasError</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">fallback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">fallback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-boundary-fallback&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Something</span><span class="w"> </span><span class="nx">went</span><span class="w"> </span><span class="nx">wrong</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">}&gt;</span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's create widget-specific error handling with proper retry logic:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/page.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/ErrorBoundary&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">UserStats</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">totalUsers</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">activeUsers</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">newToday</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">UserStatsWidget</span><span class="p">({</span><span class="w"> </span><span class="nx">retryKey</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">retryKey</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">stats</span><span class="p">,</span><span class="w"> </span><span class="nx">setStats</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">UserStats</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">setLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/stats/users&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Validate data structure</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">totalUsers</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Invalid data format from API&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">setStats</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Re-throw to be caught by error boundary</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">retryKey</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">stats</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">User</span><span class="w"> </span><span class="nx">Statistics</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Total</span><span class="w"> </span><span class="nx">Users</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="o">!</span><span class="p">.</span><span class="nx">totalUsers</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Active</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="o">!</span><span class="p">.</span><span class="nx">activeUsers</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">New</span><span class="w"> </span><span class="nx">Today</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">stats</span><span class="o">!</span><span class="p">.</span><span class="nx">newToday</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Similar updates for other widgets...</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">DashboardPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">userStatsRetry</span><span class="p">,</span><span class="w"> </span><span class="nx">setUserStatsRetry</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">ordersRetry</span><span class="p">,</span><span class="w"> </span><span class="nx">setOrdersRetry</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">revenueRetry</span><span class="p">,</span><span class="w"> </span><span class="nx">setRevenueRetry</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;dashboard&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Dashboard</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widgets-grid&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span>
<span class="w">          </span><span class="na">resetKeys</span><span class="o">=</span><span class="p">{[</span><span class="nx">userStatsRetry</span><span class="p">]}</span>
<span class="w">          </span><span class="na">fallback</span><span class="o">=</span><span class="p">{(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">WidgetError</span>
<span class="w">              </span><span class="na">name</span><span class="o">=</span><span class="s">&quot;User Stats&quot;</span>
<span class="w">              </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span>
<span class="w">              </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">setUserStatsRetry</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">                </span><span class="nx">reset</span><span class="p">();</span>
<span class="w">              </span><span class="p">}}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">)}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">UserStatsWidget</span><span class="w"> </span><span class="na">retryKey</span><span class="o">=</span><span class="p">{</span><span class="nx">userStatsRetry</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span>
<span class="w">          </span><span class="na">resetKeys</span><span class="o">=</span><span class="p">{[</span><span class="nx">ordersRetry</span><span class="p">]}</span>
<span class="w">          </span><span class="na">fallback</span><span class="o">=</span><span class="p">{(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">WidgetError</span>
<span class="w">              </span><span class="na">name</span><span class="o">=</span><span class="s">&quot;Recent Orders&quot;</span>
<span class="w">              </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span>
<span class="w">              </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">setOrdersRetry</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">                </span><span class="nx">reset</span><span class="p">();</span>
<span class="w">              </span><span class="p">}}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">)}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">RecentOrdersWidget</span><span class="w"> </span><span class="na">retryKey</span><span class="o">=</span><span class="p">{</span><span class="nx">ordersRetry</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span>
<span class="w">          </span><span class="na">resetKeys</span><span class="o">=</span><span class="p">{[</span><span class="nx">revenueRetry</span><span class="p">]}</span>
<span class="w">          </span><span class="na">fallback</span><span class="o">=</span><span class="p">{(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">WidgetError</span>
<span class="w">              </span><span class="na">name</span><span class="o">=</span><span class="s">&quot;Revenue Chart&quot;</span>
<span class="w">              </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span>
<span class="w">              </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">setRevenueRetry</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">                </span><span class="nx">reset</span><span class="p">();</span>
<span class="w">              </span><span class="p">}}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">)}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">RevenueChartWidget</span><span class="w"> </span><span class="na">retryKey</span><span class="o">=</span><span class="p">{</span><span class="nx">revenueRetry</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">WidgetError</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onRetry</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onRetry</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isNetworkError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;HTTP&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>
<span class="w">                         </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget widget-error&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-message&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">isNetworkError</span><span class="w"> </span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Failed to load data from server&#39;</span><span class="w"> </span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;An unexpected error occurred&#39;</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">details</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-details&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span><span class="nx">Technical</span><span class="w"> </span><span class="nx">details</span><span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span>
</code></pre></div>

<h3 id="verification-improved-error-handling">Verification: Improved Error Handling</h3>
<p>Now when the user stats API fails:</p>
<p><strong>Browser Behavior</strong>:
- User Stats widget shows a specific error message
- "Retry" button actually re-fetches the data
- Technical details are hidden but accessible
- Other widgets continue working</p>
<p><strong>Browser Console Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error caught by boundary: Error: Invalid data format from API
Component stack:
    at UserStatsWidget (http://localhost:3000/dashboard/page.tsx:15:5)
    at ErrorBoundary (http://localhost:3000/components/ErrorBoundary.tsx:18:3)
</code></pre></div>

<p><strong>React DevTools Evidence</strong>:
- When retry button is clicked, <code>retryKey</code> prop changes from 0 to 1
- <code>UserStatsWidget</code> remounts with new <code>retryKey</code>
- <code>useEffect</code> runs again, fetching fresh data
- If successful, error boundary resets and widget displays normally</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Generic error, no retry mechanism
- After: Specific error messages, functional retry, graceful degradation
- User experience: Clear feedback and recovery path</p>
<h3 id="limitation-preview_1">Limitation Preview</h3>
<p>We've improved error handling significantly, but there's still a critical gap: <strong>we're only logging errors to the console</strong>. In production, we need to:
1. Track errors in a centralized monitoring system
2. Get notified when errors occur
3. Analyze error patterns and frequency
4. Capture user context (browser, OS, user actions leading to error)</p>
<p>This is where error monitoring services like Sentry come in.</p>
<h2 id="common-failure-modes-and-their-signatures">Common Failure Modes and Their Signatures</h2>
<h3 id="symptom-error-boundary-doesnt-catch-the-error">Symptom: Error boundary doesn't catch the error</h3>
<p><strong>Browser behavior</strong>:
Application still crashes with blank screen</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>Uncaught Error: Something went wrong
    at handleClick (Component.tsx:45)
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Error occurs in event handler, not during render
- Component tree unmounts completely
- No error boundary state change visible</p>
<p><strong>Root cause</strong>: Error boundaries only catch errors during rendering, in lifecycle methods, and in constructors. They don't catch:
- Errors in event handlers
- Async code (setTimeout, promises)
- Server-side rendering errors
- Errors in the error boundary itself</p>
<p><strong>Solution</strong>: For event handlers and async code, use try-catch blocks:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Event handler errors - use try-catch</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">riskyOperation</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Handle error or set error state</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Operation failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClick</span><span class="p">}&gt;</span><span class="nx">Click</span><span class="w"> </span><span class="nx">me</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="symptom-error-boundary-catches-error-but-doesnt-reset">Symptom: Error boundary catches error but doesn't reset</h3>
<p><strong>Browser behavior</strong>:
Error fallback UI displays, but clicking "Try again" doesn't work</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error caught by boundary: TypeError: ...
(No additional errors, but component doesn&#39;t remount)
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Error boundary state shows <code>hasError: true</code>
- Clicking reset button doesn't change state
- Child component never remounts</p>
<p><strong>Root cause</strong>: The reset mechanism isn't properly implemented. Either:
1. The reset function isn't updating state correctly
2. The child component isn't keyed or doesn't respond to prop changes
3. The error condition still exists (e.g., bad data in parent state)</p>
<p><strong>Solution</strong>: Use <code>resetKeys</code> prop to force remount:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Parent component manages retry state</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">ParentComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">retryCount</span><span class="p">,</span><span class="w"> </span><span class="nx">setRetryCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span>
<span class="w">      </span><span class="na">resetKeys</span><span class="o">=</span><span class="p">{[</span><span class="nx">retryCount</span><span class="p">]}</span>
<span class="w">      </span><span class="na">fallback</span><span class="o">=</span><span class="p">{(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="ne">Error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">setRetryCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">reset</span><span class="p">();</span>
<span class="w">          </span><span class="p">}}&gt;</span>
<span class="w">            </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">ChildComponent</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">retryCount</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="symptom-multiple-error-boundaries-trigger-for-same-error">Symptom: Multiple error boundaries trigger for same error</h3>
<p><strong>Browser behavior</strong>:
Multiple error fallback UIs appear, nested inside each other</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error caught by boundary: TypeError: ...
Error caught by boundary: TypeError: ...
Error caught by boundary: TypeError: ...
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Multiple error boundaries in component tree all show <code>hasError: true</code>
- Error propagates up through nested boundaries
- Innermost boundary should catch it, but doesn't</p>
<p><strong>Root cause</strong>: Error boundaries don't stop error propagation by default. If an error boundary's fallback UI itself throws an error, it propagates to the next boundary up.</p>
<p><strong>Solution</strong>: Ensure fallback UI is error-free and consider using a single boundary at appropriate level:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Bad: Nested boundaries that might all trigger</span>
<span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">RiskyComponent</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>

<span class="c1">// Good: Single boundary at appropriate level</span>
<span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;widget-container&quot;</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">RiskyComponent</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>

<span class="c1">// Good: Multiple boundaries for independent sections</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;dashboard&quot;</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">WidgetA</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">WidgetB</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">ErrorBoundary</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<h2 id="error-handling-in-nextjs">Error handling in Next.js</h2>
<h2 id="the-failure-error-boundaries-dont-work-in-server-components">The Failure: Error Boundaries Don't Work in Server Components</h2>
<p><strong>Current limitation</strong>: Our error boundary works great for Client Components, but Next.js introduces a new complexity: Server Components. Let's see what happens when a Server Component fails.</p>
<p><strong>New scenario</strong>: We're adding a server-rendered product list to our dashboard. The data is fetched on the server for better performance and SEO.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/page.tsx</span>
<span class="c1">// This is a Server Component (default in Next.js App Router)</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProducts</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="err">[]</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-store&#39;</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to fetch products: </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProducts</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-grid&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;product-card&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Price</span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Stock</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">stock</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's see what happens when the API is down:</p>
<h3 id="diagnostic-analysis-server-component-failure">Diagnostic Analysis: Server Component Failure</h3>
<p><strong>Browser Behavior</strong>:
The entire page fails to load. Instead of the products page, the user sees Next.js's default error page with a generic error message.</p>
<p><strong>Browser Console Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>GET http://localhost:3000/dashboard/products 500 (Internal Server Error)
</code></pre></div>

<p><strong>Terminal Output</strong> (Next.js server):</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>fetch<span class="w"> </span>products:<span class="w"> </span><span class="m">503</span>
<span class="w">    </span>at<span class="w"> </span>getProducts<span class="w"> </span><span class="o">(</span>page.tsx:15:11<span class="o">)</span>
<span class="w">    </span>at<span class="w"> </span>ProductsPage<span class="w"> </span><span class="o">(</span>page.tsx:21:23<span class="o">)</span>

<span class="w"> </span>‚®Ø<span class="w"> </span>Error:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>fetch<span class="w"> </span>products:<span class="w"> </span><span class="m">503</span>
<span class="w">    </span>at<span class="w"> </span>getProducts<span class="w"> </span><span class="o">(</span>/app/dashboard/products/page.tsx:15:11<span class="o">)</span>
<span class="w">    </span>at<span class="w"> </span>ProductsPage<span class="w"> </span><span class="o">(</span>/app/dashboard/products/page.tsx:21:23<span class="o">)</span>
</code></pre></div>

<p><strong>React DevTools Evidence</strong>:
- Cannot inspect Server Components in React DevTools
- No component tree visible (error occurred during server rendering)
- Page never hydrates because server rendering failed</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: See products page, possibly with loading state or error message</li>
<li>
<p>Actual: Generic error page, no way to recover without page refresh</p>
</li>
<li>
<p><strong>What the console reveals</strong>:</p>
</li>
<li>Key indicator: 500 Internal Server Error from the page route</li>
<li>Error location: Server-side, during page rendering</li>
<li>
<p>The error happened before any HTML was sent to the browser</p>
</li>
<li>
<p><strong>What the terminal shows</strong>:</p>
</li>
<li>Component state: Error thrown in <code>getProducts</code> function</li>
<li>Render behavior: Server rendering failed, no HTML generated</li>
<li>
<p>The error occurred during server-side data fetching</p>
</li>
<li>
<p><strong>Root cause identified</strong>: 
   Server Components execute on the server. When they throw errors, those errors occur during server rendering, before any HTML is sent to the browser. Client-side error boundaries can't catch these errors because they never reach the client.</p>
</li>
<li>
<p><strong>Why the current approach can't solve this</strong>:
   Error boundaries are Client Components. They only catch errors that occur during client-side rendering. Server Component errors happen before the client receives any code.</p>
</li>
<li>
<p><strong>What we need</strong>:
   Next.js provides special files for handling errors at different levels: <code>error.tsx</code> for client errors and <code>global-error.tsx</code> for global errors. We need to use these Next.js-specific error handling mechanisms.</p>
</li>
</ol>
<h2 id="nextjs-error-handling-errortsx">Next.js Error Handling: error.tsx</h2>
<p>Next.js provides a file-based convention for error handling. When you create an <code>error.tsx</code> file in a route segment, it automatically wraps that segment in an error boundary.</p>
<p><strong>Key characteristics</strong>:
- <code>error.tsx</code> must be a Client Component (marked with <code>'use client'</code>)
- It receives <code>error</code> and <code>reset</code> props automatically
- It catches errors in Server Components, Client Components, and nested layouts
- It creates an error boundary at the route segment level</p>
<p>Let's add error handling to our products page:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsError</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Log error to console (we&#39;ll add proper logging later)</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Products page error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Load</span><span class="w"> </span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-message&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="nx">We</span><span class="w"> </span><span class="nx">couldn</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="nx">list</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">might</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">temporary</span><span class="w"> </span><span class="nx">issue</span><span class="p">.</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">details</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-details&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span><span class="nx">Technical</span><span class="w"> </span><span class="nx">details</span><span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">digest</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-digest&quot;</span><span class="p">&gt;</span><span class="ne">Error</span><span class="w"> </span><span class="nx">ID</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">digest</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">)}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-actions&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;btn-primary&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/dashboard&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;btn-secondary&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Dashboard</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-nextjs-error-handling-in-action">Verification: Next.js Error Handling in Action</h3>
<p>Now when the products API fails:</p>
<p><strong>Browser Behavior</strong>:
- User sees a custom error page instead of the generic Next.js error
- Error message is user-friendly and actionable
- "Try again" button re-attempts the server render
- "Back to Dashboard" provides an escape route</p>
<p><strong>Browser Console Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Products page error: Error: Failed to fetch products: 503
</code></pre></div>

<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>fetch<span class="w"> </span>products:<span class="w"> </span><span class="m">503</span>
<span class="w">    </span>at<span class="w"> </span>getProducts<span class="w"> </span><span class="o">(</span>page.tsx:15:11<span class="o">)</span>
<span class="w">    </span>at<span class="w"> </span>ProductsPage<span class="w"> </span><span class="o">(</span>page.tsx:21:23<span class="o">)</span>
</code></pre></div>

<p><strong>React DevTools Evidence</strong>:
- Error boundary (created by error.tsx) shows in component tree
- Error state is managed by Next.js's error boundary
- Clicking "Try again" triggers a new server render</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Generic error page, no recovery option
- After: Custom error UI, retry functionality, clear user guidance
- User experience: Professional error handling with recovery path</p>
<h2 id="iteration-3-granular-error-handling-with-loadingtsx">Iteration 3: Granular Error Handling with loading.tsx</h2>
<p><strong>Current limitation</strong>: When the products page is loading, there's no loading state. The user sees the previous page until the new page is ready.</p>
<p><strong>New scenario</strong>: We want to show a loading skeleton while the products are being fetched on the server.</p>
<p>Next.js provides <code>loading.tsx</code> for this purpose:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/loading.tsx</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsLoading</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-grid&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{[...</span><span class="nb">Array</span><span class="p">(</span><span class="mf">6</span><span class="p">)].</span><span class="nx">map</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;product-card skeleton&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skeleton-title&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skeleton-text&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skeleton-text&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's improve our error handling to work with Suspense boundaries:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/page.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Suspense</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProducts</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">Product</span><span class="err">[]</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-store&#39;</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to fetch products: </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsList</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProducts</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-grid&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;product-card&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Price</span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Stock</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">stock</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">ProductsLoadingSkeleton</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-grid&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{[...</span><span class="nb">Array</span><span class="p">(</span><span class="mf">6</span><span class="p">)].</span><span class="nx">map</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;product-card skeleton&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skeleton-title&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skeleton-text&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;skeleton-text&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">ProductsLoadingSkeleton</span><span class="w"> </span><span class="p">/&gt;}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ProductsList</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-loading-states-with-error-handling">Verification: Loading States with Error Handling</h3>
<p><strong>Browser Behavior</strong>:
- Page loads immediately with skeleton UI
- Products list streams in when data is ready
- If error occurs, error boundary catches it
- Page header remains visible during loading and errors</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Blank screen or previous page during loading
- After: Immediate feedback with skeleton, smooth transition
- User experience: Perceived performance improvement, no jarring transitions</p>
<h2 id="the-failure-global-errors-arent-caught">The Failure: Global Errors Aren't Caught</h2>
<p><strong>Current limitation</strong>: Our <code>error.tsx</code> file catches errors in the products route, but what about errors in the root layout or errors that occur before any route is matched?</p>
<p><strong>New scenario</strong>: The root layout fetches user authentication data. If this fails, the entire app should show an error, not just a single route.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/layout.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cookies</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/headers&#39;</span><span class="p">;</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cookieStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookies</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookieStore</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth-token&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Not authenticated&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/user&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to fetch user data&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">RootLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getUser</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">html</span><span class="w"> </span><span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">main</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="diagnostic-analysis-root-layout-failure">Diagnostic Analysis: Root Layout Failure</h3>
<p><strong>Browser Behavior</strong>:
The entire application fails to load. User sees a generic Next.js error page.</p>
<p><strong>Terminal Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>fetch<span class="w"> </span>user<span class="w"> </span>data
<span class="w">    </span>at<span class="w"> </span>getUser<span class="w"> </span><span class="o">(</span>layout.tsx:15:11<span class="o">)</span>
<span class="w">    </span>at<span class="w"> </span>RootLayout<span class="w"> </span><span class="o">(</span>layout.tsx:22:17<span class="o">)</span>

<span class="w"> </span>‚®Ø<span class="w"> </span>Error:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>fetch<span class="w"> </span>user<span class="w"> </span>data
</code></pre></div>

<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: See login page or error message</li>
<li>
<p>Actual: Generic error, no way to recover</p>
</li>
<li>
<p><strong>What the terminal reveals</strong>:</p>
</li>
<li>Error in root layout, before any route is rendered</li>
<li>
<p>No route-level error boundary can catch this</p>
</li>
<li>
<p><strong>Root cause identified</strong>: 
   Errors in the root layout occur before any route-level error boundaries are established. We need a global error handler.</p>
</li>
</ol>
<h2 id="global-error-handling-global-errortsx">Global Error Handling: global-error.tsx</h2>
<p>For errors that occur in the root layout, Next.js provides <code>global-error.tsx</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/global-error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">GlobalErrorProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">GlobalError</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">GlobalErrorProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Global error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;global-error-page&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-content&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Application</span><span class="w"> </span><span class="ne">Error</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">              </span><span class="nx">We</span><span class="err">&#39;</span><span class="nx">re</span><span class="w"> </span><span class="nx">experiencing</span><span class="w"> </span><span class="nx">technical</span><span class="w"> </span><span class="nx">difficulties</span><span class="p">.</span><span class="w"> </span>
<span class="w">              </span><span class="nx">Please</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">few</span><span class="w"> </span><span class="nx">moments</span><span class="p">.</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">            </span><span class="p">&lt;</span><span class="nt">details</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-details&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span><span class="nx">Technical</span><span class="w"> </span><span class="nx">details</span><span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">digest</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">                </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-digest&quot;</span><span class="p">&gt;</span><span class="ne">Error</span><span class="w"> </span><span class="nx">ID</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">digest</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">)}</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>

<span class="w">            </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-actions&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;btn-primary&quot;</span><span class="p">&gt;</span>
<span class="w">                </span><span class="nx">Reload</span><span class="w"> </span><span class="nx">Application</span>
<span class="w">              </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Important notes about global-error.tsx</strong>:
- It must define its own <code>&lt;html&gt;</code> and <code>&lt;body&gt;</code> tags (it replaces the root layout)
- It only catches errors in the root layout
- It's rarely triggered in development (use production build to test)
- It's a last resort fallback for catastrophic failures</p>
<h3 id="verification-global-error-handling">Verification: Global Error Handling</h3>
<p><strong>Browser Behavior</strong>:
- User sees custom global error page
- Application structure (html/body) is still valid
- Clear error message and reload option</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Generic Next.js error, no branding or guidance
- After: Branded error page, clear recovery path
- User experience: Professional error handling even for catastrophic failures</p>
<h2 id="error-handling-hierarchy-in-nextjs">Error Handling Hierarchy in Next.js</h2>
<p>Next.js has a specific hierarchy for error handling:</p>
<ol>
<li><strong>Component-level</strong>: Try-catch in event handlers and async functions</li>
<li><strong>Route-level</strong>: <code>error.tsx</code> catches errors in that route segment</li>
<li><strong>Layout-level</strong>: <code>error.tsx</code> in parent segments catches errors in child routes</li>
<li><strong>Global-level</strong>: <code>global-error.tsx</code> catches errors in root layout</li>
<li><strong>Unhandled</strong>: Next.js default error page (development) or 500 page (production)</li>
</ol>
<p>Here's a complete example showing the hierarchy:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Project structure:</span>
<span class="c1">// src/app/</span>
<span class="c1">// ‚îú‚îÄ‚îÄ global-error.tsx          ‚Üê Catches root layout errors</span>
<span class="c1">// ‚îú‚îÄ‚îÄ error.tsx                 ‚Üê Catches errors in app routes</span>
<span class="c1">// ‚îú‚îÄ‚îÄ layout.tsx                ‚Üê Root layout</span>
<span class="c1">// ‚îú‚îÄ‚îÄ page.tsx                  ‚Üê Home page</span>
<span class="c1">// ‚îî‚îÄ‚îÄ dashboard/</span>
<span class="c1">//     ‚îú‚îÄ‚îÄ error.tsx             ‚Üê Catches errors in dashboard routes</span>
<span class="c1">//     ‚îú‚îÄ‚îÄ layout.tsx            ‚Üê Dashboard layout</span>
<span class="c1">//     ‚îú‚îÄ‚îÄ page.tsx              ‚Üê Dashboard home</span>
<span class="c1">//     ‚îî‚îÄ‚îÄ products/</span>
<span class="c1">//         ‚îú‚îÄ‚îÄ error.tsx         ‚Üê Catches errors in products route</span>
<span class="c1">//         ‚îú‚îÄ‚îÄ loading.tsx       ‚Üê Loading state for products</span>
<span class="c1">//         ‚îî‚îÄ‚îÄ page.tsx          ‚Üê Products page</span>

<span class="c1">// src/app/error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">AppError</span><span class="p">({</span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reset</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;app-error&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Something</span><span class="w"> </span><span class="nx">went</span><span class="w"> </span><span class="nx">wrong</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}&gt;</span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// src/app/dashboard/error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">DashboardError</span><span class="p">({</span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reset</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;dashboard-error&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Dashboard</span><span class="w"> </span><span class="ne">Error</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">dashboard</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}&gt;</span><span class="nx">Retry</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span><span class="nx">Back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// src/app/dashboard/products/error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsError</span><span class="p">({</span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reset</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-error&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Products</span><span class="w"> </span><span class="ne">Error</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">products</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}&gt;</span><span class="nx">Retry</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/dashboard&quot;</span><span class="p">&gt;</span><span class="nx">Back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Dashboard</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="when-to-apply-error-boundary-placement-strategy">When to Apply: Error Boundary Placement Strategy</h3>
<p><strong>Route-level error.tsx</strong>:
- What it optimizes for: Granular error handling, specific recovery options
- What it sacrifices: More files to maintain
- When to choose: For routes with specific error handling needs (e.g., payment pages, admin panels)
- When to avoid: For simple routes that can share parent error handling</p>
<p><strong>Layout-level error.tsx</strong>:
- What it optimizes for: Shared error handling across multiple routes
- What it sacrifices: Less specific error messages
- When to choose: For route groups with similar error handling needs
- When to avoid: When child routes need different error handling strategies</p>
<p><strong>Global error.tsx</strong>:
- What it optimizes for: Catastrophic failure recovery
- What it sacrifices: Rarely used, hard to test
- When to choose: Always include for production applications
- When to avoid: Never avoid‚Äîit's your last line of defense</p>
<p><strong>Component-level ErrorBoundary</strong>:
- What it optimizes for: Isolated component failures, widget-style UIs
- What it sacrifices: More boilerplate code
- When to choose: For independent components that can fail without affecting siblings
- When to avoid: For tightly coupled components where one failure should affect the group</p>
<h2 id="common-failure-modes-in-nextjs-error-handling">Common Failure Modes in Next.js Error Handling</h2>
<h3 id="symptom-errortsx-doesnt-catch-server-component-errors">Symptom: error.tsx doesn't catch Server Component errors</h3>
<p><strong>Browser behavior</strong>:
Generic Next.js error page appears instead of custom error.tsx</p>
<p><strong>Terminal pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>Error:<span class="w"> </span>Something<span class="w"> </span>went<span class="w"> </span>wrong
<span class="w">    </span>at<span class="w"> </span>ServerComponent<span class="w"> </span><span class="o">(</span>page.tsx:10<span class="o">)</span>

<span class="w"> </span>‚®Ø<span class="w"> </span>Error:<span class="w"> </span>Something<span class="w"> </span>went<span class="w"> </span>wrong
</code></pre></div>

<p><strong>DevTools clues</strong>:
- No custom error UI visible
- Page returns 500 status
- error.tsx file exists but isn't used</p>
<p><strong>Root cause</strong>: error.tsx file is not marked as a Client Component with <code>'use client'</code> directive.</p>
<p><strong>Solution</strong>: Always add <code>'use client'</code> at the top of error.tsx files:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// error.tsx must be a Client Component</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="ne">Error</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="ne">Error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="symptom-reset-function-doesnt-work">Symptom: Reset function doesn't work</h3>
<p><strong>Browser behavior</strong>:
Clicking "Try again" button does nothing</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">No</span><span class="w"> </span><span class="n">errors</span><span class="p">,</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="n">click</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">registered</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="n">happens</span><span class="p">)</span>
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Button onClick fires
- No state changes visible
- Page doesn't re-render</p>
<p><strong>Root cause</strong>: The reset function only works for errors that occurred during rendering. It doesn't refetch data or reset component state.</p>
<p><strong>Solution</strong>: For data fetching errors, use router.refresh() or implement custom retry logic:</p>
<div class="codehilite"><pre><span></span><code><span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useRouter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/navigation&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="ne">Error</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRouter</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="ne">Error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">reset</span><span class="p">();</span><span class="w"> </span><span class="c1">// Reset error boundary</span>
<span class="w">        </span><span class="nx">router</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span><span class="w"> </span><span class="c1">// Refetch server data</span>
<span class="w">      </span><span class="p">}}&gt;</span>
<span class="w">        </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="symptom-error-boundary-catches-error-but-page-is-blank">Symptom: Error boundary catches error but page is blank</h3>
<p><strong>Browser behavior</strong>:
Page is completely blank, no error UI visible</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Something</span><span class="w"> </span><span class="n">went</span><span class="w"> </span><span class="n">wrong</span>
<span class="o">(</span><span class="n">Error</span><span class="w"> </span><span class="n">boundary</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">caught</span><span class="w"> </span><span class="k">this</span><span class="o">)</span>
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Error boundary component is mounted
- Error state is set
- Fallback UI is not rendering</p>
<p><strong>Root cause</strong>: The error boundary's fallback UI itself has an error (e.g., trying to access undefined props).</p>
<p><strong>Solution</strong>: Keep fallback UI simple and defensive:</p>
<div class="codehilite"><pre><span></span><code><span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="ne">Error</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Defensive: handle case where error might be undefined</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">error</span><span class="o">?</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;An unknown error occurred&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-fallback&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="ne">Error</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">reset</span><span class="p">()}&gt;</span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="logging-and-monitoring-sentry">Logging and monitoring (Sentry)</h2>
<h2 id="the-failure-console-logs-dont-help-in-production">The Failure: Console Logs Don't Help in Production</h2>
<p><strong>Current limitation</strong>: We're logging errors to the console, which is fine for development but useless in production. When a user encounters an error, we have no way to know about it unless they report it.</p>
<p><strong>New scenario</strong>: A user encounters an error in production. They see the error UI and click "Try again," but the error persists. They give up and leave. We never know this happened.</p>
<h3 id="diagnostic-analysis-the-invisible-production-error">Diagnostic Analysis: The Invisible Production Error</h3>
<p><strong>Browser Behavior</strong>:
User sees error UI, tries to recover, fails, leaves the site.</p>
<p><strong>Browser Console Output</strong> (on user's machine):</p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="n">products</span><span class="o">:</span><span class="w"> </span><span class="mi">503</span>
<span class="n">Component</span><span class="w"> </span><span class="n">stack</span><span class="o">:</span><span class="w"> </span><span class="o">...</span>
</code></pre></div>

<p><strong>Our Monitoring Dashboard</strong>:
(Empty. We have no idea this error occurred.)</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Error is logged and developers are notified</li>
<li>
<p>Actual: Error happens silently, no one knows</p>
</li>
<li>
<p><strong>What we're missing</strong>:</p>
</li>
<li>Error frequency: How often does this happen?</li>
<li>User context: What browser, OS, user actions led to this?</li>
<li>Error patterns: Is this affecting all users or specific segments?</li>
<li>
<p>Stack traces: Where exactly is the error occurring?</p>
</li>
<li>
<p><strong>Root cause identified</strong>: 
   Console logs only exist on the user's machine. We need a centralized error tracking system that captures errors from all users and provides context for debugging.</p>
</li>
<li>
<p><strong>What we need</strong>:
   A production-grade error monitoring service like Sentry that:</p>
</li>
<li>Captures errors automatically</li>
<li>Provides rich context (browser, OS, user actions)</li>
<li>Aggregates errors and shows patterns</li>
<li>Alerts us when errors occur</li>
<li>Helps us reproduce and fix issues</li>
</ol>
<h2 id="setting-up-sentry">Setting Up Sentry</h2>
<p>Sentry is the industry standard for error monitoring in React/Next.js applications. Let's integrate it into our dashboard.</p>
<p>First, install the Sentry SDK:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>@sentry/nextjs
</code></pre></div>

<p>Initialize Sentry in your project:</p>
<div class="codehilite"><pre><span></span><code>npx<span class="w"> </span>@sentry/wizard@latest<span class="w"> </span>-i<span class="w"> </span>nextjs
</code></pre></div>

<p>This wizard creates three configuration files:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// sentry.client.config.ts</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@sentry/nextjs&quot;</span><span class="p">;</span>

<span class="nx">Sentry</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
<span class="w">  </span><span class="nx">dsn</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NEXT_PUBLIC_SENTRY_DSN</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Set tracesSampleRate to 1.0 to capture 100% of transactions for performance monitoring.</span>
<span class="w">  </span><span class="c1">// We recommend adjusting this value in production</span>
<span class="w">  </span><span class="nx">tracesSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">1.0</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Capture Replay for 10% of all sessions,</span>
<span class="w">  </span><span class="c1">// plus 100% of sessions with an error</span>
<span class="w">  </span><span class="nx">replaysSessionSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">0.1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">replaysOnErrorSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">1.0</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Note: if you want to override the automatic release value, do not set a</span>
<span class="w">  </span><span class="c1">// `release` value here - use the environment variable `SENTRY_RELEASE`, so</span>
<span class="w">  </span><span class="c1">// that it will also get attached to your source maps</span>

<span class="w">  </span><span class="nx">integrations</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">replayIntegration</span><span class="p">({</span>
<span class="w">      </span><span class="nx">maskAllText</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">blockAllMedia</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">  </span><span class="p">],</span>
<span class="p">});</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// sentry.server.config.ts</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@sentry/nextjs&quot;</span><span class="p">;</span>

<span class="nx">Sentry</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
<span class="w">  </span><span class="nx">dsn</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NEXT_PUBLIC_SENTRY_DSN</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Set tracesSampleRate to 1.0 to capture 100% of transactions for performance monitoring.</span>
<span class="w">  </span><span class="c1">// We recommend adjusting this value in production</span>
<span class="w">  </span><span class="nx">tracesSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">1.0</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Note: if you want to override the automatic release value, do not set a</span>
<span class="w">  </span><span class="c1">// `release` value here - use the environment variable `SENTRY_RELEASE`, so</span>
<span class="w">  </span><span class="c1">// that it will also get attached to your source maps</span>
<span class="p">});</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// sentry.edge.config.ts</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@sentry/nextjs&quot;</span><span class="p">;</span>

<span class="nx">Sentry</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
<span class="w">  </span><span class="nx">dsn</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NEXT_PUBLIC_SENTRY_DSN</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Set tracesSampleRate to 1.0 to capture 100% of transactions for performance monitoring.</span>
<span class="w">  </span><span class="c1">// We recommend adjusting this value in production</span>
<span class="w">  </span><span class="nx">tracesSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">1.0</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>

<p>Add your Sentry DSN to environment variables:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># .env.local</span>
<span class="nv">NEXT_PUBLIC_SENTRY_DSN</span><span class="o">=</span>https://your-dsn@sentry.io/your-project-id
</code></pre></div>

<p>Now let's update our error boundaries to send errors to Sentry:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ErrorBoundary.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Component</span><span class="p">,</span><span class="w"> </span><span class="nx">ReactNode</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Props</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="p">;</span>
<span class="w">  </span><span class="nx">fallback</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onError</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ErrorInfo</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">resetKeys?</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">number</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">Component</span><span class="p">&lt;</span><span class="nt">Props</span><span class="err">,</span><span class="w"> </span><span class="na">State</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">props</span><span class="o">:</span><span class="w"> </span><span class="kt">Props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">getDerivedStateFromError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">componentDidCatch</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ErrorInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Send error to Sentry with component stack</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">captureException</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">contexts</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">react</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">componentStack</span><span class="o">:</span><span class="w"> </span><span class="kt">errorInfo.componentStack</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Call custom error handler if provided</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">errorInfo</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">componentDidUpdate</span><span class="p">(</span><span class="nx">prevProps</span><span class="o">:</span><span class="w"> </span><span class="kt">Props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">hasError</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">resetKeys</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">prevKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prevProps</span><span class="p">.</span><span class="nx">resetKeys</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">resetKeys</span><span class="p">;</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentKeys</span><span class="p">.</span><span class="nx">some</span><span class="p">((</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">prevKeys</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hasChanged</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
<span class="w">      </span><span class="nx">hasError</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">hasError</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">fallback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">fallback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-boundary-fallback&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Something</span><span class="w"> </span><span class="nx">went</span><span class="w"> </span><span class="nx">wrong</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">}&gt;</span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Update Next.js error handlers to send errors to Sentry:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsError</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Send error to Sentry with additional context</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">captureException</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">section</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">errorBoundary</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;route-level&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">extra</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">digest</span><span class="o">:</span><span class="w"> </span><span class="kt">error.digest</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Load</span><span class="w"> </span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-message&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="nx">We</span><span class="w"> </span><span class="nx">couldn</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="nx">list</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">might</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">temporary</span><span class="w"> </span><span class="nx">issue</span><span class="p">.</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">details</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-details&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span><span class="nx">Technical</span><span class="w"> </span><span class="nx">details</span><span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">digest</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-digest&quot;</span><span class="p">&gt;</span><span class="ne">Error</span><span class="w"> </span><span class="nx">ID</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">digest</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">)}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-actions&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;btn-primary&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="na">href</span><span class="o">=</span><span class="s">&quot;/dashboard&quot;</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;btn-secondary&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Dashboard</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-sentry-integration">Verification: Sentry Integration</h3>
<p>Now when an error occurs:</p>
<p><strong>Browser Behavior</strong>:
Same as before‚Äîuser sees error UI and can retry.</p>
<p><strong>Sentry Dashboard</strong>:
- New error appears in Sentry dashboard
- Error includes full stack trace
- Component stack shows where error occurred
- Browser, OS, and user context captured
- Error digest/ID for correlation</p>
<p><strong>Sentry Error Details</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="n">products</span><span class="o">:</span><span class="w"> </span><span class="mi">503</span>

<span class="n">BREADCRUMBS</span><span class="o">:</span>
<span class="w">  </span><span class="n">Navigation</span><span class="o">:</span><span class="w"> </span><span class="sr">/dashboard ‚Üí /dashboard/</span><span class="n">products</span>
<span class="w">  </span><span class="n">XHR</span><span class="o">:</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="sr">/api/</span><span class="n">products</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="mi">503</span>

<span class="n">TAGS</span><span class="o">:</span>
<span class="w">  </span><span class="n">section</span><span class="o">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">  </span><span class="n">errorBoundary</span><span class="o">:</span><span class="w"> </span><span class="n">route</span><span class="o">-</span><span class="n">level</span>

<span class="n">CONTEXT</span><span class="o">:</span>
<span class="w">  </span><span class="n">Browser</span><span class="o">:</span><span class="w"> </span><span class="n">Chrome</span><span class="w"> </span><span class="mf">120.0</span><span class="o">.</span><span class="mi">0</span>
<span class="w">  </span><span class="n">OS</span><span class="o">:</span><span class="w"> </span><span class="n">macOS</span><span class="w"> </span><span class="mf">14.0</span>
<span class="w">  </span><span class="n">URL</span><span class="o">:</span><span class="w"> </span><span class="n">https</span><span class="o">://</span><span class="n">example</span><span class="o">.</span><span class="na">com</span><span class="sr">/dashboard/</span><span class="n">products</span>

<span class="n">STACK</span><span class="w"> </span><span class="n">TRACE</span><span class="o">:</span>
<span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">getProducts</span><span class="w"> </span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">tsx</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">)</span>
<span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">ProductsPage</span><span class="w"> </span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">tsx</span><span class="o">:</span><span class="mi">21</span><span class="o">:</span><span class="mi">23</span><span class="o">)</span>
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>:
- Before: Errors invisible in production, no way to track or debug
- After: All errors captured, rich context, aggregation and alerting
- Developer experience: Can proactively fix issues before users report them</p>
<h2 id="iteration-4-adding-user-context-and-custom-tags">Iteration 4: Adding User Context and Custom Tags</h2>
<p><strong>Current limitation</strong>: Sentry captures errors, but we don't know which user encountered the error or what they were doing.</p>
<p><strong>New scenario</strong>: We want to know which users are affected by errors and what actions they took before the error occurred.</p>
<p>Let's add user context and custom breadcrumbs:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/layout.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cookies</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/headers&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cookieStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookies</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookieStore</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth-token&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/user&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">RootLayout</span><span class="p">({</span>
<span class="w">  </span><span class="nx">children</span><span class="p">,</span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getUser</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Set user context in Sentry</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">setUser</span><span class="p">({</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">user.id</span><span class="p">,</span>
<span class="w">      </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">user.email</span><span class="p">,</span>
<span class="w">      </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">user.name</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">html</span><span class="w"> </span><span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">user</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">main</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Add custom breadcrumbs for user actions:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/page.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Add breadcrumb when page loads</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">addBreadcrumb</span><span class="p">({</span>
<span class="w">      </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;navigation&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User viewed products page&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFilterChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Add breadcrumb for user action</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">addBreadcrumb</span><span class="p">({</span>
<span class="w">      </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user-action&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`User changed filter to: </span><span class="si">${</span><span class="nx">filter</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">      </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Apply filter...</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleProductClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Add breadcrumb for user action</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">addBreadcrumb</span><span class="p">({</span>
<span class="w">      </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user-action&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`User clicked product: </span><span class="si">${</span><span class="nx">productId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">      </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">productId</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Navigate to product...</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* UI implementation */</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Add custom tags for better error categorization:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">categorizeError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;fatal&#39;</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;network&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;unauthorized&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;403&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;auth&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;500&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;503&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;server&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fatal&#39;</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsError</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">category</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">categorizeError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">captureException</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="kt">severity</span><span class="p">,</span>
<span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">section</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">errorBoundary</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;route-level&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">errorCategory</span><span class="o">:</span><span class="w"> </span><span class="kt">category</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">extra</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">digest</span><span class="o">:</span><span class="w"> </span><span class="kt">error.digest</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userAgent</span><span class="o">:</span><span class="w"> </span><span class="kt">navigator.userAgent</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;products-page&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">category</span><span class="p">,</span>
<span class="w">        </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* Error UI */</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-enhanced-error-context">Verification: Enhanced Error Context</h3>
<p>Now when an error occurs:</p>
<p><strong>Sentry Dashboard</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="n">products</span><span class="o">:</span><span class="w"> </span><span class="mi">503</span>

<span class="nl">USER</span><span class="p">:</span>
<span class="w">  </span><span class="nl">ID</span><span class="p">:</span><span class="w"> </span><span class="n">user_123</span>
<span class="w">  </span><span class="nl">Email</span><span class="p">:</span><span class="w"> </span><span class="n">john</span><span class="p">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="w">  </span><span class="nl">Username</span><span class="p">:</span><span class="w"> </span><span class="n">John</span><span class="w"> </span><span class="n">Doe</span>

<span class="nl">BREADCRUMBS</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span><span class="n">Navigation</span><span class="p">]</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">viewed</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="n">page</span>
<span class="w">  </span><span class="p">[</span><span class="n">User</span><span class="w"> </span><span class="n">Action</span><span class="p">]</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">to</span><span class="o">:</span><span class="w"> </span><span class="n">electronics</span>
<span class="w">  </span><span class="p">[</span><span class="n">User</span><span class="w"> </span><span class="n">Action</span><span class="p">]</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">clicked</span><span class="w"> </span><span class="n">product</span><span class="o">:</span><span class="w"> </span><span class="n">prod_456</span>
<span class="w">  </span><span class="p">[</span><span class="n">XHR</span><span class="p">]</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">products</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="mi">503</span>

<span class="nl">TAGS</span><span class="p">:</span>
<span class="w">  </span><span class="nl">section</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">  </span><span class="nl">errorBoundary</span><span class="p">:</span><span class="w"> </span><span class="n">route</span><span class="o">-</span><span class="n">level</span>
<span class="w">  </span><span class="nl">errorCategory</span><span class="p">:</span><span class="w"> </span><span class="n">server</span>

<span class="nl">EXTRA</span><span class="p">:</span>
<span class="w">  </span><span class="nl">digest</span><span class="p">:</span><span class="w"> </span><span class="n">abc123</span>
<span class="w">  </span><span class="nl">userAgent</span><span class="p">:</span><span class="w"> </span><span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span><span class="p">...</span>
<span class="w">  </span><span class="nl">timestamp</span><span class="p">:</span><span class="w"> </span><span class="mi">2024</span><span class="mo">-01</span><span class="mi">-15</span><span class="n">T10</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mo">00</span><span class="n">Z</span>

<span class="nl">FINGERPRINT</span><span class="p">:</span>
<span class="w">  </span><span class="n">products</span><span class="o">-</span><span class="n">page</span>
<span class="w">  </span><span class="n">server</span>
<span class="w">  </span><span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="n">products</span><span class="o">:</span><span class="w"> </span><span class="mi">503</span>
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>:
- Before: Error captured but no user context
- After: Full user journey, categorized errors, custom metadata
- Developer experience: Can reproduce issues and understand user impact</p>
<h2 id="iteration-5-performance-monitoring-and-alerts">Iteration 5: Performance Monitoring and Alerts</h2>
<p><strong>Current limitation</strong>: We're capturing errors, but we don't know about performance issues or when errors spike.</p>
<p><strong>New scenario</strong>: We want to monitor performance metrics and get alerted when error rates increase.</p>
<p>Configure Sentry performance monitoring:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// sentry.client.config.ts</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@sentry/nextjs&quot;</span><span class="p">;</span>

<span class="nx">Sentry</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
<span class="w">  </span><span class="nx">dsn</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NEXT_PUBLIC_SENTRY_DSN</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Performance monitoring</span>
<span class="w">  </span><span class="nx">tracesSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">0.1</span><span class="p">,</span><span class="w"> </span><span class="c1">// Sample 10% of transactions in production</span>

<span class="w">  </span><span class="c1">// Session replay</span>
<span class="w">  </span><span class="nx">replaysSessionSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">0.1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">replaysOnErrorSampleRate</span><span class="o">:</span><span class="w"> </span><span class="kt">1.0</span><span class="p">,</span>

<span class="w">  </span><span class="nx">integrations</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">replayIntegration</span><span class="p">({</span>
<span class="w">      </span><span class="nx">maskAllText</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">blockAllMedia</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">browserTracingIntegration</span><span class="p">({</span>
<span class="w">      </span><span class="c1">// Track navigation and page loads</span>
<span class="w">      </span><span class="nx">tracingOrigins</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="sr">/^\//</span><span class="p">],</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">  </span><span class="p">],</span>

<span class="w">  </span><span class="c1">// Filter out noise</span>
<span class="w">  </span><span class="nx">beforeSend</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">hint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Don&#39;t send errors from browser extensions</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">exception</span><span class="o">?</span><span class="p">.</span><span class="nx">values</span><span class="o">?</span><span class="p">.[</span><span class="mf">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">stacktrace</span><span class="o">?</span><span class="p">.</span><span class="nx">frames</span><span class="o">?</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span>
<span class="w">      </span><span class="nx">frame</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">frame</span><span class="p">.</span><span class="nx">filename</span><span class="o">?</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;chrome-extension://&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Don&#39;t send network errors for known flaky endpoints</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">message</span><span class="o">?</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">        </span><span class="nx">event</span><span class="p">.</span><span class="nx">tags</span><span class="o">?</span><span class="p">.</span><span class="nx">endpoint</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;analytics&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">event</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// Environment-specific configuration</span>
<span class="w">  </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NODE_ENV</span><span class="p">,</span>
<span class="w">  </span><span class="nx">release</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>

<p>Add custom performance tracking:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/page.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Start performance transaction</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">startTransaction</span><span class="p">({</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Products Page Load&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">op</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;page-load&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Track data fetching</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fetchSpan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transaction</span><span class="p">.</span><span class="nx">startChild</span><span class="p">({</span>
<span class="w">      </span><span class="nx">op</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http.client&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Fetch products&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/products&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fetchSpan</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Track rendering</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">renderSpan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transaction</span><span class="p">.</span><span class="nx">startChild</span><span class="p">({</span>
<span class="w">          </span><span class="nx">op</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;react.render&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Render products list&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Simulate render time</span>
<span class="w">        </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">renderSpan</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="w">          </span><span class="nx">transaction</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fetchSpan</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="w">        </span><span class="nx">transaction</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-page&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="cm">/* UI implementation */</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Configure Sentry alerts in the Sentry dashboard:</p>
<ol>
<li><strong>Error Rate Alert</strong>:</li>
<li>Condition: Error rate &gt; 5% of sessions</li>
<li>Action: Email team, post to Slack</li>
<li>
<p>Frequency: Maximum once per hour</p>
</li>
<li>
<p><strong>New Error Alert</strong>:</p>
</li>
<li>Condition: First occurrence of new error</li>
<li>Action: Email on-call engineer</li>
<li>
<p>Frequency: Immediate</p>
</li>
<li>
<p><strong>Performance Alert</strong>:</p>
</li>
<li>Condition: P95 page load time &gt; 3 seconds</li>
<li>Action: Post to Slack #performance channel</li>
<li>Frequency: Daily digest</li>
</ol>
<h3 id="verification-complete-monitoring-setup">Verification: Complete Monitoring Setup</h3>
<p><strong>Sentry Dashboard Features</strong>:
- Error tracking with full context
- Performance monitoring (page loads, API calls)
- Session replay (watch user sessions that had errors)
- Release tracking (correlate errors with deployments)
- Alerts (get notified when things go wrong)</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Reactive debugging after user reports
- After: Proactive monitoring and alerting
- Developer experience: Fix issues before they impact many users</p>
<h2 id="when-to-apply-error-monitoring-strategy">When to Apply: Error Monitoring Strategy</h2>
<p><strong>Sentry (or similar service)</strong>:
- What it optimizes for: Production error visibility, user impact analysis
- What it sacrifices: Additional service cost, some performance overhead
- When to choose: Always for production applications
- When to avoid: Never avoid‚Äîit's essential for production</p>
<p><strong>Error sampling rate</strong>:
- What it optimizes for: Cost reduction, performance
- What it sacrifices: Some errors might not be captured
- When to choose: High-traffic applications (sample 10-20%)
- When to avoid: Low-traffic applications (sample 100%)</p>
<p><strong>Session replay</strong>:
- What it optimizes for: Understanding user context
- What it sacrifices: Privacy concerns, bandwidth
- When to choose: Complex UIs where user actions matter
- When to avoid: Privacy-sensitive applications, high-traffic sites</p>
<p><strong>Performance monitoring</strong>:
- What it optimizes for: Identifying slow pages and API calls
- What it sacrifices: Additional overhead, cost
- When to choose: User-facing applications where performance matters
- When to avoid: Internal tools with low traffic</p>
<h2 id="common-failure-modes-in-error-monitoring">Common Failure Modes in Error Monitoring</h2>
<h3 id="symptom-errors-not-appearing-in-sentry">Symptom: Errors not appearing in Sentry</h3>
<p><strong>Browser behavior</strong>:
Errors occur and are logged to console, but don't appear in Sentry dashboard.</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Something</span><span class="w"> </span><span class="n">went</span><span class="w"> </span><span class="n">wrong</span>
<span class="o">(</span><span class="n">No</span><span class="w"> </span><span class="n">Sentry</span><span class="o">-</span><span class="n">related</span><span class="w"> </span><span class="n">logs</span><span class="o">)</span>
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Network tab shows no requests to Sentry
- Sentry SDK might not be initialized
- DSN might be missing or incorrect</p>
<p><strong>Root cause</strong>: Sentry not properly initialized or DSN not configured.</p>
<p><strong>Solution</strong>: Verify Sentry initialization and environment variables:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check environment variables</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$NEXT_PUBLIC_SENTRY_DSN</span>

<span class="c1"># Verify Sentry is initialized</span>
<span class="c1"># Add this to your app to test:</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// Test Sentry initialization</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>

<span class="c1">// This should send a test error to Sentry</span>
<span class="nx">Sentry</span><span class="p">.</span><span class="nx">captureMessage</span><span class="p">(</span><span class="s1">&#39;Test message from app&#39;</span><span class="p">);</span>
</code></pre></div>

<h3 id="symptom-too-many-errors-flooding-sentry">Symptom: Too many errors flooding Sentry</h3>
<p><strong>Sentry Dashboard</strong>:
Thousands of identical errors, quota exceeded warnings.</p>
<p><strong>Root cause</strong>: Error loop or missing error deduplication.</p>
<p><strong>Solution</strong>: Implement error fingerprinting and rate limiting:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// sentry.client.config.ts</span>
<span class="nx">Sentry</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
<span class="w">  </span><span class="nx">dsn</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NEXT_PUBLIC_SENTRY_DSN</span><span class="p">,</span>

<span class="w">  </span><span class="nx">beforeSend</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">hint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Deduplicate errors by fingerprint</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">exception</span><span class="o">?</span><span class="p">.</span><span class="nx">values</span><span class="o">?</span><span class="p">.[</span><span class="mf">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">exception</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">      </span><span class="nx">event</span><span class="p">.</span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="nx">error</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Error&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">error</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="c1">// Include first frame of stack trace for uniqueness</span>
<span class="w">        </span><span class="nx">error</span><span class="p">.</span><span class="nx">stacktrace</span><span class="o">?</span><span class="p">.</span><span class="nx">frames</span><span class="o">?</span><span class="p">.[</span><span class="mf">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">filename</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">event</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// Rate limit errors</span>
<span class="w">  </span><span class="nx">maxBreadcrumbs</span><span class="o">:</span><span class="w"> </span><span class="kt">50</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// Filter out known noisy errors</span>
<span class="w">  </span><span class="nx">ignoreErrors</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;ResizeObserver loop limit exceeded&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Non-Error promise rejection captured&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">],</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="symptom-sensitive-data-leaked-to-sentry">Symptom: Sensitive data leaked to Sentry</h3>
<p><strong>Sentry Dashboard</strong>:
Error context includes passwords, API keys, or PII.</p>
<p><strong>Root cause</strong>: Not scrubbing sensitive data before sending to Sentry.</p>
<p><strong>Solution</strong>: Implement data scrubbing:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// sentry.client.config.ts</span>
<span class="nx">Sentry</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
<span class="w">  </span><span class="nx">dsn</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.NEXT_PUBLIC_SENTRY_DSN</span><span class="p">,</span>

<span class="w">  </span><span class="nx">beforeSend</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">hint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Remove sensitive data from event</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="o">?</span><span class="p">.</span><span class="nx">headers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="ow">delete</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">];</span>
<span class="w">      </span><span class="ow">delete</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Cookie&#39;</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Scrub sensitive data from extra context</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">extra</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">extra</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="nx">key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="nx">key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">event</span><span class="p">.</span><span class="nx">extra</span><span class="o">!</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;[Filtered]&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">event</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// Use session replay with masking</span>
<span class="w">  </span><span class="nx">integrations</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">replayIntegration</span><span class="p">({</span>
<span class="w">      </span><span class="nx">maskAllText</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">maskAllInputs</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">blockAllMedia</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">  </span><span class="p">],</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="user-friendly-error-states">User-friendly error states</h2>
<h2 id="the-failure-technical-error-messages-confuse-users">The Failure: Technical Error Messages Confuse Users</h2>
<p><strong>Current limitation</strong>: Our error messages are developer-focused. They show technical details that confuse non-technical users and don't provide clear guidance on what to do next.</p>
<p><strong>New scenario</strong>: A user encounters a network error. They see "Failed to fetch products: 503" and don't know what that means or what to do about it.</p>
<h3 id="diagnostic-analysis-poor-error-ux">Diagnostic Analysis: Poor Error UX</h3>
<p><strong>Browser Behavior</strong>:
User sees technical error message: "Failed to fetch products: 503"</p>
<p><strong>User's Mental Model</strong>:
- "What's a 503?"
- "Is this my fault?"
- "Should I wait or try again?"
- "Is my data safe?"</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Clear explanation of what went wrong and what to do</li>
<li>
<p>Actual: Technical jargon, no actionable guidance</p>
</li>
<li>
<p><strong>What's missing</strong>:</p>
</li>
<li>Plain language explanation</li>
<li>Clear next steps</li>
<li>Indication of severity (temporary vs. permanent)</li>
<li>
<p>Reassurance about data safety</p>
</li>
<li>
<p><strong>Root cause identified</strong>: 
   We're showing raw error messages meant for developers, not user-friendly explanations.</p>
</li>
<li>
<p><strong>What we need</strong>:
   A system for translating technical errors into user-friendly messages with clear guidance.</p>
</li>
</ol>
<h2 id="creating-user-friendly-error-messages">Creating User-Friendly Error Messages</h2>
<p>Let's build a comprehensive error message system:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/lib/errors/errorMessages.ts</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">canRetry</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">showTechnicalDetails</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Network errors</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;failed to fetch&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Connection Problem&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;We&#39;</span><span class="nx">re</span><span class="w"> </span><span class="nx">having</span><span class="w"> </span><span class="nx">trouble</span><span class="w"> </span><span class="nx">connecting</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">servers</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">usually</span><span class="w"> </span><span class="nx">temporary</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      action: &#39;</span><span class="nx">Check</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">internet</span><span class="w"> </span><span class="nx">connection</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">moment</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      severity: &#39;</span><span class="nx">warning</span><span class="s1">&#39;,</span>
<span class="s1">      canRetry: true,</span>
<span class="s1">      showTechnicalDetails: false,</span>
<span class="s1">    };</span>
<span class="s1">  }</span>

<span class="s1">  // Timeout errors</span>
<span class="s1">  if (message.includes(&#39;</span><span class="nx">timeout</span><span class="s1">&#39;)) {</span>
<span class="s1">    return {</span>
<span class="s1">      title: &#39;</span><span class="nx">Request</span><span class="w"> </span><span class="nx">Timed</span><span class="w"> </span><span class="nx">Out</span><span class="s1">&#39;,</span>
<span class="s1">      description: &#39;</span><span class="nx">The</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="nx">took</span><span class="w"> </span><span class="nx">too</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">complete</span><span class="p">.</span><span class="w"> </span><span class="nx">Our</span><span class="w"> </span><span class="nx">servers</span><span class="w"> </span><span class="nx">might</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">busy</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      action: &#39;</span><span class="nx">Please</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="p">.</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">keeps</span><span class="w"> </span><span class="nx">happening</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="w"> </span><span class="nx">later</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      severity: &#39;</span><span class="nx">warning</span><span class="s1">&#39;,</span>
<span class="s1">      canRetry: true,</span>
<span class="s1">      showTechnicalDetails: false,</span>
<span class="s1">    };</span>
<span class="s1">  }</span>

<span class="s1">  // Server errors (5xx)</span>
<span class="s1">  if (message.includes(&#39;</span><span class="mf">500</span><span class="s1">&#39;) || message.includes(&#39;</span><span class="mf">503</span><span class="s1">&#39;) || message.includes(&#39;</span><span class="mf">502</span><span class="s1">&#39;)) {</span>
<span class="s1">    return {</span>
<span class="s1">      title: &#39;</span><span class="nx">Server</span><span class="w"> </span><span class="ne">Error</span><span class="s1">&#39;,</span>
<span class="s1">      description: &#39;</span><span class="nx">Our</span><span class="w"> </span><span class="nx">servers</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">experiencing</span><span class="w"> </span><span class="nx">issues</span><span class="p">.</span><span class="w"> </span><span class="nx">We</span><span class="s1">&#39;ve been notified and are working on it.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Please try again in a few minutes.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">canRetry</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">showTechnicalDetails</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Authentication errors</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;unauthorized&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;401&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;403&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Access Denied&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;You don&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">permission</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">session</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">expired</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      action: &#39;</span><span class="nx">Please</span><span class="w"> </span><span class="nx">sign</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">again</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      severity: &#39;</span><span class="nx">warning</span><span class="s1">&#39;,</span>
<span class="s1">      canRetry: false,</span>
<span class="s1">      showTechnicalDetails: false,</span>
<span class="s1">    };</span>
<span class="s1">  }</span>

<span class="s1">  // Not found errors</span>
<span class="s1">  if (message.includes(&#39;</span><span class="mf">404</span><span class="s1">&#39;) || message.includes(&#39;</span><span class="nx">not</span><span class="w"> </span><span class="nx">found</span><span class="s1">&#39;)) {</span>
<span class="s1">    return {</span>
<span class="s1">      title: &#39;</span><span class="nx">Content</span><span class="w"> </span><span class="nx">Not</span><span class="w"> </span><span class="nx">Found</span><span class="s1">&#39;,</span>
<span class="s1">      description: &#39;</span><span class="nx">The</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="nx">you</span><span class="s1">&#39;re looking for doesn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">exist</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">moved</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      action: &#39;</span><span class="nx">Check</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">URL</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">go</span><span class="w"> </span><span class="nx">back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">previous</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      severity: &#39;</span><span class="nx">info</span><span class="s1">&#39;,</span>
<span class="s1">      canRetry: false,</span>
<span class="s1">      showTechnicalDetails: false,</span>
<span class="s1">    };</span>
<span class="s1">  }</span>

<span class="s1">  // Validation errors</span>
<span class="s1">  if (message.includes(&#39;</span><span class="nx">validation</span><span class="s1">&#39;) || message.includes(&#39;</span><span class="nx">invalid</span><span class="s1">&#39;)) {</span>
<span class="s1">    return {</span>
<span class="s1">      title: &#39;</span><span class="nx">Invalid</span><span class="w"> </span><span class="nx">Input</span><span class="s1">&#39;,</span>
<span class="s1">      description: &#39;</span><span class="nx">Some</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">information</span><span class="w"> </span><span class="nx">provided</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">incorrect</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">incomplete</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      action: &#39;</span><span class="nx">Please</span><span class="w"> </span><span class="nx">check</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      severity: &#39;</span><span class="nx">warning</span><span class="s1">&#39;,</span>
<span class="s1">      canRetry: true,</span>
<span class="s1">      showTechnicalDetails: false,</span>
<span class="s1">    };</span>
<span class="s1">  }</span>

<span class="s1">  // Rate limiting</span>
<span class="s1">  if (message.includes(&#39;</span><span class="nx">rate</span><span class="w"> </span><span class="nx">limit</span><span class="s1">&#39;) || message.includes(&#39;</span><span class="nx">too</span><span class="w"> </span><span class="nx">many</span><span class="w"> </span><span class="nx">requests</span><span class="s1">&#39;)) {</span>
<span class="s1">    return {</span>
<span class="s1">      title: &#39;</span><span class="nx">Too</span><span class="w"> </span><span class="nx">Many</span><span class="w"> </span><span class="nx">Requests</span><span class="s1">&#39;,</span>
<span class="s1">      description: &#39;</span><span class="nx">You</span><span class="s1">&#39;ve made too many requests in a short time.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Please wait a moment before trying again.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">canRetry</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">showTechnicalDetails</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Default for unknown errors</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Something Went Wrong&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;An unexpected error occurred. We&#39;</span><span class="nx">ve</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">notified</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">look</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">    action: &#39;</span><span class="nx">Please</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="p">.</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">problem</span><span class="w"> </span><span class="nx">persists</span><span class="p">,</span><span class="w"> </span><span class="nx">contact</span><span class="w"> </span><span class="nx">support</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">    severity: &#39;</span><span class="nx">error</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">canRetry</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">showTechnicalDetails</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's create a reusable error display component:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ErrorDisplay.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">,</span><span class="w"> </span><span class="nx">ErrorMessage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/errors/errorMessages&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorDisplayProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onRetry</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onDismiss</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">className?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ErrorDisplay</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onRetry</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onDismiss</span><span class="p">,</span>
<span class="w">  </span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorDisplayProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">showDetails</span><span class="p">,</span><span class="w"> </span><span class="nx">setShowDetails</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">severityStyles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-blue-50 border-blue-200 text-blue-900&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">warning</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-yellow-50 border-yellow-200 text-yellow-900&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-red-50 border-red-200 text-red-900&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">critical</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-red-100 border-red-300 text-red-950&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">severityIcons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ÑπÔ∏è&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">warning</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ö†Ô∏è&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ùå&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">critical</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üö®&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span>
<span class="w">      </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="sb">`error-display border-2 rounded-lg p-6 </span><span class="si">${</span><span class="nx">severityStyles</span><span class="p">[</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">severity</span><span class="p">]</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">className</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">      </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span>
<span class="w">      </span><span class="na">aria-live</span><span class="o">=</span><span class="s">&quot;assertive&quot;</span>
<span class="w">    </span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex items-start gap-4&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl&quot;</span><span class="w"> </span><span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">severityIcons</span><span class="p">[</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">severity</span><span class="p">]}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex-1&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-lg font-semibold mb-2&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm font-medium mb-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">action</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">showTechnicalDetails</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">details</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">summary</span><span class="w"> </span>
<span class="w">                </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;cursor-pointer text-sm font-medium hover:underline&quot;</span>
<span class="w">                </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setShowDetails</span><span class="p">(</span><span class="o">!</span><span class="nx">showDetails</span><span class="p">)}</span>
<span class="w">              </span><span class="p">&gt;</span>
<span class="w">                </span><span class="p">{</span><span class="nx">showDetails</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Hide&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Show&#39;</span><span class="p">}</span><span class="w"> </span><span class="nx">technical</span><span class="w"> </span><span class="nx">details</span>
<span class="w">              </span><span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mt-2 p-3 bg-white bg-opacity-50 rounded border&quot;</span><span class="p">&gt;</span>

<span class="w">                  </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span>
</code></pre></div>

<p>Update our error boundaries to use the new error display:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/error.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useRouter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;next/navigation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/nextjs&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorDisplay</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/ErrorDisplay&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">digest?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nx">reset</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsError</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRouter</span><span class="p">();</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">captureException</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">section</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">errorBoundary</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;route-level&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">extra</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">digest</span><span class="o">:</span><span class="w"> </span><span class="kt">error.digest</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleRetry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">reset</span><span class="p">();</span>
<span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDismiss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/dashboard&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-error-page p-6&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">ErrorDisplay</span>
<span class="w">        </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span>
<span class="w">        </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">handleRetry</span><span class="p">}</span>
<span class="w">        </span><span class="na">onDismiss</span><span class="o">=</span><span class="p">{</span><span class="nx">handleDismiss</span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-user-friendly-error-messages">Verification: User-Friendly Error Messages</h3>
<p>Now when a network error occurs:</p>
<p><strong>Browser Behavior</strong>:
- User sees: "Connection Problem"
- Description: "We're having trouble connecting to our servers. This is usually temporary."
- Action: "Check your internet connection and try again in a moment."
- Clear "Try Again" button
- Technical details hidden by default</p>
<p><strong>User's Mental Model</strong>:
- "Oh, it's a connection issue"
- "It's probably temporary"
- "I should check my internet"
- "I can try again"</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: "Failed to fetch products: 503" (confusing)
- After: Clear explanation, actionable guidance, appropriate severity
- User experience: Reduced confusion, clear next steps, maintained trust</p>
<h2 id="iteration-6-contextual-error-states">Iteration 6: Contextual Error States</h2>
<p><strong>Current limitation</strong>: All errors show the same generic error display, regardless of where they occur or what the user was doing.</p>
<p><strong>New scenario</strong>: We want different error presentations for different contexts: inline errors for form fields, toast notifications for background operations, full-page errors for critical failures.</p>
<p>Let's create context-aware error components:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/errors/InlineError.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/errors/errorMessages&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">InlineErrorProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onRetry</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">compact?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">InlineError</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">onRetry</span><span class="p">,</span><span class="w"> </span><span class="nx">compact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">InlineErrorProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">compact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;inline-error-compact flex items-center gap-2 text-sm text-red-600&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="err">‚ùå</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">onRetry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">canRetry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onRetry</span><span class="p">}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-xs underline hover:no-underline&quot;</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Retry</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;inline-error bg-red-50 border border-red-200 rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex items-start gap-3&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-xl&quot;</span><span class="p">&gt;</span><span class="err">‚ùå</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex-1&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;font-medium text-red-900&quot;</span><span class="p">&gt;{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-red-700 mt-1&quot;</span><span class="p">&gt;{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">onRetry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">canRetry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">              </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onRetry</span><span class="p">}</span>
<span class="w">              </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mt-2 text-sm font-medium text-red-900 underline hover:no-underline&quot;</span>
<span class="w">            </span><span class="p">&gt;</span>
<span class="w">              </span><span class="nx">Try</span><span class="w"> </span><span class="nx">again</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">)}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/errors/ToastError.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/errors/errorMessages&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ToastErrorProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onDismiss</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">duration?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ToastError</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">onDismiss</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ToastErrorProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isVisible</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsVisible</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setIsVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">onDismiss</span><span class="p">,</span><span class="w"> </span><span class="mf">300</span><span class="p">);</span><span class="w"> </span><span class="c1">// Wait for fade out animation</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="nx">duration</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">duration</span><span class="p">,</span><span class="w"> </span><span class="nx">onDismiss</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isVisible</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span>
<span class="w">      </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="sb">`toast-error fixed bottom-4 right-4 max-w-md bg-white border-2 border-red-200 rounded-lg shadow-lg p-4 transition-opacity duration-300 </span><span class="si">${</span><span class="nx">isVisible</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;opacity-100&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;opacity-0&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">      </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span>
<span class="w">      </span><span class="na">aria-live</span><span class="o">=</span><span class="s">&quot;polite&quot;</span>
<span class="w">    </span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex items-start gap-3&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-xl&quot;</span><span class="p">&gt;</span><span class="err">‚ùå</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex-1&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;font-semibold text-gray-900&quot;</span><span class="p">&gt;{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">title</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-600 mt-1&quot;</span><span class="p">&gt;{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">setIsVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">onDismiss</span><span class="p">,</span><span class="w"> </span><span class="mf">300</span><span class="p">);</span>
<span class="w">          </span><span class="p">}}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-400 hover:text-gray-600&quot;</span>
<span class="w">          </span><span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Dismiss&quot;</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="err">‚úï</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/errors/EmptyState.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/errors/errorMessages&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">EmptyStateProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onRetry</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">illustration?</span><span class="o">:</span><span class="w"> </span><span class="kt">React.ReactNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">EmptyState</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">onRetry</span><span class="p">,</span><span class="w"> </span><span class="nx">illustration</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">EmptyStateProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;empty-state flex flex-col items-center justify-center min-h-[400px] p-8 text-center&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">illustration</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-6xl mb-4&quot;</span><span class="w"> </span><span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="err">üì≠</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-semibold text-gray-900 mb-2&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600 max-w-md mb-2&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-500 mb-6&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">action</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">onRetry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">canRetry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onRetry</span><span class="p">}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors&quot;</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="nx">Try</span><span class="w"> </span><span class="nx">Again</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's use these contextual error components in different scenarios:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/app/dashboard/products/page.tsx</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">InlineError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/errors/InlineError&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ToastError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/errors/ToastError&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EmptyState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/components/errors/EmptyState&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductsPage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">products</span><span class="p">,</span><span class="w"> </span><span class="nx">setProducts</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Product</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">setLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Error</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">toastError</span><span class="p">,</span><span class="w"> </span><span class="nx">setToastError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Error</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fetchProducts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/products&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to fetch products: </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="nx">setProducts</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="ne">Error</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetchProducts</span><span class="p">();</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/products/</span><span class="si">${</span><span class="nx">productId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to delete product&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">setProducts</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">productId</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Show toast for background operation errors</span>
<span class="w">      </span><span class="nx">setToastError</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="ne">Error</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;p-6&quot;</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">products</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Full-page error for critical failures</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">products</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;p-6&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span>
<span class="w">          </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span>
<span class="w">          </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchProducts</span><span class="p">}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-page p-6&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex items-center justify-between mb-6&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h1</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl font-bold&quot;</span><span class="p">&gt;</span><span class="nx">Products</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;px-4 py-2 bg-blue-600 text-white rounded&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="nx">Add</span><span class="w"> </span><span class="nx">Product</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Inline error for non-critical failures */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">products</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">InlineError</span>
<span class="w">          </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span>
<span class="w">          </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchProducts</span><span class="p">}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)}</span>

<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;products-grid grid grid-cols-3 gap-4 mt-4&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;product-card border rounded p-4&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;font-semibold&quot;</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-gray-600&quot;</span><span class="p">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm text-gray-500&quot;</span><span class="p">&gt;</span><span class="nx">Stock</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">stock</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">button</span>
<span class="w">              </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">handleDelete</span><span class="p">(</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span>
<span class="w">              </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mt-2 text-sm text-red-600 hover:underline&quot;</span>
<span class="w">            </span><span class="p">&gt;</span>
<span class="w">              </span><span class="nx">Delete</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Toast for background operation errors */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">toastError</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ToastError</span>
<span class="w">          </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">toastError</span><span class="p">}</span>
<span class="w">          </span><span class="na">onDismiss</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setToastError</span><span class="p">(</span><span class="kc">null</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-contextual-error-states">Verification: Contextual Error States</h3>
<p><strong>Scenario 1: Initial load fails</strong>
- User sees: Empty state with illustration
- Message: User-friendly explanation
- Action: Large "Try Again" button</p>
<p><strong>Scenario 2: Refresh fails but data exists</strong>
- User sees: Inline error banner at top
- Message: Brief error message
- Action: Small "Retry" link
- Products: Still visible below</p>
<p><strong>Scenario 3: Delete operation fails</strong>
- User sees: Toast notification in bottom-right
- Message: Brief error message
- Action: Auto-dismisses after 5 seconds
- Products: Remain unchanged</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Same error display for all contexts
- After: Appropriate error presentation based on context and severity
- User experience: Less disruptive, more contextually appropriate</p>
<h2 id="iteration-7-accessibility-and-internationalization">Iteration 7: Accessibility and Internationalization</h2>
<p><strong>Current limitation</strong>: Our error messages aren't accessible to screen reader users and only support English.</p>
<p><strong>New scenario</strong>: We want our error handling to be accessible and support multiple languages.</p>
<p>Let's add accessibility features:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ErrorDisplay.tsx (updated)</span>
<span class="s1">&#39;use client&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/lib/errors/errorMessages&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorDisplayProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onRetry</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onDismiss</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">className?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ErrorDisplay</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onRetry</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onDismiss</span><span class="p">,</span>
<span class="w">  </span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorDisplayProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">showDetails</span><span class="p">,</span><span class="w"> </span><span class="nx">setShowDetails</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">retryButtonRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">HTMLButtonElement</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Focus retry button when error appears</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">canRetry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">retryButtonRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">retryButtonRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">canRetry</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">severityStyles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-blue-50 border-blue-200 text-blue-900&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">warning</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-yellow-50 border-yellow-200 text-yellow-900&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-red-50 border-red-200 text-red-900&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">critical</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bg-red-100 border-red-300 text-red-950&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">severityIcons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ÑπÔ∏è&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">warning</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ö†Ô∏è&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ùå&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">critical</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üö®&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">severityLabels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Information&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">warning</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Warning&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Error&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">critical</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Critical Error&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span>
<span class="w">      </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="sb">`error-display border-2 rounded-lg p-6 </span><span class="si">${</span><span class="nx">severityStyles</span><span class="p">[</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">severity</span><span class="p">]</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">className</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">      </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span>
<span class="w">      </span><span class="na">aria-live</span><span class="o">=</span><span class="s">&quot;assertive&quot;</span>
<span class="w">      </span><span class="na">aria-atomic</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
<span class="w">    </span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex items-start gap-4&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-2xl&quot;</span><span class="w"> </span>
<span class="w">          </span><span class="na">aria-label</span><span class="o">=</span><span class="p">{</span><span class="nx">severityLabels</span><span class="p">[</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">severity</span><span class="p">]}</span>
<span class="w">          </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;img&quot;</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">severityIcons</span><span class="p">[</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">severity</span><span class="p">]}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>

<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;flex-1&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h2</span><span class="w"> </span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-lg font-semibold mb-2&quot;</span>
<span class="w">            </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;error-title&quot;</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span>
<span class="w">            </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;error-description&quot;</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;text-sm font-medium mb-4&quot;</span>
<span class="w">            </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;error-action&quot;</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">action</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">          </span><span class="p">{</span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">showTechnicalDetails</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">details</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">summary</span><span class="w"> </span>
<span class="w">                </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;cursor-pointer text-sm font-medium hover:underline&quot;</span>
<span class="w">                </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setShowDetails</span><span class="p">(</span><span class="o">!</span><span class="nx">showDetails</span><span class="p">)}</span>
<span class="w">                </span><span class="na">aria-expanded</span><span class="o">=</span><span class="p">{</span><span class="nx">showDetails</span><span class="p">}</span>
<span class="w">                </span><span class="na">aria-controls</span><span class="o">=</span><span class="s">&quot;technical-details&quot;</span>
<span class="w">              </span><span class="p">&gt;</span>
<span class="w">                </span><span class="p">{</span><span class="nx">showDetails</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Hide&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Show&#39;</span><span class="p">}</span><span class="w"> </span><span class="nx">technical</span><span class="w"> </span><span class="nx">details</span>
<span class="w">              </span><span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span>
<span class="w">                </span><span class="na">id</span><span class="o">=</span><span class="s">&quot;technical-details&quot;</span>
<span class="w">                </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;mt-2 p-3 bg-white bg-opacity-50 rounded border&quot;</span>
<span class="w">                </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;region&quot;</span>
<span class="w">                </span><span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Technical error details&quot;</span>
<span class="w">              </span><span class="p">&gt;</span>

<span class="w">                  </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span>
</code></pre></div>

<p>Add internationalization support:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/lib/errors/errorMessages.ts (updated)</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">canRetry</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">showTechnicalDetails</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorTranslations</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">translations</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">locale</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorTranslations</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">en</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">network</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Connection Problem&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;We&#39;</span><span class="nx">re</span><span class="w"> </span><span class="nx">having</span><span class="w"> </span><span class="nx">trouble</span><span class="w"> </span><span class="nx">connecting</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">servers</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">usually</span><span class="w"> </span><span class="nx">temporary</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      action: &#39;</span><span class="nx">Check</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">internet</span><span class="w"> </span><span class="nx">connection</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">moment</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">    },</span>
<span class="s1">    timeout: {</span>
<span class="s1">      title: &#39;</span><span class="nx">Request</span><span class="w"> </span><span class="nx">Timed</span><span class="w"> </span><span class="nx">Out</span><span class="s1">&#39;,</span>
<span class="s1">      description: &#39;</span><span class="nx">The</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="nx">took</span><span class="w"> </span><span class="nx">too</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">complete</span><span class="p">.</span><span class="w"> </span><span class="nx">Our</span><span class="w"> </span><span class="nx">servers</span><span class="w"> </span><span class="nx">might</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">busy</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">      action: &#39;</span><span class="nx">Please</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="p">.</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">keeps</span><span class="w"> </span><span class="nx">happening</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">again</span><span class="w"> </span><span class="nx">later</span><span class="p">.</span><span class="s1">&#39;,</span>
<span class="s1">    },</span>
<span class="s1">    server: {</span>
<span class="s1">      title: &#39;</span><span class="nx">Server</span><span class="w"> </span><span class="ne">Error</span><span class="s1">&#39;,</span>
<span class="s1">      description: &#39;</span><span class="nx">Our</span><span class="w"> </span><span class="nx">servers</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">experiencing</span><span class="w"> </span><span class="nx">issues</span><span class="p">.</span><span class="w"> </span><span class="nx">We</span><span class="s1">&#39;ve been notified and are working on it.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Please try again in a few minutes.&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ... other error types</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">es</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">network</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Problema de Conexi√≥n&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Tenemos problemas para conectarnos a nuestros servidores. Esto suele ser temporal.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Verifica tu conexi√≥n a internet e intenta nuevamente en un momento.&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Tiempo de Espera Agotado&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;La solicitud tard√≥ demasiado en completarse. Nuestros servidores podr√≠an estar ocupados.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Por favor, intenta nuevamente. Si esto contin√∫a, intenta m√°s tarde.&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Error del Servidor&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Nuestros servidores est√°n experimentando problemas. Hemos sido notificados y estamos trabajando en ello.&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Por favor, intenta nuevamente en unos minutos.&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ... other error types</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUserFriendlyError</span><span class="p">(</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">locale</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;en&#39;</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">localeTranslations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">translations</span><span class="p">[</span><span class="nx">locale</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">translations</span><span class="p">.</span><span class="nx">en</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Determine error type</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">errorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;failed to fetch&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">errorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;network&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">errorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;timeout&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;500&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;503&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;502&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">errorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;server&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// ... other error type checks</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">translation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localeTranslations</span><span class="p">[</span><span class="nx">errorType</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">localeTranslations</span><span class="p">.</span><span class="nx">unknown</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">translation.title</span><span class="p">,</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">translation.description</span><span class="p">,</span>
<span class="w">    </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">translation.action</span><span class="p">,</span>
<span class="w">    </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="kt">errorType</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;server&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">canRetry</span><span class="o">:</span><span class="w"> </span><span class="kt">errorType</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;auth&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">showTechnicalDetails</span><span class="o">:</span><span class="w"> </span><span class="kt">errorType</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="verification-accessible-and-internationalized-errors">Verification: Accessible and Internationalized Errors</h3>
<p><strong>Accessibility Features</strong>:
- Screen reader announces error with <code>role="alert"</code> and <code>aria-live="assertive"</code>
- Retry button receives focus automatically
- All interactive elements have proper ARIA labels
- Keyboard navigation works correctly
- Focus management guides user to recovery action</p>
<p><strong>Internationalization</strong>:
- Error messages display in user's preferred language
- Fallback to English if translation not available
- Technical details remain in English (for support purposes)</p>
<p><strong>Expected vs. Actual improvement</strong>:
- Before: Not accessible, English only
- After: Fully accessible, multi-language support
- User experience: Inclusive, works for all users</p>
<h2 id="the-complete-journey-from-crash-to-professional-error-handling">The Complete Journey: From Crash to Professional Error Handling</h2>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Failure Mode</th>
<th>Technique Applied</th>
<th>Result</th>
<th>User Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Entire app crashes on error</td>
<td>None</td>
<td>Blank screen</td>
<td>Complete failure</td>
</tr>
<tr>
<td>1</td>
<td>App crashes, no recovery</td>
<td>Error Boundary</td>
<td>Isolated failures</td>
<td>Partial functionality</td>
</tr>
<tr>
<td>2</td>
<td>Generic errors, no retry</td>
<td>Granular boundaries + reset</td>
<td>Specific errors, retry works</td>
<td>Clear recovery path</td>
</tr>
<tr>
<td>3</td>
<td>Server errors not caught</td>
<td>Next.js error.tsx</td>
<td>Server errors handled</td>
<td>Consistent error handling</td>
</tr>
<tr>
<td>4</td>
<td>Errors invisible in production</td>
<td>Sentry integration</td>
<td>All errors tracked</td>
<td>Proactive issue resolution</td>
</tr>
<tr>
<td>5</td>
<td>Technical messages confuse users</td>
<td>User-friendly error messages</td>
<td>Clear, actionable guidance</td>
<td>Reduced confusion</td>
</tr>
<tr>
<td>6</td>
<td>Same error UI everywhere</td>
<td>Contextual error components</td>
<td>Appropriate error presentation</td>
<td>Less disruptive</td>
</tr>
<tr>
<td>7</td>
<td>Not accessible, English only</td>
<td>A11y + i18n</td>
<td>Accessible, multi-language</td>
<td>Inclusive experience</td>
</tr>
</tbody>
</table>
<h3 id="final-implementation-production-ready-error-handling">Final Implementation: Production-Ready Error Handling</h3>
<p>Our complete error handling system now includes:</p>
<ol>
<li><strong>Error Boundaries</strong>: Catch rendering errors at appropriate levels</li>
<li><strong>Next.js Error Files</strong>: Handle server-side errors with error.tsx and global-error.tsx</li>
<li><strong>Sentry Integration</strong>: Track all errors with rich context</li>
<li><strong>User-Friendly Messages</strong>: Translate technical errors into clear guidance</li>
<li><strong>Contextual Presentation</strong>: Show errors appropriately based on context</li>
<li><strong>Accessibility</strong>: Full screen reader support and keyboard navigation</li>
<li><strong>Internationalization</strong>: Multi-language error messages</li>
</ol>
<h3 id="decision-framework-error-handling-strategy">Decision Framework: Error Handling Strategy</h3>
<p><strong>When to use Error Boundaries</strong>:
- Isolate independent components (widgets, cards)
- Prevent cascading failures
- Provide component-specific recovery</p>
<p><strong>When to use error.tsx</strong>:
- Handle route-level errors
- Provide page-specific error UI
- Catch Server Component errors</p>
<p><strong>When to use global-error.tsx</strong>:
- Handle root layout errors
- Provide last-resort fallback
- Maintain branding during catastrophic failures</p>
<p><strong>When to use inline errors</strong>:
- Form validation errors
- Non-critical failures
- Errors that don't block main content</p>
<p><strong>When to use toast notifications</strong>:
- Background operation failures
- Non-blocking errors
- Temporary status updates</p>
<p><strong>When to use empty states</strong>:
- Critical failures with no data
- First-time load failures
- Complete feature unavailability</p>
<h3 id="lessons-learned">Lessons Learned</h3>
<ol>
<li><strong>Error boundaries are essential</strong>: Never ship a React app without error boundaries</li>
<li><strong>User-friendly messages matter</strong>: Technical errors confuse users; translate them</li>
<li><strong>Context determines presentation</strong>: Different errors need different UI treatments</li>
<li><strong>Monitoring is not optional</strong>: You can't fix errors you don't know about</li>
<li><strong>Accessibility is fundamental</strong>: Error handling must work for all users</li>
<li><strong>Recovery paths are critical</strong>: Always provide a way forward</li>
<li><strong>Test error states</strong>: Error handling is often the least-tested code path</li>
</ol>
        </div>
        <div class="footer">
            Generated on 2025-12-03 12:42:35 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>