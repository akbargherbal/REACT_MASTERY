<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05 Lists, Keys, and Conditional Rendering</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">01 React Fundamentals</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-5-lists-keys-and-conditional-rendering">Chapter 5: Lists, Keys, and Conditional Rendering</h1>
<h2 id="rendering-arrays-efficiently">Rendering arrays efficiently</h2>
<h2 id="rendering-arrays-efficiently_1">Rendering Arrays Efficiently</h2>
<p>In Chapter 4, we built a <code>UserDashboard</code> that fetches and displays user data. Now we need to extend it to show a list of activities‚Äîrecent actions the user has taken. This is where React's array rendering capabilities come into play.</p>
<p>But before we dive into the "right way," let's see what happens when we approach this naively.</p>
<h3 id="phase-1-the-reference-implementation">Phase 1: The Reference Implementation</h3>
<p>We're building an <strong>Activity Feed</strong> component that displays a user's recent actions. This will be our anchor example throughout this chapter, evolving through multiple iterations as we discover and fix problems.</p>
<p><strong>Project Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">src</span><span class="o">/</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">components</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">UserDashboard</span><span class="p">.</span><span class="nx">tsx</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">.</span><span class="nx">tsx</span><span class="w">      </span><span class="err">‚Üê</span><span class="w"> </span><span class="nx">Our</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">reference</span><span class="w"> </span><span class="nx">implementation</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="p">.</span><span class="nx">tsx</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">types</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">activity</span><span class="p">.</span><span class="nx">ts</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">app</span><span class="o">/</span>
<span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">tsx</span>
</code></pre></div>

<p>Let's start with the data structure:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/types/activity.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;login&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;share&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">metadata</span><span class="o">?:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">amount?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">    </span><span class="nx">productName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">targetUser?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<p>Now, our first attempt at rendering this list:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 1 (Naive Implementation)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">activities</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-type&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">{</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">).</span><span class="nx">toLocaleString</span><span class="p">()}</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This code runs without errors. It displays the activities. It seems to work perfectly.</p>
<p><strong>But there's a hidden problem.</strong></p>
<h3 id="the-failure-reacts-warning-in-the-console">The Failure: React's Warning in the Console</h3>
<p>Let's run this component with real data and check the browser console.</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="k">Each</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">list</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="s2">&quot;key&quot;</span><span class="w"> </span><span class="n">prop</span><span class="p">.</span>

<span class="k">Check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">render</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n n-Quoted">`ActivityFeed`</span><span class="p">.</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="n">https</span><span class="o">://</span><span class="n">reactjs</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">link</span><span class="o">/</span><span class="n">warning</span><span class="o">-</span><span class="k">keys</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="p">.</span>
<span class="w">    </span><span class="k">at</span><span class="w"> </span><span class="k">div</span>
<span class="w">    </span><span class="k">at</span><span class="w"> </span><span class="n">ActivityFeed</span>
</code></pre></div>

<p><strong>Browser Behavior</strong>:
The activities display correctly. No visual problems. The warning is easy to ignore‚Äîafter all, everything <em>looks</em> fine.</p>
<h3 id="diagnostic-analysis-why-react-complains">Diagnostic Analysis: Why React Complains</h3>
<p><strong>What the console reveals</strong>:
React is warning us about a missing <code>key</code> prop. This isn't a hard error‚Äîthe app still works. But React is telling us we're doing something that will cause problems.</p>
<p><strong>What's actually happening under the hood</strong>:
When React renders a list, it needs to track which items are which across re-renders. Without keys, React uses the array index as an implicit key. This works fine... until it doesn't.</p>
<p><strong>Why the current approach can't scale</strong>:
Imagine we add the ability to:
- Delete an activity
- Add new activities in real-time
- Reorder activities by timestamp
- Filter activities by type</p>
<p>Without proper keys, React will struggle to efficiently update the list. It might re-render items unnecessarily, lose component state, or even display the wrong data.</p>
<p><strong>What we need</strong>: A way to give React a stable identity for each list item.</p>
<h3 id="the-concept-reacts-reconciliation-algorithm">The Concept: React's Reconciliation Algorithm</h3>
<p>Before we fix the code, understand what React is doing when it renders a list.</p>
<p><strong>The Problem React Solves</strong>:
When your component re-renders with a new array, React needs to figure out:
1. Which items are new (add them to the DOM)
2. Which items were removed (remove them from the DOM)
3. Which items moved (reorder them in the DOM)
4. Which items changed (update them in the DOM)</p>
<p><strong>Without Keys</strong> (using array index):</p>
<div class="codehilite"><pre><span></span><code>Old array: [A, B, C]  ‚Üí  Indices: [0, 1, 2]
New array: [A, C, D]  ‚Üí  Indices: [0, 1, 2]

React thinks:
- Index 0: A ‚Üí A (no change)
- Index 1: B ‚Üí C (update B to look like C)
- Index 2: C ‚Üí D (update C to look like D)
</code></pre></div>

<p>React doesn't realize that B was deleted and D was added. It thinks B and C changed. This causes unnecessary re-renders and can lose component state.</p>
<p><strong>With Keys</strong> (using unique IDs):</p>
<div class="codehilite"><pre><span></span><code>Old array: [A(id:1), B(id:2), C(id:3)]
New array: [A(id:1), C(id:3), D(id:4)]

React thinks:
- id:1 (A): Still here, no change
- id:2 (B): Gone, remove it
- id:3 (C): Still here, moved from index 2 to index 1
- id:4 (D): New, add it
</code></pre></div>

<p>React correctly identifies what changed. It can reuse existing DOM nodes efficiently.</p>
<h3 id="solution-adding-keys">Solution: Adding Keys</h3>
<p>The fix is simple‚Äîadd a <code>key</code> prop to each list item:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 2 (With Keys)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">activities</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-type&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;</span>
<span class="w">              </span><span class="p">{</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">).</span><span class="nx">toLocaleString</span><span class="p">()}</span>
<span class="w">            </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Added <code>key={activity.id}</code> to the mapped <code>div</code>
- Used the activity's unique <code>id</code> field as the key</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No warnings)
</code></pre></div>

<p><strong>Verification</strong>:
The warning is gone. React can now efficiently track each activity item.</p>
<h3 id="extracting-to-a-component">Extracting to a Component</h3>
<p>As our activity items get more complex, let's extract them into a separate component. This is a common pattern‚Äîit keeps the list rendering logic clean and makes each item easier to test and maintain.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityItem.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activity</span><span class="o">:</span><span class="w"> </span><span class="kt">Activity</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="p">({</span><span class="w"> </span><span class="nx">activity</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">formatTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;Just now&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">diffMins</span><span class="si">}</span><span class="sb">m ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1440</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="si">}</span><span class="sb">h ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">toLocaleDateString</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getActivityIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">icons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">login</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîê&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">purchase</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üõí&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üí¨&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">like</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">share</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîÑ&#39;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">icons</span><span class="p">[</span><span class="kr">type</span><span class="p">];</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-icon&quot;</span><span class="p">&gt;{</span><span class="nx">getActivityIcon</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">productName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-meta&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Product</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">productName</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">amount</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-meta&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Amount</span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">amount</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;{</span><span class="nx">formatTimestamp</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 3 (With Extracted Component)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">activities</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Important</strong>: The <code>key</code> prop stays on the component in the <code>.map()</code> call, not inside the <code>ActivityItem</code> component itself. Keys are used by React's reconciliation algorithm and are not passed as props to your component.</p>
<h3 id="when-you-dont-have-a-unique-id">When You Don't Have a Unique ID</h3>
<p>Sometimes your data doesn't come with unique IDs. What then?</p>
<p><strong>Option 1: Generate IDs on the server</strong> (preferred)
If you control the API, add unique IDs to your data structure.</p>
<p><strong>Option 2: Generate stable IDs on the client</strong>
If the data is truly static (never changes), you can generate IDs once:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Generate IDs once when data arrives</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">activitiesWithIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rawActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="p">...</span><span class="nx">activity</span><span class="p">,</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nx">index</span><span class="si">}</span><span class="sb">`</span>
<span class="p">}));</span>
</code></pre></div>

<p><strong>Option 3: Use array index as a last resort</strong>
Only if:
- The list never reorders
- Items are never added/removed from the middle
- Items don't have any internal state</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nx">activities</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">))}</span>
</code></pre></div>

<p><strong>Warning</strong>: Using index as key is almost always wrong. It defeats the purpose of keys and can cause subtle bugs.</p>
<h3 id="limitation-preview">Limitation Preview</h3>
<p>Our activity feed now renders efficiently with proper keys. But we still have problems:</p>
<ol>
<li><strong>No real-time updates</strong>: New activities don't appear automatically</li>
<li><strong>No filtering</strong>: Users can't filter by activity type</li>
<li><strong>Performance</strong>: What happens with 1,000 activities?</li>
</ol>
<p>We'll address these in the next sections.</p>
<h2 id="why-keys-matter-and-what-happens-when-you-get-them-wrong">Why keys matter (and what happens when you get them wrong)</h2>
<h2 id="why-keys-matter-and-what-happens-when-you-get-them-wrong_1">Why Keys Matter (And What Happens When You Get Them Wrong)</h2>
<p>We added keys to fix a warning. But let's see what actually breaks when keys are wrong. This section will demonstrate the concrete failures that occur with improper key usage.</p>
<h3 id="iteration-1-adding-interactive-state">Iteration 1: Adding Interactive State</h3>
<p>Let's make our activity feed interactive. Users can now "like" activities, and we'll track which ones they've liked.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityItem.tsx - Version 2 (With Like Button)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activity</span><span class="o">:</span><span class="w"> </span><span class="kt">Activity</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onLike</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="p">({</span><span class="w"> </span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span><span class="nx">onLike</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLiked</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLiked</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">likeCount</span><span class="p">,</span><span class="w"> </span><span class="nx">setLikeCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">likes</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLiked</span><span class="p">(</span><span class="o">!</span><span class="nx">isLiked</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setLikeCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">onLike</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">formatTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;Just now&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">diffMins</span><span class="si">}</span><span class="sb">m ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1440</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="si">}</span><span class="sb">h ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">toLocaleDateString</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getActivityIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">icons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">login</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîê&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">purchase</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üõí&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üí¨&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">like</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">share</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîÑ&#39;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">icons</span><span class="p">[</span><span class="kr">type</span><span class="p">];</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-icon&quot;</span><span class="p">&gt;{</span><span class="nx">getActivityIcon</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">productName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-meta&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Product</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">productName</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-actions&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;liked&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ü§ç&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">likeCount</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;{</span><span class="nx">formatTimestamp</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now let's add filtering to the feed:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 4 (With Filtering)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">ActivityFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ActivityFilter</span><span class="p">&gt;(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activityId</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// In a real app, this would make an API call</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">activities.filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">activities</span><span class="p">...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-filters&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">All</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Purchases</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Comments</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;like&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Likes</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">            </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">            </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This works correctly. Now let's see what happens when we use the wrong key.</p>
<h3 id="the-failure-using-array-index-as-key">The Failure: Using Array Index as Key</h3>
<p>Let's intentionally break our code by using array index as the key:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - BROKEN VERSION (Index as Key)</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ... (same state and effects as before)</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="cm">/* ... (same filters as before) */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">            </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="na">WRONG</span><span class="err">:</span><span class="w"> </span><span class="na">Using</span><span class="w"> </span><span class="na">index</span><span class="w"> </span><span class="na">as</span><span class="w"> </span><span class="na">key</span>
<span class="w">            </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">            </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="diagnostic-analysis-the-wrong-item-gets-updated">Diagnostic Analysis: The Wrong Item Gets Updated</h3>
<p><strong>Test scenario</strong>:
1. Load the activity feed (shows 10 activities)
2. Like the 3rd activity (Purchase: "Bought Premium Plan")
3. Click "Purchases" filter (now shows only 3 purchase activities)
4. Observe which activity shows as liked</p>
<p><strong>Browser Behavior</strong>:
The WRONG activity shows as liked. The 3rd item in the filtered list is liked, even though it's a different activity than the one we actually liked.</p>
<p><strong>React DevTools Evidence - Components Tab</strong>:
Before filtering:</p>
<div class="codehilite"><pre><span></span><code>ActivityFeed
  ‚îú‚îÄ ActivityItem (key: 0) - Login
  ‚îú‚îÄ ActivityItem (key: 1) - Comment
  ‚îú‚îÄ ActivityItem (key: 2) - Purchase ‚Üê We liked this one
  ‚îú‚îÄ ActivityItem (key: 3) - Like
  ‚îî‚îÄ ...
</code></pre></div>

<p>After filtering to "Purchases":</p>
<div class="codehilite"><pre><span></span><code>ActivityFeed
  ‚îú‚îÄ ActivityItem (key: 0) - Purchase (different activity)
  ‚îú‚îÄ ActivityItem (key: 1) - Purchase (different activity)
  ‚îú‚îÄ ActivityItem (key: 2) - Purchase ‚Üê Shows as liked (WRONG!)
  ‚îî‚îÄ ...
</code></pre></div>

<p><strong>What React DevTools shows</strong>:
- The component at index 2 retained its state (<code>isLiked: true</code>)
- But it's now rendering a DIFFERENT activity
- React reused the component instance because the key (index 2) stayed the same</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Only the "Premium Plan" purchase should show as liked</li>
<li>
<p>Actual: A completely different purchase shows as liked</p>
</li>
<li>
<p><strong>What React DevTools reveals</strong>:</p>
</li>
<li>The component at key <code>2</code> kept its internal state</li>
<li>But the <code>activity</code> prop changed to a different activity</li>
<li>
<p>React thought it was the same component (same key), so it preserved state</p>
</li>
<li>
<p><strong>Root cause identified</strong>:
   When the array changes (filtering), the indices shift. React sees the same key (index 2) and thinks it's the same component, so it preserves the component's internal state (<code>isLiked</code>, <code>likeCount</code>). But the <code>activity</code> prop is now pointing to a different activity.</p>
</li>
<li>
<p><strong>Why index keys can't solve this</strong>:
   Array indices are not stable identifiers. They change when the array is filtered, sorted, or reordered. React needs stable keys that move with the data.</p>
</li>
<li>
<p><strong>What we need</strong>:
   Keys that are tied to the data itself, not its position in the array.</p>
</li>
</ol>
<h3 id="the-fix-using-stable-keys">The Fix: Using Stable Keys</h3>
<p>Let's fix this by using the activity's unique ID:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - FIXED VERSION (Proper Keys)</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ... (same state and effects as before)</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="cm">/* ... (same filters as before) */</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">            </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">‚úì</span><span class="w"> </span><span class="na">CORRECT</span><span class="err">:</span><span class="w"> </span><span class="na">Using</span><span class="w"> </span><span class="na">stable</span><span class="w"> </span><span class="na">ID</span>
<span class="w">            </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">            </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Verification</strong>:
1. Load the activity feed
2. Like the "Premium Plan" purchase
3. Filter to "Purchases"
4. Result: Only the "Premium Plan" purchase shows as liked ‚úì</p>
<p><strong>React DevTools Evidence - After Fix</strong>:
Before filtering:</p>
<div class="codehilite"><pre><span></span><code>ActivityFeed
  ‚îú‚îÄ ActivityItem (key: &quot;act_123&quot;) - Login
  ‚îú‚îÄ ActivityItem (key: &quot;act_124&quot;) - Comment
  ‚îú‚îÄ ActivityItem (key: &quot;act_125&quot;) - Purchase ‚Üê We liked this one
  ‚îú‚îÄ ActivityItem (key: &quot;act_126&quot;) - Like
  ‚îî‚îÄ ...
</code></pre></div>

<p>After filtering to "Purchases":</p>
<div class="codehilite"><pre><span></span><code>ActivityFeed
  ‚îú‚îÄ ActivityItem (key: &quot;act_125&quot;) - Purchase ‚Üê Still liked ‚úì
  ‚îú‚îÄ ActivityItem (key: &quot;act_130&quot;) - Purchase
  ‚îú‚îÄ ActivityItem (key: &quot;act_135&quot;) - Purchase
  ‚îî‚îÄ ...
</code></pre></div>

<p><strong>What changed</strong>:
- The component with key <code>"act_125"</code> moved positions but kept its state
- React correctly identified it as the same component
- Other purchase activities have different keys, so they have their own independent state</p>
<h3 id="common-failure-modes-and-their-signatures">Common Failure Modes and Their Signatures</h3>
<h4 id="symptom-state-appears-on-wrong-items-after-filteringsorting">Symptom: State appears on wrong items after filtering/sorting</h4>
<p><strong>Browser behavior</strong>:
User interacts with one item, filters the list, and a different item shows the interaction state.</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No errors - this is a logic bug, not a runtime error)
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Component tree shows same keys before and after filter
- Props change but state doesn't reset
- Highlighted updates show components reusing instances</p>
<p><strong>Root cause</strong>: Using array index or non-unique values as keys</p>
<p><strong>Solution</strong>: Use stable, unique identifiers from your data</p>
<h4 id="symptom-components-dont-update-when-array-is-reordered">Symptom: Components don't update when array is reordered</h4>
<p><strong>Browser behavior</strong>:
User sorts the list, but items appear in wrong order or with wrong data.</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No errors)
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Component order in tree doesn't match visual order
- Props update but components don't re-render
- Keys are duplicated or based on position</p>
<p><strong>Root cause</strong>: Keys don't uniquely identify items</p>
<p><strong>Solution</strong>: Ensure each key is unique and stable across renders</p>
<h4 id="symptom-input-fields-lose-focus-or-reset-when-typing">Symptom: Input fields lose focus or reset when typing</h4>
<p><strong>Browser behavior</strong>:
User types in an input field within a list item, and the input loses focus or resets after each keystroke.</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">Each</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="s2">&quot;key&quot;</span><span class="w"> </span><span class="n">prop</span><span class="o">.</span>
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Component unmounts and remounts on each keystroke
- New component instance created each render
- Keys are generated inside render (e.g., <code>Math.random()</code>)</p>
<p><strong>Root cause</strong>: Keys change on every render</p>
<p><strong>Solution</strong>: Generate keys outside of render, or use stable data properties</p>
<h3 id="when-to-apply-this-solution">When to Apply This Solution</h3>
<p><strong>What it optimizes for</strong>:
- Correct component state preservation
- Efficient DOM updates
- Predictable behavior when lists change</p>
<p><strong>What it requires</strong>:
- Unique identifiers in your data
- Understanding of your data's identity</p>
<p><strong>When to use stable keys</strong>:
- Always, for any list that can change
- Especially when list items have internal state
- When lists can be filtered, sorted, or reordered
- When items can be added/removed</p>
<p><strong>When index keys might be acceptable</strong> (rare):
- Static lists that never change
- Server-rendered lists with no client-side interaction
- Lists where items have no internal state and never reorder</p>
<p><strong>Code characteristics</strong>:
- Setup: Minimal (just use existing ID field)
- Maintenance: None (keys are part of data structure)
- Performance: Optimal (React can efficiently reconcile changes)</p>
<h2 id="conditional-rendering-patterns">Conditional rendering patterns</h2>
<h2 id="conditional-rendering-patterns_1">Conditional Rendering Patterns</h2>
<p>Our activity feed now handles lists correctly. But what about showing different UI based on conditions? Empty states, loading states, error states‚Äîthese are all forms of conditional rendering.</p>
<h3 id="iteration-2-adding-empty-and-error-states">Iteration 2: Adding Empty and Error States</h3>
<p>Let's enhance our activity feed to handle edge cases:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 5 (With All States)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">ActivityFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ActivityFilter</span><span class="p">&gt;(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activityId</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">activities.filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Loading state</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-loading&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">activities</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Error state</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-error&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-icon&quot;</span><span class="p">&gt;</span><span class="err">‚ö†Ô∏è</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">activities</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">()}&gt;</span>
<span class="w">            </span><span class="nx">Try</span><span class="w"> </span><span class="nx">Again</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Empty state (no activities at all)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-empty&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;empty-icon&quot;</span><span class="p">&gt;</span><span class="err">üì≠</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">No</span><span class="w"> </span><span class="nx">activity</span><span class="w"> </span><span class="nx">yet</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Your</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">actions</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">appear</span><span class="w"> </span><span class="nx">here</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-filters&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">All</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Purchases</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Comments</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;like&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Likes</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* Empty state for filtered results */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-empty-filter&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">No</span><span class="w"> </span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span><span class="nx">found</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}&gt;</span>
<span class="w">            </span><span class="nx">Show</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">activities</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">              </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">              </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">              </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This component now handles five distinct states:
1. <strong>Loading</strong>: Fetching data
2. <strong>Error</strong>: Fetch failed
3. <strong>Empty</strong>: No activities exist
4. <strong>Filtered empty</strong>: Activities exist, but none match the filter
5. <strong>Success</strong>: Activities to display</p>
<h3 id="conditional-rendering-patterns_2">Conditional Rendering Patterns</h3>
<p>React offers several ways to conditionally render content. Let's examine each pattern and when to use it.</p>
<h4 id="pattern-1-early-return-guard-clauses">Pattern 1: Early Return (Guard Clauses)</h4>
<p><strong>Best for</strong>: Mutually exclusive states (loading, error, empty)</p>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Component</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">LoadingSpinner</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ErrorMessage</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span><span class="p">/&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">MainContent</span><span class="w"> </span><span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Advantages</strong>:
- Clear, linear flow
- Easy to read and reason about
- No nesting</p>
<p><strong>When to use</strong>:
- States are mutually exclusive
- Each state needs completely different UI
- You want to avoid deeply nested JSX</p>
<h4 id="pattern-2-ternary-operator">Pattern 2: Ternary Operator</h4>
<p><strong>Best for</strong>: Simple binary conditions</p>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Component</span><span class="p">({</span><span class="w"> </span><span class="nx">isPublic</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isPublic</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isPublic</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">PublicContent</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">PrivateContent</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Advantages</strong>:
- Concise for simple conditions
- Works inline in JSX</p>
<p><strong>When to use</strong>:
- Two mutually exclusive options
- Both branches are simple
- Condition is straightforward</p>
<p><strong>Avoid when</strong>:
- Nesting multiple ternaries (becomes unreadable)
- Either branch is complex (use early return instead)</p>
<h4 id="pattern-3-logical-and">Pattern 3: Logical AND (&amp;&amp;)</h4>
<p><strong>Best for</strong>: Conditionally showing a single element</p>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Component</span><span class="p">({</span><span class="w"> </span><span class="nx">showBanner</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">showBanner</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span><span class="w"> </span><span class="nx">message?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">showBanner</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Banner</span><span class="w"> </span><span class="p">/&gt;}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">message</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Alert</span><span class="w"> </span><span class="na">message</span><span class="o">=</span><span class="p">{</span><span class="nx">message</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Advantages</strong>:
- Very concise
- Clear intent: "show this if condition is true"</p>
<p><strong>When to use</strong>:
- Showing/hiding a single element
- No "else" branch needed
- Condition is boolean or truthy/falsy</p>
<p><strong>Gotcha</strong>: Be careful with numbers!</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå WRONG: Renders &quot;0&quot; when count is 0</span>
<span class="p">{</span><span class="nx">count</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">You</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}</span><span class="w"> </span><span class="nx">items</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>

<span class="c1">// ‚úì CORRECT: Explicitly check for &gt; 0</span>
<span class="p">{</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">You</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}</span><span class="w"> </span><span class="nx">items</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>

<span class="c1">// ‚úì ALSO CORRECT: Convert to boolean</span>
<span class="p">{</span><span class="o">!!</span><span class="nx">count</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">You</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}</span><span class="w"> </span><span class="nx">items</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>
</code></pre></div>

<h4 id="pattern-4-nullish-coalescing-for-defaults">Pattern 4: Nullish Coalescing for Defaults</h4>
<p><strong>Best for</strong>: Providing fallback content</p>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">UserProfile</span><span class="p">({</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">user?</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;Anonymous User&#39;</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">bio</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;No bio provided&#39;</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">img</span><span class="w"> </span><span class="na">src</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">avatar</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;/default-avatar.png&#39;</span><span class="p">}</span><span class="w"> </span><span class="na">alt</span><span class="o">=</span><span class="s">&quot;Avatar&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Advantages</strong>:
- Concise fallback values
- Handles <code>null</code> and <code>undefined</code> (but not <code>0</code> or <code>''</code>)</p>
<p><strong>When to use</strong>:
- Providing default values
- Handling optional data
- You want to preserve falsy values like <code>0</code> or <code>''</code></p>
<h4 id="pattern-5-switch-statements-via-object-mapping">Pattern 5: Switch Statements (via Object Mapping)</h4>
<p><strong>Best for</strong>: Multiple distinct states with different UI</p>
<div class="codehilite"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;idle&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;success&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Component</span><span class="p">({</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">Status</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">statusComponents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">idle</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">IdleState</span><span class="w"> </span><span class="p">/&gt;,</span>
<span class="w">    </span><span class="nx">loading</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">LoadingSpinner</span><span class="w"> </span><span class="p">/&gt;,</span>
<span class="w">    </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">SuccessMessage</span><span class="w"> </span><span class="p">/&gt;,</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ErrorMessage</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">statusComponents</span><span class="p">[</span><span class="nx">status</span><span class="p">]}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Advantages</strong>:
- Scales well with many states
- Easy to add new states
- TypeScript ensures all states are handled</p>
<p><strong>When to use</strong>:
- 3+ distinct states
- Each state has different UI
- States are represented by a union type</p>
<h4 id="pattern-6-render-props-children-functions">Pattern 6: Render Props / Children Functions</h4>
<p><strong>Best for</strong>: Delegating rendering logic to parent</p>
<div class="codehilite"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">DataFetcherProps</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">DataFetcher</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;({</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">DataFetcherProps</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">setData</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">T</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Error</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">url</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;&gt;{</span><span class="nx">children</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">)}&lt;/&gt;;</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeedWrapper</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">DataFetcher</span><span class="err">&lt;</span><span class="na">Activity</span><span class="err">[]</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;/api/activities&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">{(</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">LoadingSpinner</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ErrorMessage</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">activities</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">ActivityList</span><span class="w"> </span><span class="na">activities</span><span class="o">=</span><span class="p">{</span><span class="nx">activities</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="w">      </span><span class="p">}}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">DataFetcher</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Advantages</strong>:
- Separates data fetching from rendering
- Reusable data fetching logic
- Parent controls rendering</p>
<p><strong>When to use</strong>:
- Building reusable data fetching components
- Complex conditional logic that varies by use case
- You want to separate concerns</p>
<h3 id="iteration-3-extracting-state-components">Iteration 3: Extracting State Components</h3>
<p>As our conditional rendering grows, let's extract each state into its own component:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed/LoadingState.tsx</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">LoadingState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-loading&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">activities</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed/ErrorState.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorStateProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onRetry</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ErrorState</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">onRetry</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorStateProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-error&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-icon&quot;</span><span class="p">&gt;</span><span class="err">‚ö†Ô∏è</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">activities</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onRetry</span><span class="p">}&gt;</span><span class="nx">Try</span><span class="w"> </span><span class="nx">Again</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed/EmptyState.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">EmptyStateProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">isFiltered?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">filterType?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onClearFilter</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">EmptyState</span><span class="p">({</span><span class="w"> </span><span class="nx">isFiltered</span><span class="p">,</span><span class="w"> </span><span class="nx">filterType</span><span class="p">,</span><span class="w"> </span><span class="nx">onClearFilter</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">EmptyStateProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isFiltered</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-empty-filter&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">No</span><span class="w"> </span><span class="p">{</span><span class="nx">filterType</span><span class="p">}</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span><span class="nx">found</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClearFilter</span><span class="p">}&gt;</span><span class="nx">Show</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">activities</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-empty&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;empty-icon&quot;</span><span class="p">&gt;</span><span class="err">üì≠</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">No</span><span class="w"> </span><span class="nx">activity</span><span class="w"> </span><span class="nx">yet</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Your</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">actions</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">appear</span><span class="w"> </span><span class="nx">here</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 6 (Refactored)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoadingState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/LoadingState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/ErrorState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EmptyState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/EmptyState&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">ActivityFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ActivityFilter</span><span class="p">&gt;(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fetchActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetchActivities</span><span class="p">();</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activityId</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">activities.filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Early returns for distinct states</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">LoadingState</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorState</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="w"> </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchActivities</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-filters&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">All</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Purchases</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Comments</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span>
<span class="w">          </span><span class="na">isFiltered</span><span class="w"> </span>
<span class="w">          </span><span class="na">filterType</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span>
<span class="w">          </span><span class="na">onClearFilter</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">              </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">              </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">              </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Improvements</strong>:
- Each state has its own component
- Main component is easier to read
- State components are reusable and testable
- Clear separation of concerns</p>
<h3 id="common-failure-modes-and-their-signatures_1">Common Failure Modes and Their Signatures</h3>
<h4 id="symptom-renders-0-or-false-in-the-ui">Symptom: Renders "0" or "false" in the UI</h4>
<p><strong>Browser behavior</strong>:
Instead of showing nothing, the number <code>0</code> or the word <code>false</code> appears in the UI.</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>(No errors - this is expected React behavior)
</code></pre></div>

<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå Renders &quot;0&quot; when count is 0</span>
<span class="p">{</span><span class="nx">count</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>

<span class="c1">// ‚úì Fixed</span>
<span class="p">{</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>
</code></pre></div>

<p><strong>Root cause</strong>: <code>&amp;&amp;</code> operator returns the left side if falsy. React renders <code>0</code> and <code>false</code> as text.</p>
<p><strong>Solution</strong>: Use explicit boolean conditions</p>
<h4 id="symptom-ternary-becomes-unreadable">Symptom: Ternary becomes unreadable</h4>
<p><strong>Browser behavior</strong>:
Code works but is impossible to maintain.</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå Nested ternary hell</span>
<span class="p">{</span><span class="nx">isLoading</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Spinner</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Error</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Empty</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">List</span><span class="w"> </span><span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">)}</span>

<span class="c1">// ‚úì Use early returns instead</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Spinner</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Error</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Empty</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">List</span><span class="w"> </span><span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
</code></pre></div>

<p><strong>Root cause</strong>: Ternaries don't scale beyond 2 branches</p>
<p><strong>Solution</strong>: Use early returns or object mapping for multiple states</p>
<h4 id="symptom-condition-always-evaluates-to-truefalse">Symptom: Condition always evaluates to true/false</h4>
<p><strong>Browser behavior</strong>:
Component always shows or never shows, regardless of actual state.</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå String &quot;false&quot; is truthy</span>
<span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">AdminPanel</span><span class="w"> </span><span class="p">/&gt;}</span>

<span class="c1">// ‚úì Compare to boolean</span>
<span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">AdminPanel</span><span class="w"> </span><span class="p">/&gt;}</span>

<span class="c1">// ‚úì Or use strict equality</span>
<span class="p">{</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">AdminPanel</span><span class="w"> </span><span class="p">/&gt;}</span>
</code></pre></div>

<p><strong>Root cause</strong>: Type coercion or incorrect comparison</p>
<p><strong>Solution</strong>: Use TypeScript and strict equality checks</p>
<h3 id="when-to-apply-these-patterns">When to Apply These Patterns</h3>
<p><strong>Early Returns</strong>:
- Use for: Mutually exclusive states (loading, error, success)
- Optimizes for: Readability, linear flow
- Avoid when: States can overlap or you need to show multiple things</p>
<p><strong>Ternary Operator</strong>:
- Use for: Simple binary conditions
- Optimizes for: Conciseness
- Avoid when: Nesting more than one level</p>
<p><strong>Logical AND (&amp;&amp;)</strong>:
- Use for: Showing/hiding single elements
- Optimizes for: Brevity
- Avoid when: Left side can be <code>0</code>, <code>""</code>, or other falsy values you want to render</p>
<p><strong>Object Mapping</strong>:
- Use for: 3+ distinct states
- Optimizes for: Scalability, type safety
- Avoid when: States are not mutually exclusive</p>
<p><strong>Component Extraction</strong>:
- Use for: Complex conditional UI
- Optimizes for: Reusability, testability
- Avoid when: Component is used only once and is simple</p>
<h2 id="avoiding-unnecessary-re-renders">Avoiding unnecessary re-renders</h2>
<h2 id="avoiding-unnecessary-re-renders_1">Avoiding Unnecessary Re-Renders</h2>
<p>Our activity feed now handles lists, keys, and conditional rendering correctly. But there's one more problem: <strong>performance</strong>. What happens when we have hundreds of activities and the list re-renders frequently?</p>
<h3 id="the-failure-entire-list-re-renders-on-one-item-change">The Failure: Entire List Re-renders on One Item Change</h3>
<p>Let's add a feature that updates activity timestamps in real-time (e.g., "2m ago" ‚Üí "3m ago"). This will expose a performance problem.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 7 (With Real-time Updates)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoadingState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/LoadingState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/ErrorState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EmptyState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/EmptyState&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">ActivityFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ActivityFilter</span><span class="p">&gt;(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">currentTime</span><span class="p">,</span><span class="w"> </span><span class="nx">setCurrentTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>

<span class="w">  </span><span class="c1">// Update current time every minute to refresh &quot;X minutes ago&quot; displays</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setCurrentTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Every 60 seconds</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fetchActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetchActivities</span><span class="p">();</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activityId</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">activities.filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">LoadingState</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">ErrorState</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="w"> </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchActivities</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">EmptyState</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-filters&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">All</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Purchases</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span>
<span class="w">          </span><span class="na">isFiltered</span><span class="w"> </span>
<span class="w">          </span><span class="na">filterType</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span>
<span class="w">          </span><span class="na">onClearFilter</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">              </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">              </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">              </span><span class="na">currentTime</span><span class="o">=</span><span class="p">{</span><span class="nx">currentTime</span><span class="p">}</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="na">Pass</span><span class="w"> </span><span class="na">current</span><span class="w"> </span><span class="na">time</span><span class="w"> </span><span class="na">to</span><span class="w"> </span><span class="na">each</span><span class="w"> </span><span class="na">item</span>
<span class="w">              </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityItem.tsx - Version 3 (With Current Time Prop)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activity</span><span class="o">:</span><span class="w"> </span><span class="kt">Activity</span><span class="p">;</span>
<span class="w">  </span><span class="nx">currentTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span><span class="w">  </span><span class="c1">// ‚Üê New prop</span>
<span class="w">  </span><span class="nx">onLike</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="p">({</span><span class="w"> </span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">,</span><span class="w"> </span><span class="nx">onLike</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLiked</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLiked</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">likeCount</span><span class="p">,</span><span class="w"> </span><span class="nx">setLikeCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">likes</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Add console.log to track renders</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Rendering ActivityItem: </span><span class="si">${</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLiked</span><span class="p">(</span><span class="o">!</span><span class="nx">isLiked</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setLikeCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">onLike</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">formatTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">now</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;Just now&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">diffMins</span><span class="si">}</span><span class="sb">m ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1440</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="si">}</span><span class="sb">h ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">toLocaleDateString</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getActivityIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">icons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">login</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîê&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">purchase</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üõí&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üí¨&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">like</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">share</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîÑ&#39;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">icons</span><span class="p">[</span><span class="kr">type</span><span class="p">];</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-icon&quot;</span><span class="p">&gt;{</span><span class="nx">getActivityIcon</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">productName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-meta&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Product</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">productName</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-actions&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;liked&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ü§ç&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">likeCount</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">formatTimestamp</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">)}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-performance-problem">Diagnostic Analysis: Reading the Performance Problem</h3>
<p><strong>Test scenario</strong>:
1. Load activity feed with 50 activities
2. Wait 60 seconds for the timer to tick
3. Observe browser console</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Rendering ActivityItem: act_001
Rendering ActivityItem: act_002
Rendering ActivityItem: act_003
<span class="k">...</span> (50 times)
Rendering ActivityItem: act_050
</code></pre></div>

<p>Every 60 seconds, all 50 console.log statements fire. Every single <code>ActivityItem</code> re-renders, even though only the timestamps changed.</p>
<p><strong>React DevTools Evidence - Profiler Tab</strong>:
1. Open React DevTools
2. Go to Profiler tab
3. Click "Record"
4. Wait for timer to tick (or manually change <code>currentTime</code> state)
5. Stop recording</p>
<p><strong>Profiler shows</strong>:
- <code>ActivityFeed</code> rendered: 1 time (2.3ms)
- <code>ActivityItem</code> rendered: 50 times (total: 45ms)
- Each <code>ActivityItem</code> took ~0.9ms
- Reason for each render: "Props changed"</p>
<p><strong>React DevTools Evidence - Components Tab with Highlight Updates</strong>:
1. Open React DevTools
2. Go to Components tab
3. Click the "‚öôÔ∏è" icon ‚Üí Enable "Highlight updates when components render"
4. Wait for timer to tick</p>
<p><strong>What you see</strong>:
Every single <code>ActivityItem</code> flashes with a colored border, indicating they all re-rendered.</p>
<p><strong>Let's parse this evidence</strong>:</p>
<ol>
<li><strong>What the user experiences</strong>:</li>
<li>Expected: Smooth, imperceptible updates</li>
<li>
<p>Actual: With 50 items, no visible lag yet. But with 500 items, the UI would stutter.</p>
</li>
<li>
<p><strong>What the console reveals</strong>:</p>
</li>
<li>All 50 items log on every timer tick</li>
<li>
<p>This means all 50 components are executing their render function</p>
</li>
<li>
<p><strong>What React DevTools shows</strong>:</p>
</li>
<li>Profiler: 50 separate render operations</li>
<li>Highlight updates: All items flash simultaneously</li>
<li>
<p>Props changed: <code>currentTime</code> prop is new on every tick</p>
</li>
<li>
<p><strong>Root cause identified</strong>:
   When <code>currentTime</code> state updates in <code>ActivityFeed</code>, React re-renders the component. This creates a new <code>currentTime</code> value that gets passed to every <code>ActivityItem</code>. React sees the prop changed and re-renders all items.</p>
</li>
<li>
<p><strong>Why the current approach can't scale</strong>:</p>
</li>
<li>With 500 activities, that's 500 re-renders every 60 seconds</li>
<li>Each render executes the entire component function</li>
<li>
<p>Even though most items' timestamps don't actually change (e.g., "2 hours ago" stays "2 hours ago")</p>
</li>
<li>
<p><strong>What we need</strong>:
   A way to tell React: "Only re-render this component if its output would actually be different."</p>
</li>
</ol>
<h3 id="the-concept-reactmemo-and-memoization">The Concept: React.memo and Memoization</h3>
<p><strong>Memoization</strong> is a technique where you cache the result of an expensive computation and reuse it if the inputs haven't changed.</p>
<p>React provides <code>React.memo()</code> to memoize components. It works like this:</p>
<ol>
<li>React renders your component with props <code>{ a: 1, b: 2 }</code></li>
<li>React.memo caches the output</li>
<li>Next render, props are <code>{ a: 1, b: 2 }</code> (same values)</li>
<li>React.memo returns the cached output without re-rendering</li>
<li>Next render, props are <code>{ a: 1, b: 3 }</code> (b changed)</li>
<li>React.memo re-renders because props changed</li>
</ol>
<p><strong>The key insight</strong>: React.memo does a <strong>shallow comparison</strong> of props. If all props are the same (using <code>Object.is</code> comparison), React skips the render.</p>
<h3 id="iteration-1-applying-reactmemo">Iteration 1: Applying React.memo</h3>
<p>Let's wrap <code>ActivityItem</code> with <code>React.memo</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityItem.tsx - Version 4 (With React.memo)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">memo</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activity</span><span class="o">:</span><span class="w"> </span><span class="kt">Activity</span><span class="p">;</span>
<span class="w">  </span><span class="nx">currentTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onLike</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Wrap the component with memo</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">currentTime</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onLike</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLiked</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLiked</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">likeCount</span><span class="p">,</span><span class="w"> </span><span class="nx">setLikeCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">likes</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Rendering ActivityItem: </span><span class="si">${</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLiked</span><span class="p">(</span><span class="o">!</span><span class="nx">isLiked</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setLikeCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">onLike</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">formatTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">now</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;Just now&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">diffMins</span><span class="si">}</span><span class="sb">m ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1440</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="si">}</span><span class="sb">h ago`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">toLocaleDateString</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getActivityIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">icons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">login</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîê&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">purchase</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üõí&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üí¨&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">like</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">share</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîÑ&#39;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">icons</span><span class="p">[</span><span class="kr">type</span><span class="p">];</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-icon&quot;</span><span class="p">&gt;{</span><span class="nx">getActivityIcon</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">productName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-meta&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Product</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">productName</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-actions&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;liked&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ü§ç&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">likeCount</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">formatTimestamp</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">)}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Verification</strong>:
Wait 60 seconds for the timer to tick...</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Rendering ActivityItem: act_001
Rendering ActivityItem: act_002
<span class="k">...</span> (still 50 times!)
</code></pre></div>

<p><strong>Wait, what?</strong> We added <code>React.memo</code> but all items still re-render!</p>
<h3 id="diagnostic-analysis-why-reactmemo-didnt-help">Diagnostic Analysis: Why React.memo Didn't Help</h3>
<p><strong>React DevTools Evidence - Profiler</strong>:
- All 50 <code>ActivityItem</code> components still rendered
- Reason: "Props changed"</p>
<p><strong>Let's investigate which prop changed</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Add this inside ActivityItem to debug</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Props:&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">activity.id</span><span class="p">,</span>
<span class="w">  </span><span class="nx">currentTime</span><span class="o">:</span><span class="w"> </span><span class="kt">currentTime.toISOString</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">onLike</span><span class="o">:</span><span class="w"> </span><span class="kt">onLike.toString</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Console output on first render</strong>:</p>
<div class="codehilite"><pre><span></span><code>Props: {
  activityId: &quot;act_001&quot;,
  currentTime: &quot;2024-01-15T10:30:00.000Z&quot;,
  onLike: &quot;function onLike() { ... }&quot;
}
</code></pre></div>

<p><strong>Console output on second render (after timer tick)</strong>:</p>
<div class="codehilite"><pre><span></span><code>Props: {
  activityId: &quot;act_001&quot;,
  currentTime: &quot;2024-01-15T10:31:00.000Z&quot;,  ‚Üê Changed!
  onLike: &quot;function onLike() { ... }&quot;
}
</code></pre></div>

<p><strong>Root cause identified</strong>:
The <code>currentTime</code> prop is a new <code>Date</code> object on every render. Even though the time value changed by only 60 seconds, it's a completely new object reference. React.memo's shallow comparison sees:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">oldProps</span><span class="p">.</span><span class="nx">currentTime</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">newProps</span><span class="p">.</span><span class="nx">currentTime</span><span class="w">  </span><span class="c1">// false (different objects)</span>
</code></pre></div>

<p>So React.memo thinks the props changed and re-renders the component.</p>
<p><strong>But there's another problem</strong>: The <code>onLike</code> function is also recreated on every render of <code>ActivityFeed</code>. Let's verify:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// In ActivityFeed, add this:</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activityId</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// This function is recreated on every render of ActivityFeed</span>
<span class="c1">// So every ActivityItem gets a new function reference</span>
</code></pre></div>

<h3 id="the-failure-reference-equality-vs-value-equality">The Failure: Reference Equality vs. Value Equality</h3>
<p>This is a fundamental JavaScript concept that trips up many React developers.</p>
<p><strong>Primitive values</strong> (numbers, strings, booleans) are compared by value:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>
</code></pre></div>

<p><strong>Objects, arrays, and functions</strong> are compared by reference:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">obj1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">obj2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">obj2</span><span class="p">);</span><span class="w">  </span><span class="c1">// false (different objects)</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">arr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">arr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">arr2</span><span class="p">);</span><span class="w">  </span><span class="c1">// false (different arrays)</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">fn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fn2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fn1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">fn2</span><span class="p">);</span><span class="w">  </span><span class="c1">// false (different functions)</span>
</code></pre></div>

<p><strong>In React</strong>:
Every time a component re-renders, any objects, arrays, or functions defined inside it are recreated with new references. React.memo sees these as "changed" even if their content is identical.</p>
<h3 id="solution-usecallback-for-function-stability">Solution: useCallback for Function Stability</h3>
<p>React provides <code>useCallback</code> to memoize functions:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 8 (With useCallback)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useCallback</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoadingState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/LoadingState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/ErrorState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EmptyState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/EmptyState&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">ActivityFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ActivityFilter</span><span class="p">&gt;(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">currentTime</span><span class="p">,</span><span class="w"> </span><span class="nx">setCurrentTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setCurrentTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fetchActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span><span class="w">  </span><span class="c1">// Only recreate if userId changes</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetchActivities</span><span class="p">();</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">fetchActivities</span><span class="p">]);</span>

<span class="w">  </span><span class="c1">// Memoize the like handler</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activityId</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// In a real app, this would make an API call</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span><span class="w">  </span><span class="c1">// No dependencies, so function never changes</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">activities.filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">LoadingState</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">ErrorState</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="w"> </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchActivities</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">EmptyState</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-filters&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">All</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Purchases</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span>
<span class="w">          </span><span class="na">isFiltered</span><span class="w"> </span>
<span class="w">          </span><span class="na">filterType</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span>
<span class="w">          </span><span class="na">onClearFilter</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">              </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">              </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">              </span><span class="na">currentTime</span><span class="o">=</span><span class="p">{</span><span class="nx">currentTime</span><span class="p">}</span>
<span class="w">              </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="na">Now</span><span class="w"> </span><span class="na">stable</span><span class="w"> </span><span class="na">across</span><span class="w"> </span><span class="na">renders</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Wrapped <code>handleLike</code> with <code>useCallback</code>
- Added empty dependency array <code>[]</code> (function never changes)
- Wrapped <code>fetchActivities</code> with <code>useCallback</code> too (depends on <code>userId</code>)</p>
<p><strong>Verification</strong>:
Wait 60 seconds for the timer to tick...</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Rendering ActivityItem: act_001
Rendering ActivityItem: act_002
<span class="k">...</span> (still 50 times!)
</code></pre></div>

<p><strong>Still not working!</strong> The <code>onLike</code> function is now stable, but <code>currentTime</code> is still a new object on every render.</p>
<h3 id="the-real-problem-passing-unnecessary-props">The Real Problem: Passing Unnecessary Props</h3>
<p>Here's the key insight: <strong>Do we actually need to pass <code>currentTime</code> as a prop?</strong></p>
<p>Each <code>ActivityItem</code> only needs to know its own <code>activity.timestamp</code>. It can calculate the relative time itself using the current time. We don't need to pass <code>currentTime</code> from the parent.</p>
<h3 id="iteration-2-removing-unnecessary-props">Iteration 2: Removing Unnecessary Props</h3>
<p>Let's refactor to remove the <code>currentTime</code> prop entirely:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityItem.tsx - Version 5 (Self-contained Time Formatting)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">memo</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activity</span><span class="o">:</span><span class="w"> </span><span class="kt">Activity</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onLike</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onLike</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLiked</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLiked</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">likeCount</span><span class="p">,</span><span class="w"> </span><span class="nx">setLikeCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">likes</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">relativeTime</span><span class="p">,</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Rendering ActivityItem: </span><span class="si">${</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Each item manages its own time updates</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="s1">&#39;Just now&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">diffMins</span><span class="si">}</span><span class="sb">m ago`</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1440</span><span class="p">)</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="si">}</span><span class="sb">h ago`</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">).</span><span class="nx">toLocaleDateString</span><span class="p">());</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">updateTime</span><span class="p">();</span><span class="w">  </span><span class="c1">// Initial update</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">updateTime</span><span class="p">,</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span><span class="w">  </span><span class="c1">// Update every minute</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLiked</span><span class="p">(</span><span class="o">!</span><span class="nx">isLiked</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setLikeCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">onLike</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getActivityIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">icons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">login</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîê&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">purchase</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üõí&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üí¨&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">like</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">share</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîÑ&#39;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">icons</span><span class="p">[</span><span class="kr">type</span><span class="p">];</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-icon&quot;</span><span class="p">&gt;{</span><span class="nx">getActivityIcon</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">productName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-meta&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Product</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">productName</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-actions&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;liked&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ü§ç&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">likeCount</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;{</span><span class="nx">relativeTime</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Version 9 (No currentTime Prop)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useCallback</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoadingState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/LoadingState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/ErrorState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EmptyState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/EmptyState&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">ActivityFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ActivityFilter</span><span class="p">&gt;(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fetchActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetchActivities</span><span class="p">();</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">fetchActivities</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activityId</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">activities.filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">LoadingState</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">ErrorState</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="w"> </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchActivities</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;&lt;</span><span class="nt">EmptyState</span><span class="w"> </span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-filters&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">All</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Purchases</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span>
<span class="w">          </span><span class="na">isFiltered</span><span class="w"> </span>
<span class="w">          </span><span class="na">filterType</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span>
<span class="w">          </span><span class="na">onClearFilter</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">              </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">              </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">              </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What changed</strong>:
- Removed <code>currentTime</code> state from <code>ActivityFeed</code>
- Removed <code>currentTime</code> prop from <code>ActivityItem</code>
- Each <code>ActivityItem</code> now manages its own timer with <code>useEffect</code>
- Each item updates independently</p>
<p><strong>Verification</strong>:
Wait 60 seconds...</p>
<p><strong>Browser Console</strong>:</p>
<div class="codehilite"><pre><span></span><code>Rendering ActivityItem: act_001
</code></pre></div>

<p>Only ONE item re-renders! The item whose timestamp just crossed a minute boundary (e.g., from "2m ago" to "3m ago").</p>
<p><strong>React DevTools Evidence - Profiler</strong>:
- <code>ActivityFeed</code> rendered: 0 times (not triggered)
- <code>ActivityItem</code> rendered: 1 time (only the one that needed to update)
- Total render time: 0.8ms (vs. 45ms before)</p>
<p><strong>React DevTools Evidence - Highlight Updates</strong>:
Only one item flashes when its timer updates. The other 49 items remain static.</p>
<p><strong>Performance improvement</strong>:
- Before: 50 re-renders every 60 seconds = 45ms
- After: 1 re-render every 60 seconds = 0.8ms
- <strong>56x faster</strong> ‚úì</p>
<h3 id="the-lesson-optimize-component-boundaries">The Lesson: Optimize Component Boundaries</h3>
<p>The best optimization is often <strong>not using optimization techniques at all</strong>, but rather <strong>designing better component boundaries</strong>.</p>
<p><strong>Before</strong>: Parent managed time, passed it to all children
- Every child re-rendered when parent's time changed
- Needed React.memo and useCallback to prevent re-renders</p>
<p><strong>After</strong>: Each child manages its own time
- Only the child that needs to update re-renders
- No React.memo or useCallback needed for this specific case</p>
<p><strong>General principle</strong>: Push state down to the component that needs it. Don't lift state up unless multiple components need to share it.</p>
<h3 id="when-reactmemo-and-usecallback-are-actually-needed">When React.memo and useCallback Are Actually Needed</h3>
<p>Our refactor eliminated the need for React.memo in this case. But there are scenarios where you do need it:</p>
<h4 id="scenario-1-expensive-rendering">Scenario 1: Expensive Rendering</h4>
<p>If a component is computationally expensive to render:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Component that does heavy calculations</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ExpensiveChart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">ExpensiveChart</span><span class="p">({</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">[]</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Expensive calculations here</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">processedData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="cm">/* complex transformations */</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">canvas</span><span class="p">&gt;{</span><span class="cm">/* render chart */</span><span class="p">}&lt;/</span><span class="nt">canvas</span><span class="p">&gt;;</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="scenario-2-large-lists">Scenario 2: Large Lists</h4>
<p>When rendering many items that don't change often:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// List of 1000 items</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ProductList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">products</span><span class="o">:</span><span class="w"> </span><span class="kt">Product</span><span class="p">[]</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleAddToCart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">productId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Add to cart logic</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ProductCard</span><span class="w"> </span>
<span class="w">          </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
<span class="w">          </span><span class="na">product</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">}</span>
<span class="w">          </span><span class="na">onAddToCart</span><span class="o">=</span><span class="p">{</span><span class="nx">handleAddToCart</span><span class="p">}</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="na">Stable</span><span class="w"> </span><span class="na">function</span><span class="w"> </span><span class="na">reference</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">))}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Memoized to prevent re-render when parent re-renders</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ProductCard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">ProductCard</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">product</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onAddToCart</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">product</span><span class="o">:</span><span class="w"> </span><span class="kt">Product</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onAddToCart</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">onAddToCart</span><span class="p">(</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">)}&gt;</span><span class="nx">Add</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Cart</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="scenario-3-props-that-are-objects-or-arrays">Scenario 3: Props That Are Objects or Arrays</h4>
<p>When you must pass objects/arrays as props:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">ParentComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Without useMemo, this creates a new object on every render</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">theme</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;dark&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">fontSize</span><span class="o">:</span><span class="w"> </span><span class="kt">14</span><span class="p">,</span>
<span class="w">    </span><span class="nx">showLineNumbers</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="w">  </span><span class="p">}),</span><span class="w"> </span><span class="p">[]);</span><span class="w">  </span><span class="c1">// Empty deps = never changes</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">CodeEditor</span><span class="w"> </span><span class="na">config</span><span class="o">=</span><span class="p">{</span><span class="nx">config</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">CodeEditor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">CodeEditor</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">config</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="kt">EditorConfig</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Expensive editor initialization</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="cm">/* editor UI */</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="common-failure-modes-and-their-signatures_2">Common Failure Modes and Their Signatures</h3>
<h4 id="symptom-reactmemo-doesnt-prevent-re-renders">Symptom: React.memo doesn't prevent re-renders</h4>
<p><strong>Browser behavior</strong>:
Component still re-renders despite being wrapped in memo.</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Rendering</span><span class="w"> </span><span class="n">MyComponent</span><span class="w"> </span><span class="p">(</span><span class="nl">props</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="err">{</span><span class="p">...</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="nl">onClick</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">Function</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="p">)</span>
<span class="n">Rendering</span><span class="w"> </span><span class="n">MyComponent</span><span class="w"> </span><span class="p">(</span><span class="nl">props</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="err">{</span><span class="p">...</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="nl">onClick</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">Function</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="p">)</span>
</code></pre></div>

<p><strong>DevTools clues</strong>:
- Profiler shows "Props changed" as reason
- Props appear identical but are different object references</p>
<p><strong>Root cause</strong>: Props are objects, arrays, or functions recreated on each render</p>
<p><strong>Solution</strong>: Use <code>useCallback</code> for functions, <code>useMemo</code> for objects/arrays, or redesign component boundaries</p>
<h4 id="symptom-usecallback-dependencies-cause-infinite-loops">Symptom: useCallback dependencies cause infinite loops</h4>
<p><strong>Browser behavior</strong>:
Browser freezes, "Maximum update depth exceeded" error.</p>
<p><strong>Console pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="n">exceeded</span><span class="o">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span>
<span class="n">repeatedly</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">setState</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">useEffect</span><span class="o">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">useEffect</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="n">dependency</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">render</span><span class="o">.</span>
</code></pre></div>

<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå WRONG: handleClick depends on count, which changes, which recreates handleClick</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">handleClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// ‚Üê Depends on count</span>
<span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">]);</span><span class="w">  </span><span class="c1">// ‚Üê count changes, so handleClick changes</span>

<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// This effect runs when handleClick changes</span>
<span class="w">  </span><span class="c1">// But handleClick changes when count changes</span>
<span class="w">  </span><span class="c1">// And this effect might change count...</span>
<span class="w">  </span><span class="c1">// INFINITE LOOP</span>
<span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">handleClick</span><span class="p">]);</span>
</code></pre></div>

<p><strong>Solution</strong>: Use functional state updates:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚úì CORRECT: No dependency on count</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">handleClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">setCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// ‚Üê Functional update</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span><span class="w">  </span><span class="c1">// ‚Üê Empty deps, never changes</span>
</code></pre></div>

<h4 id="symptom-premature-optimization-makes-code-worse">Symptom: Premature optimization makes code worse</h4>
<p><strong>Browser behavior</strong>:
Code works but is harder to read and maintain.</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ‚ùå Unnecessary optimization</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">MyComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Hello</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>
<span class="p">});</span>

<span class="c1">// This component is so simple that memo adds no value</span>
<span class="c1">// It just makes the code harder to understand</span>
</code></pre></div>

<p><strong>Root cause</strong>: Optimizing before measuring</p>
<p><strong>Solution</strong>: Profile first, optimize second</p>
<h3 id="when-to-apply-these-optimizations">When to Apply These Optimizations</h3>
<p><strong>React.memo</strong>:
- Use for: Components that render frequently with the same props
- Optimizes for: Preventing unnecessary re-renders
- Avoid when: Component is simple and fast to render
- Measure: Use React DevTools Profiler to confirm it helps</p>
<p><strong>useCallback</strong>:
- Use for: Functions passed to memoized child components
- Optimizes for: Stable function references
- Avoid when: Function is not passed to memoized children
- Measure: Check if removing it causes performance issues</p>
<p><strong>useMemo</strong>:
- Use for: Expensive calculations or object/array props
- Optimizes for: Avoiding recalculation
- Avoid when: Calculation is cheap (&lt; 1ms)
- Measure: Profile the calculation time</p>
<p><strong>Component Boundary Redesign</strong>:
- Use for: State that only one component needs
- Optimizes for: Reducing re-render scope
- Prefer this over: memo/useCallback when possible
- Measure: Simplicity and maintainability</p>
<p><strong>General Rule</strong>: Don't optimize until you have a performance problem. When you do optimize, measure before and after to confirm it helped.</p>
<h2 id="the-complete-journey-chapter-5-synthesis">The Complete Journey - Chapter 5 Synthesis</h2>
<h2 id="the-complete-journey-from-naive-lists-to-optimized-rendering">The Complete Journey: From Naive Lists to Optimized Rendering</h2>
<p>Let's trace the evolution of our Activity Feed through all its iterations, examining what we learned at each stage.</p>
<h3 id="the-journey-from-problem-to-solution">The Journey: From Problem to Solution</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Problem</th>
<th>Technique Applied</th>
<th>Result</th>
<th>Performance Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No keys in list</td>
<td>None</td>
<td>Console warning, potential bugs</td>
<td>Baseline</td>
</tr>
<tr>
<td>1</td>
<td>Added keys</td>
<td><code>key={activity.id}</code></td>
<td>Warning gone, correct reconciliation</td>
<td>No change</td>
</tr>
<tr>
<td>2</td>
<td>Wrong keys (index)</td>
<td><code>key={index}</code></td>
<td>State appears on wrong items</td>
<td>No change</td>
</tr>
<tr>
<td>3</td>
<td>Fixed keys</td>
<td><code>key={activity.id}</code> (corrected)</td>
<td>State preserved correctly</td>
<td>No change</td>
</tr>
<tr>
<td>4</td>
<td>No empty/error states</td>
<td>Conditional rendering patterns</td>
<td>Better UX for edge cases</td>
<td>No change</td>
</tr>
<tr>
<td>5</td>
<td>All items re-render on timer</td>
<td>Passed <code>currentTime</code> prop</td>
<td>Timestamps update, but inefficient</td>
<td>50 re-renders/min (45ms)</td>
</tr>
<tr>
<td>6</td>
<td>Attempted React.memo</td>
<td><code>memo(ActivityItem)</code></td>
<td>Still re-renders (props change)</td>
<td>No improvement</td>
</tr>
<tr>
<td>7</td>
<td>Attempted useCallback</td>
<td><code>useCallback(handleLike)</code></td>
<td>Still re-renders (currentTime object)</td>
<td>No improvement</td>
</tr>
<tr>
<td>8</td>
<td>Redesigned component boundaries</td>
<td>Each item manages own timer</td>
<td>Only changed items re-render</td>
<td>1 re-render/min (0.8ms) - 56x ‚úì</td>
</tr>
<tr>
<td>9</td>
<td>Extracted state components</td>
<td>Separate Loading/Error/Empty</td>
<td>Cleaner code, better maintainability</td>
<td>No change (code quality win)</td>
</tr>
</tbody>
</table>
<h3 id="final-implementation-production-ready-activity-feed">Final Implementation: Production-Ready Activity Feed</h3>
<p>Here's our complete, optimized implementation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// src/types/activity.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;login&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;share&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">metadata</span><span class="o">?:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">amount?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">    </span><span class="nx">productName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">targetUser?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">likes?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed/LoadingState.tsx</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">LoadingState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-loading&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">activities</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed/ErrorState.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorStateProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onRetry</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ErrorState</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">onRetry</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ErrorStateProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-error&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;error-icon&quot;</span><span class="p">&gt;</span><span class="err">‚ö†Ô∏è</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="nx">activities</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">error</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onRetry</span><span class="p">}&gt;</span><span class="nx">Try</span><span class="w"> </span><span class="nx">Again</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed/EmptyState.tsx</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">EmptyStateProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">isFiltered?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
<span class="w">  </span><span class="nx">filterType?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onClearFilter</span><span class="o">?:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">EmptyState</span><span class="p">({</span><span class="w"> </span><span class="nx">isFiltered</span><span class="p">,</span><span class="w"> </span><span class="nx">filterType</span><span class="p">,</span><span class="w"> </span><span class="nx">onClearFilter</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">EmptyStateProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isFiltered</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-empty-filter&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">No</span><span class="w"> </span><span class="p">{</span><span class="nx">filterType</span><span class="p">}</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span><span class="nx">found</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClearFilter</span><span class="p">}&gt;</span><span class="nx">Show</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">activities</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-empty&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;empty-icon&quot;</span><span class="p">&gt;</span><span class="err">üì≠</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">No</span><span class="w"> </span><span class="nx">activity</span><span class="w"> </span><span class="nx">yet</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Your</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">actions</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">appear</span><span class="w"> </span><span class="nx">here</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityItem.tsx - Final Version</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">memo</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activity</span><span class="o">:</span><span class="w"> </span><span class="kt">Activity</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onLike</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">activity</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onLike</span><span class="w"> </span>
<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ActivityItemProps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLiked</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLiked</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">likeCount</span><span class="p">,</span><span class="w"> </span><span class="nx">setLikeCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">likes</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">relativeTime</span><span class="p">,</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffMins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="s1">&#39;Just now&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">diffMins</span><span class="si">}</span><span class="sb">m ago`</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1440</span><span class="p">)</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">diffMins</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="si">}</span><span class="sb">h ago`</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="nx">setRelativeTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">).</span><span class="nx">toLocaleDateString</span><span class="p">());</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">updateTime</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">updateTime</span><span class="p">,</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">activity</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLiked</span><span class="p">(</span><span class="o">!</span><span class="nx">isLiked</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setLikeCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">onLike</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getActivityIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">icons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">login</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîê&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">purchase</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üõí&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üí¨&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">like</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">share</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;üîÑ&#39;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">icons</span><span class="p">[</span><span class="kr">type</span><span class="p">];</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-item&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-icon&quot;</span><span class="p">&gt;{</span><span class="nx">getActivityIcon</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="kr">type</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-content&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-description&quot;</span><span class="p">&gt;{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">description</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">productName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-meta&quot;</span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Product</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">productName</span><span class="p">}</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-actions&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">          </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">          </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;liked&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="na">aria-label</span><span class="o">=</span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Unlike&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Like&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">isLiked</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;‚ù§Ô∏è&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ü§ç&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="nx">likeCount</span><span class="p">}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">span</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-time&quot;</span><span class="p">&gt;{</span><span class="nx">relativeTime</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">// src/components/ActivityFeed.tsx - Final Version</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useCallback</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Activity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../types/activity&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ActivityItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityItem&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoadingState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/LoadingState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/ErrorState&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EmptyState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ActivityFeed/EmptyState&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">ActivityFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Activity</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ActivityFeed</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activities</span><span class="p">,</span><span class="w"> </span><span class="nx">setActivities</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Activity</span><span class="err">[]</span><span class="p">&gt;([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ActivityFilter</span><span class="p">&gt;(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fetchActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/activities`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setActivities</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetchActivities</span><span class="p">();</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">fetchActivities</span><span class="p">]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">activityId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// In production, this would make an API call</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/activities/</span><span class="si">${</span><span class="nx">activityId</span><span class="si">}</span><span class="sb">/like`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="w"> </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Liked activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Failed to like activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filteredActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nx">activities</span><span class="w"> </span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">activities.filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">filter</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Early returns for distinct states</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">LoadingState</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">ErrorState</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="w"> </span><span class="na">onRetry</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchActivities</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-feed&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-header&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">Activity</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-filters&quot;</span><span class="w"> </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;tablist&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;tab&quot;</span>
<span class="w">            </span><span class="na">aria-selected</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">}</span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">All</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;tab&quot;</span>
<span class="w">            </span><span class="na">aria-selected</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">}</span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Purchases</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;tab&quot;</span>
<span class="w">            </span><span class="na">aria-selected</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="p">}</span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Comments</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;comment&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span>
<span class="w">            </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;tab&quot;</span>
<span class="w">            </span><span class="na">aria-selected</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="p">}</span>
<span class="w">            </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;like&#39;</span><span class="p">)}</span>
<span class="w">            </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">          </span><span class="p">&gt;</span>
<span class="w">            </span><span class="nx">Likes</span><span class="w"> </span><span class="p">({</span><span class="nx">activities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">})</span>
<span class="w">          </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">EmptyState</span><span class="w"> </span>
<span class="w">          </span><span class="na">isFiltered</span><span class="w"> </span>
<span class="w">          </span><span class="na">filterType</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span>
<span class="w">          </span><span class="na">onClearFilter</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)}</span>
<span class="w">        </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;activity-list&quot;</span><span class="w"> </span><span class="na">role</span><span class="o">=</span><span class="s">&quot;feed&quot;</span><span class="w"> </span><span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Activity feed&quot;</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">filteredActivities</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">activity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">&lt;</span><span class="nt">ActivityItem</span><span class="w"> </span>
<span class="w">              </span><span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span>
<span class="w">              </span><span class="na">activity</span><span class="o">=</span><span class="p">{</span><span class="nx">activity</span><span class="p">}</span>
<span class="w">              </span><span class="na">onLike</span><span class="o">=</span><span class="p">{</span><span class="nx">handleLike</span><span class="p">}</span>
<span class="w">            </span><span class="p">/&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="decision-framework-list-rendering-and-performance">Decision Framework: List Rendering and Performance</h3>
<p>Use this framework to make decisions about list rendering and optimization:</p>
<h4 id="when-to-use-keys">When to Use Keys</h4>
<p><strong>Always use unique, stable keys for lists</strong>:
- ‚úì Use data IDs: <code>key={item.id}</code>
- ‚úì Generate stable IDs: <code>key={</code>${item.type}-${item.timestamp}<code>}</code>
- ‚ö†Ô∏è Use index only if: List never reorders, items have no state, items never added/removed
- ‚ùå Never use: <code>Math.random()</code>, <code>Date.now()</code>, or any value that changes on each render</p>
<h4 id="when-to-use-conditional-rendering-patterns">When to Use Conditional Rendering Patterns</h4>
<p><strong>Early returns</strong> (guard clauses):
- Use for: Mutually exclusive states (loading, error, empty, success)
- Best when: Each state needs completely different UI
- Example: Loading spinner vs. error message vs. data display</p>
<p><strong>Ternary operator</strong>:
- Use for: Simple binary conditions
- Best when: Both branches are simple
- Avoid: Nesting more than one level</p>
<p><strong>Logical AND (&amp;&amp;)</strong>:
- Use for: Showing/hiding single elements
- Best when: No "else" branch needed
- Watch out: Falsy values like <code>0</code> will render</p>
<p><strong>Object mapping</strong>:
- Use for: 3+ distinct states
- Best when: States are represented by union types
- Example: Status indicators, theme variants</p>
<h4 id="when-to-optimize-with-reactmemo">When to Optimize with React.memo</h4>
<p><strong>Use React.memo when</strong>:
1. Component renders frequently with same props
2. Component is expensive to render (&gt; 5ms)
3. Component is in a large list (&gt; 50 items)
4. Profiler shows it's a bottleneck</p>
<p><strong>Don't use React.memo when</strong>:
1. Component is simple and fast (&lt; 1ms)
2. Props change on every render anyway
3. You haven't measured a performance problem
4. Component rarely re-renders</p>
<h4 id="when-to-use-usecallback">When to Use useCallback</h4>
<p><strong>Use useCallback when</strong>:
1. Passing function to memoized child component
2. Function is a dependency of useEffect
3. Function is expensive to create
4. Profiler shows function recreation is a problem</p>
<p><strong>Don't use useCallback when</strong>:
1. Function is not passed to memoized children
2. Function has no dependencies
3. You haven't measured a performance problem
4. It makes code harder to read</p>
<h4 id="when-to-redesign-component-boundaries">When to Redesign Component Boundaries</h4>
<p><strong>Consider redesigning when</strong>:
1. Parent re-renders cause many children to re-render
2. State is only used by one component
3. You're using many memo/useCallback to prevent re-renders
4. Component tree is deeply nested</p>
<p><strong>Redesign strategies</strong>:
1. <strong>Push state down</strong>: Move state to the component that uses it
2. <strong>Lift content up</strong>: Pass children as props to avoid re-renders
3. <strong>Split components</strong>: Separate frequently-changing parts from static parts
4. <strong>Use composition</strong>: Combine small, focused components</p>
<h3 id="lessons-learned">Lessons Learned</h3>
<h4 id="1-keys-are-not-optional">1. Keys Are Not Optional</h4>
<p>Keys are React's way of tracking list items across renders. Without proper keys:
- State appears on wrong items
- Performance degrades
- Animations break
- Focus is lost</p>
<p><strong>Always use stable, unique identifiers as keys.</strong></p>
<h4 id="2-conditional-rendering-is-about-clarity">2. Conditional Rendering Is About Clarity</h4>
<p>Choose the pattern that makes your intent clearest:
- Early returns for mutually exclusive states
- Ternaries for simple binary conditions
- Logical AND for showing/hiding elements
- Object mapping for multiple states</p>
<p><strong>Optimize for readability first, performance second.</strong></p>
<h4 id="3-optimization-is-about-measurement">3. Optimization Is About Measurement</h4>
<p>Don't optimize until you have evidence of a problem:
1. Use React DevTools Profiler to measure
2. Identify the bottleneck
3. Apply the appropriate technique
4. Measure again to confirm improvement</p>
<p><strong>Premature optimization makes code harder to maintain.</strong></p>
<h4 id="4-component-boundaries-matter-more-than-optimization-techniques">4. Component Boundaries Matter More Than Optimization Techniques</h4>
<p>The best optimization is often redesigning component boundaries:
- Push state down to where it's used
- Avoid passing props that change frequently
- Let components manage their own concerns</p>
<p><strong>Good architecture beats clever optimization.</strong></p>
<h4 id="5-reference-equality-vs-value-equality">5. Reference Equality vs. Value Equality</h4>
<p>Objects, arrays, and functions are compared by reference, not value:
- New object/array/function = new reference
- React.memo sees new reference as "changed"
- Use useCallback/useMemo to stabilize references</p>
<p><strong>Understand JavaScript's equality semantics to use React effectively.</strong></p>
<h3 id="whats-next">What's Next</h3>
<p>In Chapter 6, we'll tackle forms and validation. We'll see how the patterns we learned here‚Äîproper keys, conditional rendering, and performance optimization‚Äîapply to complex form interactions. We'll also introduce React Hook Form and Zod to handle form state and validation professionally.</p>
<p>Our Activity Feed is now production-ready:
- ‚úì Proper keys for correct reconciliation
- ‚úì Comprehensive error handling
- ‚úì Optimized rendering (56x faster)
- ‚úì Clean, maintainable code
- ‚úì Accessible UI with ARIA attributes</p>
<p>This is the foundation for building any list-based UI in React.</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 12:33:23 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>