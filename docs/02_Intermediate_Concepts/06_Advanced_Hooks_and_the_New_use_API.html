<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06_Advanced_Hooks_and_the_New_use_API</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">02_Intermediate_Concepts</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-6-advanced-hooks-and-the-new-use-api">Chapter 6: Advanced Hooks and the New <code>use</code> API</h1>
<h2 id="the-revolutionary-use-hook">The Revolutionary <code>use</code> Hook</h2>
<h2 id="learning-objective">Learning Objective</h2>
<p>Understand the purpose of the new <code>use</code> hook and its unique ability to be called conditionally, breaking one of the original rules of hooks.</p>
<h2 id="why-this-matters">Why This Matters</h2>
<p>The <code>use</code> hook is the most significant addition to React's hook system since its introduction. It simplifies reading data from resources like Promises and Context, and its conditional nature unlocks more flexible and efficient component patterns that were previously impossible.</p>
<h2 id="discovery-phase">Discovery Phase</h2>
<p>In all the hooks we've seen so far‚Äî<code>useState</code>, <code>useEffect</code>, <code>useContext</code>‚Äîwe've followed a strict rule: <strong>Hooks must be called at the top level of your component.</strong> They cannot be inside loops, conditions, or nested functions.</p>
<p>React 19 introduces a new, special hook that changes this rule: the <code>use</code> hook.</p>
<p>The <code>use</code> hook is a unified API for a single purpose: <strong>reading a value from a resource</strong>. A "resource" can be a Promise (which represents future data) or Context (which represents shared data). The key innovation is that <code>use</code> can be called inside conditions and loops.</p>
<p>Let's see a conceptual example to grasp the difference.</p>
<p>Here's what you <strong>cannot</strong> do with traditional hooks:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useContext</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">MyContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">);</span>

<span class="c1">// THIS CODE WILL CAUSE A REACT ERROR</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">InvalidConditionalHook</span><span class="p">({</span><span class="w"> </span><span class="nx">shouldGetData</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">shouldGetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Error: React Hook &quot;useState&quot; is called conditionally.</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">setData</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Error: React Hook &quot;useContext&quot; is called conditionally.</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useContext</span><span class="p">(</span><span class="nx">MyContext</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;...&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p>React enforces this "top-level" rule to ensure that hooks are called in the same order on every render, which is how React keeps track of state between renders.</p>
<p>Now, let's see how the <code>use</code> hook is different. It's designed specifically for these conditional scenarios.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ThemeContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">(</span><span class="s1">&#39;light&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">UserContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Guest&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">ConditionalComponent</span><span class="p">({</span><span class="w"> </span><span class="nx">useTheme</span><span class="p">,</span><span class="w"> </span><span class="nx">useUser</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Welcome&#39;</span><span class="p">;</span>

<span class="c1">// ‚úÖ CORRECT: `use` can be called conditionally</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">useTheme</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">use</span><span class="p">(</span><span class="nx">ThemeContext</span><span class="p">);</span>
<span class="nx">message</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`, enjoying the </span><span class="si">${</span><span class="nx">theme</span><span class="si">}</span><span class="sb"> theme`</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ‚úÖ CORRECT: Another conditional call</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">useUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">use</span><span class="p">(</span><span class="nx">UserContext</span><span class="p">);</span>
<span class="nx">message</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">` </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{</span><span class="nx">message</span><span class="p">}</span><span class="o">!</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">ThemeContext</span><span class="p">.</span><span class="na">Provider</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;dark&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">UserContext</span><span class="p">.</span><span class="na">Provider</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="w"> </span><span class="p">}}&gt;</span>
<span class="p">&lt;</span><span class="nt">ConditionalComponent</span><span class="w"> </span><span class="na">useTheme</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="w"> </span><span class="na">useUser</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">ConditionalComponent</span><span class="w"> </span><span class="na">useTheme</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span><span class="w"> </span><span class="na">useUser</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">ConditionalComponent</span><span class="w"> </span><span class="na">useTheme</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="w"> </span><span class="na">useUser</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">UserContext</span><span class="p">.</span><span class="na">Provider</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ThemeContext</span><span class="p">.</span><span class="na">Provider</span><span class="p">&gt;</span>
<span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Rendered Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Welcome, enjoying the dark theme Alice!
Welcome Alice!
Welcome, enjoying the dark theme!
</code></pre></div>

<p>This code works perfectly. The <code>use</code> hook allows the component to "opt-in" to reading a resource based on props or state. This was a major limitation of <code>useContext</code> and is a huge step forward for component flexibility.</p>
<h2 id="deep-dive">Deep Dive</h2>
<p>The <code>use</code> hook's ability to be called conditionally might seem like it breaks the fundamental rules of hooks, but it's designed with a different internal mechanism. Unlike <code>useState</code>, which needs to preserve its "slot" on every render, <code>use</code> is purely for <em>reading</em> a value that already exists somewhere else (in a context provider or a promise). React can handle this dynamic reading without losing track of component state.</p>
<p>Think of it this way:</p>
<ul>
<li><strong><code>useState</code>, <code>useEffect</code>, etc.</strong>: These hooks <em>create and manage stateful logic</em> within a component. Their order must be consistent for React to link the state from one render to the next.</li>
<li><strong><code>use</code></strong>: This hook <em>reads data from an external source</em>. It doesn't create its own state in the same way. It's more like a special, React-aware "getter" function that can suspend the component.</li>
</ul>
<p>This new capability allows for more efficient components. A component can avoid the work of subscribing to and processing context if it doesn't need it for the current render.</p>
<h3 id="common-confusion-is-use-a-replacement-for-all-other-hooks">Common Confusion: Is <code>use</code> a replacement for all other hooks?</h3>
<p><strong>You might think</strong>: I should replace all my <code>useState</code> and <code>useEffect</code> calls with <code>use</code>.</p>
<p><strong>Actually</strong>: No. The <code>use</code> hook is not a general-purpose replacement for other hooks. It serves a very specific purpose: to read values from resources. You still need <code>useState</code> for managing component state, <code>useEffect</code> for side effects, and <code>useReducer</code> for complex state logic.</p>
<p><strong>Why the confusion happens</strong>: The name "use" is very generic, and its ability to be called conditionally makes it seem like a "better" hook.</p>
<p><strong>How to remember</strong>: Think of <code>use</code> as <code>useResource</code>. Its job is to <strong>use a resource</strong>, like a promise or context. If you aren't reading from a resource, you need a different hook.</p>
<h2 id="production-perspective">Production Perspective</h2>
<p>The introduction of <code>use</code> simplifies many patterns and improves performance.</p>
<p><strong>When professionals will choose this</strong>:</p>
<ul>
<li><strong>Conditional Data Fetching</strong>: Kicking off a data fetch only after a user interaction, right inside the render logic.</li>
<li><strong>Dynamic Context Consumption</strong>: A component might only need theme context when in "edit mode". Using <code>use(ThemeContext)</code> inside an <code>if (isEditing)</code> block is cleaner and more performant than <code>useContext</code> at the top level.</li>
<li><strong>A/B Testing or Feature Flags</strong>: A component can conditionally read from a feature flag context to alter its behavior, without subscribing to that context if the feature is disabled.</li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li>‚úÖ <strong>Advantage</strong>: Drastically simplifies component logic by allowing you to read data where you need it.</li>
<li>‚úÖ <strong>Advantage</strong>: Can improve performance by avoiding unnecessary context subscriptions.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: It's a new concept. Teams will need to learn when to use it versus traditional hooks. Overusing it could make component logic harder to follow if conditions become too nested.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: To use <code>use</code> with promises, your component architecture needs to incorporate <code>&lt;Suspense&gt;</code> boundaries, which we'll cover next.</li>
</ul>
<h2 id="reading-promises-with-use">Reading Promises with <code>use</code></h2>
<h2 id="learning-objective_1">Learning Objective</h2>
<p>Learn how to use the <code>use</code> hook with Promises to handle asynchronous operations, replacing complex <code>useEffect</code> and <code>useState</code> combinations for data fetching.</p>
<h2 id="why-this-matters_1">Why This Matters</h2>
<p>Data fetching is a core task in any React application. The traditional approach using <code>useEffect</code> and <code>useState</code> involves significant boilerplate to manage loading, error, and data states. The <code>use</code> hook, combined with React Suspense, revolutionizes this by letting you write data fetching logic as if it were synchronous.</p>
<h2 id="discovery-phase-the-old-way">Discovery Phase: The Old Way</h2>
<p>Let's start with a concrete example of fetching user data the "classic" way. We need at least three state variables: one for the data, one for the loading status, and one for any potential errors.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// A mock API call that returns a promise</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fetchUserProfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userId</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resolve</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">reject</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;User not found&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">UserProfileClassic</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">setUser</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Reset state for new fetch</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="nx">setUser</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="nx">fetchUserProfile</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setUser</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">finally</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Re-run effect if userId changes</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">profile</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="ne">Error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Email</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">UserProfileClassic</span><span class="w"> </span><span class="na">userId</span><span class="o">=</span><span class="p">{</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ol>
<li>Initially, "Loading profile..." is displayed for 1 second.</li>
<li>Then, the user's profile is rendered: "Alice", "Email: alice@example.com".</li>
<li>If you were to change the <code>userId</code> prop to <code>2</code>, it would show "Loading profile..." again, then "Error: User not found".</li>
</ol>
<p>This pattern works, but it's verbose. We're manually managing three different states and their transitions. This complexity grows with every new piece of data you need to fetch.</p>
<h2 id="deep-dive-the-new-way-with-use-and-suspense">Deep Dive: The New Way with <code>use</code> and Suspense</h2>
<p>Now, let's refactor this using the <code>use</code> hook. The <code>use</code> hook can be passed a promise.</p>
<ul>
<li>If the promise is <strong>pending</strong>, React will <strong>suspend</strong> the rendering of the component.</li>
<li>If the promise <strong>resolves</strong>, <code>use</code> will return the resolved <strong>value</strong>.</li>
<li>If the promise <strong>rejects</strong>, <code>use</code> will <strong>throw</strong> the error.</li>
</ul>
<p>This suspension and error throwing are caught by two special components: <code>&lt;Suspense&gt;</code> and <strong>Error Boundaries</strong>. For now, we'll focus on Suspense.</p>
<p>Let's see the code. It's shockingly simple.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">use</span><span class="p">,</span><span class="w"> </span><span class="nx">Suspense</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// A mock API call that returns a promise</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fetchUserProfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userId</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resolve</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">reject</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;User not found&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>

<span class="c1">// NOTE: For `use` to work with promises, we need a way to cache the promise</span>
<span class="c1">// so it&#39;s not re-created on every render. A simple cache can be a Map.</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">promiseCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">getProfile</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">promiseCache</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">userId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">promiseCache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">userId</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchUserProfile</span><span class="p">(</span><span class="nx">userId</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">promiseCache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">UserProfile</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 1. Get the promise (from a cache or library)</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userPromise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getProfile</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// 2. Pass the promise to `use`. React handles the rest.</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">use</span><span class="p">(</span><span class="nx">userPromise</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// 3. Render the success state. The loading and error states are handled by React.</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Email</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">User</span><span class="w"> </span><span class="nx">Profile</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Suspense</span><span class="w"> </span><span class="na">fallback</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Loading</span><span class="w"> </span><span class="nx">profile</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;}&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">UserProfile</span><span class="w"> </span><span class="na">userId</span><span class="o">=</span><span class="p">{</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">Suspense</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:
The visual behavior is identical to the classic version.</p>
<ol>
<li>"Loading profile..." is displayed for 1 second. (This is the <code>fallback</code> from <code>&lt;Suspense&gt;</code>).</li>
<li>The <code>UserProfile</code> component renders its UI.</li>
</ol>
<h3 id="component-trace">Component Trace</h3>
<p>Let's trace what happens when <code>&lt;UserProfile userId={1} /&gt;</code> renders for the first time:</p>
<ol>
<li><code>UserProfile</code> is called.</li>
<li><code>getProfile(1)</code> is called. It creates a new promise to fetch the user data, stores it in the cache, and returns it.</li>
<li><code>const user = use(userPromise);</code> is executed.</li>
<li>The promise is <strong>pending</strong>. React sees this and <strong>suspends</strong> <code>UserProfile</code>. It stops rendering this component.</li>
<li>React looks up the component tree for the nearest <code>&lt;Suspense&gt;</code> boundary.</li>
<li>It finds <code>&lt;Suspense fallback={&lt;p&gt;Loading profile...&lt;/p&gt;}&gt;</code> and renders its <code>fallback</code> UI.</li>
<li>After 1 second, the promise <strong>resolves</strong>.</li>
<li>React "wakes up" and tries to render <code>UserProfile</code> again from where it left off.</li>
<li><code>const user = use(userPromise);</code> is executed again. This time, the promise is already resolved.</li>
<li><code>use</code> returns the resolved value: <code>{ id: 1, name: 'Alice', ... }</code>.</li>
<li>The component continues rendering and returns the JSX with the user's name and email.</li>
<li>React replaces the "Loading profile..." fallback with the fully rendered <code>UserProfile</code> component.</li>
</ol>
<p>Notice we didn't write <code>if (isLoading)</code> or <code>if (error)</code>. React handles these states declaratively through <code>&lt;Suspense&gt;</code> and Error Boundaries (Chapter 18). The component code is only concerned with the "happy path"‚Äîwhat to render when the data is available.</p>
<h3 id="common-confusion-where-did-my-data-fetching-library-go">Common Confusion: Where did my data fetching library go?</h3>
<p><strong>You might think</strong>: <code>use(fetch(...))</code> is all I need, and I can forget about libraries like React Query or SWR.</p>
<p><strong>Actually</strong>: The <code>use</code> hook is a low-level primitive. It doesn't handle caching, request deduplication, or re-fetching. In the example above, we created a very simple <code>promiseCache</code> to prevent re-fetching on every render. Production-grade data fetching libraries will integrate with <code>use</code> and Suspense to provide these features for you.</p>
<p><strong>How to remember</strong>: <code>use</code> gives you the ability to suspend. Data fetching libraries give you the policies (caching, revalidation) for <em>when</em> and <em>how</em> to fetch. You will likely use a library that uses <code>use</code> under the hood.</p>
<h2 id="production-perspective_1">Production Perspective</h2>
<p>Using <code>use</code> with Suspense is the future of data fetching in React.</p>
<p><strong>When professionals choose this</strong>:</p>
<ul>
<li>For nearly all data fetching in new React 19+ applications.</li>
<li>To create smoother loading experiences where different parts of the page can load independently. You can nest multiple <code>&lt;Suspense&gt;</code> boundaries.</li>
<li>To simplify component logic and remove vast amounts of state management boilerplate.</li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li>‚úÖ <strong>Advantage</strong>: Massively simplified component code. Focus on the success case.</li>
<li>‚úÖ <strong>Advantage</strong>: Better UX. Suspense avoids jarring whole-page spinners and allows for granular loading states.</li>
<li>‚úÖ <strong>Advantage</strong>: Eliminates entire classes of bugs, like race conditions, that are common with <code>useEffect</code> fetching.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: Requires a mental model shift. You need to think in terms of Suspense boundaries rather than <code>isLoading</code> flags.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: Requires a caching strategy for promises. You can't just call <code>use(fetch(...))</code> in a loop or on every render. This is why data fetching libraries that support Suspense are still essential.</li>
</ul>
<h2 id="conditional-context-consumption-with-use">Conditional Context Consumption with <code>use</code></h2>
<h2 id="learning-objective_2">Learning Objective</h2>
<p>Demonstrate how the <code>use</code> hook enables conditional and dynamic consumption of React Context, overcoming a key limitation of <code>useContext</code>.</p>
<h2 id="why-this-matters_2">Why This Matters</h2>
<p>Components often need to adapt their behavior based on props or internal state. Previously, if a component <em>might</em> need a value from context, it had to subscribe using <code>useContext</code> on every single render, even when the value wasn't used. The <code>use</code> hook solves this, allowing components to be more efficient and logically cleaner.</p>
<h2 id="discovery-phase-the-usecontext-limitation">Discovery Phase: The <code>useContext</code> Limitation</h2>
<p>Let's set up a scenario. We have a <code>SettingsPanel</code> component. If the user is an admin (indicated by an <code>isAdmin</code> prop), we want to show a special theme setting read from an <code>AdminThemeContext</code>.</p>
<p>Here's how we might try to build it with <code>useContext</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useContext</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">AdminThemeContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">({</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">SettingsPanel</span><span class="p">({</span><span class="w"> </span><span class="nx">isAdmin</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// We MUST call useContext at the top level, unconditionally.</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">adminTheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useContext</span><span class="p">(</span><span class="nx">AdminThemeContext</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">User</span><span class="w"> </span><span class="nx">Settings</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Standard</span><span class="w"> </span><span class="nx">setting</span><span class="w"> </span><span class="mf">1</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Standard</span><span class="w"> </span><span class="nx">setting</span><span class="w"> </span><span class="mf">2</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="cm">/* We only USE the value down here, but we subscribed above. */</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isAdmin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span>
<span class="w">          </span><span class="na">style</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">border</span><span class="o">:</span><span class="w"> </span><span class="sb">`2px solid </span><span class="si">${</span><span class="nx">adminTheme</span><span class="p">.</span><span class="nx">color</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;10px&quot;</span><span class="w"> </span><span class="p">}}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span><span class="nx">Admin</span><span class="w"> </span><span class="nx">Controls</span><span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Theme</span><span class="w"> </span><span class="nx">Color</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">adminTheme</span><span class="p">.</span><span class="nx">color</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">AdminThemeContext</span><span class="p">.</span><span class="na">Provider</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;blue&quot;</span><span class="w"> </span><span class="p">}}&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">SettingsPanel</span><span class="w"> </span><span class="na">isAdmin</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">hr</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">SettingsPanel</span><span class="w"> </span><span class="na">isAdmin</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">AdminThemeContext</span><span class="p">.</span><span class="na">Provider</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Rendered Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>User Settings
Standard setting 1
Standard setting 2

Admin Controls
Theme Color: blue

---
User Settings
Standard setting 1
Standard setting 2
</code></pre></div>

<p>This works, but look closely at the <code>SettingsPanel</code> component when <code>isAdmin</code> is <code>false</code>. It still calls <code>useContext(AdminThemeContext)</code>. This means that even the non-admin panel is subscribed to the <code>AdminThemeContext</code>. If the context value were to change, this component would re-render unnecessarily. For a small app, this is trivial. For a large app with many components and contexts, this can lead to performance issues.</p>
<h2 id="deep-dive-conditional-reading-with-use">Deep Dive: Conditional Reading with <code>use</code></h2>
<p>Now, let's refactor <code>SettingsPanel</code> using the <code>use</code> hook. Since <code>use</code> can be called inside an <code>if</code> statement, we can make the context subscription itself conditional.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">AdminThemeContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">({</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">SettingsPanel</span><span class="p">({</span><span class="w"> </span><span class="nx">isAdmin</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">adminTheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// ‚úÖ We only read from the context IF we are an admin.</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isAdmin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">adminTheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">use</span><span class="p">(</span><span class="nx">AdminThemeContext</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span><span class="nx">User</span><span class="w"> </span><span class="nx">Settings</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Standard</span><span class="w"> </span><span class="nx">setting</span><span class="w"> </span><span class="mf">1</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Standard</span><span class="w"> </span><span class="nx">setting</span><span class="w"> </span><span class="mf">2</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="w">      </span><span class="p">{</span><span class="nx">isAdmin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span>
<span class="w">          </span><span class="na">style</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">border</span><span class="o">:</span><span class="w"> </span><span class="sb">`2px solid </span><span class="si">${</span><span class="nx">adminTheme</span><span class="p">.</span><span class="nx">color</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;10px&quot;</span><span class="w"> </span><span class="p">}}</span>
<span class="w">        </span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span><span class="nx">Admin</span><span class="w"> </span><span class="nx">Controls</span><span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
<span class="w">          </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Theme</span><span class="w"> </span><span class="nx">Color</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">adminTheme</span><span class="p">.</span><span class="nx">color</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">AdminThemeContext</span><span class="p">.</span><span class="na">Provider</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;blue&quot;</span><span class="w"> </span><span class="p">}}&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">SettingsPanel</span><span class="w"> </span><span class="na">isAdmin</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">hr</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">SettingsPanel</span><span class="w"> </span><span class="na">isAdmin</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">AdminThemeContext</span><span class="p">.</span><span class="na">Provider</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>The rendered output is identical, but the behavior is fundamentally better.</p>
<h3 id="component-trace_1">Component Trace</h3>
<p>Let's trace the two scenarios for the new <code>SettingsPanel</code>:</p>
<p><strong>Scenario 1: <code>isAdmin={true}</code></strong></p>
<ol>
<li>The <code>SettingsPanel</code> component renders.</li>
<li>The <code>if (isAdmin)</code> condition is <code>true</code>.</li>
<li><code>adminTheme = use(AdminThemeContext);</code> is executed.</li>
<li>The hook reads the value <code>{ color: 'blue' }</code> from the context provider.</li>
<li>The component subscribes to changes in this context.</li>
<li>The admin controls are rendered using the theme color.</li>
</ol>
<p><strong>Scenario 2: <code>isAdmin={false}</code></strong></p>
<ol>
<li>The <code>SettingsPanel</code> component renders.</li>
<li>The <code>if (isAdmin)</code> condition is <code>false</code>.</li>
<li>The <code>use(AdminThemeContext)</code> line is <strong>never executed</strong>.</li>
<li>The component <strong>does not subscribe</strong> to the <code>AdminThemeContext</code>.</li>
<li>The admin controls are not rendered.</li>
<li>If the <code>AdminThemeContext</code> value changes, this component will <strong>not</strong> re-render.</li>
</ol>
<p>This is a powerful optimization. The component only pays the cost (subscription and potential re-renders) for the context it actually needs for a given render.</p>
<h3 id="common-confusion-should-i-always-use-usecontext-instead-of-usecontextcontext">Common Confusion: Should I always use <code>use(Context)</code> instead of <code>useContext(Context)</code>?</h3>
<p><strong>You might think</strong>: <code>use(Context)</code> is strictly better, so I should replace all my <code>useContext</code> calls.</p>
<p><strong>Actually</strong>: Not necessarily. If your component <em>always</em> needs the value from a context, <code>useContext(Context)</code> at the top level is perfectly clear and idiomatic. It signals to anyone reading the code that this component has a firm dependency on that context.</p>
<p><strong>How to remember</strong>:</p>
<ul>
<li>Use <code>useContext(Context)</code> when the dependency is <strong>unconditional</strong>.</li>
<li>Use <code>use(Context)</code> when the dependency is <strong>conditional</strong> (inside an <code>if</code>, a <code>switch</code>, or an early <code>return</code>).</li>
</ul>
<h2 id="production-perspective_2">Production Perspective</h2>
<p>Conditional context consumption is a significant architectural improvement for large-scale React applications.</p>
<p><strong>When professionals choose this</strong>:</p>
<ul>
<li><strong>Feature Flags</strong>: A component can <code>use(FeatureFlagContext)</code> inside a conditional block to enable or disable features, avoiding subscriptions for users who don't have the flag enabled.</li>
<li><strong>Complex UI States</strong>: In a component with multiple modes (e.g., "view", "edit", "comment"), it can conditionally <code>use</code> different contexts relevant to each mode.</li>
<li><strong>Performance Optimization</strong>: In complex dashboards, components can opt-out of subscribing to high-frequency update contexts if they are not currently visible or relevant, preventing cascading re-renders.</li>
</ul>
<p><strong>Real-world example</strong>: Imagine a component in a design tool like Figma. When you select an element, the component might need to <code>use(SelectedElementContext)</code>. When no element is selected, it has no need for that context. Using <code>use</code> inside <code>if (isSelected)</code> is the perfect pattern for this. It makes the component more self-contained and efficient.</p>
<h2 id="usecontext-for-global-state">useContext for Global State</h2>
<h2 id="learning-objective_3">Learning Objective</h2>
<p>Understand how to use the <code>useContext</code> hook to consume shared data from a React Context, solving the "prop drilling" problem.</p>
<h2 id="why-this-matters_3">Why This Matters</h2>
<p>While <code>use</code> provides a new way to consume context, <code>useContext</code> remains a fundamental hook. Understanding it is crucial because it establishes the provider/consumer pattern that <code>use</code> builds upon. It's the primary tool for making data like themes, user information, or language preferences available throughout your application without passing props through many layers.</p>
<h2 id="discovery-phase-the-problem-of-prop-drilling">Discovery Phase: The Problem of Prop Drilling</h2>
<p>Imagine a simple app that needs to display the current user's name in a deeply nested component. Without Context, you have to pass the <code>user</code> object down as a prop through every single intermediate component. This is called "prop drilling."</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// App has the user data</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Barbara&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Page</span><span class="w"> </span><span class="na">user</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="c1">// Page doesn&#39;t need user, but has to pass it down</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">Page</span><span class="p">({</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="na">user</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="c1">// Layout doesn&#39;t need user, but has to pass it down</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">Layout</span><span class="p">({</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Header</span><span class="w"> </span><span class="na">user</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="c1">// Header is the component that finally needs the data</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">Header</span><span class="p">({</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">!</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<p><strong>Rendered Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Welcome, Barbara!
</code></pre></div>

<p>This works, but it's brittle and verbose. <code>Page</code> and <code>Layout</code> are cluttered with a prop they don't care about. If another component deep in the tree needed <code>user</code>, we'd have to thread it through even more components.</p>
<h2 id="deep-dive-solving-prop-drilling-with-context">Deep Dive: Solving Prop Drilling with Context</h2>
<p>React's Context API provides a way to solve this. It creates a sort of "teleporter" for data.</p>
<p>The process has three steps:</p>
<ol>
<li><strong>Create</strong> the context using <code>React.createContext()</code>.</li>
<li><strong>Provide</strong> a value to the context using a <code>&lt;MyContext.Provider&gt;</code> component, wrapping a part of your component tree.</li>
<li><strong>Consume</strong> the value in any child component using the <code>useContext</code> hook.</li>
</ol>
<p>Let's refactor our example.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createContext</span><span class="p">,</span><span class="w"> </span><span class="nx">useContext</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// 1. Create the context. We can provide a default value.</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">UserContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createContext</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Guest&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// App provides the user data</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Barbara&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="c1">// 2. Provide the value to the entire component tree</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">UserContext</span><span class="p">.</span><span class="na">Provider</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">}&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Page</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">UserContext</span><span class="p">.</span><span class="na">Provider</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Page no longer needs to know about `user`</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">Page</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Layout</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="c1">// Layout no longer needs to know about `user`</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">Layout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">Header</span><span class="w"> </span><span class="p">/&gt;;</span>
<span class="p">}</span>

<span class="c1">// Header can now directly access the data</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">Header</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 3. Consume the value from the nearest provider</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useContext</span><span class="p">(</span><span class="nx">UserContext</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Welcome</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">!</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<p><strong>Rendered Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>Welcome, Barbara!
</code></pre></div>

<p>The result is the same, but the code is much cleaner. <code>Page</code> and <code>Layout</code> are simplified because they no longer act as intermediaries. <code>Header</code> is now self-sufficient; it explicitly declares its dependency on <code>UserContext</code> and gets the data directly.</p>
<h3 id="component-trace_2">Component Trace</h3>
<ol>
<li><code>App</code> renders and wraps its children in <code>&lt;UserContext.Provider value={{ name: 'Barbara' }}&gt;</code>. This makes the <code>user</code> object available to any component inside it.</li>
<li><code>Page</code> and <code>Layout</code> render. They don't know or care about <code>UserContext</code>.</li>
<li><code>Header</code> renders. It calls <code>useContext(UserContext)</code>.</li>
<li>React looks up the component tree from <code>Header</code>.</li>
<li>It finds the <code>&lt;UserContext.Provider&gt;</code> in <code>App</code> and its <code>value</code> prop.</li>
<li><code>useContext</code> returns that value (<code>{ name: 'Barbara' }</code>).</li>
<li>The <code>Header</code> component renders the welcome message.</li>
<li>Crucially, if the <code>value</code> in the provider changes, React will automatically re-render any components that consume that context (like <code>Header</code>).</li>
</ol>
<h3 id="common-confusion-does-context-replace-redux-or-other-state-management-libraries">Common Confusion: Does Context replace Redux or other state management libraries?</h3>
<p><strong>You might think</strong>: Context provides global state, so I don't need libraries like Redux or Zustand anymore.</p>
<p><strong>Actually</strong>: Context is a mechanism for dependency injection, not a complete state management solution. It's excellent for low-frequency updates of global data (theme, user auth, language). However, for high-frequency updates (like state in a complex editor), it can lead to performance issues, as every component consuming the context will re-render on every change.</p>
<p><strong>How to remember</strong>:</p>
<ul>
<li><strong>Context</strong>: Best for making static or infrequently changing global data available. Think "read-mostly".</li>
<li><strong>State Management Libraries (Redux, Zustand)</strong>: Best for managing complex, frequently updated application state. They offer performance optimizations (like selectors), middleware for side effects, and better developer tools.</li>
</ul>
<h2 id="production-perspective_3">Production Perspective</h2>
<p>Context is a foundational tool in any production React application.</p>
<p><strong>When professionals choose this</strong>:</p>
<ul>
<li><strong>Theming</strong>: Providing a theme object (colors, fonts) to the entire app.</li>
<li><strong>Authentication</strong>: Sharing the current user's status and profile across all components.</li>
<li><strong>Internationalization (i18n)</strong>: Making the current language and translation functions available.</li>
</ul>
<p><strong>Best Practices</strong>:</p>
<ul>
<li><strong>Keep contexts focused</strong>: Don't create one giant "AppContext" with everything. Create separate contexts for separate concerns (<code>ThemeContext</code>, <code>AuthContext</code>). This prevents components from re-rendering due to unrelated state changes.</li>
<li><strong>Memoize provider values</strong>: If the <code>value</code> passed to a provider is an object or array created inline (<code>&lt;MyContext.Provider value={{ theme: 'dark' }}&gt;</code>), it will be a new object on every render, causing all consumers to re-render. You should memoize this value with <code>useMemo</code> or <code>useState</code> to prevent unnecessary re-renders (we'll cover <code>useMemo</code> shortly).</li>
</ul>
<h2 id="usereducer-for-complex-state-logic">useReducer for Complex State Logic</h2>
<h2 id="learning-objective_4">Learning Objective</h2>
<p>Learn how to manage complex component state using the <code>useReducer</code> hook, making state transitions more predictable and maintainable.</p>
<h2 id="why-this-matters_4">Why This Matters</h2>
<p>As your components grow, managing state with multiple <code>useState</code> calls can become messy and error-prone. <code>useReducer</code> provides a more structured approach, inspired by the Redux pattern, for handling state logic. It's perfect for when the next state depends on the previous one, or when you have several related pieces of state to manage together.</p>
<h2 id="discovery-phase-the-usestate-spaghetti">Discovery Phase: The <code>useState</code> Spaghetti</h2>
<p>Let's build a simple shopping cart quantity selector. It needs to increment, decrement, and allow the user to set a specific quantity. Using <code>useState</code>, the logic might look like this.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">QuantitySelector</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">quantity</span><span class="p">,</span><span class="w"> </span><span class="nx">setQuantity</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">quantity</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setQuantity</span><span class="p">((</span><span class="nx">q</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="s2">&quot;Cannot add more than 10 items.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleDecrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">quantity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setQuantity</span><span class="p">((</span><span class="nx">q</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="s2">&quot;Quantity cannot be less than 1.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSetQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setQuantity</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setQuantity</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Reset on invalid input</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="s2">&quot;Please enter a number between 1 and 10.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleDecrement</span><span class="p">}&gt;</span><span class="o">-</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">input</span><span class="w"> </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">quantity</span><span class="p">}</span><span class="w"> </span><span class="na">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSetQuantity</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleIncrement</span><span class="p">}&gt;</span><span class="o">+</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">style</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="w"> </span><span class="p">}}&gt;{</span><span class="nx">error</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">QuantitySelector</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ul>
<li>Clicking "+" increases the number.</li>
<li>Clicking "-" decreases the number.</li>
<li>Typing in the input sets the number.</li>
<li>An error message appears if you go outside the 1-10 range.</li>
</ul>
<p>This works, but notice how the state logic is scattered across three different event handlers. The business rules for <code>quantity</code> and <code>error</code> are intertwined and duplicated. If we added another piece of related state, like a "last action" tracker, it would get even messier.</p>
<h2 id="deep-dive-centralizing-logic-with-usereducer">Deep Dive: Centralizing Logic with <code>useReducer</code></h2>
<p><code>useReducer</code> lets us consolidate all this state transition logic into a single function called a <strong>reducer</strong>.</p>
<p>A reducer is a pure function that takes two arguments: the current <code>state</code> and an <code>action</code> object. It computes and returns the <em>next</em> state.</p>
<p>The hook <code>useReducer</code> returns the current <code>state</code> and a <code>dispatch</code> function. Instead of calling <code>setState</code>, you <code>dispatch</code> an action object.</p>
<p>Let's refactor our <code>QuantitySelector</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useReducer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">initialState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">quantity</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="w">  </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">quantityReducer</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;INCREMENT&quot;</span><span class="o">:</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">quantity</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">quantity</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">quantity</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">};</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Cannot add more than </span><span class="si">${</span><span class="nx">state</span><span class="p">.</span><span class="nx">max</span><span class="si">}</span><span class="sb"> items.`</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;DECREMENT&quot;</span><span class="o">:</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">quantity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">quantity</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">quantity</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">};</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Quantity cannot be less than </span><span class="si">${</span><span class="nx">state</span><span class="p">.</span><span class="nx">min</span><span class="si">}</span><span class="sb">.`</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;SET_QUANTITY&quot;</span><span class="o">:</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">min</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">quantity</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">};</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span>
<span class="w">        </span><span class="nx">quantity</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Please enter a number between </span><span class="si">${</span><span class="nx">state</span><span class="p">.</span><span class="nx">min</span><span class="si">}</span><span class="sb"> and </span><span class="si">${</span><span class="nx">state</span><span class="p">.</span><span class="nx">max</span><span class="si">}</span><span class="sb">.`</span><span class="p">,</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Unknown action type&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">QuantitySelector</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useReducer</span><span class="p">(</span><span class="nx">quantityReducer</span><span class="p">,</span><span class="w"> </span><span class="nx">initialState</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DECREMENT&quot;</span><span class="w"> </span><span class="p">})}&gt;</span><span class="o">-</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">        </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span>
<span class="w">        </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">quantity</span><span class="p">}</span>
<span class="w">        </span><span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">          </span><span class="nx">dispatch</span><span class="p">({</span>
<span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SET_QUANTITY&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">),</span>
<span class="w">          </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;INCREMENT&quot;</span><span class="w"> </span><span class="p">})}&gt;</span><span class="o">+</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">p</span><span class="w"> </span><span class="na">style</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="w"> </span><span class="p">}}&gt;{</span><span class="nx">state</span><span class="p">.</span><span class="nx">error</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">QuantitySelector</span><span class="p">;</span>
</code></pre></div>

<h3 id="component-trace_3">Component Trace</h3>
<ol>
<li><strong>Initialization</strong>: <code>useReducer(quantityReducer, initialState)</code> is called. React stores <code>initialState</code> and gives us back the current state (<code>state</code>) and the <code>dispatch</code> function.</li>
<li><strong>User Interaction</strong>: The user clicks the "+" button.</li>
<li><strong>Dispatch</strong>: The <code>onClick</code> handler calls <code>dispatch({ type: 'INCREMENT' })</code>.</li>
<li><strong>Reducer Execution</strong>: React calls our <code>quantityReducer</code> with the current <code>state</code> and the <code>action</code> we dispatched.</li>
<li><strong>State Calculation</strong>: Inside the reducer, the <code>switch</code> statement matches the <code>'INCREMENT'</code> type. It calculates the new state object based on the current state and returns it.</li>
<li><strong>Re-render</strong>: React receives the new state object from the reducer. It detects a change and re-renders the <code>QuantitySelector</code> component. The component now receives the updated <code>state</code> from the <code>useReducer</code> hook, and the UI reflects the new quantity.</li>
</ol>
<p>The component's responsibility is now much clearer: it dispatches actions describing <em>what happened</em>. The reducer's responsibility is to handle the state logic, describing <em>how the state changes</em> in response. This separation makes both parts easier to understand, test, and maintain.</p>
<h3 id="common-confusion-is-usereducer-just-for-redux-users">Common Confusion: Is <code>useReducer</code> just for Redux users?</h3>
<p><strong>You might think</strong>: <code>useReducer</code> is a mini-Redux, and I only need it if I'm building a huge application.</p>
<p><strong>Actually</strong>: <code>useReducer</code> is a built-in React hook that is useful for any component with moderately complex state, regardless of whether you use Redux. It's a natural step up from <code>useState</code>. In fact, <code>useState</code> can be implemented using <code>useReducer</code> under the hood.</p>
<p><strong>How to remember</strong>:</p>
<ul>
<li><code>useState</code>: Great for simple, independent state (a boolean toggle, a single input field).</li>
<li><code>useReducer</code>: Great for complex, related state (multiple form fields with validation, state machines). Choose it when the next state depends on the previous state in a non-trivial way.</li>
</ul>
<h2 id="production-perspective_4">Production Perspective</h2>
<p>Knowing when to switch from <code>useState</code> to <code>useReducer</code> is a sign of a maturing React developer.</p>
<p><strong>When professionals choose <code>useReducer</code></strong>:</p>
<ul>
<li><strong>Complex Forms</strong>: When state updates for one field can affect others (e.g., selecting a country populates a list of states).</li>
<li><strong>State Machines</strong>: When a component can be in one of several distinct states (e.g., <code>idle</code>, <code>loading</code>, <code>success</code>, <code>error</code>) and transitions between them are well-defined.</li>
<li><strong>Decoupling Logic</strong>: When the state logic is complex enough that you want to test it separately from the UI component. You can export the reducer and test it as a pure function.</li>
<li><strong>Improving Performance</strong>: When updates are triggered from deep within a component tree, passing <code>dispatch</code> down is often more efficient than passing callback functions, as <code>dispatch</code> has a stable identity.</li>
</ul>
<h2 id="usecallback-for-performance-pre-compiler">useCallback for Performance (Pre-Compiler)</h2>
<h2 id="learning-objective_5">Learning Objective</h2>
<p>Understand the purpose of <code>useCallback</code> for memoizing functions, and recognize its role in optimizing performance before the introduction of the React 19 Compiler.</p>
<h2 id="why-this-matters_5">Why This Matters</h2>
<p>In React, re-rendering is normal. However, unnecessary re-renders of child components can slow down your application. <code>useCallback</code> is a tool to prevent this by ensuring that functions passed as props don't change on every render, which is crucial when working with memoized child components.</p>
<h3 id="legacy-pattern-notice">Legacy Pattern Notice</h3>
<p><strong>Pre-React 19</strong>: <code>useCallback</code> was a manual optimization that developers had to apply frequently to prevent performance issues, especially when passing callbacks to components wrapped in <code>React.memo</code>.</p>
<p><strong>React 19+</strong>: The new React Compiler aims to make <code>useCallback</code> and <code>useMemo</code> obsolete by automatically memoizing components and hooks. This section teaches the concept because it's vital for understanding how React's rendering works and for maintaining older codebases. In new projects with the compiler enabled, you will rarely need to write this by hand.</p>
<h2 id="discovery-phase-the-problem-of-re-created-functions">Discovery Phase: The Problem of Re-created Functions</h2>
<p>Let's create a scenario with a parent component that has a counter, and a child component that has a button to increment that counter. We will wrap the child component in <code>React.memo</code> to prevent it from re-rendering if its props don't change.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// React.memo prevents a re-render if props are shallowly equal</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">IncrementButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(({</span><span class="w"> </span><span class="nx">onIncrement</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;IncrementButton is rendering!&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onIncrement</span><span class="p">}&gt;</span><span class="nx">Increment</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;;</span>
<span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">ParentComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">otherState</span><span class="p">,</span><span class="w"> </span><span class="nx">setOtherState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// This function is re-created on every render of ParentComponent</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setCount</span><span class="p">((</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">IncrementButton</span><span class="w"> </span><span class="na">onIncrement</span><span class="o">=</span><span class="p">{</span><span class="nx">handleIncrement</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">hr</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setOtherState</span><span class="p">(</span><span class="o">!</span><span class="nx">otherState</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="nx">Toggle</span><span class="w"> </span><span class="nx">Other</span><span class="w"> </span><span class="nx">State</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Other</span><span class="w"> </span><span class="nx">State</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nb">String</span><span class="p">(</span><span class="nx">otherState</span><span class="p">)}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">ParentComponent</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ol>
<li>Open your developer console. You will see "IncrementButton is rendering!".</li>
<li>Click the "Increment" button. The count increases, and you see "IncrementButton is rendering!" again in the console. This is expected.</li>
<li>Now, click the "Toggle Other State" button. The <code>otherState</code> value flips, but notice the console: "IncrementButton is rendering!" appears again!</li>
</ol>
<p>This is the problem. Even though <code>IncrementButton</code> has nothing to do with <code>otherState</code>, it re-renders. We wrapped it in <code>React.memo</code>, so why is this happening?</p>
<p>Because on every render of <code>ParentComponent</code>, <code>const handleIncrement = () =&gt; { ... }</code> is a <strong>brand new function</strong>. When React compares the props for <code>IncrementButton</code>, it sees that the <code>onIncrement</code> prop from the last render is not strictly equal (<code>===</code>) to the <code>onIncrement</code> prop from the current render. So, <code>React.memo</code> gives up, and the component re-renders.</p>
<h2 id="deep-dive-memoizing-the-callback">Deep Dive: Memoizing the Callback</h2>
<p><code>useCallback</code> solves this by giving us the <em>same function instance</em> between renders, as long as its dependencies haven't changed.</p>
<p><code>const memoizedCallback = useCallback(callbackFunction, [dependencies]);</code></p>
<p>Let's apply it to our example.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useCallback</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">IncrementButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(({</span><span class="w"> </span><span class="nx">onIncrement</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;IncrementButton is rendering!&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onIncrement</span><span class="p">}&gt;</span><span class="nx">Increment</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;;</span>
<span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">ParentComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">otherState</span><span class="p">,</span><span class="w"> </span><span class="nx">setOtherState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// `useCallback` returns a memoized version of the callback.</span>
<span class="w">  </span><span class="c1">// The dependency array `[]` is empty, so the same function is returned on every render.</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setCount</span><span class="p">((</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span><span class="w"> </span><span class="c1">// Empty dependency array means the function never needs to be recreated.</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">IncrementButton</span><span class="w"> </span><span class="na">onIncrement</span><span class="o">=</span><span class="p">{</span><span class="nx">handleIncrement</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">hr</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setOtherState</span><span class="p">(</span><span class="o">!</span><span class="nx">otherState</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="nx">Toggle</span><span class="w"> </span><span class="nx">Other</span><span class="w"> </span><span class="nx">State</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Other</span><span class="w"> </span><span class="nx">State</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nb">String</span><span class="p">(</span><span class="nx">otherState</span><span class="p">)}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">ParentComponent</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ol>
<li>Open your developer console. You will see "IncrementButton is rendering!".</li>
<li>Click "Increment". The count increases, and "IncrementButton is rendering!" appears. This is still expected because the parent's state changed, causing it to re-render.</li>
<li>Click "Toggle Other State". The <code>otherState</code> flips, but this time <strong>nothing is logged to the console</strong>.</li>
</ol>
<p>Success! Because <code>handleIncrement</code> is now a stable function reference thanks to <code>useCallback</code>, <code>React.memo</code> sees that the <code>onIncrement</code> prop has not changed, and it correctly skips re-rendering the <code>IncrementButton</code>.</p>
<h3 id="the-dependency-array">The Dependency Array</h3>
<p>The second argument to <code>useCallback</code> is crucial. It's an array of values that the callback depends on. If any of these values change between renders, <code>useCallback</code> will discard the old memoized function and create a new one with the updated values.</p>
<p>For example, if our callback needed to use a prop:
<code>const memoizedFn = useCallback(() =&gt; { console.log(someProp); }, [someProp]);</code>
This tells React: "Only create a new version of this function if <code>someProp</code> changes."</p>
<h3 id="common-confusion-should-i-wrap-every-function-in-usecallback">Common Confusion: Should I wrap every function in <code>useCallback</code>?</h3>
<p><strong>You might think</strong>: <code>useCallback</code> is for performance, so I should use it on every function in my component.</p>
<p><strong>Actually</strong>: No. This is a common anti-pattern. <code>useCallback</code> itself has a small cost. It's only beneficial when you are passing the function as a prop to an optimized child component (<code>React.memo</code>), or when you're using it as a dependency in another hook like <code>useEffect</code>. Applying it everywhere adds unnecessary complexity for zero gain.</p>
<p><strong>How to remember</strong>: Use <code>useCallback</code> as a targeted optimization tool, not a default practice. Ask yourself: "Am I passing this function to a <code>React.memo</code> component?" If the answer is yes, <code>useCallback</code> is likely appropriate.</p>
<h2 id="production-perspective_5">Production Perspective</h2>
<p>Before the React Compiler, <code>useCallback</code> was a key tool in the performance optimization toolkit.</p>
<p><strong>When professionals used this</strong>:</p>
<ul>
<li>To preserve referential equality for callbacks passed to components wrapped in <code>React.memo</code>.</li>
<li>To prevent effects in <code>useEffect</code> from re-running unnecessarily when they depend on a function.</li>
<li>In custom hooks that return functions, to ensure the returned functions are stable for consumers of the hook.</li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li>‚úÖ <strong>Advantage</strong>: Prevents unnecessary re-renders of memoized children, which can be a significant performance win in complex UIs.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: Adds complexity to the code. It's another thing to reason about.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: Incorrect dependency arrays are a common source of bugs (e.g., the callback captures a "stale" value because a dependency was missed). The React ESLint plugin is essential for catching these errors.</li>
</ul>
<p>With the React 19 Compiler, the need for manual <code>useCallback</code> is greatly diminished, but understanding the concept of referential equality and its impact on rendering remains essential for any serious React developer.</p>
<h2 id="usememo-for-expensive-calculations-pre-compiler">useMemo for Expensive Calculations (Pre-Compiler)</h2>
<h2 id="learning-objective_6">Learning Objective</h2>
<p>Understand how <code>useMemo</code> can memoize the result of an expensive calculation to avoid re-computing it on every render.</p>
<h2 id="why-this-matters_6">Why This Matters</h2>
<p>Just as re-creating functions can be problematic, re-running expensive calculations on every render can make your UI feel sluggish. <code>useMemo</code> is a hook that lets you cache the result of a calculation and only re-run it when its dependencies change.</p>
<h3 id="legacy-pattern-notice_1">Legacy Pattern Notice</h3>
<p><strong>Pre-React 19</strong>: <code>useMemo</code> was the standard tool for optimizing computationally intensive operations within a component's render cycle.</p>
<p><strong>React 19+</strong>: The React Compiler is designed to handle this automatically. It can analyze your code and memoize expensive calculations without you needing to manually wrap them in <code>useMemo</code>. Learning <code>useMemo</code> is still important for understanding the underlying performance concepts and for working on projects without the compiler.</p>
<h2 id="discovery-phase-the-expensive-calculation-problem">Discovery Phase: The Expensive Calculation Problem</h2>
<p>Let's imagine we have a component that displays a list of numbers and allows the user to filter for only the prime numbers. Finding prime numbers can be computationally expensive.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="c1">// An intentionally slow function to check for primality</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">isPrime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">numberList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="mf">10000</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">PrimeNumberDisplay</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">time</span><span class="p">,</span><span class="w"> </span><span class="nx">setTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>

<span class="c1">// Update time every second to trigger re-renders</span>
<span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Component is rendering...&#39;</span><span class="p">);</span>

<span class="c1">// This expensive calculation runs on EVERY render</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">primeNumbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">numberList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">isPrime</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">filteredPrimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">primeNumbers</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">filter</span><span class="p">));</span>

<span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Current</span><span class="w"> </span><span class="nx">Time</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">time</span><span class="p">.</span><span class="nx">toLocaleTimeString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span>
<span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Filter primes...&quot;</span>
<span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span>
<span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Found</span><span class="w"> </span><span class="p">{</span><span class="nx">filteredPrimes</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="w"> </span><span class="nx">primes</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">{</span><span class="sr">/_ We&#39;ll just show the first 10 for brevity _/</span><span class="p">}</span>
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;{</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">filteredPrimes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">))}&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">PrimeNumberDisplay</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ol>
<li>The component renders and displays the time and the list of primes.</li>
<li>The time updates every second, causing the component to re-render. Notice the "Component is rendering..." log in the console every second.</li>
<li>Now, try typing in the filter input. You might notice a significant lag. Each keystroke is slow.</li>
</ol>
<p>Why is it slow? Because every time the component re-renders‚Äîwhether from the timer updating or you typing in the input‚Äîwe are re-calculating <code>numberList.filter(isPrime)</code>. This is a huge waste of CPU cycles, as the list of prime numbers itself never changes.</p>
<h2 id="deep-dive-memoizing-the-result">Deep Dive: Memoizing the Result</h2>
<p><code>useMemo</code> lets us cache, or "memoize," the result of this expensive calculation.</p>
<p><code>const memoizedValue = useMemo(() =&gt; computeExpensiveValue(a, b), [a, b]);</code></p>
<p>React will only re-run the function passed to <code>useMemo</code> if one of the dependencies (<code>a</code> or <code>b</code>) has changed since the last render. Otherwise, it returns the cached value.</p>
<p>Let's fix our component.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useMemo</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">isPrime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">numberList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="mf">10000</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">PrimeNumberDisplay</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">time</span><span class="p">,</span><span class="w"> </span><span class="nx">setTime</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>

<span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTime</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Component is rendering...&#39;</span><span class="p">);</span>

<span class="c1">// The expensive calculation is wrapped in useMemo</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">primeNumbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Calculating prime numbers... (this should be rare)&#39;</span><span class="p">);</span>
<span class="k">return</span><span class="w"> </span><span class="nx">numberList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">isPrime</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span><span class="w"> </span><span class="c1">// Empty dependency array means this runs only ONCE.</span>

<span class="c1">// This part is cheap and can run on every render</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">filteredPrimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">primeNumbers</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">filter</span><span class="p">));</span>

<span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Current</span><span class="w"> </span><span class="nx">Time</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">time</span><span class="p">.</span><span class="nx">toLocaleTimeString</span><span class="p">()}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span>
<span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Filter primes...&quot;</span>
<span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">filter</span><span class="p">}</span>
<span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setFilter</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Found</span><span class="w"> </span><span class="p">{</span><span class="nx">filteredPrimes</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="w"> </span><span class="nx">primes</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;{</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">filteredPrimes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">))}&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">PrimeNumberDisplay</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ol>
<li>On the first render, you will see "Calculating prime numbers..." in the console.</li>
<li>The time will update every second, and "Component is rendering..." will log, but "Calculating prime numbers..." will <strong>not</strong> appear again.</li>
<li>Try typing in the filter input. It should be perfectly smooth and responsive.</li>
</ol>
<p>By wrapping the expensive part in <code>useMemo</code> with an empty dependency array <code>[]</code>, we've told React to run that calculation only once for the entire lifecycle of the component and then reuse the result on every subsequent render.</p>
<h3 id="common-confusion-usecallback-vs-usememo">Common Confusion: <code>useCallback</code> vs. <code>useMemo</code></h3>
<p><strong>You might think</strong>: These two hooks seem very similar. When do I use which?</p>
<p><strong>Actually</strong>: They are related but serve different purposes.</p>
<ul>
<li><code>useMemo</code> caches the <strong>return value</strong> of a function.</li>
<li><code>useCallback</code> caches the <strong>function itself</strong>.</li>
</ul>
<p><strong>How to remember</strong>:</p>
<ul>
<li><code>useMemo</code> for <strong>values</strong> (memoized values). Use it to avoid re-computing expensive data.</li>
<li><code>useCallback</code> for <strong>functions</strong> (memoized callbacks). Use it to pass stable functions as props to <code>React.memo</code> components.</li>
</ul>
<p>In fact, <code>useCallback(fn, deps)</code> is equivalent to <code>useMemo(() =&gt; fn, deps)</code>.</p>
<h2 id="production-perspective_6">Production Perspective</h2>
<p><code>useMemo</code> is a powerful tool but should be used judiciously.</p>
<p><strong>When professionals use <code>useMemo</code></strong>:</p>
<ul>
<li>For genuinely expensive, synchronous calculations like filtering, sorting, or mapping large arrays of data.</li>
<li>To preserve referential equality for objects or arrays passed as props to memoized child components. For example, <code>const style = useMemo(() =&gt; ({ color: 'red' }), [])</code> ensures the <code>style</code> object is the same on every render.</li>
<li>When profiling has shown that a specific calculation is a performance bottleneck.</li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li>‚úÖ <strong>Advantage</strong>: Can dramatically improve performance by preventing expensive work on re-renders.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: Adds complexity. Every <code>useMemo</code> is another piece of code to maintain.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: It's not free. It uses memory to store the cached value and adds a small overhead for dependency checking. Don't wrap simple calculations in <code>useMemo</code>.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: Just like <code>useCallback</code>, an incorrect dependency array can lead to bugs where the component shows stale, outdated data because the calculation didn't re-run when it should have.</li>
</ul>
<h2 id="useref-for-dom-access-and-persistence">useRef for DOM Access and Persistence</h2>
<h2 id="learning-objective_7">Learning Objective</h2>
<p>Understand the two primary use cases for the <code>useRef</code> hook: accessing DOM elements imperatively and creating mutable "instance variables" that persist across renders without causing re-renders.</p>
<h2 id="why-this-matters_7">Why This Matters</h2>
<p>While React's declarative nature (describing UI with state and props) is its main strength, sometimes you need to step outside that model. You might need to directly interact with a DOM element (like focusing an input) or keep track of a value without triggering a re-render. <code>useRef</code> is the "escape hatch" that provides this capability.</p>
<h2 id="discovery-phase-use-case-1-accessing-the-dom">Discovery Phase: Use Case 1 - Accessing the DOM</h2>
<p>Imagine you want to build a feature where clicking a button immediately focuses a text input. This is an imperative action‚Äîyou're telling the browser "do this now." You can't achieve this with state alone. This is where <code>useRef</code> comes in.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">FocusInput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 1. Create a ref object</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">inputRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 3. Access the DOM node via the .current property</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">inputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="sr">/_ 2. Attach the ref to a DOM element _/</span><span class="p">}</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">input</span><span class="w"> </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">inputRef</span><span class="p">}</span><span class="w"> </span><span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;I will be focused&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClick</span><span class="p">}&gt;</span><span class="nx">Focus</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Input</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">FocusInput</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:
When you click the "Focus the Input" button, the text input field immediately gains focus, and your cursor appears inside it.</p>
<h3 id="component-trace_4">Component Trace</h3>
<ol>
<li><strong><code>const inputRef = useRef(null)</code></strong>: React creates a special object that looks like <code>{ current: null }</code>. This object will persist for the full lifetime of the component.</li>
<li><strong><code>&lt;input ref={inputRef} ... /&gt;</code></strong>: When React renders the <code>&lt;input&gt;</code> element to the DOM, it takes the actual DOM node and assigns it to the <code>current</code> property of our <code>inputRef</code> object. So, after rendering, <code>inputRef</code> is <code>{ current: &lt;the input DOM element&gt; }</code>.</li>
<li><strong><code>handleClick</code></strong>: When the button is clicked, we access <code>inputRef.current</code>. This now holds the real DOM input element, which has methods like <code>.focus()</code>. We call this method to imperatively focus the input.</li>
</ol>
<h2 id="deep-dive-use-case-2-persistent-instance-variables">Deep Dive: Use Case 2 - Persistent "Instance Variables"</h2>
<p>The second major use of <code>useRef</code> is to store a value that you want to persist across renders, but which <strong>should not trigger a re-render when it changes</strong>. This is the key difference between <code>useRef</code> and <code>useState</code>.</p>
<p>Let's build a simple stopwatch. We need to store the ID of the <code>setInterval</code> timer so we can clear it later.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useRef</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Stopwatch</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">seconds</span><span class="p">,</span><span class="w"> </span><span class="nx">setSeconds</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isRunning</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsRunning</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Use a ref to hold the interval ID.</span>
<span class="w">  </span><span class="c1">// If we used useState, setting the ID would cause a re-render.</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">intervalRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isRunning</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="nx">setIsRunning</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">intervalRef</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setSeconds</span><span class="p">((</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleStop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isRunning</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="nx">setIsRunning</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="w">    </span><span class="nx">intervalRef</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleReset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsRunning</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="w">    </span><span class="nx">intervalRef</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="nx">setSeconds</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Time</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">seconds</span><span class="p">}</span><span class="nx">s</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleStart</span><span class="p">}&gt;</span><span class="nx">Start</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleStop</span><span class="p">}&gt;</span><span class="nx">Stop</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleReset</span><span class="p">}&gt;</span><span class="nx">Reset</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">Stopwatch</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ul>
<li>Click "Start": The timer begins counting up every second.</li>
<li>Click "Stop": The timer pauses.</li>
<li>Click "Reset": The timer stops and resets to 0.</li>
</ul>
<p>In this example, <code>intervalRef.current</code> is used to store the timer ID returned by <code>setInterval</code>. When we assign to <code>intervalRef.current</code>, the component does <strong>not</strong> re-render. This is exactly what we want. The timer ID is just an internal piece of bookkeeping; it has no direct visual representation, so changing it shouldn't trigger a UI update. The re-renders are driven only by the <code>seconds</code> state.</p>
<h3 id="common-confusion-useref-vs-usestate">Common Confusion: <code>useRef</code> vs. <code>useState</code></h3>
<p><strong>You might think</strong>: They both store values, so when should I use one over the other?</p>
<p><strong>Actually</strong>: The difference is fundamental to how React works.</p>
<ul>
<li><strong><code>useState</code></strong>: Use for any data that is part of your component's visual output. When this data changes, you <em>want</em> React to re-render.</li>
<li><strong><code>useRef</code></strong>: Use for data that is <em>not</em> part of the visual output. It's for things the component needs to keep track of behind the scenes, like a timer ID, a subscription object, or a previous state value.</li>
</ul>
<p><strong>How to remember</strong>: If changing the value should update the screen, use <code>useState</code>. If not, use <code>useRef</code>.</p>
<h2 id="production-perspective_7">Production Perspective</h2>
<p><code>useRef</code> is an indispensable tool for bridging the declarative world of React with the imperative world of the DOM and browser APIs.</p>
<p><strong>When professionals use <code>useRef</code></strong>:</p>
<ul>
<li><strong>Managing Focus, Text Selection, or Media Playback</strong>: For controlling <code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code>, <code>&lt;video&gt;</code>, and <code>&lt;audio&gt;</code> elements.</li>
<li><strong>Integrating with Third-Party DOM Libraries</strong>: When using a library that manipulates the DOM directly (like a charting or mapping library), you'll often use a ref to give that library a DOM element to mount itself onto.</li>
<li><strong>Storing Previous State/Props</strong>: A common pattern is to store the previous value of a prop inside a ref to compare it with the current value in an effect.</li>
<li><strong>Caching expensive object instances</strong>: Storing an instance of a class that should persist for the life of the component.</li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li>‚úÖ <strong>Advantage</strong>: Provides a clean and officially supported way to work with the DOM and manage mutable state without re-renders.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: Overusing refs to manipulate the DOM can be an anti-pattern. It's often a sign that you are "fighting the framework." Always try to solve a problem with state and props first before reaching for a ref. Imperative code is generally harder to reason about than declarative code.</li>
</ul>
<h2 id="useimperativehandle">useImperativeHandle</h2>
<h2 id="learning-objective_8">Learning Objective</h2>
<p>Understand how to use <code>useImperativeHandle</code> in conjunction with <code>ref</code> to expose a custom, limited API from a child component to a parent.</p>
<h2 id="why-this-matters_8">Why This Matters</h2>
<p>Sometimes, a parent component needs to call a method on a child component. This breaks React's standard top-down data flow and is generally discouraged, but it's necessary for certain use cases, like controlling a video player or a custom form input. <code>useImperativeHandle</code> is the hook that allows you to do this in a controlled way, exposing only the specific functions you want, rather than the entire component instance.</p>
<h3 id="legacy-pattern-notice_2">Legacy Pattern Notice</h3>
<p><strong>Pre-React 19</strong>: To pass a <code>ref</code> to a function component, you had to wrap it in another function called <code>forwardRef</code>.</p>
<p><strong>React 19+</strong>: Refs are now passed as regular props, so <code>forwardRef</code> is no longer needed. This simplifies the code significantly. <code>useImperativeHandle</code> is still used inside the child component to customize the value that the ref receives. This module will show the modern React 19 approach.</p>
<h2 id="discovery-phase-the-need-for-an-imperative-api">Discovery Phase: The Need for an Imperative API</h2>
<p>Let's build a <code>FancyInput</code> component. Internally, it might have multiple DOM nodes, but we want to expose a simple API to the parent: <code>focus()</code>, <code>clear()</code>, and <code>shake()</code>. The parent shouldn't need to know about the internal structure of <code>FancyInput</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useRef</span><span class="p">,</span><span class="w"> </span><span class="nx">useImperativeHandle</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;./FancyInput.css&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assume this file has CSS for a &#39;shake&#39; animation</span>

<span class="c1">// FancyInput.css would contain something like:</span>
<span class="c1">// @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } ... }</span>
<span class="c1">// .shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">FancyInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">ref</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">internalInputRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isShaking</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsShaking</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// useImperativeHandle customizes the instance value that is exposed to parent components when using ref.</span>
<span class="w">  </span><span class="nx">useImperativeHandle</span><span class="p">(</span><span class="nx">ref</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="c1">// Expose a `focus` method</span>
<span class="w">    </span><span class="nx">focus</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">internalInputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// Expose a `clear` method</span>
<span class="w">    </span><span class="nx">clear</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">internalInputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// Expose a `shake` method</span>
<span class="w">    </span><span class="nx">shake</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setIsShaking</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">      </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsShaking</span><span class="p">(</span><span class="kc">false</span><span class="p">),</span><span class="w"> </span><span class="mf">820</span><span class="p">);</span><span class="w"> </span><span class="c1">// Duration of the CSS animation</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">}));</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">input</span>
<span class="w">      </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">internalInputRef</span><span class="p">}</span>
<span class="w">      </span><span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">isShaking</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;shake&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">}</span>
<span class="w">      </span><span class="p">{</span><span class="na">...props</span><span class="p">}</span>
<span class="w">    </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fancyInputRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFocusAndClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fancyInputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="nx">fancyInputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleInvalidSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fancyInputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">shake</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">FancyInput</span><span class="w"> </span><span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">fancyInputRef</span><span class="p">}</span><span class="w"> </span><span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Enter something...&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleFocusAndClear</span><span class="p">}&gt;</span><span class="nx">Focus</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Clear</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleInvalidSubmit</span><span class="p">}&gt;</span><span class="nx">Invalid</span><span class="w"> </span><span class="nx">Submit</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ul>
<li>Click "Focus &amp; Clear": The input field gets focus and its content is cleared.</li>
<li>Click "Invalid Submit": The input field performs a visual "shake" animation.</li>
</ul>
<h2 id="deep-dive-how-it-works">Deep Dive: How It Works</h2>
<p>Let's break down the key parts of <code>useImperativeHandle</code>.</p>
<p><code>useImperativeHandle(ref, createHandle, [dependencies])</code></p>
<ol>
<li><strong><code>ref</code></strong>: This is the <code>ref</code> prop passed down from the parent component.</li>
<li><strong><code>createHandle</code></strong>: This is a function that should return the object that will be assigned to <code>parentRef.current</code>. This object is our custom "API". In our example, it's <code>{ focus, clear, shake }</code>.</li>
<li><strong><code>[dependencies]</code> (optional)</strong>: Just like <code>useEffect</code> or <code>useMemo</code>, this dependency array determines when the <code>createHandle</code> function should be re-run.</li>
</ol>
<h3 id="component-trace_5">Component Trace</h3>
<ol>
<li>In <code>App</code>, we create a ref: <code>const fancyInputRef = useRef(null)</code>.</li>
<li>We pass this ref to our component: <code>&lt;FancyInput ref={fancyInputRef} /&gt;</code>.</li>
<li>Inside <code>FancyInput</code>, the <code>useImperativeHandle</code> hook is called. It knows about the parent's <code>ref</code>.</li>
<li>The hook executes our <code>createHandle</code> function: <code>() =&gt; ({ focus: ..., clear: ..., shake: ... })</code>.</li>
<li>It takes the returned object and assigns it to <code>fancyInputRef.current</code> in the parent component.</li>
<li>Now, back in <code>App</code>, <code>fancyInputRef.current</code> is not the <code>&lt;input&gt;</code> DOM node. Instead, it's the custom object we defined.</li>
<li>When we call <code>fancyInputRef.current.shake()</code>, we are executing the <code>shake</code> function that we defined inside <code>FancyInput</code>.</li>
</ol>
<p>This acts as a protective barrier. The parent component has no access to <code>internalInputRef</code> or the component's state. It can only interact with the public API we explicitly exposed.</p>
<h3 id="common-confusion-why-not-just-pass-the-whole-ref-up">Common Confusion: Why not just pass the whole ref up?</h3>
<p><strong>You might think</strong>: Why not just make <code>internalInputRef</code> the ref that the parent gets? It seems simpler.</p>
<p><strong>Actually</strong>: Exposing the internal DOM structure of your component is a bad practice. It creates a tight coupling between the parent and the child. If you were to refactor <code>FancyInput</code> to be a <code>&lt;div&gt;</code> with a nested <code>&lt;input&gt;</code>, the parent's code would break because it would no longer be getting an input element.</p>
<p><strong>How to remember</strong>: <code>useImperativeHandle</code> allows a component to maintain its <strong>encapsulation</strong>. It lets the child decide what, if any, imperative actions it wants to expose to its parents, hiding its internal implementation details.</p>
<h2 id="production-perspective_8">Production Perspective</h2>
<p><code>useImperativeHandle</code> is an "escape hatch" and should be used sparingly.</p>
<p><strong>When professionals use this</strong>:</p>
<ul>
<li><strong>Wrapping complex non-React widgets</strong>: When you have a rich text editor or a video player component, you often need to expose methods like <code>editor.clear()</code> or <code>player.play()</code>.</li>
<li><strong>Controlling animations</strong>: Triggering animations imperatively, as in our <code>shake</code> example.</li>
<li><strong>Managing focus across complex form fields</strong>: A parent form might need to tell a custom <code>AddressInput</code> component to "focus the zip code field".</li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li>‚úÖ <strong>Advantage</strong>: Provides a clean, explicit way to create an imperative API for a component.</li>
<li>‚úÖ <strong>Advantage</strong>: Promotes encapsulation by hiding internal implementation details from the parent.</li>
<li>‚ö†Ô∏è <strong>Cost</strong>: It breaks the declarative, top-down data flow of React. This can make your application harder to reason about. Always consider if you can achieve the same result with props and state first. For example, instead of a <code>shake()</code> method, you could pass a prop <code>isInvalid={true}</code> and have the child component trigger the animation based on that prop change.</li>
</ul>
<h2 id="custom-hooks-creating-reusable-logic">Custom Hooks: Creating Reusable Logic</h2>
<h2 id="learning-objective_9">Learning Objective</h2>
<p>Learn how to create and use custom hooks to extract and share stateful logic between components.</p>
<h2 id="why-this-matters_9">Why This Matters</h2>
<p>Custom hooks are arguably the most powerful feature of the hooks paradigm. They allow you to solve a problem that plagued React for years: how to share stateful logic without resorting to complex patterns like Higher-Order Components or Render Props. Custom hooks make your code cleaner, more reusable, and easier to understand.</p>
<h2 id="discovery-phase-the-problem-of-duplicated-logic">Discovery Phase: The Problem of Duplicated Logic</h2>
<p>Imagine we have two different components in our app that both need to track the current window width. Without custom hooks, we would have to duplicate the logic in both places.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Header</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleResize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Cleanup function</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span><span class="w"> </span><span class="c1">// Empty array ensures this effect runs only once</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;{</span><span class="nx">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">800</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;Desktop Header&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Mobile Header&quot;</span><span class="p">}&lt;/</span><span class="nt">header</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Sidebar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleResize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">aside</span><span class="p">&gt;{</span><span class="nx">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">600</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;Full Sidebar&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Collapsed Sidebar&quot;</span><span class="p">}&lt;/</span><span class="nt">aside</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Header</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Sidebar</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:
If you resize your browser window, you'll see the text in the header and sidebar change as they cross their respective width thresholds.</p>
<p>This code works, but the <code>useState</code> and <code>useEffect</code> logic for tracking window width is identical in both <code>Header</code> and <code>Sidebar</code>. This is a violation of the "Don't Repeat Yourself" (DRY) principle. If we needed to add throttling to the resize event, we'd have to change it in two places.</p>
<h2 id="deep-dive-extracting-logic-to-a-custom-hook">Deep Dive: Extracting Logic to a Custom Hook</h2>
<p>A custom hook is simply a JavaScript function whose name starts with "use" and that can call other hooks. Let's extract our duplicated logic into a <code>useWindowWidth</code> hook.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// 1. Create the custom hook. It&#39;s just a function.</span>
<span class="c1">// Its name MUST start with &quot;use&quot;.</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useWindowWidth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleResize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="c1">// 3. Return the value the component needs.</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">width</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// --- Now our components become much simpler ---</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Header</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 2. Use the custom hook just like a built-in one.</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useWindowWidth</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;{</span><span class="nx">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">800</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;Desktop Header&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Mobile Header&quot;</span><span class="p">}&lt;/</span><span class="nt">header</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Sidebar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useWindowWidth</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">aside</span><span class="p">&gt;{</span><span class="nx">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">600</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;Full Sidebar&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Collapsed Sidebar&quot;</span><span class="p">}&lt;/</span><span class="nt">aside</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Header</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">Sidebar</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>The behavior is identical, but the code is vastly improved.</p>
<ul>
<li>The stateful logic is defined in one place (<code>useWindowWidth</code>).</li>
<li>The components (<code>Header</code>, <code>Sidebar</code>) are now declarative and simple. They just ask for the window width and use it. They don't care <em>how</em> that width is obtained or tracked.</li>
</ul>
<h3 id="component-trace-how-custom-hooks-share-logic-but-not-state">Component Trace: How Custom Hooks Share Logic (But Not State)</h3>
<p>This is a critical concept to understand. When <code>Header</code> and <code>Sidebar</code> both call <code>useWindowWidth</code>, they are <strong>not sharing state</strong>. Each one gets its own independent copy of the state inside the hook.</p>
<ol>
<li><code>Header</code> renders and calls <code>useWindowWidth()</code>. React creates a new <code>width</code> state variable for this instance.</li>
<li><code>Sidebar</code> renders and calls <code>useWindowWidth()</code>. React creates a <em>separate</em>, new <code>width</code> state variable for this instance.</li>
<li>The <code>useEffect</code> inside the hook sets up two separate event listeners, one for each component's state.</li>
<li>When the window resizes, both event listeners fire, and each one calls its own <code>setWidth</code> function, updating its own component's state.</li>
</ol>
<p>Custom hooks share <strong>stateful logic</strong>, not state itself.</p>
<h3 id="common-confusion-is-a-custom-hook-a-component">Common Confusion: Is a custom hook a component?</h3>
<p><strong>You might think</strong>: It's a function that uses React features, so it's a type of component.</p>
<p><strong>Actually</strong>: No. A component is a function that returns JSX (or other renderable output). A custom hook is a function that returns arbitrary values (a number, a string, an object, an array) and is meant to be used <em>inside</em> other components or hooks.</p>
<p><strong>How to remember</strong>: Components make UI. Hooks provide logic <em>to</em> components. If it returns JSX, it's a component. If its name starts with "use" and it doesn't return JSX, it's a hook.</p>
<h2 id="production-perspective_9">Production Perspective</h2>
<p>Custom hooks are the primary pattern for code reuse and abstraction in modern React.</p>
<p><strong>Common Custom Hooks you'll see or build</strong>:</p>
<ul>
<li><code>useFetch(url)</code>: Encapsulates data fetching, loading, and error states.</li>
<li><code>useLocalStorage(key, initialValue)</code>: A drop-in replacement for <code>useState</code> that persists the value to local storage.</li>
<li><code>useForm(initialState)</code>: Manages the state of a form, including values, errors, and submission handlers.</li>
<li><code>useAuth()</code>: Provides information about the current user from an <code>AuthContext</code>.</li>
<li><code>useDebounce(value, delay)</code>: Returns a debounced version of a value, useful for search inputs.</li>
</ul>
<p><strong>Best Practices</strong>:</p>
<ul>
<li><strong>Keep them focused</strong>: A good hook does one thing well. <code>useWindowSize</code> is better than <code>useBrowserAPIs</code> that returns everything.</li>
<li><strong>Flexible return values</strong>: Return an object (<code>{ data, loading, error }</code>) or an array (<code>[value, setValue]</code>) depending on what's most ergonomic for the consumer. Arrays are great for hooks that mimic built-in ones like <code>useState</code>. Objects are better when you return many values and want them to be self-documenting.</li>
<li><strong>Parameterize them</strong>: Make your hooks configurable by accepting arguments, like the <code>url</code> in <code>useFetch</code>.</li>
</ul>
<h2 id="hook-composition-patterns">Hook Composition Patterns</h2>
<h2 id="learning-objective_10">Learning Objective</h2>
<p>Learn how to compose custom hooks by building more complex hooks that use other, simpler hooks, creating powerful and reusable logic.</p>
<h2 id="why-this-matters_10">Why This Matters</h2>
<p>The true power of custom hooks is unlocked when you start treating them as building blocks. Just as you compose simple components to build complex UIs, you can compose simple hooks to build complex logic. This pattern allows you to create layers of abstraction that make your application code incredibly clean and maintainable.</p>
<h2 id="discovery-phase-building-on-our-blocks">Discovery Phase: Building on Our Blocks</h2>
<p>In the last section, we created a <code>useWindowWidth</code> hook. Let's say we also have another common need: persisting a user's preference to local storage. We can create a <code>useLocalStorage</code> hook.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// Hook 1: A generic hook to sync state with localStorage</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useLocalStorage</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">initialValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">storedValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setStoredValue</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">initialValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">initialValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">setValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">valueToStore</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="nx">value</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Function</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">value</span><span class="p">(</span><span class="nx">storedValue</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">      </span><span class="nx">setStoredValue</span><span class="p">(</span><span class="nx">valueToStore</span><span class="p">);</span>
<span class="w">      </span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">valueToStore</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">storedValue</span><span class="p">,</span><span class="w"> </span><span class="nx">setValue</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Hook 2: Our hook from the previous section</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useWindowWidth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleResize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setWidth</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleResize</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">width</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A component using one of our hooks</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">UserPreferences</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">theme</span><span class="p">,</span><span class="w"> </span><span class="nx">setTheme</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLocalStorage</span><span class="p">(</span><span class="s2">&quot;theme&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;light&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Current</span><span class="w"> </span><span class="nx">theme</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">theme</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTheme</span><span class="p">(</span><span class="s2">&quot;light&quot;</span><span class="p">)}&gt;</span><span class="nx">Light</span><span class="w"> </span><span class="nx">Mode</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTheme</span><span class="p">(</span><span class="s2">&quot;dark&quot;</span><span class="p">)}&gt;</span><span class="nx">Dark</span><span class="w"> </span><span class="nx">Mode</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">UserPreferences</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:
Click "Dark Mode". The theme changes. Now, refresh the page. The theme remains "dark" because it was saved to local storage.</p>
<p>We now have two useful, independent hooks: <code>useLocalStorage</code> and <code>useWindowWidth</code>.</p>
<h2 id="deep-dive-composing-hooks">Deep Dive: Composing Hooks</h2>
<p>Now, let's create a new, more powerful hook by composing the two we already have. Let's build <code>useResponsiveTheme</code>. The requirement is: the theme should be "dark" on large screens and "light" on small screens, but the user should also be able to override this preference and have it saved.</p>
<p>This new hook will <em>use</em> our other hooks.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="c1">// --- Assume useLocalStorage and useWindowWidth from previous example exist here ---</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useLocalStorage</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">initialValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="sr">/_ ... implementation ... _/</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useWindowWidth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="sr">/_ ... implementation ... _/</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Our new, composed hook</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useResponsiveTheme</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 1. Use our existing hooks to get the building blocks</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useWindowWidth</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">preferredTheme</span><span class="p">,</span><span class="w"> </span><span class="nx">setPreferredTheme</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useLocalStorage</span><span class="p">(</span><span class="s2">&quot;theme&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// 2. Derive state based on the output of our other hooks</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isDesktop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">768</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">defaultTheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isDesktop</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;dark&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;light&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// 3. The final theme is the user&#39;s preference, or the responsive default</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">preferredTheme</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">defaultTheme</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// 4. Return the theme and a way to set the preference</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">theme</span><span class="p">,</span><span class="w"> </span><span class="nx">setPreferredTheme</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// --- Our component is now incredibly simple ---</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">theme</span><span class="p">,</span><span class="w"> </span><span class="nx">setTheme</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useResponsiveTheme</span><span class="p">();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">appStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="nx">theme</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;dark&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;#282c34&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="nx">theme</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;dark&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;white&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;20px&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">minHeight</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;100vh&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">transition</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;all 0.3s&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">style</span><span class="o">=</span><span class="p">{</span><span class="nx">appStyle</span><span class="p">}&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Responsive</span><span class="w"> </span><span class="nx">Theming</span><span class="w"> </span><span class="nx">App</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Current</span><span class="w"> </span><span class="nx">theme</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">theme</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">Resize</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nb">window</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">buttons</span><span class="w"> </span><span class="nx">below</span><span class="p">.&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTheme</span><span class="p">(</span><span class="s2">&quot;light&quot;</span><span class="p">)}&gt;</span><span class="nb">Set</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Light</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTheme</span><span class="p">(</span><span class="s2">&quot;dark&quot;</span><span class="p">)}&gt;</span><span class="nb">Set</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Dark</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTheme</span><span class="p">(</span><span class="kc">null</span><span class="p">)}&gt;</span><span class="nx">Reset</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Auto</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>

<p><strong>Interactive Behavior</strong>:</p>
<ul>
<li>If your window is wide, the theme will default to "dark". If it's narrow, it defaults to "light".</li>
<li>Resizing the browser will automatically change the theme.</li>
<li>If you click "Set to Light", the theme will become "light" and stay that way even if you resize the window. Your preference is saved.</li>
<li>Clicking "Reset to Auto" clears your preference, and the theme becomes responsive again.</li>
</ul>
<h3 id="component-trace_6">Component Trace</h3>
<ol>
<li>The <code>App</code> component calls <code>useResponsiveTheme()</code>.</li>
<li>Inside <code>useResponsiveTheme</code>, it first calls <code>useWindowWidth()</code>. This hook sets up its own state and effect to track the window width.</li>
<li>Next, it calls <code>useLocalStorage('theme', null)</code>. This hook sets up its own state and logic to interact with local storage.</li>
<li>The rest of the logic in <code>useResponsiveTheme</code> simply uses the values returned by the other hooks (<code>width</code> and <code>preferredTheme</code>) to calculate the final <code>theme</code>.</li>
<li>It returns the final <code>theme</code> and the <code>setPreferredTheme</code> function to the <code>App</code> component.</li>
</ol>
<p>This is the beauty of composition. Our <code>App</code> component is completely unaware of <code>localStorage</code> or window resize events. It just asks for a responsive theme and gets it. All the complexity is neatly encapsulated within the <code>useResponsiveTheme</code> hook, which itself is built from smaller, single-purpose hooks.</p>
<h2 id="production-perspective_10">Production Perspective</h2>
<p>Hook composition is the cornerstone of modern React architecture.</p>
<p><strong>When professionals use this pattern</strong>:</p>
<ul>
<li><strong>Everywhere</strong>. It's the standard way to build abstractions.</li>
<li>To create application-specific hooks like <code>useCurrentUser</code>, which might compose <code>useContext</code> and <code>useFetch</code>.</li>
<li>To build form logic hooks like <code>useForm</code>, which will compose multiple <code>useState</code> or <code>useReducer</code> calls.</li>
<li>To create data-fetching hooks that also handle authentication, like <code>useAuthenticatedFetch</code>, which might compose <code>useAuth</code> and <code>useFetch</code>.</li>
</ul>
<p><strong>Benefits</strong>:</p>
<ul>
<li><strong>Separation of Concerns</strong>: Each hook handles one piece of logic. Components focus on rendering UI.</li>
<li><strong>Reusability</strong>: <code>useLocalStorage</code> can be used dozens of times throughout an application.</li>
<li><strong>Testability</strong>: Simple, pure hooks are easy to unit test in isolation.</li>
<li><strong>Readability</strong>: A component that uses <code>const { data, isLoading } = usePaginatedPosts('react');</code> is much easier to understand than a component filled with all the raw state and effects for pagination and fetching.</li>
</ul>
<p>This pattern allows you to build your own "language" for your application's logic, making development faster, safer, and more enjoyable.</p>
<h2 id="module-synthesis">Module Synthesis üìã</h2>
<h2 id="module-synthesis-advanced-hooks-and-the-use-api">Module Synthesis: Advanced Hooks and the <code>use</code> API</h2>
<p>This module marked a significant step up in our React journey, moving from the foundational hooks to the advanced patterns that power modern, complex applications. We've covered a wide spectrum of tools, from the revolutionary to the classic.</p>
<h3 id="key-takeaways">Key Takeaways</h3>
<ol>
<li>
<p><strong>The <code>use</code> Hook is a Game-Changer</strong>: React 19's <code>use</code> hook fundamentally alters how we interact with resources.</p>
<ul>
<li>It can read from <strong>Promises</strong>, turning asynchronous data fetching into code that looks synchronous and integrating seamlessly with <strong>Suspense</strong>.</li>
<li>It can read from <strong>Context</strong>, and crucially, it can do so <strong>conditionally</strong>, unlocking more efficient and flexible component designs.</li>
</ul>
</li>
<li>
<p><strong>Classic Hooks Remain Essential</strong>:</p>
<ul>
<li><strong><code>useContext</code></strong>: The standard for unconditional consumption of shared, global data.</li>
<li><strong><code>useReducer</code></strong>: The tool of choice for managing complex, related state, promoting predictable state transitions by centralizing logic in a reducer function.</li>
<li><strong><code>useRef</code></strong>: Our "escape hatch" for imperative needs, allowing us to access DOM nodes directly and to maintain mutable values without triggering re-renders.</li>
</ul>
</li>
<li>
<p><strong>Manual Optimization is Becoming History</strong>:</p>
<ul>
<li>We learned about <code>useCallback</code> and <code>useMemo</code> as tools to manually optimize performance by memoizing functions and values.</li>
<li>Crucially, we framed these in the context of the new <strong>React 19 Compiler</strong>, which aims to make these manual optimizations unnecessary in most cases. Understanding them is key to grasping the problems the compiler solves automatically.</li>
</ul>
</li>
<li>
<p><strong>Custom Hooks are the Core of Modern React Architecture</strong>:</p>
<ul>
<li>The most important pattern we learned is the ability to create our own hooks to <strong>extract and reuse stateful logic</strong>.</li>
<li>We saw how to <strong>compose hooks</strong>, building powerful, high-level hooks from simpler, single-purpose ones. This is the primary way to build clean, maintainable, and scalable React applications.</li>
</ul>
</li>
</ol>
<h3 id="looking-forward">Looking Forward</h3>
<p>You now have a powerful toolkit of hooks at your disposal. You understand not only how to manage state and effects, but how to structure and reuse logic in a clean, composable way. You've also had your first taste of React 19's biggest features, which simplify asynchronous code and component design.</p>
<p>In the next chapter, <strong>Chapter 7: React 19 Compiler and Automatic Optimization</strong>, we will dive deep into the magic that makes manual memoization with <code>useCallback</code> and <code>useMemo</code> a thing of the past. You'll learn how the compiler works, how to write compiler-friendly code, and how React is making high-performance applications the default, not the exception.</p>
        </div>
        <div class="footer">
            Generated on 2025-10-25 16:27:47 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>